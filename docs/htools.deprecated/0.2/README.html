<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.7: http://docutils.sourceforge.net/" />
<title>Ganeti Cluster tools (ganeti-htools)</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 6253 2010-03-02 00:24:53Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: left }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="ganeti-cluster-tools-ganeti-htools">
<h1 class="title">Ganeti Cluster tools (ganeti-htools)</h1>

<p>These are some simple cluster tools for fixing common allocation
problems on Ganeti 2.0 clusters.</p>
<p>Note that these tools are most useful for bigger cluster sizes
(e.g. more than five or ten machines); at lower sizes, the computations
they do can also be done manually.</p>
<p>Most of the tools revolve around the concept of keeping the cluster N+1
compliant: this means that in case of failure of any node, the instances
affected can be failed over (via <tt class="docutils literal"><span class="pre">gnt-node</span> failover</tt> or <tt class="docutils literal"><span class="pre">gnt-instance</span>
failover</tt>) to their secondary node, and there is enough memory reserved
for this operation without needing to shutdown other instances or
rebalance the cluster.</p>
<p><strong>Quick start</strong> (see the installation section for more details):</p>
<ul class="simple">
<li>(have the ghc compiler and the prerequisite libraries installed)</li>
<li>make</li>
<li>./hbal -m $cluster -C -p</li>
<li>look at the original and final cluster layout, and if acceptable,
execute the given commands</li>
</ul>
<div class="section" id="available-tools">
<h1>Available tools</h1>
<div class="section" id="cluster-rebalancer">
<h2>Cluster rebalancer</h2>
<p>The rebalancer uses a simple algorithm to try to get the nodes of the
cluster as equal as possible in their resource usage. It tries to
repeatedly move each instance one step, so that the cluster score
becomes better. We stop when no further move can improve the score.</p>
<p>For algorithm details and usage, see the man page hbal(1).</p>
</div>
<div class="section" id="iallocator-plugin">
<h2>IAllocator plugin</h2>
<p>The <tt class="docutils literal">hail</tt> iallocator plugin can be used for allocations of mirrored
and non-mirrored instances and for relocations of mirrored instances. It
needs to be installed in Ganeti's iallocator search pathâ€”usually
<tt class="docutils literal">/usr/lib/ganeti/iallocators</tt> or
<tt class="docutils literal">/usr/local/lib/ganeti/iallocators</tt>, and after that it can be used via
ganeti's <tt class="docutils literal"><span class="pre">--iallocator</span></tt> option (in various gnt-node/gnt-instance
commands). See the man page hail(1) for more details.</p>
</div>
<div class="section" id="cluster-capacity-estimator">
<h2>Cluster capacity estimator</h2>
<p>The <tt class="docutils literal">hspace</tt> program will, given an input instance specification,
estimate how many instances of those type can be place on the cluster
before it will become full (as in any new allocation would fail N+1
checks). For more details, see the man page hspace(1).</p>
</div>
</div>
<div class="section" id="integration-with-ganeti">
<h1>Integration with Ganeti</h1>
<p>The <tt class="docutils literal">hbal</tt> and <tt class="docutils literal">hspace</tt> programs can either get their input from
text files, locally from the master daemon (when run on the master node
of a cluster), or remote from a cluster via RAPI. The &quot;-L&quot; argument
enables local collection (with an optional path to the unix socket). For
online collection via RAPI, the &quot;-m&quot; argument should specify the cluster
or master node name. Only <tt class="docutils literal">hbal</tt> and <tt class="docutils literal">hspace</tt> use these arguments,
<tt class="docutils literal">hail</tt> uses the standard iallocator API and thus doesn't need any
special setup (just needs to be installed in the right directory).</p>
<p>For generating the text files, a separate tool (<tt class="docutils literal">hscan</tt>) is provided
to automate their gathering if RAPI is available, which is better since
it can extract more precise information. In case RAPI is not usable for
whatever reason, <tt class="docutils literal"><span class="pre">gnt-node</span> list</tt> and <tt class="docutils literal"><span class="pre">gnt-instance</span> list</tt> could be
used, and their output concatenated in a single file, separated by one
blank line. If you need to do this manually, you'll need to check the
sources to see which fields are needed exactly.</p>
<p>The <tt class="docutils literal">hail</tt> program gets its data automatically from Ganeti when used
as described in its section.</p>
</div>
<div class="section" id="installation">
<h1>Installation</h1>
<p>If installing from source, you need a working ghc compiler (6.8 at
least) and some extra Haskell libraries which usually need to be
installed manually:</p>
<ul class="simple">
<li>json (<a class="reference external" href="http://hackage.haskell.org/package/json">http://hackage.haskell.org/package/json</a>)</li>
<li>curl (<a class="reference external" href="http://hackage.haskell.org/package/curl">http://hackage.haskell.org/package/curl</a>)</li>
<li>network (<a class="reference external" href="http://hackage.haskell.org/package/network">http://hackage.haskell.org/package/network</a>)</li>
</ul>
<p>Once these are installed, just typing <em>make</em> in the top-level directory
should be enough.</p>
<p>Only the <tt class="docutils literal">hail</tt> program needs to be installed in a specific place, the
other tools are not location-dependent.</p>
<p>For running the (admittedly small) unittest suite (via <em>make check</em>),
the QuickCheck version 1 library is needed.</p>
<p>Internal (implementation) documentation is available in the <tt class="docutils literal">apidoc</tt>
directory.</p>
<!-- vim: set textwidth=72 : -->
<!-- Local Variables: -->
<!-- mode: rst -->
<!-- fill-column: 72 -->
<!-- End: -->
</div>
</div>
</body>
</html>
