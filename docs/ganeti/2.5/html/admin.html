<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Ganeti administrator’s guide &mdash; Ganeti v2.5.2 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '2.5.2',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Ganeti v2.5.2 documentation" href="index.html" />
    <link rel="next" title="Ganeti walk-through" href="walkthrough.html" />
    <link rel="prev" title="Upgrade notes" href="upgrade.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="walkthrough.html" title="Ganeti walk-through"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="upgrade.html" title="Upgrade notes"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Ganeti v2.5.2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="ganeti-administrator-s-guide">
<h1><a class="toc-backref" href="#id2">Ganeti administrator&#8217;s guide</a><a class="headerlink" href="#ganeti-administrator-s-guide" title="Permalink to this headline">¶</a></h1>
<p>Documents Ganeti version 2.5</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#ganeti-administrator-s-guide" id="id2">Ganeti administrator&#8217;s guide</a><ul>
<li><a class="reference internal" href="#introduction" id="id3">Introduction</a><ul>
<li><a class="reference internal" href="#ganeti-terminology" id="id4">Ganeti terminology</a><ul>
<li><a class="reference internal" href="#cluster" id="id5">Cluster</a></li>
<li><a class="reference internal" href="#node" id="id6">Node</a></li>
<li><a class="reference internal" href="#instance" id="id7">Instance</a></li>
<li><a class="reference internal" href="#disk-template" id="id8">Disk template</a></li>
<li><a class="reference internal" href="#iallocator" id="id9">IAllocator</a></li>
<li><a class="reference internal" href="#primary-and-secondary-concepts" id="id10">“Primary” and “secondary” concepts</a></li>
<li><a class="reference internal" href="#tags" id="id11">Tags</a></li>
<li><a class="reference internal" href="#jobs-and-opcodes" id="id12">Jobs and OpCodes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#prerequisites" id="id13">Prerequisites</a></li>
</ul>
</li>
<li><a class="reference internal" href="#instance-management" id="id14">Instance management</a><ul>
<li><a class="reference internal" href="#adding-an-instance" id="id15">Adding an instance</a></li>
<li><a class="reference internal" href="#regular-instance-operations" id="id16">Regular instance operations</a><ul>
<li><a class="reference internal" href="#removal" id="id17">Removal</a></li>
<li><a class="reference internal" href="#startup-shutdown" id="id18">Startup/shutdown</a></li>
<li><a class="reference internal" href="#querying-instances" id="id19">Querying instances</a></li>
</ul>
</li>
<li><a class="reference internal" href="#export-import" id="id20">Export/Import</a></li>
<li><a class="reference internal" href="#import-of-foreign-instances" id="id21">Import of foreign instances</a></li>
<li><a class="reference internal" href="#instance-kernel-selection" id="id22">Instance kernel selection</a><ul>
<li><a class="reference internal" href="#xen-pvm" id="id23">Xen-PVM</a></li>
<li><a class="reference internal" href="#kvm" id="id24">KVM</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#instance-ha-features" id="id25">Instance HA features</a><ul>
<li><a class="reference internal" href="#changing-the-primary-node" id="id26">Changing the primary node</a><ul>
<li><a class="reference internal" href="#failing-over-an-instance" id="id27">Failing over an instance</a></li>
<li><a class="reference internal" href="#live-migrating-an-instance" id="id28">Live migrating an instance</a></li>
<li><a class="reference internal" href="#moving-an-instance-offline" id="id29">Moving an instance (offline)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#disk-operations" id="id30">Disk operations</a><ul>
<li><a class="reference internal" href="#preparing-for-disk-operations" id="id31">Preparing for disk operations</a></li>
<li><a class="reference internal" href="#restoring-redundancy-for-drbd-based-instances" id="id32">Restoring redundancy for DRBD-based instances</a></li>
<li><a class="reference internal" href="#re-creating-disks-for-non-redundant-instances" id="id33">Re-creating disks for non-redundant instances</a></li>
<li><a class="reference internal" href="#conversion-of-an-instance-s-disk-type" id="id34">Conversion of an instance&#8217;s disk type</a></li>
</ul>
</li>
<li><a class="reference internal" href="#debugging-instances" id="id35">Debugging instances</a><ul>
<li><a class="reference internal" href="#accessing-an-instance-s-disks" id="id36">Accessing an instance&#8217;s disks</a></li>
<li><a class="reference internal" href="#accessing-an-instance-s-console" id="id37">Accessing an instance&#8217;s console</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-instance-operations" id="id38">Other instance operations</a><ul>
<li><a class="reference internal" href="#reboot" id="id39">Reboot</a></li>
</ul>
</li>
<li><a class="reference internal" href="#instance-os-definitions-debugging" id="id40">Instance OS definitions debugging</a><ul>
<li><a class="reference internal" href="#instance-relocation" id="id41">Instance relocation</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#node-operations" id="id42">Node operations</a><ul>
<li><a class="reference internal" href="#add-readd" id="id43">Add/readd</a></li>
<li><a class="reference internal" href="#changing-the-node-role" id="id44">Changing the node role</a><ul>
<li><a class="reference internal" href="#failing-over-the-master-node" id="id45">Failing over the master node</a></li>
<li><a class="reference internal" href="#changing-between-the-other-roles" id="id46">Changing between the other roles</a></li>
</ul>
</li>
<li><a class="reference internal" href="#evacuating-nodes" id="id47">Evacuating nodes</a><ul>
<li><a class="reference internal" href="#primary-instance-conversion" id="id48">Primary instance conversion</a></li>
<li><a class="reference internal" href="#secondary-instance-evacuation" id="id49">Secondary instance evacuation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id1" id="id50">Removal</a></li>
<li><a class="reference internal" href="#storage-handling" id="id51">Storage handling</a><ul>
<li><a class="reference internal" href="#logical-volumes" id="id52">Logical volumes</a></li>
<li><a class="reference internal" href="#generalized-storage-handling" id="id53">Generalized storage handling</a></li>
<li><a class="reference internal" href="#use-of-the-storage-commands" id="id54">Use of the storage commands</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#cluster-operations" id="id55">Cluster operations</a><ul>
<li><a class="reference internal" href="#standard-operations" id="id56">Standard operations</a></li>
<li><a class="reference internal" href="#global-node-commands" id="id57">Global node commands</a></li>
<li><a class="reference internal" href="#cluster-verification" id="id58">Cluster verification</a></li>
<li><a class="reference internal" href="#configuration-redistribution" id="id59">Configuration redistribution</a></li>
<li><a class="reference internal" href="#cluster-renaming" id="id60">Cluster renaming</a></li>
<li><a class="reference internal" href="#queue-operations" id="id61">Queue operations</a></li>
<li><a class="reference internal" href="#watcher-control" id="id62">Watcher control</a></li>
<li><a class="reference internal" href="#node-auto-maintenance" id="id63">Node auto-maintenance</a></li>
<li><a class="reference internal" href="#removing-a-cluster-entirely" id="id64">Removing a cluster entirely</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tags-handling" id="id65">Tags handling</a><ul>
<li><a class="reference internal" href="#limitations" id="id66">Limitations</a></li>
<li><a class="reference internal" href="#operations" id="id67">Operations</a></li>
<li><a class="reference internal" href="#global-tag-search" id="id68">Global tag search</a></li>
</ul>
</li>
<li><a class="reference internal" href="#job-operations" id="id69">Job operations</a></li>
<li><a class="reference internal" href="#special-ganeti-deployments" id="id70">Special Ganeti deployments</a><ul>
<li><a class="reference internal" href="#running-ganeti-under-ganeti" id="id71">Running Ganeti under Ganeti</a></li>
<li><a class="reference internal" href="#multi-site-model" id="id72">Multi-site model</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ganeti-tools" id="id73">Ganeti tools</a><ul>
<li><a class="reference internal" href="#lvmstrap" id="id74">lvmstrap</a></li>
<li><a class="reference internal" href="#cfgupgrade" id="id75">cfgupgrade</a></li>
<li><a class="reference internal" href="#cfgshell" id="id76">cfgshell</a></li>
<li><a class="reference internal" href="#burnin" id="id77">burnin</a></li>
<li><a class="reference internal" href="#sanitize-config" id="id78">sanitize-config</a></li>
<li><a class="reference internal" href="#move-instance" id="id79">move-instance</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-ganeti-projects" id="id80">Other Ganeti projects</a><ul>
<li><a class="reference internal" href="#nbma-tools" id="id81">NBMA tools</a></li>
<li><a class="reference internal" href="#ganeti-htools" id="id82">ganeti-htools</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id3">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Ganeti is a virtualization cluster management software. You are expected
to be a system administrator familiar with your Linux distribution and
the Xen or KVM virtualization environments before using it.</p>
<p>The various components of Ganeti all have man pages and interactive
help. This manual though will help you getting familiar with the system
by explaining the most common operations, grouped by related use.</p>
<p>After a terminology glossary and a section on the prerequisites needed
to use this manual, the rest of this document is divided in sections
for the different targets that a command affects: instance, nodes, etc.</p>
<div class="section" id="ganeti-terminology">
<span id="terminology-label"></span><h3><a class="toc-backref" href="#id4">Ganeti terminology</a><a class="headerlink" href="#ganeti-terminology" title="Permalink to this headline">¶</a></h3>
<p>This section provides a small introduction to Ganeti terminology, which
might be useful when reading the rest of the document.</p>
<div class="section" id="cluster">
<h4><a class="toc-backref" href="#id5">Cluster</a><a class="headerlink" href="#cluster" title="Permalink to this headline">¶</a></h4>
<p>A set of machines (nodes) that cooperate to offer a coherent, highly
available virtualization service under a single administration domain.</p>
</div>
<div class="section" id="node">
<h4><a class="toc-backref" href="#id6">Node</a><a class="headerlink" href="#node" title="Permalink to this headline">¶</a></h4>
<p>A physical machine which is member of a cluster.  Nodes are the basic
cluster infrastructure, and they don&#8217;t need to be fault tolerant in
order to achieve high availability for instances.</p>
<p>Node can be added and removed (if they host no instances) at will from
the cluster. In a HA cluster and only with HA instances, the loss of any
single node will not cause disk data loss for any instance; of course,
a node crash will cause the crash of the its primary instances.</p>
<p>A node belonging to a cluster can be in one of the following roles at a
given time:</p>
<ul class="simple">
<li><em>master</em> node, which is the node from which the cluster is controlled</li>
<li><em>master candidate</em> node, only nodes in this role have the full cluster
configuration and knowledge, and only master candidates can become the
master node</li>
<li><em>regular</em> node, which is the state in which most nodes will be on
bigger clusters (&gt;20 nodes)</li>
<li><em>drained</em> node, nodes in this state are functioning normally but the
cannot receive new instances; the intention is that nodes in this role
have some issue and they are being evacuated for hardware repairs</li>
<li><em>offline</em> node, in which there is a record in the cluster
configuration about the node, but the daemons on the master node will
not talk to this node; any instances declared as having an offline
node as either primary or secondary will be flagged as an error in the
cluster verify operation</li>
</ul>
<p>Depending on the role, each node will run a set of daemons:</p>
<ul class="simple">
<li>the <strong>ganeti-noded</strong> daemon, which control the manipulation of
this node&#8217;s hardware resources; it runs on all nodes which are in a
cluster</li>
<li>the <strong>ganeti-confd</strong> daemon (Ganeti 2.1+) which runs on all
nodes, but is only functional on master candidate nodes</li>
<li>the <strong>ganeti-rapi</strong> daemon which runs on the master node and
offers an HTTP-based API for the cluster</li>
<li>the <strong>ganeti-masterd</strong> daemon which runs on the master node and
allows control of the cluster</li>
</ul>
<p>Beside the node role, there are other node flags that influence its
behaviour:</p>
<ul class="simple">
<li>the <em>master_capable</em> flag denotes whether the node can ever become a
master candidate; setting this to &#8216;no&#8217; means that auto-promotion will
never make this node a master candidate; this flag can be useful for a
remote node that only runs local instances, and having it become a
master is impractical due to networking or other constraints</li>
<li>the <em>vm_capable</em> flag denotes whether the node can host instances or
not; for example, one might use a non-vm_capable node just as a master
candidate, for configuration backups; setting this flag to no
disallows placement of instances of this node, deactivates hypervisor
and related checks on it (e.g. bridge checks, LVM check, etc.), and
removes it from cluster capacity computations</li>
</ul>
</div>
<div class="section" id="instance">
<h4><a class="toc-backref" href="#id7">Instance</a><a class="headerlink" href="#instance" title="Permalink to this headline">¶</a></h4>
<p>A virtual machine which runs on a cluster. It can be a fault tolerant,
highly available entity.</p>
<p>An instance has various parameters, which are classified in three
categories: hypervisor related-parameters (called <tt class="docutils literal"><span class="pre">hvparams</span></tt>), general
parameters (called <tt class="docutils literal"><span class="pre">beparams</span></tt>) and per network-card parameters (called
<tt class="docutils literal"><span class="pre">nicparams</span></tt>). All these parameters can be modified either at instance
level or via defaults at cluster level.</p>
</div>
<div class="section" id="disk-template">
<h4><a class="toc-backref" href="#id8">Disk template</a><a class="headerlink" href="#disk-template" title="Permalink to this headline">¶</a></h4>
<p>The are multiple options for the storage provided to an instance; while
the instance sees the same virtual drive in all cases, the node-level
configuration varies between them.</p>
<p>There are four disk templates you can choose from:</p>
<dl class="docutils">
<dt>diskless</dt>
<dd>The instance has no disks. Only used for special purpose operating
systems or for testing.</dd>
<dt>file</dt>
<dd>The instance will use plain files as backend for its disks. No
redundancy is provided, and this is somewhat more difficult to
configure for high performance.</dd>
<dt>plain</dt>
<dd>The instance will use LVM devices as backend for its disks. No
redundancy is provided.</dd>
<dt>drbd</dt>
<dd><div class="first admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is only valid for multi-node clusters using DRBD 8.0+</p>
</div>
<p class="last">A mirror is set between the local node and a remote one, which must be
specified with the second value of the &#8211;node option. Use this option
to obtain a highly available instance that can be failed over to a
remote node should the primary one fail.</p>
</dd>
</dl>
</div>
<div class="section" id="iallocator">
<h4><a class="toc-backref" href="#id9">IAllocator</a><a class="headerlink" href="#iallocator" title="Permalink to this headline">¶</a></h4>
<p>A framework for using external (user-provided) scripts to compute the
placement of instances on the cluster nodes. This eliminates the need to
manually specify nodes in instance add, instance moves, node evacuate,
etc.</p>
<p>In order for Ganeti to be able to use these scripts, they must be place
in the iallocator directory (usually <tt class="docutils literal"><span class="pre">lib/ganeti/iallocators</span></tt> under
the installation prefix, e.g. <tt class="docutils literal"><span class="pre">/usr/local</span></tt>).</p>
</div>
<div class="section" id="primary-and-secondary-concepts">
<h4><a class="toc-backref" href="#id10">“Primary” and “secondary” concepts</a><a class="headerlink" href="#primary-and-secondary-concepts" title="Permalink to this headline">¶</a></h4>
<p>An instance has a primary and depending on the disk configuration, might
also have a secondary node. The instance always runs on the primary node
and only uses its secondary node for disk replication.</p>
<p>Similarly, the term of primary and secondary instances when talking
about a node refers to the set of instances having the given node as
primary, respectively secondary.</p>
</div>
<div class="section" id="tags">
<h4><a class="toc-backref" href="#id11">Tags</a><a class="headerlink" href="#tags" title="Permalink to this headline">¶</a></h4>
<p>Tags are short strings that can be attached to either to cluster itself,
or to nodes or instances. They are useful as a very simplistic
information store for helping with cluster administration, for example
by attaching owner information to each instance after it&#8217;s created:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-instance add … instance1
gnt-instance add-tags instance1 owner:user2
</pre></div>
</div>
<p>And then by listing each instance and its tags, this information could
be used for contacting the users of each instance.</p>
</div>
<div class="section" id="jobs-and-opcodes">
<h4><a class="toc-backref" href="#id12">Jobs and OpCodes</a><a class="headerlink" href="#jobs-and-opcodes" title="Permalink to this headline">¶</a></h4>
<p>While not directly visible by an end-user, it&#8217;s useful to know that a
basic cluster operation (e.g. starting an instance) is represented
internall by Ganeti as an <em>OpCode</em> (abbreviation from operation
code). These OpCodes are executed as part of a <em>Job</em>. The OpCodes in a
single Job are processed serially by Ganeti, but different Jobs will be
processed (depending on resource availability) in parallel. They will
not be executed in the submission order, but depending on resource
availability, locks and (starting with Ganeti 2.3) priority. An earlier
job may have to wait for a lock while a newer job doesn&#8217;t need any locks
and can be executed right away. Operations requiring a certain order
need to be submitted as a single job, or the client must submit one job
at a time and wait for it to finish before continuing.</p>
<p>For example, shutting down the entire cluster can be done by running the
command <tt class="docutils literal"><span class="pre">gnt-instance</span> <span class="pre">shutdown</span> <span class="pre">--all</span></tt>, which will submit for each
instance a separate job containing the “shutdown instance” OpCode.</p>
</div>
</div>
<div class="section" id="prerequisites">
<h3><a class="toc-backref" href="#id13">Prerequisites</a><a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h3>
<p>You need to have your Ganeti cluster installed and configured before you
try any of the commands in this document. Please follow the
<a class="reference external" href="install.html"><em>Ganeti installation tutorial</em></a> for instructions on how to do that.</p>
</div>
</div>
<div class="section" id="instance-management">
<h2><a class="toc-backref" href="#id14">Instance management</a><a class="headerlink" href="#instance-management" title="Permalink to this headline">¶</a></h2>
<div class="section" id="adding-an-instance">
<h3><a class="toc-backref" href="#id15">Adding an instance</a><a class="headerlink" href="#adding-an-instance" title="Permalink to this headline">¶</a></h3>
<p>The add operation might seem complex due to the many parameters it
accepts, but once you have understood the (few) required parameters and
the customisation capabilities you will see it is an easy operation.</p>
<p>The add operation requires at minimum five parameters:</p>
<ul class="simple">
<li>the OS for the instance</li>
<li>the disk template</li>
<li>the disk count and size</li>
<li>the node specification or alternatively the iallocator to use</li>
<li>and finally the instance name</li>
</ul>
<p>The OS for the instance must be visible in the output of the command
<tt class="docutils literal"><span class="pre">gnt-os</span> <span class="pre">list</span></tt> and specifies which guest OS to install on the instance.</p>
<p>The disk template specifies what kind of storage to use as backend for
the (virtual) disks presented to the instance; note that for instances
with multiple virtual disks, they all must be of the same type.</p>
<p>The node(s) on which the instance will run can be given either manually,
via the <tt class="docutils literal"><span class="pre">-n</span></tt> option, or computed automatically by Ganeti, if you have
installed any iallocator script.</p>
<p>With the above parameters in mind, the command is:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-instance add \
  -n TARGET_NODE:SECONDARY_NODE \
  -o OS_TYPE \
  -t DISK_TEMPLATE -s DISK_SIZE \
  INSTANCE_NAME
</pre></div>
</div>
<p>The instance name must be resolvable (e.g. exist in DNS) and usually
points to an address in the same subnet as the cluster itself.</p>
<p>The above command has the minimum required options; other options you
can give include, among others:</p>
<ul class="simple">
<li>The memory size (<tt class="docutils literal"><span class="pre">-B</span> <span class="pre">memory</span></tt>)</li>
<li>The number of virtual CPUs (<tt class="docutils literal"><span class="pre">-B</span> <span class="pre">vcpus</span></tt>)</li>
<li>Arguments for the NICs of the instance; by default, a single-NIC
instance is created. The IP and/or bridge of the NIC can be changed
via <tt class="docutils literal"><span class="pre">--nic</span> <span class="pre">0:ip=IP,bridge=BRIDGE</span></tt></li>
</ul>
<p>See the manpage for gnt-instance for the detailed option list.</p>
<p>For example if you want to create an highly available instance, with a
single disk of 50GB and the default memory size, having primary node
<tt class="docutils literal"><span class="pre">node1</span></tt> and secondary node <tt class="docutils literal"><span class="pre">node3</span></tt>, use the following command:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-instance add -n node1:node3 -o debootstrap -t drbd \
  instance1
</pre></div>
</div>
<p>There is a also a command for batch instance creation from a
specification file, see the <tt class="docutils literal"><span class="pre">batch-create</span></tt> operation in the
gnt-instance manual page.</p>
</div>
<div class="section" id="regular-instance-operations">
<h3><a class="toc-backref" href="#id16">Regular instance operations</a><a class="headerlink" href="#regular-instance-operations" title="Permalink to this headline">¶</a></h3>
<div class="section" id="removal">
<h4><a class="toc-backref" href="#id17">Removal</a><a class="headerlink" href="#removal" title="Permalink to this headline">¶</a></h4>
<p>Removing an instance is even easier than creating one. This operation is
irreversible and destroys all the contents of your instance. Use with
care:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-instance remove INSTANCE_NAME
</pre></div>
</div>
</div>
<div class="section" id="startup-shutdown">
<h4><a class="toc-backref" href="#id18">Startup/shutdown</a><a class="headerlink" href="#startup-shutdown" title="Permalink to this headline">¶</a></h4>
<p>Instances are automatically started at instance creation time. To
manually start one which is currently stopped you can run:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-instance startup INSTANCE_NAME
</pre></div>
</div>
<p>While the command to stop one is:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-instance shutdown INSTANCE_NAME
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not use the Xen or KVM commands directly to stop
instances. If you run for example <tt class="docutils literal"><span class="pre">xm</span> <span class="pre">shutdown</span></tt> or <tt class="docutils literal"><span class="pre">xm</span> <span class="pre">destroy</span></tt>
on an instance Ganeti will automatically restart it (via
the <strong>ganeti-watcher</strong> command which is launched via cron).</p>
</div>
</div>
<div class="section" id="querying-instances">
<h4><a class="toc-backref" href="#id19">Querying instances</a><a class="headerlink" href="#querying-instances" title="Permalink to this headline">¶</a></h4>
<p>There are two ways to get information about instances: listing
instances, which does a tabular output containing a given set of fields
about each instance, and querying detailed information about a set of
instances.</p>
<p>The command to see all the instances configured and their status is:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-instance list
</pre></div>
</div>
<p>The command can return a custom set of information when using the <tt class="docutils literal"><span class="pre">-o</span></tt>
option (as always, check the manpage for a detailed specification). Each
instance will be represented on a line, thus making it easy to parse
this output via the usual shell utilities (grep, sed, etc.).</p>
<p>To get more detailed information about an instance, you can run:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-instance info INSTANCE
</pre></div>
</div>
<p>which will give a multi-line block of information about the instance,
it&#8217;s hardware resources (especially its disks and their redundancy
status), etc. This is harder to parse and is more expensive than the
list operation, but returns much more detailed information.</p>
</div>
</div>
<div class="section" id="export-import">
<h3><a class="toc-backref" href="#id20">Export/Import</a><a class="headerlink" href="#export-import" title="Permalink to this headline">¶</a></h3>
<p>You can create a snapshot of an instance disk and its Ganeti
configuration, which then you can backup, or import into another
cluster. The way to export an instance is:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-backup export -n TARGET_NODE INSTANCE_NAME
</pre></div>
</div>
<p>The target node can be any node in the cluster with enough space under
<tt class="docutils literal"><span class="pre">/srv/ganeti</span></tt> to hold the instance image. Use the <tt class="docutils literal"><span class="pre">--noshutdown</span></tt>
option to snapshot an instance without rebooting it. Note that Ganeti
only keeps one snapshot for an instance - any previous snapshot of the
same instance existing cluster-wide under <tt class="docutils literal"><span class="pre">/srv/ganeti</span></tt> will be
removed by this operation: if you want to keep them, you need to move
them out of the Ganeti exports directory.</p>
<p>Importing an instance is similar to creating a new one, but additionally
one must specify the location of the snapshot. The command is:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-backup import -n TARGET_NODE \
  --src-node=NODE --src-dir=DIR INSTANCE_NAME
</pre></div>
</div>
<p>By default, parameters will be read from the export information, but you
can of course pass them in via the command line - most of the options
available for the command <strong>gnt-instance add</strong> are supported here
too.</p>
</div>
<div class="section" id="import-of-foreign-instances">
<h3><a class="toc-backref" href="#id21">Import of foreign instances</a><a class="headerlink" href="#import-of-foreign-instances" title="Permalink to this headline">¶</a></h3>
<p>There is a possibility to import a foreign instance whose disk data is
already stored as LVM volumes without going through copying it: the disk
adoption mode.</p>
<p>For this, ensure that the original, non-managed instance is stopped,
then create a Ganeti instance in the usual way, except that instead of
passing the disk information you specify the current volumes:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-instance add -t plain -n HOME_NODE ... \
  --disk 0:adopt=lv_name[,vg=vg_name] INSTANCE_NAME
</pre></div>
</div>
<p>This will take over the given logical volumes, rename them to the Ganeti
standard (UUID-based), and without installing the OS on them start
directly the instance. If you configure the hypervisor similar to the
non-managed configuration that the instance had, the transition should
be seamless for the instance. For more than one disk, just pass another
disk parameter (e.g. <tt class="docutils literal"><span class="pre">--disk</span> <span class="pre">1:adopt=...</span></tt>).</p>
</div>
<div class="section" id="instance-kernel-selection">
<h3><a class="toc-backref" href="#id22">Instance kernel selection</a><a class="headerlink" href="#instance-kernel-selection" title="Permalink to this headline">¶</a></h3>
<p>The kernel that instances uses to bootup can come either from the node,
or from instances themselves, depending on the setup.</p>
<div class="section" id="xen-pvm">
<h4><a class="toc-backref" href="#id23">Xen-PVM</a><a class="headerlink" href="#xen-pvm" title="Permalink to this headline">¶</a></h4>
<p>With Xen PVM, there are three options.</p>
<p>First, you can use a kernel from the node, by setting the hypervisor
parameters as such:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">kernel_path</span></tt> to a valid file on the node (and appropriately
<tt class="docutils literal"><span class="pre">initrd_path</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">kernel_args</span></tt> optionally set to a valid Linux setting (e.g. <tt class="docutils literal"><span class="pre">ro</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">root_path</span></tt> to a valid setting (e.g. <tt class="docutils literal"><span class="pre">/dev/xvda1</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">bootloader_path</span></tt> and <tt class="docutils literal"><span class="pre">bootloader_args</span></tt> to empty</li>
</ul>
<p>Alternatively, you can delegate the kernel management to instances, and
use either <tt class="docutils literal"><span class="pre">pvgrub</span></tt> or the deprecated <tt class="docutils literal"><span class="pre">pygrub</span></tt>. For this, you must
install the kernels and initrds in the instance and create a valid GRUB
v1 configuration file.</p>
<p>For <tt class="docutils literal"><span class="pre">pvgrub</span></tt> (new in version 2.4.2), you need to set:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">kernel_path</span></tt> to point to the <tt class="docutils literal"><span class="pre">pvgrub</span></tt> loader present on the node
(e.g. <tt class="docutils literal"><span class="pre">/usr/lib/xen/boot/pv-grub-x86_32.gz</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">kernel_args</span></tt> to the path to the GRUB config file, relative to the
instance (e.g. <tt class="docutils literal"><span class="pre">(hd0,0)/grub/menu.lst</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">root_path</span></tt> <strong>must</strong> be empty</li>
<li><tt class="docutils literal"><span class="pre">bootloader_path</span></tt> and <tt class="docutils literal"><span class="pre">bootloader_args</span></tt> to empty</li>
</ul>
<p>While <tt class="docutils literal"><span class="pre">pygrub</span></tt> is deprecated, here is how you can configure it:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">bootloader_path</span></tt> to the pygrub binary (e.g. <tt class="docutils literal"><span class="pre">/usr/bin/pygrub</span></tt>)</li>
<li>the other settings are not important</li>
</ul>
<p>More information can be found in the Xen wiki pages for <a class="reference external" href="http://wiki.xensource.com/xenwiki/PvGrub">pvgrub</a> and <a class="reference external" href="http://wiki.xensource.com/xenwiki/PyGrub">pygrub</a>.</p>
</div>
<div class="section" id="kvm">
<h4><a class="toc-backref" href="#id24">KVM</a><a class="headerlink" href="#kvm" title="Permalink to this headline">¶</a></h4>
<p>For KVM also the kernel can be loaded either way.</p>
<p>For loading the kernels from the node, you need to set:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">kernel_path</span></tt> to a valid value</li>
<li><tt class="docutils literal"><span class="pre">initrd_path</span></tt> optionally set if you use an initrd</li>
<li><tt class="docutils literal"><span class="pre">kernel_args</span></tt> optionally set to a valid value (e.g. <tt class="docutils literal"><span class="pre">ro</span></tt>)</li>
</ul>
<p>If you want instead to have the instance boot from its disk (and execute
its bootloader), simply set the <tt class="docutils literal"><span class="pre">kernel_path</span></tt> parameter to an empty
string, and all the others will be ignored.</p>
</div>
</div>
</div>
<div class="section" id="instance-ha-features">
<h2><a class="toc-backref" href="#id25">Instance HA features</a><a class="headerlink" href="#instance-ha-features" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section only applies to multi-node clusters</p>
</div>
<div class="section" id="changing-the-primary-node">
<span id="instance-change-primary-label"></span><h3><a class="toc-backref" href="#id26">Changing the primary node</a><a class="headerlink" href="#changing-the-primary-node" title="Permalink to this headline">¶</a></h3>
<p>There are three ways to exchange an instance&#8217;s primary and secondary
nodes; the right one to choose depends on how the instance has been
created and the status of its current primary node. See
<a class="reference internal" href="#rest-redundancy-label"><em>Restoring redundancy for DRBD-based instances</em></a> for information on changing the secondary
node. Note that it&#8217;s only possible to change the primary node to the
secondary and vice-versa; a direct change of the primary node with a
third node, while keeping the current secondary is not possible in a
single step, only via multiple operations as detailed in
<a class="reference internal" href="#instance-relocation-label"><em>Instance relocation</em></a>.</p>
<div class="section" id="failing-over-an-instance">
<h4><a class="toc-backref" href="#id27">Failing over an instance</a><a class="headerlink" href="#failing-over-an-instance" title="Permalink to this headline">¶</a></h4>
<p>If an instance is built in highly available mode you can at any time
fail it over to its secondary node, even if the primary has somehow
failed and it&#8217;s not up anymore. Doing it is really easy, on the master
node you can just run:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-instance failover INSTANCE_NAME
</pre></div>
</div>
<p>That&#8217;s it. After the command completes the secondary node is now the
primary, and vice-versa.</p>
</div>
<div class="section" id="live-migrating-an-instance">
<h4><a class="toc-backref" href="#id28">Live migrating an instance</a><a class="headerlink" href="#live-migrating-an-instance" title="Permalink to this headline">¶</a></h4>
<p>If an instance is built in highly available mode, it currently runs and
both its nodes are running fine, you can at migrate it over to its
secondary node, without downtime. On the master node you need to run:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-instance migrate INSTANCE_NAME
</pre></div>
</div>
<p>The current load on the instance and its memory size will influence how
long the migration will take. In any case, for both KVM and Xen
hypervisors, the migration will be transparent to the instance.</p>
</div>
<div class="section" id="moving-an-instance-offline">
<h4><a class="toc-backref" href="#id29">Moving an instance (offline)</a><a class="headerlink" href="#moving-an-instance-offline" title="Permalink to this headline">¶</a></h4>
<p>If an instance has not been create as mirrored, then the only way to
change its primary node is to execute the move command:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-instance move -n NEW_NODE INSTANCE
</pre></div>
</div>
<p>This has a few prerequisites:</p>
<ul class="simple">
<li>the instance must be stopped</li>
<li>its current primary node must be on-line and healthy</li>
<li>the disks of the instance must not have any errors</li>
</ul>
<p>Since this operation actually copies the data from the old node to the
new node, expect it to take proportional to the size of the instance&#8217;s
disks and the speed of both the nodes&#8217; I/O system and their networking.</p>
</div>
</div>
<div class="section" id="disk-operations">
<h3><a class="toc-backref" href="#id30">Disk operations</a><a class="headerlink" href="#disk-operations" title="Permalink to this headline">¶</a></h3>
<p>Disk failures are a common cause of errors in any server
deployment. Ganeti offers protection from single-node failure if your
instances were created in HA mode, and it also offers ways to restore
redundancy after a failure.</p>
<div class="section" id="preparing-for-disk-operations">
<h4><a class="toc-backref" href="#id31">Preparing for disk operations</a><a class="headerlink" href="#preparing-for-disk-operations" title="Permalink to this headline">¶</a></h4>
<p>It is important to note that for Ganeti to be able to do any disk
operation, the Linux machines on top of which Ganeti must be consistent;
for LVM, this means that the LVM commands must not return failures; it
is common that after a complete disk failure, any LVM command aborts
with an error similar to:</p>
<div class="highlight-text"><div class="highlight"><pre># vgs
/dev/sdb1: read failed after 0 of 4096 at 0: Input/output error
/dev/sdb1: read failed after 0 of 4096 at 750153695232: Input/output
error
/dev/sdb1: read failed after 0 of 4096 at 0: Input/output error
Couldn&#39;t find device with uuid
&#39;t30jmN-4Rcf-Fr5e-CURS-pawt-z0jU-m1TgeJ&#39;.
Couldn&#39;t find all physical volumes for volume group xenvg.
</pre></div>
</div>
<p>Before restoring an instance&#8217;s disks to healthy status, it&#8217;s needed to
fix the volume group used by Ganeti so that we can actually create and
manage the logical volumes. This is usually done in a multi-step
process:</p>
<ol class="arabic">
<li><p class="first">first, if the disk is completely gone and LVM commands exit with
“Couldn&#8217;t find device with uuid…” then you need to run the command:</p>
<div class="highlight-text"><div class="highlight"><pre>vgreduce --removemissing VOLUME_GROUP
</pre></div>
</div>
</li>
<li><p class="first">after the above command, the LVM commands should be executing
normally (warnings are normal, but the commands will not fail
completely).</p>
</li>
<li><p class="first">if the failed disk is still visible in the output of the <tt class="docutils literal"><span class="pre">pvs</span></tt>
command, you need to deactivate it from allocations by running:</p>
<div class="highlight-text"><div class="highlight"><pre>pvs -x n /dev/DISK
</pre></div>
</div>
</li>
</ol>
<p>At this point, the volume group should be consistent and any bad
physical volumes should not longer be available for allocation.</p>
<p>Note that since version 2.1 Ganeti provides some commands to automate
these two operations, see <a class="reference internal" href="#storage-units-label"><em>Generalized storage handling</em></a>.</p>
</div>
<div class="section" id="restoring-redundancy-for-drbd-based-instances">
<span id="rest-redundancy-label"></span><h4><a class="toc-backref" href="#id32">Restoring redundancy for DRBD-based instances</a><a class="headerlink" href="#restoring-redundancy-for-drbd-based-instances" title="Permalink to this headline">¶</a></h4>
<p>A DRBD instance has two nodes, and the storage on one of them has
failed. Depending on which node (primary or secondary) has failed, you
have three options at hand:</p>
<ul class="simple">
<li>if the storage on the primary node has failed, you need to re-create
the disks on it</li>
<li>if the storage on the secondary node has failed, you can either
re-create the disks on it or change the secondary and recreate
redundancy on the new secondary node</li>
</ul>
<p>Of course, at any point it&#8217;s possible to force re-creation of disks even
though everything is already fine.</p>
<p>For all three cases, the <tt class="docutils literal"><span class="pre">replace-disks</span></tt> operation can be used:</p>
<div class="highlight-text"><div class="highlight"><pre># re-create disks on the primary node
gnt-instance replace-disks -p INSTANCE_NAME
# re-create disks on the current secondary
gnt-instance replace-disks -s INSTANCE_NAME
# change the secondary node, via manual specification
gnt-instance replace-disks -n NODE INSTANCE_NAME
# change the secondary node, via an iallocator script
gnt-instance replace-disks -I SCRIPT INSTANCE_NAME
# since Ganeti 2.1: automatically fix the primary or secondary node
gnt-instance replace-disks -a INSTANCE_NAME
</pre></div>
</div>
<p>Since the process involves copying all data from the working node to the
target node, it will take a while, depending on the instance&#8217;s disk
size, node I/O system and network speed. But it is (baring any network
interruption) completely transparent for the instance.</p>
</div>
<div class="section" id="re-creating-disks-for-non-redundant-instances">
<h4><a class="toc-backref" href="#id33">Re-creating disks for non-redundant instances</a><a class="headerlink" href="#re-creating-disks-for-non-redundant-instances" title="Permalink to this headline">¶</a></h4>
<p>
<span class="versionmodified">New in version 2.1.</span></p>
<p>For non-redundant instances, there isn&#8217;t a copy (except backups) to
re-create the disks. But it&#8217;s possible to at-least re-create empty
disks, after which a reinstall can be run, via the <tt class="docutils literal"><span class="pre">recreate-disks</span></tt>
command:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-instance recreate-disks INSTANCE
</pre></div>
</div>
<p>Note that this will fail if the disks already exists.</p>
</div>
<div class="section" id="conversion-of-an-instance-s-disk-type">
<h4><a class="toc-backref" href="#id34">Conversion of an instance&#8217;s disk type</a><a class="headerlink" href="#conversion-of-an-instance-s-disk-type" title="Permalink to this headline">¶</a></h4>
<p>It is possible to convert between a non-redundant instance of type
<tt class="docutils literal"><span class="pre">plain</span></tt> (LVM storage) and redundant <tt class="docutils literal"><span class="pre">drbd</span></tt> via the <tt class="docutils literal"><span class="pre">gnt-instance</span>
<span class="pre">modify</span></tt> command:</p>
<div class="highlight-text"><div class="highlight"><pre># start with a non-redundant instance
gnt-instance add -t plain ... INSTANCE

# later convert it to redundant
gnt-instance stop INSTANCE
gnt-instance modify -t drbd -n NEW_SECONDARY INSTANCE
gnt-instance start INSTANCE

# and convert it back
gnt-instance stop INSTANCE
gnt-instance modify -t plain INSTANCE
gnt-instance start INSTANCE
</pre></div>
</div>
<p>The conversion must be done while the instance is stopped, and
converting from plain to drbd template presents a small risk, especially
if the instance has multiple disks and/or if one node fails during the
conversion procedure). As such, it&#8217;s recommended (as always) to make
sure that downtime for manual recovery is acceptable and that the
instance has up-to-date backups.</p>
</div>
</div>
<div class="section" id="debugging-instances">
<h3><a class="toc-backref" href="#id35">Debugging instances</a><a class="headerlink" href="#debugging-instances" title="Permalink to this headline">¶</a></h3>
<div class="section" id="accessing-an-instance-s-disks">
<h4><a class="toc-backref" href="#id36">Accessing an instance&#8217;s disks</a><a class="headerlink" href="#accessing-an-instance-s-disks" title="Permalink to this headline">¶</a></h4>
<p>From an instance&#8217;s primary node you can have access to its disks. Never
ever mount the underlying logical volume manually on a fault tolerant
instance, or will break replication and your data will be
inconsistent. The correct way to access an instance&#8217;s disks is to run
(on the master node, as usual) the command:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-instance activate-disks INSTANCE
</pre></div>
</div>
<p>And then, <em>on the primary node of the instance</em>, access the device that
gets created. For example, you could mount the given disks, then edit
files on the filesystem, etc.</p>
<p>Note that with partitioned disks (as opposed to whole-disk filesystems),
you will need to use a tool like <em>kpartx(8)</em>:</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-instance activate-disks instance1
…
node1# ssh node3
node3# kpartx -l /dev/…
node3# kpartx -a /dev/…
node3# mount /dev/mapper/… /mnt/
# edit files under mnt as desired
node3# umount /mnt/
node3# kpartx -d /dev/…
node3# exit
node1#
</pre></div>
</div>
<p>After you&#8217;ve finished you can deactivate them with the deactivate-disks
command, which works in the same way:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-instance deactivate-disks INSTANCE
</pre></div>
</div>
<p>Note that if any process started by you is still using the disks, the
above command will error out, and you <strong>must</strong> cleanup and ensure that
the above command runs successfully before you start the instance,
otherwise the instance will suffer corruption.</p>
</div>
<div class="section" id="accessing-an-instance-s-console">
<h4><a class="toc-backref" href="#id37">Accessing an instance&#8217;s console</a><a class="headerlink" href="#accessing-an-instance-s-console" title="Permalink to this headline">¶</a></h4>
<p>The command to access a running instance&#8217;s console is:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-instance console INSTANCE_NAME
</pre></div>
</div>
<p>Use the console normally and then type <tt class="docutils literal"><span class="pre">^]</span></tt> when done, to exit.</p>
</div>
</div>
<div class="section" id="other-instance-operations">
<h3><a class="toc-backref" href="#id38">Other instance operations</a><a class="headerlink" href="#other-instance-operations" title="Permalink to this headline">¶</a></h3>
<div class="section" id="reboot">
<h4><a class="toc-backref" href="#id39">Reboot</a><a class="headerlink" href="#reboot" title="Permalink to this headline">¶</a></h4>
<p>There is a wrapper command for rebooting instances:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-instance reboot instance2
</pre></div>
</div>
<p>By default, this does the equivalent of shutting down and then starting
the instance, but it accepts parameters to perform a soft-reboot (via
the hypervisor), a hard reboot (hypervisor shutdown and then startup) or
a full one (the default, which also de-configures and then configures
again the disks of the instance).</p>
</div>
</div>
<div class="section" id="instance-os-definitions-debugging">
<h3><a class="toc-backref" href="#id40">Instance OS definitions debugging</a><a class="headerlink" href="#instance-os-definitions-debugging" title="Permalink to this headline">¶</a></h3>
<p>Should you have any problems with instance operating systems the command
to see a complete status for all your nodes is:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-os diagnose
</pre></div>
</div>
<div class="section" id="instance-relocation">
<span id="instance-relocation-label"></span><h4><a class="toc-backref" href="#id41">Instance relocation</a><a class="headerlink" href="#instance-relocation" title="Permalink to this headline">¶</a></h4>
<p>While it is not possible to move an instance from nodes <tt class="docutils literal"><span class="pre">(A,</span> <span class="pre">B)</span></tt> to
nodes <tt class="docutils literal"><span class="pre">(C,</span> <span class="pre">D)</span></tt> in a single move, it is possible to do so in a few
steps:</p>
<div class="highlight-text"><div class="highlight"><pre># instance is located on A, B
node1# gnt-instance replace -n nodeC instance1
# instance has moved from (A, B) to (A, C)
# we now flip the primary/secondary nodes
node1# gnt-instance migrate instance1
# instance lives on (C, A)
# we can then change A to D via:
node1# gnt-instance replace -n nodeD instance1
</pre></div>
</div>
<p>Which brings it into the final configuration of <tt class="docutils literal"><span class="pre">(C,</span> <span class="pre">D)</span></tt>. Note that we
needed to do two replace-disks operation (two copies of the instance
disks), because we needed to get rid of both the original nodes (A and
B).</p>
</div>
</div>
</div>
<div class="section" id="node-operations">
<h2><a class="toc-backref" href="#id42">Node operations</a><a class="headerlink" href="#node-operations" title="Permalink to this headline">¶</a></h2>
<p>There are much fewer node operations available than for instances, but
they are equivalently important for maintaining a healthy cluster.</p>
<div class="section" id="add-readd">
<h3><a class="toc-backref" href="#id43">Add/readd</a><a class="headerlink" href="#add-readd" title="Permalink to this headline">¶</a></h3>
<p>It is at any time possible to extend the cluster with one more node, by
using the node add operation:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-node add NEW_NODE
</pre></div>
</div>
<p>If the cluster has a replication network defined, then you need to pass
the <tt class="docutils literal"><span class="pre">-s</span> <span class="pre">REPLICATION_IP</span></tt> parameter to this option.</p>
<p>A variation of this command can be used to re-configure a node if its
Ganeti configuration is broken, for example if it has been reinstalled
by mistake:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-node add --readd EXISTING_NODE
</pre></div>
</div>
<p>This will reinitialise the node as if it&#8217;s been newly added, but while
keeping its existing configuration in the cluster (primary/secondary IP,
etc.), in other words you won&#8217;t need to use <tt class="docutils literal"><span class="pre">-s</span></tt> here.</p>
</div>
<div class="section" id="changing-the-node-role">
<h3><a class="toc-backref" href="#id44">Changing the node role</a><a class="headerlink" href="#changing-the-node-role" title="Permalink to this headline">¶</a></h3>
<p>A node can be in different roles, as explained in the
<a class="reference internal" href="#terminology-label"><em>Ganeti terminology</em></a> section. Promoting a node to the master role is
special, while the other roles are handled all via a single command.</p>
<div class="section" id="failing-over-the-master-node">
<h4><a class="toc-backref" href="#id45">Failing over the master node</a><a class="headerlink" href="#failing-over-the-master-node" title="Permalink to this headline">¶</a></h4>
<p>If you want to promote a different node to the master role (for whatever
reason), run on any other master-candidate node the command:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-cluster master-failover
</pre></div>
</div>
<p>and the node you ran it on is now the new master. In case you try to run
this on a non master-candidate node, you will get an error telling you
which nodes are valid.</p>
</div>
<div class="section" id="changing-between-the-other-roles">
<h4><a class="toc-backref" href="#id46">Changing between the other roles</a><a class="headerlink" href="#changing-between-the-other-roles" title="Permalink to this headline">¶</a></h4>
<p>The <tt class="docutils literal"><span class="pre">gnt-node</span> <span class="pre">modify</span></tt> command can be used to select a new role:</p>
<div class="highlight-text"><div class="highlight"><pre># change to master candidate
gnt-node modify -C yes NODE
# change to drained status
gnt-node modify -D yes NODE
# change to offline status
gnt-node modify -O yes NODE
# change to regular mode (reset all flags)
gnt-node modify -O no -D no -C no NODE
</pre></div>
</div>
<p>Note that the cluster requires that at any point in time, a certain
number of nodes are master candidates, so changing from master candidate
to other roles might fail. It is recommended to either force the
operation (via the <tt class="docutils literal"><span class="pre">--force</span></tt> option) or first change the number of
master candidates in the cluster - see <a class="reference internal" href="#cluster-config-label"><em>Standard operations</em></a>.</p>
</div>
</div>
<div class="section" id="evacuating-nodes">
<h3><a class="toc-backref" href="#id47">Evacuating nodes</a><a class="headerlink" href="#evacuating-nodes" title="Permalink to this headline">¶</a></h3>
<p>There are two steps of moving instances off a node:</p>
<ul class="simple">
<li>moving the primary instances (actually converting them into secondary
instances)</li>
<li>moving the secondary instances (including any instances converted in
the step above)</li>
</ul>
<div class="section" id="primary-instance-conversion">
<h4><a class="toc-backref" href="#id48">Primary instance conversion</a><a class="headerlink" href="#primary-instance-conversion" title="Permalink to this headline">¶</a></h4>
<p>For this step, you can use either individual instance move
commands (as seen in <a class="reference internal" href="#instance-change-primary-label"><em>Changing the primary node</em></a>) or the bulk
per-node versions; these are:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-node migrate NODE
gnt-node evacuate NODE
</pre></div>
</div>
<p>Note that the instance “move” command doesn&#8217;t currently have a node
equivalent.</p>
<p>Both these commands, or the equivalent per-instance command, will make
this node the secondary node for the respective instances, whereas their
current secondary node will become primary. Note that it is not possible
to change in one step the primary node to another node as primary, while
keeping the same secondary node.</p>
</div>
<div class="section" id="secondary-instance-evacuation">
<h4><a class="toc-backref" href="#id49">Secondary instance evacuation</a><a class="headerlink" href="#secondary-instance-evacuation" title="Permalink to this headline">¶</a></h4>
<p>For the evacuation of secondary instances, a command called
<strong>gnt-node evacuate</strong> is provided and its syntax is:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-node evacuate -I IALLOCATOR_SCRIPT NODE
gnt-node evacuate -n DESTINATION_NODE NODE
</pre></div>
</div>
<p>The first version will compute the new secondary for each instance in
turn using the given iallocator script, whereas the second one will
simply move all instances to DESTINATION_NODE.</p>
</div>
</div>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id50">Removal</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Once a node no longer has any instances (neither primary nor secondary),
it&#8217;s easy to remove it from the cluster:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-node remove NODE_NAME
</pre></div>
</div>
<p>This will deconfigure the node, stop the ganeti daemons on it and leave
it hopefully like before it joined to the cluster.</p>
</div>
<div class="section" id="storage-handling">
<h3><a class="toc-backref" href="#id51">Storage handling</a><a class="headerlink" href="#storage-handling" title="Permalink to this headline">¶</a></h3>
<p>When using LVM (either standalone or with DRBD), it can become tedious
to debug and fix it in case of errors. Furthermore, even file-based
storage can become complicated to handle manually on many hosts. Ganeti
provides a couple of commands to help with automation.</p>
<div class="section" id="logical-volumes">
<h4><a class="toc-backref" href="#id52">Logical volumes</a><a class="headerlink" href="#logical-volumes" title="Permalink to this headline">¶</a></h4>
<p>This is a command specific to LVM handling. It allows listing the
logical volumes on a given node or on all nodes and their association to
instances via the <tt class="docutils literal"><span class="pre">volumes</span></tt> command:</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-node volumes
Node  PhysDev   VG    Name             Size Instance
node1 /dev/sdb1 xenvg e61fbc97-….disk0 512M instance17
node1 /dev/sdb1 xenvg ebd1a7d1-….disk0 512M instance19
node2 /dev/sdb1 xenvg 0af08a3d-….disk0 512M instance20
node2 /dev/sdb1 xenvg cc012285-….disk0 512M instance16
node2 /dev/sdb1 xenvg f0fac192-….disk0 512M instance18
</pre></div>
</div>
<p>The above command maps each logical volume to a volume group and
underlying physical volume and (possibly) to an instance.</p>
</div>
<div class="section" id="generalized-storage-handling">
<span id="storage-units-label"></span><h4><a class="toc-backref" href="#id53">Generalized storage handling</a><a class="headerlink" href="#generalized-storage-handling" title="Permalink to this headline">¶</a></h4>
<p>
<span class="versionmodified">New in version 2.1.</span></p>
<p>Starting with Ganeti 2.1, a new storage framework has been implemented
that tries to abstract the handling of the storage type the cluster
uses.</p>
<p>First is listing the backend storage and their space situation:</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-node list-storage
Node  Name        Size Used   Free
node1 /dev/sda7 673.8G   0M 673.8G
node1 /dev/sdb1 698.6G 1.5G 697.1G
node2 /dev/sda7 673.8G   0M 673.8G
node2 /dev/sdb1 698.6G 1.0G 697.6G
</pre></div>
</div>
<p>The default is to list LVM physical volumes. It&#8217;s also possible to list
the LVM volume groups:</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-node list-storage -t lvm-vg
Node  Name  Size
node1 xenvg 1.3T
node2 xenvg 1.3T
</pre></div>
</div>
<p>Next is repairing storage units, which is currently only implemented for
volume groups and does the equivalent of <tt class="docutils literal"><span class="pre">vgreduce</span> <span class="pre">--removemissing</span></tt>:</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-node repair-storage node2 lvm-vg xenvg
Sun Oct 25 22:21:45 2009 Repairing storage unit &#39;xenvg&#39; on node2 ...
</pre></div>
</div>
<p>Last is the modification of volume properties, which is (again) only
implemented for LVM physical volumes and allows toggling the
<tt class="docutils literal"><span class="pre">allocatable</span></tt> value:</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-node modify-storage --allocatable=no node2 lvm-pv /dev/sdb1
</pre></div>
</div>
</div>
<div class="section" id="use-of-the-storage-commands">
<h4><a class="toc-backref" href="#id54">Use of the storage commands</a><a class="headerlink" href="#use-of-the-storage-commands" title="Permalink to this headline">¶</a></h4>
<p>All these commands are needed when recovering a node from a disk
failure:</p>
<ul class="simple">
<li>first, we need to recover from complete LVM failure (due to missing
disk), by running the <tt class="docutils literal"><span class="pre">repair-storage</span></tt> command</li>
<li>second, we need to change allocation on any partially-broken disk
(i.e. LVM still sees it, but it has bad blocks) by running
<tt class="docutils literal"><span class="pre">modify-storage</span></tt></li>
<li>then we can evacuate the instances as needed</li>
</ul>
</div>
</div>
</div>
<div class="section" id="cluster-operations">
<h2><a class="toc-backref" href="#id55">Cluster operations</a><a class="headerlink" href="#cluster-operations" title="Permalink to this headline">¶</a></h2>
<p>Beside the cluster initialisation command (which is detailed in the
<a class="reference external" href="install.html"><em>Ganeti installation tutorial</em></a> document) and the master failover command which is
explained under node handling, there are a couple of other cluster
operations available.</p>
<div class="section" id="standard-operations">
<span id="cluster-config-label"></span><h3><a class="toc-backref" href="#id56">Standard operations</a><a class="headerlink" href="#standard-operations" title="Permalink to this headline">¶</a></h3>
<p>One of the few commands that can be run on any node (not only the
master) is the <tt class="docutils literal"><span class="pre">getmaster</span></tt> command:</p>
<div class="highlight-text"><div class="highlight"><pre>node2# gnt-cluster getmaster
node1.example.com
node2#
</pre></div>
</div>
<p>It is possible to query and change global cluster parameters via the
<tt class="docutils literal"><span class="pre">info</span></tt> and <tt class="docutils literal"><span class="pre">modify</span></tt> commands:</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-cluster info
Cluster name: cluster.example.com
Cluster UUID: 07805e6f-f0af-4310-95f1-572862ee939c
Creation time: 2009-09-25 05:04:15
Modification time: 2009-10-18 22:11:47
Master node: node1.example.com
Architecture (this node): 64bit (x86_64)
…
Tags: foo
Default hypervisor: xen-pvm
Enabled hypervisors: xen-pvm
Hypervisor parameters:
  - xen-pvm:
      root_path: /dev/sda1
      …
Cluster parameters:
  - candidate pool size: 10
    …
Default instance parameters:
  - default:
      memory: 128
      …
Default nic parameters:
  - default:
      link: xen-br0
      …
</pre></div>
</div>
<p>There various parameters above can be changed via the <tt class="docutils literal"><span class="pre">modify</span></tt>
commands as follows:</p>
<ul class="simple">
<li>the hypervisor parameters can be changed via <tt class="docutils literal"><span class="pre">modify</span> <span class="pre">-H</span>
<span class="pre">xen-pvm:root_path=…</span></tt>, and so on for other hypervisors/key/values</li>
<li>the &#8220;default instance parameters&#8221; are changeable via <tt class="docutils literal"><span class="pre">modify</span> <span class="pre">-B</span>
<span class="pre">parameter=value…</span></tt> syntax</li>
<li>the cluster parameters are changeable via separate options to the
modify command (e.g. <tt class="docutils literal"><span class="pre">--candidate-pool-size</span></tt>, etc.)</li>
</ul>
<p>For detailed option list see the <em>gnt-cluster(8)</em> man page.</p>
<dl class="docutils">
<dt>The cluster version can be obtained via the <tt class="docutils literal"><span class="pre">version</span></tt> command::</dt>
<dd>node1# gnt-cluster version
Software version: 2.1.0
Internode protocol: 20
Configuration format: 2010000
OS api version: 15
Export interface: 0</dd>
</dl>
<p>This is not very useful except when debugging Ganeti.</p>
</div>
<div class="section" id="global-node-commands">
<h3><a class="toc-backref" href="#id57">Global node commands</a><a class="headerlink" href="#global-node-commands" title="Permalink to this headline">¶</a></h3>
<p>There are two commands provided for replicating files to all nodes of a
cluster and for running commands on all the nodes:</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-cluster copyfile /path/to/file
node1# gnt-cluster command ls -l /path/to/file
</pre></div>
</div>
<p>These are simple wrappers over scp/ssh and more advanced usage can be
obtained using <em>dsh(1)</em> and similar commands. But they are
useful to update an OS script from the master node, for example.</p>
</div>
<div class="section" id="cluster-verification">
<h3><a class="toc-backref" href="#id58">Cluster verification</a><a class="headerlink" href="#cluster-verification" title="Permalink to this headline">¶</a></h3>
<p>There are three commands that relate to global cluster checks. The first
one is <tt class="docutils literal"><span class="pre">verify</span></tt> which gives an overview on the cluster state,
highlighting any issues. In normal operation, this command should return
no <tt class="docutils literal"><span class="pre">ERROR</span></tt> messages:</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-cluster verify
Sun Oct 25 23:08:58 2009 * Verifying global settings
Sun Oct 25 23:08:58 2009 * Gathering data (2 nodes)
Sun Oct 25 23:09:00 2009 * Verifying node status
Sun Oct 25 23:09:00 2009 * Verifying instance status
Sun Oct 25 23:09:00 2009 * Verifying orphan volumes
Sun Oct 25 23:09:00 2009 * Verifying remaining instances
Sun Oct 25 23:09:00 2009 * Verifying N+1 Memory redundancy
Sun Oct 25 23:09:00 2009 * Other Notes
Sun Oct 25 23:09:00 2009   - NOTICE: 5 non-redundant instance(s) found.
Sun Oct 25 23:09:00 2009 * Hooks Results
</pre></div>
</div>
<p>The second command is <tt class="docutils literal"><span class="pre">verify-disks</span></tt>, which checks that the instance&#8217;s
disks have the correct status based on the desired instance state
(up/down):</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-cluster verify-disks
</pre></div>
</div>
<p>Note that this command will show no output when disks are healthy.</p>
<p>The last command is used to repair any discrepancies in Ganeti&#8217;s
recorded disk size and the actual disk size (disk size information is
needed for proper activation and growth of DRBD-based disks):</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-cluster repair-disk-sizes
Sun Oct 25 23:13:16 2009  - INFO: Disk 0 of instance instance1 has mismatched size, correcting: recorded 512, actual 2048
Sun Oct 25 23:13:17 2009  - WARNING: Invalid result from node node4, ignoring node results
</pre></div>
</div>
<p>The above shows one instance having wrong disk size, and a node which
returned invalid data, and thus we ignored all primary instances of that
node.</p>
</div>
<div class="section" id="configuration-redistribution">
<h3><a class="toc-backref" href="#id59">Configuration redistribution</a><a class="headerlink" href="#configuration-redistribution" title="Permalink to this headline">¶</a></h3>
<p>If the verify command complains about file mismatches between the master
and other nodes, due to some node problems or if you manually modified
configuration files, you can force an push of the master configuration
to all other nodes via the <tt class="docutils literal"><span class="pre">redist-conf</span></tt> command:</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-cluster redist-conf
node1#
</pre></div>
</div>
<p>This command will be silent unless there are problems sending updates to
the other nodes.</p>
</div>
<div class="section" id="cluster-renaming">
<h3><a class="toc-backref" href="#id60">Cluster renaming</a><a class="headerlink" href="#cluster-renaming" title="Permalink to this headline">¶</a></h3>
<p>It is possible to rename a cluster, or to change its IP address, via the
<tt class="docutils literal"><span class="pre">rename</span></tt> command. If only the IP has changed, you need to pass the
current name and Ganeti will realise its IP has changed:</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-cluster rename cluster.example.com
This will rename the cluster to &#39;cluster.example.com&#39;. If
you are connected over the network to the cluster name, the operation
is very dangerous as the IP address will be removed from the node and
the change may not go through. Continue?
y/[n]/?: y
Failure: prerequisites not met for this operation:
Neither the name nor the IP address of the cluster has changed
</pre></div>
</div>
<p>In the above output, neither value has changed since the cluster
initialisation so the operation is not completed.</p>
</div>
<div class="section" id="queue-operations">
<h3><a class="toc-backref" href="#id61">Queue operations</a><a class="headerlink" href="#queue-operations" title="Permalink to this headline">¶</a></h3>
<p>The job queue execution in Ganeti 2.0 and higher can be inspected,
suspended and resumed via the <tt class="docutils literal"><span class="pre">queue</span></tt> command:</p>
<div class="highlight-text"><div class="highlight"><pre>node1~# gnt-cluster queue info
The drain flag is unset
node1~# gnt-cluster queue drain
node1~# gnt-instance stop instance1
Failed to submit job for instance1: Job queue is drained, refusing job
node1~# gnt-cluster queue info
The drain flag is set
node1~# gnt-cluster queue undrain
</pre></div>
</div>
<p>This is most useful if you have an active cluster and you need to
upgrade the Ganeti software, or simply restart the software on any node:</p>
<ol class="arabic simple">
<li>suspend the queue via <tt class="docutils literal"><span class="pre">queue</span> <span class="pre">drain</span></tt></li>
<li>wait until there are no more running jobs via <tt class="docutils literal"><span class="pre">gnt-job</span> <span class="pre">list</span></tt></li>
<li>restart the master or another node, or upgrade the software</li>
<li>resume the queue via <tt class="docutils literal"><span class="pre">queue</span> <span class="pre">undrain</span></tt></li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">this command only stores a local flag file, and if you
failover the master, it will not have effect on the new master.</p>
</div>
</div>
<div class="section" id="watcher-control">
<h3><a class="toc-backref" href="#id62">Watcher control</a><a class="headerlink" href="#watcher-control" title="Permalink to this headline">¶</a></h3>
<p>The <em>ganeti-watcher</em> is a program, usually scheduled via
<tt class="docutils literal"><span class="pre">cron</span></tt>, that takes care of cluster maintenance operations (restarting
downed instances, activating down DRBD disks, etc.). However, during
maintenance and troubleshooting, this can get in your way; disabling it
via commenting out the cron job is not so good as this can be
forgotten. Thus there are some commands for automated control of the
watcher: <tt class="docutils literal"><span class="pre">pause</span></tt>, <tt class="docutils literal"><span class="pre">info</span></tt> and <tt class="docutils literal"><span class="pre">continue</span></tt>:</p>
<div class="highlight-text"><div class="highlight"><pre>node1~# gnt-cluster watcher info
The watcher is not paused.
node1~# gnt-cluster watcher pause 1h
The watcher is paused until Mon Oct 26 00:30:37 2009.
node1~# gnt-cluster watcher info
The watcher is paused until Mon Oct 26 00:30:37 2009.
node1~# ganeti-watcher -d
2009-10-25 23:30:47,984:  pid=28867 ganeti-watcher:486 DEBUG Pause has been set, exiting
node1~# gnt-cluster watcher continue
The watcher is no longer paused.
node1~# ganeti-watcher -d
2009-10-25 23:31:04,789:  pid=28976 ganeti-watcher:345 DEBUG Archived 0 jobs, left 0
2009-10-25 23:31:05,884:  pid=28976 ganeti-watcher:280 DEBUG Got data from cluster, writing instance status file
2009-10-25 23:31:06,061:  pid=28976 ganeti-watcher:150 DEBUG Data didn&#39;t change, just touching status file
node1~# gnt-cluster watcher info
The watcher is not paused.
node1~#
</pre></div>
</div>
<p>The exact details of the argument to the <tt class="docutils literal"><span class="pre">pause</span></tt> command are available
in the manpage.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">this command only stores a local flag file, and if you
failover the master, it will not have effect on the new master.</p>
</div>
</div>
<div class="section" id="node-auto-maintenance">
<h3><a class="toc-backref" href="#id63">Node auto-maintenance</a><a class="headerlink" href="#node-auto-maintenance" title="Permalink to this headline">¶</a></h3>
<p>If the cluster parameter <tt class="docutils literal"><span class="pre">maintain_node_health</span></tt> is enabled (see the
manpage for <strong>gnt-cluster</strong>, the init and modify subcommands),
then the following will happen automatically:</p>
<ul class="simple">
<li>the watcher will shutdown any instances running on offline nodes</li>
<li>the watcher will deactivate any DRBD devices on offline nodes</li>
</ul>
<p>In the future, more actions are planned, so only enable this parameter
if the nodes are completely dedicated to Ganeti; otherwise it might be
possible to lose data due to auto-maintenance actions.</p>
</div>
<div class="section" id="removing-a-cluster-entirely">
<h3><a class="toc-backref" href="#id64">Removing a cluster entirely</a><a class="headerlink" href="#removing-a-cluster-entirely" title="Permalink to this headline">¶</a></h3>
<p>The usual method to cleanup a cluster is to run <tt class="docutils literal"><span class="pre">gnt-cluster</span> <span class="pre">destroy</span></tt>
however if the Ganeti installation is broken in any way then this will
not run.</p>
<p>It is possible in such a case to cleanup manually most if not all traces
of a cluster installation by following these steps on all of the nodes:</p>
<ol class="arabic simple">
<li>Shutdown all instances. This depends on the virtualisation method
used (Xen, KVM, etc.):</li>
</ol>
<blockquote>
<ul class="simple">
<li>Xen: run <tt class="docutils literal"><span class="pre">xm</span> <span class="pre">list</span></tt> and <tt class="docutils literal"><span class="pre">xm</span> <span class="pre">destroy</span></tt> on all the non-Domain-0
instances</li>
<li>KVM: kill all the KVM processes</li>
<li>chroot: kill all processes under the chroot mountpoints</li>
</ul>
</blockquote>
<ol class="arabic simple" start="2">
<li>If using DRBD, shutdown all DRBD minors (which should by at this time
no-longer in use by instances); on each node, run <tt class="docutils literal"><span class="pre">drbdsetup</span>
<span class="pre">/dev/drbdN</span> <span class="pre">down</span></tt> for each active DRBD minor.</li>
<li>If using LVM, cleanup the Ganeti volume group; if only Ganeti created
logical volumes (and you are not sharing the volume group with the
OS, for example), then simply running <tt class="docutils literal"><span class="pre">lvremove</span> <span class="pre">-f</span> <span class="pre">xenvg</span></tt> (replace
&#8216;xenvg&#8217; with your volume group name) should do the required cleanup.</li>
<li>If using file-based storage, remove recursively all files and
directories under your file-storage directory: <tt class="docutils literal"><span class="pre">rm</span> <span class="pre">-rf</span>
<span class="pre">/srv/ganeti/file-storage/*</span></tt> replacing the path with the correct path
for your cluster.</li>
<li>Stop the ganeti daemons (<tt class="docutils literal"><span class="pre">/etc/init.d/ganeti</span> <span class="pre">stop</span></tt>) and kill any
that remain alive (<tt class="docutils literal"><span class="pre">pgrep</span> <span class="pre">ganeti</span></tt> and <tt class="docutils literal"><span class="pre">pkill</span> <span class="pre">ganeti</span></tt>).</li>
<li>Remove the ganeti state directory (<tt class="docutils literal"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">/var/lib/ganeti/*</span></tt>),
replacing the path with the correct path for your installation.</li>
</ol>
<p>On the master node, remove the cluster from the master-netdev (usually
<tt class="docutils literal"><span class="pre">xen-br0</span></tt> for bridged mode, otherwise <tt class="docutils literal"><span class="pre">eth0</span></tt> or similar), by running
<tt class="docutils literal"><span class="pre">ip</span> <span class="pre">a</span> <span class="pre">del</span> <span class="pre">$clusterip/32</span> <span class="pre">dev</span> <span class="pre">xen-br0</span></tt> (use the correct cluster ip and
network device name).</p>
<p>At this point, the machines are ready for a cluster creation; in case
you want to remove Ganeti completely, you need to also undo some of the
SSH changes and log directories:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">/var/log/ganeti</span> <span class="pre">/srv/ganeti</span></tt> (replace with the correct
paths)</li>
<li>remove from <tt class="docutils literal"><span class="pre">/root/.ssh</span></tt> the keys that Ganeti added (check the
<tt class="docutils literal"><span class="pre">authorized_keys</span></tt> and <tt class="docutils literal"><span class="pre">id_dsa</span></tt> files)</li>
<li>regenerate the host&#8217;s SSH keys (check the OpenSSH startup scripts)</li>
<li>uninstall Ganeti</li>
</ul>
<p>Otherwise, if you plan to re-create the cluster, you can just go ahead
and rerun <tt class="docutils literal"><span class="pre">gnt-cluster</span> <span class="pre">init</span></tt>.</p>
</div>
</div>
<div class="section" id="tags-handling">
<h2><a class="toc-backref" href="#id65">Tags handling</a><a class="headerlink" href="#tags-handling" title="Permalink to this headline">¶</a></h2>
<p>The tags handling (addition, removal, listing) is similar for all the
objects that support it (instances, nodes, and the cluster).</p>
<div class="section" id="limitations">
<h3><a class="toc-backref" href="#id66">Limitations</a><a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h3>
<p>Note that the set of characters present in a tag and the maximum tag
length are restricted. Currently the maximum length is 128 characters,
there can be at most 4096 tags per object, and the set of characters is
comprised by alphanumeric characters and additionally <tt class="docutils literal"><span class="pre">.+*/:&#64;-</span></tt>.</p>
</div>
<div class="section" id="operations">
<h3><a class="toc-backref" href="#id67">Operations</a><a class="headerlink" href="#operations" title="Permalink to this headline">¶</a></h3>
<p>Tags can be added via <tt class="docutils literal"><span class="pre">add-tags</span></tt>:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-instance add-tags INSTANCE a b c
gnt-node add-tags INSTANCE a b c
gnt-cluster add-tags a b c
</pre></div>
</div>
<p>The above commands add three tags to an instance, to a node and to the
cluster. Note that the cluster command only takes tags as arguments,
whereas the node and instance commands first required the node and
instance name.</p>
<p>Tags can also be added from a file, via the <tt class="docutils literal"><span class="pre">--from=FILENAME</span></tt>
argument. The file is expected to contain one tag per line.</p>
<p>Tags can also be remove via a syntax very similar to the add one:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-instance remove-tags INSTANCE a b c
</pre></div>
</div>
<p>And listed via:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-instance list-tags
gnt-node list-tags
gnt-cluster list-tags
</pre></div>
</div>
</div>
<div class="section" id="global-tag-search">
<h3><a class="toc-backref" href="#id68">Global tag search</a><a class="headerlink" href="#global-tag-search" title="Permalink to this headline">¶</a></h3>
<p>It is also possible to execute a global search on the all tags defined
in the cluster configuration, via a cluster command:</p>
<div class="highlight-text"><div class="highlight"><pre>gnt-cluster search-tags REGEXP
</pre></div>
</div>
<p>The parameter expected is a regular expression (see
<em>regex(7)</em>). This will return all tags that match the search,
together with the object they are defined in (the names being show in a
hierarchical kind of way):</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-cluster search-tags o
/cluster foo
/instances/instance1 owner:bar
</pre></div>
</div>
</div>
</div>
<div class="section" id="job-operations">
<h2><a class="toc-backref" href="#id69">Job operations</a><a class="headerlink" href="#job-operations" title="Permalink to this headline">¶</a></h2>
<p>The various jobs submitted by the instance/node/cluster commands can be
examined, canceled and archived by various invocations of the
<tt class="docutils literal"><span class="pre">gnt-job</span></tt> command.</p>
<p>First is the job list command:</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-job list
17771 success INSTANCE_QUERY_DATA
17773 success CLUSTER_VERIFY_DISKS
17775 success CLUSTER_REPAIR_DISK_SIZES
17776 error   CLUSTER_RENAME(cluster.example.com)
17780 success CLUSTER_REDIST_CONF
17792 success INSTANCE_REBOOT(instance1.example.com)
</pre></div>
</div>
<p>More detailed information about a job can be found via the <tt class="docutils literal"><span class="pre">info</span></tt>
command:</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-job info 17776
Job ID: 17776
  Status: error
  Received:         2009-10-25 23:18:02.180569
  Processing start: 2009-10-25 23:18:02.200335 (delta 0.019766s)
  Processing end:   2009-10-25 23:18:02.279743 (delta 0.079408s)
  Total processing time: 0.099174 seconds
  Opcodes:
    OP_CLUSTER_RENAME
      Status: error
      Processing start: 2009-10-25 23:18:02.200335
      Processing end:   2009-10-25 23:18:02.252282
      Input fields:
        name: cluster.example.com
      Result:
        OpPrereqError
        [Neither the name nor the IP address of the cluster has changed]
      Execution log:
</pre></div>
</div>
<p>During the execution of a job, it&#8217;s possible to follow the output of a
job, similar to the log that one get from the <tt class="docutils literal"><span class="pre">gnt-</span></tt> commands, via the
watch command:</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-instance add --submit … instance1
JobID: 17818
node1# gnt-job watch 17818
Output from job 17818 follows
-----------------------------
Mon Oct 26 00:22:48 2009  - INFO: Selected nodes for instance instance1 via iallocator dumb: node1, node2
Mon Oct 26 00:22:49 2009 * creating instance disks...
Mon Oct 26 00:22:52 2009 adding instance instance1 to cluster config
Mon Oct 26 00:22:52 2009  - INFO: Waiting for instance instance1 to sync disks.
…
Mon Oct 26 00:23:03 2009 creating os for instance instance1 on node node1
Mon Oct 26 00:23:03 2009 * running the instance OS create scripts...
Mon Oct 26 00:23:13 2009 * starting instance...
node1#
</pre></div>
</div>
<p>This is useful if you need to follow a job&#8217;s progress from multiple
terminals.</p>
<p>A job that has not yet started to run can be canceled:</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-job cancel 17810
</pre></div>
</div>
<p>But not one that has already started execution:</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-job cancel 17805
Job 17805 is no longer waiting in the queue
</pre></div>
</div>
<p>There are two queues for jobs: the <em>current</em> and the <em>archive</em>
queue. Jobs are initially submitted to the current queue, and they stay
in that queue until they have finished execution (either successfully or
not). At that point, they can be moved into the archive queue, and the
ganeti-watcher script will do this automatically after 6 hours. The
ganeti-cleaner script will remove the jobs from the archive directory
after three weeks.</p>
<p>Note that only jobs in the current queue can be viewed via the list and
info commands; Ganeti itself doesn&#8217;t examine the archive directory. If
you need to see an older job, either move the file manually in the
top-level queue directory, or look at its contents (it&#8217;s a
JSON-formatted file).</p>
</div>
<div class="section" id="special-ganeti-deployments">
<h2><a class="toc-backref" href="#id70">Special Ganeti deployments</a><a class="headerlink" href="#special-ganeti-deployments" title="Permalink to this headline">¶</a></h2>
<p>Since Ganeti 2.4, it is possible to extend the Ganeti deployment with
two custom scenarios: Ganeti inside Ganeti and multi-site model.</p>
<div class="section" id="running-ganeti-under-ganeti">
<h3><a class="toc-backref" href="#id71">Running Ganeti under Ganeti</a><a class="headerlink" href="#running-ganeti-under-ganeti" title="Permalink to this headline">¶</a></h3>
<p>It is sometimes useful to be able to use a Ganeti instance as a Ganeti
node (part of another cluster, usually). One example scenario is two
small clusters, where we want to have an additional master candidate
that holds the cluster configuration and can be used for helping with
the master voting process.</p>
<p>However, these Ganeti instance should not host instances themselves, and
should not be considered in the normal capacity planning, evacuation
strategies, etc. In order to accomplish this, mark these nodes as
non-<tt class="docutils literal"><span class="pre">vm_capable</span></tt>:</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-node modify --vm-capable=no node3
</pre></div>
</div>
<p>The vm_capable status can be listed as usual via <tt class="docutils literal"><span class="pre">gnt-node</span> <span class="pre">list</span></tt>:</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-node list -oname,vm_capable
Node  VMCapable
node1 Y
node2 Y
node3 N
</pre></div>
</div>
<p>When this flag is set, the cluster will not do any operations that
relate to instances on such nodes, e.g. hypervisor operations,
disk-related operations, etc. Basically they will just keep the ssconf
files, and if master candidates the full configuration.</p>
</div>
<div class="section" id="multi-site-model">
<h3><a class="toc-backref" href="#id72">Multi-site model</a><a class="headerlink" href="#multi-site-model" title="Permalink to this headline">¶</a></h3>
<p>If Ganeti is deployed in multi-site model, with each site being a node
group (so that instances are not relocated across the WAN by mistake),
it is conceivable that either the WAN latency is high or that some sites
have a lower reliability than others. In this case, it doesn&#8217;t make
sense to replicate the job information across all sites (or even outside
of a “central” node group), so it should be possible to restrict which
nodes can become master candidates via the auto-promotion algorithm.</p>
<p>Ganeti 2.4 introduces for this purpose a new <tt class="docutils literal"><span class="pre">master_capable</span></tt> flag,
which (when unset) prevents nodes from being marked as master
candidates, either manually or automatically.</p>
<p>As usual, the node modify operation can change this flag:</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-node modify --auto-promote --master-capable=no node3
Fri Jan  7 06:23:07 2011  - INFO: Demoting from master candidate
Fri Jan  7 06:23:08 2011  - INFO: Promoted nodes to master candidate role: node4
Modified node node3
 - master_capable -&gt; False
 - master_candidate -&gt; False
</pre></div>
</div>
<p>And the node list operation will list this flag:</p>
<div class="highlight-text"><div class="highlight"><pre>node1# gnt-node list -oname,master_capable node1 node2 node3
Node  MasterCapable
node1 Y
node2 Y
node3 N
</pre></div>
</div>
<p>Note that marking a node both not <tt class="docutils literal"><span class="pre">vm_capable</span></tt> and not
<tt class="docutils literal"><span class="pre">master_capable</span></tt> makes the node practically unusable from Ganeti&#8217;s
point of view. Hence these two flags should be used probably in
contrast: some nodes will be only master candidates (master_capable but
not vm_capable), and other nodes will only hold instances (vm_capable
but not master_capable).</p>
</div>
</div>
<div class="section" id="ganeti-tools">
<h2><a class="toc-backref" href="#id73">Ganeti tools</a><a class="headerlink" href="#ganeti-tools" title="Permalink to this headline">¶</a></h2>
<p>Beside the usual <tt class="docutils literal"><span class="pre">gnt-</span></tt> and <tt class="docutils literal"><span class="pre">ganeti-</span></tt> commands which are provided
and installed in <tt class="docutils literal"><span class="pre">$prefix/sbin</span></tt> at install time, there are a couple of
other tools installed which are used seldom but can be helpful in some
cases.</p>
<div class="section" id="lvmstrap">
<h3><a class="toc-backref" href="#id74">lvmstrap</a><a class="headerlink" href="#lvmstrap" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">lvmstrap</span></tt> tool, introduced in <a class="reference external" href="install.html#configure-lvm-label"><em>Configuring LVM</em></a> section,
has two modes of operation:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">diskinfo</span></tt> shows the discovered disks on the system and their status</li>
<li><tt class="docutils literal"><span class="pre">create</span></tt> takes all not-in-use disks and creates a volume group out
of them</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <tt class="docutils literal"><span class="pre">create</span></tt> argument to this command causes data-loss!</p>
</div>
</div>
<div class="section" id="cfgupgrade">
<h3><a class="toc-backref" href="#id75">cfgupgrade</a><a class="headerlink" href="#cfgupgrade" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">cfgupgrade</span></tt> tools is used to upgrade between major (and minor)
Ganeti versions. Point-releases are usually transparent for the admin.</p>
<p>More information about the upgrade procedure is listed on the wiki at
<a class="reference external" href="http://code.google.com/p/ganeti/wiki/UpgradeNotes">http://code.google.com/p/ganeti/wiki/UpgradeNotes</a>.</p>
<p>There is also a script designed to upgrade from Ganeti 1.2 to 2.0,
called <tt class="docutils literal"><span class="pre">cfgupgrade12</span></tt>.</p>
</div>
<div class="section" id="cfgshell">
<h3><a class="toc-backref" href="#id76">cfgshell</a><a class="headerlink" href="#cfgshell" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This command is not actively maintained; make sure you backup
your configuration before using it</p>
</div>
<p>This can be used as an alternative to direct editing of the
main configuration file if Ganeti has a bug and prevents you, for
example, from removing an instance or a node from the configuration
file.</p>
</div>
<div class="section" id="burnin">
<span id="burnin-label"></span><h3><a class="toc-backref" href="#id77">burnin</a><a class="headerlink" href="#burnin" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This command will erase existing instances if given as
arguments!</p>
</div>
<p>This tool is used to exercise either the hardware of machines or
alternatively the Ganeti software. It is safe to run on an existing
cluster <strong>as long as you don&#8217;t pass it existing instance names</strong>.</p>
<p>The command will, by default, execute a comprehensive set of operations
against a list of instances, these being:</p>
<ul class="simple">
<li>creation</li>
<li>disk replacement (for redundant instances)</li>
<li>failover and migration (for redundant instances)</li>
<li>move (for non-redundant instances)</li>
<li>disk growth</li>
<li>add disks, remove disk</li>
<li>add NICs, remove NICs</li>
<li>export and then import</li>
<li>rename</li>
<li>reboot</li>
<li>shutdown/startup</li>
<li>and finally removal of the test instances</li>
</ul>
<p>Executing all these operations will test that the hardware performs
well: the creation, disk replace, disk add and disk growth will exercise
the storage and network; the migrate command will test the memory of the
systems. Depending on the passed options, it can also test that the
instance OS definitions are executing properly the rename, import and
export operations.</p>
</div>
<div class="section" id="sanitize-config">
<h3><a class="toc-backref" href="#id78">sanitize-config</a><a class="headerlink" href="#sanitize-config" title="Permalink to this headline">¶</a></h3>
<p>This tool takes the Ganeti configuration and outputs a &#8220;sanitized&#8221;
version, by randomizing or clearing:</p>
<ul class="simple">
<li>DRBD secrets and cluster public key (always)</li>
<li>host names (optional)</li>
<li>IPs (optional)</li>
<li>OS names (optional)</li>
<li>LV names (optional, only useful for very old clusters which still have
instances whose LVs are based on the instance name)</li>
</ul>
<p>By default, all optional items are activated except the LV name
randomization. When passing <tt class="docutils literal"><span class="pre">--no-randomization</span></tt>, which disables the
optional items (i.e. just the DRBD secrets and cluster public keys are
randomized), the resulting file can be used as a safety copy of the
cluster config - while not trivial, the layout of the cluster can be
recreated from it and if the instance disks have not been lost it
permits recovery from the loss of all master candidates.</p>
</div>
<div class="section" id="move-instance">
<h3><a class="toc-backref" href="#id79">move-instance</a><a class="headerlink" href="#move-instance" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference external" href="move-instance.html"><em>separate documentation for move-instance</em></a>.</p>
</div>
</div>
<div class="section" id="other-ganeti-projects">
<h2><a class="toc-backref" href="#id80">Other Ganeti projects</a><a class="headerlink" href="#other-ganeti-projects" title="Permalink to this headline">¶</a></h2>
<p>Below is a list (which might not be up-to-date) of additional projects
that can be useful in a Ganeti deployment. They can be downloaded from
the project site (<a class="reference external" href="http://code.google.com/p/ganeti/">http://code.google.com/p/ganeti/</a>) and the repositories
are also on the project git site (<a class="reference external" href="http://git.ganeti.org">http://git.ganeti.org</a>).</p>
<div class="section" id="nbma-tools">
<h3><a class="toc-backref" href="#id81">NBMA tools</a><a class="headerlink" href="#nbma-tools" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">ganeti-nbma</span></tt> software is designed to allow instances to live on a
separate, virtual network from the nodes, and in an environment where
nodes are not guaranteed to be able to reach each other via multicasting
or broadcasting. For more information see the README in the source
archive.</p>
</div>
<div class="section" id="ganeti-htools">
<h3><a class="toc-backref" href="#id82">ganeti-htools</a><a class="headerlink" href="#ganeti-htools" title="Permalink to this headline">¶</a></h3>
<p>Before Ganeti version 2.5, this was a standalone project; since that
version it is integrated into the Ganeti codebase (see
<a class="reference external" href="install-quick.html"><em>Ganeti quick installation guide</em></a> for instructions on how to enable it). If you run
an older Ganeti version, you will have to download and build it
separately.</p>
<p>For more information and installation instructions, see the README file
in the source archive.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">Ganeti administrator&#8217;s guide</a><ul>
<li><a class="reference external" href="#introduction">Introduction</a><ul>
<li><a class="reference external" href="#ganeti-terminology">Ganeti terminology</a><ul>
<li><a class="reference external" href="#cluster">Cluster</a></li>
<li><a class="reference external" href="#node">Node</a></li>
<li><a class="reference external" href="#instance">Instance</a></li>
<li><a class="reference external" href="#disk-template">Disk template</a></li>
<li><a class="reference external" href="#iallocator">IAllocator</a></li>
<li><a class="reference external" href="#primary-and-secondary-concepts">“Primary” and “secondary” concepts</a></li>
<li><a class="reference external" href="#tags">Tags</a></li>
<li><a class="reference external" href="#jobs-and-opcodes">Jobs and OpCodes</a></li>
</ul>
</li>
<li><a class="reference external" href="#prerequisites">Prerequisites</a></li>
</ul>
</li>
<li><a class="reference external" href="#instance-management">Instance management</a><ul>
<li><a class="reference external" href="#adding-an-instance">Adding an instance</a></li>
<li><a class="reference external" href="#regular-instance-operations">Regular instance operations</a><ul>
<li><a class="reference external" href="#removal">Removal</a></li>
<li><a class="reference external" href="#startup-shutdown">Startup/shutdown</a></li>
<li><a class="reference external" href="#querying-instances">Querying instances</a></li>
</ul>
</li>
<li><a class="reference external" href="#export-import">Export/Import</a></li>
<li><a class="reference external" href="#import-of-foreign-instances">Import of foreign instances</a></li>
<li><a class="reference external" href="#instance-kernel-selection">Instance kernel selection</a><ul>
<li><a class="reference external" href="#xen-pvm">Xen-PVM</a></li>
<li><a class="reference external" href="#kvm">KVM</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference external" href="#instance-ha-features">Instance HA features</a><ul>
<li><a class="reference external" href="#changing-the-primary-node">Changing the primary node</a><ul>
<li><a class="reference external" href="#failing-over-an-instance">Failing over an instance</a></li>
<li><a class="reference external" href="#live-migrating-an-instance">Live migrating an instance</a></li>
<li><a class="reference external" href="#moving-an-instance-offline">Moving an instance (offline)</a></li>
</ul>
</li>
<li><a class="reference external" href="#disk-operations">Disk operations</a><ul>
<li><a class="reference external" href="#preparing-for-disk-operations">Preparing for disk operations</a></li>
<li><a class="reference external" href="#restoring-redundancy-for-drbd-based-instances">Restoring redundancy for DRBD-based instances</a></li>
<li><a class="reference external" href="#re-creating-disks-for-non-redundant-instances">Re-creating disks for non-redundant instances</a></li>
<li><a class="reference external" href="#conversion-of-an-instance-s-disk-type">Conversion of an instance&#8217;s disk type</a></li>
</ul>
</li>
<li><a class="reference external" href="#debugging-instances">Debugging instances</a><ul>
<li><a class="reference external" href="#accessing-an-instance-s-disks">Accessing an instance&#8217;s disks</a></li>
<li><a class="reference external" href="#accessing-an-instance-s-console">Accessing an instance&#8217;s console</a></li>
</ul>
</li>
<li><a class="reference external" href="#other-instance-operations">Other instance operations</a><ul>
<li><a class="reference external" href="#reboot">Reboot</a></li>
</ul>
</li>
<li><a class="reference external" href="#instance-os-definitions-debugging">Instance OS definitions debugging</a><ul>
<li><a class="reference external" href="#instance-relocation">Instance relocation</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference external" href="#node-operations">Node operations</a><ul>
<li><a class="reference external" href="#add-readd">Add/readd</a></li>
<li><a class="reference external" href="#changing-the-node-role">Changing the node role</a><ul>
<li><a class="reference external" href="#failing-over-the-master-node">Failing over the master node</a></li>
<li><a class="reference external" href="#changing-between-the-other-roles">Changing between the other roles</a></li>
</ul>
</li>
<li><a class="reference external" href="#evacuating-nodes">Evacuating nodes</a><ul>
<li><a class="reference external" href="#primary-instance-conversion">Primary instance conversion</a></li>
<li><a class="reference external" href="#secondary-instance-evacuation">Secondary instance evacuation</a></li>
</ul>
</li>
<li><a class="reference external" href="#id1">Removal</a></li>
<li><a class="reference external" href="#storage-handling">Storage handling</a><ul>
<li><a class="reference external" href="#logical-volumes">Logical volumes</a></li>
<li><a class="reference external" href="#generalized-storage-handling">Generalized storage handling</a></li>
<li><a class="reference external" href="#use-of-the-storage-commands">Use of the storage commands</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference external" href="#cluster-operations">Cluster operations</a><ul>
<li><a class="reference external" href="#standard-operations">Standard operations</a></li>
<li><a class="reference external" href="#global-node-commands">Global node commands</a></li>
<li><a class="reference external" href="#cluster-verification">Cluster verification</a></li>
<li><a class="reference external" href="#configuration-redistribution">Configuration redistribution</a></li>
<li><a class="reference external" href="#cluster-renaming">Cluster renaming</a></li>
<li><a class="reference external" href="#queue-operations">Queue operations</a></li>
<li><a class="reference external" href="#watcher-control">Watcher control</a></li>
<li><a class="reference external" href="#node-auto-maintenance">Node auto-maintenance</a></li>
<li><a class="reference external" href="#removing-a-cluster-entirely">Removing a cluster entirely</a></li>
</ul>
</li>
<li><a class="reference external" href="#tags-handling">Tags handling</a><ul>
<li><a class="reference external" href="#limitations">Limitations</a></li>
<li><a class="reference external" href="#operations">Operations</a></li>
<li><a class="reference external" href="#global-tag-search">Global tag search</a></li>
</ul>
</li>
<li><a class="reference external" href="#job-operations">Job operations</a></li>
<li><a class="reference external" href="#special-ganeti-deployments">Special Ganeti deployments</a><ul>
<li><a class="reference external" href="#running-ganeti-under-ganeti">Running Ganeti under Ganeti</a></li>
<li><a class="reference external" href="#multi-site-model">Multi-site model</a></li>
</ul>
</li>
<li><a class="reference external" href="#ganeti-tools">Ganeti tools</a><ul>
<li><a class="reference external" href="#lvmstrap">lvmstrap</a></li>
<li><a class="reference external" href="#cfgupgrade">cfgupgrade</a></li>
<li><a class="reference external" href="#cfgshell">cfgshell</a></li>
<li><a class="reference external" href="#burnin">burnin</a></li>
<li><a class="reference external" href="#sanitize-config">sanitize-config</a></li>
<li><a class="reference external" href="#move-instance">move-instance</a></li>
</ul>
</li>
<li><a class="reference external" href="#other-ganeti-projects">Other Ganeti projects</a><ul>
<li><a class="reference external" href="#nbma-tools">NBMA tools</a></li>
<li><a class="reference external" href="#ganeti-htools">ganeti-htools</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="upgrade.html"
                                  title="previous chapter">Upgrade notes</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="walkthrough.html"
                                  title="next chapter">Ganeti walk-through</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/admin.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="walkthrough.html" title="Ganeti walk-through"
             >next</a></li>
        <li class="right" >
          <a href="upgrade.html" title="Upgrade notes"
             >previous</a> |</li>
        <li><a href="index.html">Ganeti v2.5.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2006, 2007, 2008, 2009, 2010, Google Inc..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.7.
    </div>
  </body>
</html>