<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ganeti.Query.Filter</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Ganeti-Query-Filter.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="Ganeti/Query/Filter.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ganeti</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Infered</td></tr></table><p class="caption">Ganeti.Query.Filter</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Implementation of the Ganeti Query2 filterning.
</p><p>The filtering of results should be done in two phases.
</p><p>In the first phase, before contacting any remote nodes for runtime
data, the filtering should be executed with <code>Nothing</code> for the runtime
context. This will make all non-runtime filters filter correctly,
whereas all runtime filters will respond successfully. As described in
the Python version too, this makes for example <em>Or</em> filters very
inefficient if they contain runtime fields.
</p><p>Once this first filtering phase has been done, we hopefully eliminated
some remote nodes out of the list of candidates, we run the remote
data gathering, and we evaluate the filter again, this time with a
<code>Just</code> runtime context. This will make all filters work correctly.
</p><p>Note that the second run will re-evaluate the config/simple fields,
without caching; this is not perfect, but we consider config accesses
very cheap (and the configuration snapshot we have won't change
between the two runs, hence we will not get inconsistent results).
</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:compileFilter">compileFilter</a> ::  <a href="Ganeti-Query-Types.html#t:FieldMap">FieldMap</a> a b -&gt; <a href="Ganeti-Query-Language.html#t:Filter">Filter</a> <a href="Ganeti-Query-Language.html#t:FilterField">FilterField</a> -&gt; <a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> (<a href="Ganeti-Query-Language.html#t:Filter">Filter</a> (<a href="Ganeti-Query-Types.html#t:FieldGetter">FieldGetter</a> a b, <a href="Ganeti-Query-Types.html#t:QffMode">QffMode</a>))</li><li class="src short"><a href="#v:qffField">qffField</a> :: <a href="Ganeti-Query-Types.html#t:QffMode">QffMode</a> -&gt; JSValue -&gt; <a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> JSValue</li><li class="src short"><a href="#v:wrapGetter">wrapGetter</a> ::  <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; Maybe b -&gt; a -&gt; (<a href="Ganeti-Query-Types.html#t:FieldGetter">FieldGetter</a> a b, <a href="Ganeti-Query-Types.html#t:QffMode">QffMode</a>) -&gt; (<a href="Ganeti-Query-Types.html#t:QffMode">QffMode</a> -&gt; JSValue -&gt; <a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> Bool) -&gt; <a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> Bool</li><li class="src short"><a href="#v:ignoreMode">ignoreMode</a> ::  a -&gt; <a href="Ganeti-Query-Types.html#t:QffMode">QffMode</a> -&gt; a</li><li class="src short"><a href="#v:trueFilter">trueFilter</a> :: JSValue -&gt; <a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> Bool</li><li class="src short"><span class="keyword">type</span> <a href="#t:Comparator">Comparator</a> = (Eq a, Ord a) =&gt; a -&gt; a -&gt; Bool</li><li class="src short"><a href="#v:eqFilter">eqFilter</a> :: <a href="Ganeti-Query-Language.html#t:FilterValue">FilterValue</a> -&gt; <a href="Ganeti-Query-Types.html#t:QffMode">QffMode</a> -&gt; JSValue -&gt; <a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> Bool</li><li class="src short"><a href="#v:binOpFilter">binOpFilter</a> :: <a href="Ganeti-Query-Filter.html#t:Comparator">Comparator</a> -&gt; <a href="Ganeti-Query-Language.html#t:FilterValue">FilterValue</a> -&gt; JSValue -&gt; <a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> Bool</li><li class="src short"><a href="#v:regexpFilter">regexpFilter</a> :: <a href="Ganeti-Query-Language.html#t:FilterRegex">FilterRegex</a> -&gt; JSValue -&gt; <a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> Bool</li><li class="src short"><a href="#v:containsFilter">containsFilter</a> :: <a href="Ganeti-Query-Language.html#t:FilterValue">FilterValue</a> -&gt; JSValue -&gt; <a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> Bool</li><li class="src short"><a href="#v:evaluateFilter">evaluateFilter</a> ::  <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; Maybe b -&gt; a -&gt; <a href="Ganeti-Query-Language.html#t:Filter">Filter</a> (<a href="Ganeti-Query-Types.html#t:FieldGetter">FieldGetter</a> a b, <a href="Ganeti-Query-Types.html#t:QffMode">QffMode</a>) -&gt; <a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> Bool</li><li class="src short"><a href="#v:tryGetter">tryGetter</a> ::  <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; Maybe b -&gt; a -&gt; <a href="Ganeti-Query-Types.html#t:FieldGetter">FieldGetter</a> a b -&gt; Maybe <a href="Ganeti-Query-Language.html#t:ResultEntry">ResultEntry</a></li><li class="src short"><a href="#v:requestedNames">requestedNames</a> :: <a href="Ganeti-Query-Language.html#t:FilterField">FilterField</a> -&gt; <a href="Ganeti-Query-Language.html#t:Filter">Filter</a> <a href="Ganeti-Query-Language.html#t:FilterField">FilterField</a> -&gt; Maybe [<a href="Ganeti-Query-Language.html#t:FilterValue">FilterValue</a>]</li><li class="src short"><a href="#v:makeSimpleFilter">makeSimpleFilter</a> :: String -&gt; [Either String Integer] -&gt; <a href="Ganeti-Query-Language.html#t:Filter">Filter</a> <a href="Ganeti-Query-Language.html#t:FilterField">FilterField</a></li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a name="v:compileFilter" class="def">compileFilter</a> ::  <a href="Ganeti-Query-Types.html#t:FieldMap">FieldMap</a> a b -&gt; <a href="Ganeti-Query-Language.html#t:Filter">Filter</a> <a href="Ganeti-Query-Language.html#t:FilterField">FilterField</a> -&gt; <a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> (<a href="Ganeti-Query-Language.html#t:Filter">Filter</a> (<a href="Ganeti-Query-Types.html#t:FieldGetter">FieldGetter</a> a b, <a href="Ganeti-Query-Types.html#t:QffMode">QffMode</a>))<a href="Ganeti/Query/Filter.html#compileFilter" class="link">Source</a></p><div class="doc"><p>Compiles a filter based on field names to one based on getters.
</p></div></div><div class="top"><p class="src"><a name="v:qffField" class="def">qffField</a> :: <a href="Ganeti-Query-Types.html#t:QffMode">QffMode</a> -&gt; JSValue -&gt; <a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> JSValue<a href="Ganeti/Query/Filter.html#qffField" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:wrapGetter" class="def">wrapGetter</a> ::  <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; Maybe b -&gt; a -&gt; (<a href="Ganeti-Query-Types.html#t:FieldGetter">FieldGetter</a> a b, <a href="Ganeti-Query-Types.html#t:QffMode">QffMode</a>) -&gt; (<a href="Ganeti-Query-Types.html#t:QffMode">QffMode</a> -&gt; JSValue -&gt; <a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> Bool) -&gt; <a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> Bool<a href="Ganeti/Query/Filter.html#wrapGetter" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:ignoreMode" class="def">ignoreMode</a> ::  a -&gt; <a href="Ganeti-Query-Types.html#t:QffMode">QffMode</a> -&gt; a<a href="Ganeti/Query/Filter.html#ignoreMode" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:trueFilter" class="def">trueFilter</a> :: JSValue -&gt; <a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> Bool<a href="Ganeti/Query/Filter.html#trueFilter" class="link">Source</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:Comparator" class="def">Comparator</a> = (Eq a, Ord a) =&gt; a -&gt; a -&gt; Bool<a href="Ganeti/Query/Filter.html#Comparator" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:eqFilter" class="def">eqFilter</a> :: <a href="Ganeti-Query-Language.html#t:FilterValue">FilterValue</a> -&gt; <a href="Ganeti-Query-Types.html#t:QffMode">QffMode</a> -&gt; JSValue -&gt; <a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> Bool<a href="Ganeti/Query/Filter.html#eqFilter" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:binOpFilter" class="def">binOpFilter</a> :: <a href="Ganeti-Query-Filter.html#t:Comparator">Comparator</a> -&gt; <a href="Ganeti-Query-Language.html#t:FilterValue">FilterValue</a> -&gt; JSValue -&gt; <a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> Bool<a href="Ganeti/Query/Filter.html#binOpFilter" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:regexpFilter" class="def">regexpFilter</a> :: <a href="Ganeti-Query-Language.html#t:FilterRegex">FilterRegex</a> -&gt; JSValue -&gt; <a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> Bool<a href="Ganeti/Query/Filter.html#regexpFilter" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:containsFilter" class="def">containsFilter</a> :: <a href="Ganeti-Query-Language.html#t:FilterValue">FilterValue</a> -&gt; JSValue -&gt; <a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> Bool<a href="Ganeti/Query/Filter.html#containsFilter" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:evaluateFilter" class="def">evaluateFilter</a> ::  <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; Maybe b -&gt; a -&gt; <a href="Ganeti-Query-Language.html#t:Filter">Filter</a> (<a href="Ganeti-Query-Types.html#t:FieldGetter">FieldGetter</a> a b, <a href="Ganeti-Query-Types.html#t:QffMode">QffMode</a>) -&gt; <a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> Bool<a href="Ganeti/Query/Filter.html#evaluateFilter" class="link">Source</a></p><div class="doc"><p>Verifies if a given item passes a filter. The runtime context
 might be missing, in which case most of the filters will consider
 this as passing the filter.
</p><p>Note: we use explicit recursion to reduce unneeded memory use;
 <code>any</code> and <code>all</code> do not play nice with monadic values, resulting in
 either too much memory use or in too many thunks being created.
</p></div></div><div class="top"><p class="src"><a name="v:tryGetter" class="def">tryGetter</a> ::  <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; Maybe b -&gt; a -&gt; <a href="Ganeti-Query-Types.html#t:FieldGetter">FieldGetter</a> a b -&gt; Maybe <a href="Ganeti-Query-Language.html#t:ResultEntry">ResultEntry</a><a href="Ganeti/Query/Filter.html#tryGetter" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:requestedNames" class="def">requestedNames</a> :: <a href="Ganeti-Query-Language.html#t:FilterField">FilterField</a> -&gt; <a href="Ganeti-Query-Language.html#t:Filter">Filter</a> <a href="Ganeti-Query-Language.html#t:FilterField">FilterField</a> -&gt; Maybe [<a href="Ganeti-Query-Language.html#t:FilterValue">FilterValue</a>]<a href="Ganeti/Query/Filter.html#requestedNames" class="link">Source</a></p><div class="doc"><p>Computes the requested names, if only names were requested (and
 with equality). Otherwise returns <code>Nothing</code>.
</p></div></div><div class="top"><p class="src"><a name="v:makeSimpleFilter" class="def">makeSimpleFilter</a> :: String -&gt; [Either String Integer] -&gt; <a href="Ganeti-Query-Language.html#t:Filter">Filter</a> <a href="Ganeti-Query-Language.html#t:FilterField">FilterField</a><a href="Ganeti/Query/Filter.html#makeSimpleFilter" class="link">Source</a></p><div class="doc"><p>Builds a simple filter from a list of names.
</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.10.0</p></div></body></html>