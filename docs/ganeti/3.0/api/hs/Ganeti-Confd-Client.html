<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Ganeti.Confd.Client</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ganeti</span><ul class="links" id="page-menu"><li><a href="Ganeti/Confd/Client.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Ganeti.Confd.Client</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Implementation of the Ganeti Confd client functionality.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:getConfdClient">getConfdClient</a> :: Maybe String -&gt; Maybe Int -&gt; IO <a href="Ganeti-Confd-Types.html#t:ConfdClient" title="Ganeti.Confd.Types">ConfdClient</a></li><li class="src short"><a href="#v:query">query</a> :: <a href="Ganeti-Confd-Types.html#t:ConfdClient" title="Ganeti.Confd.Types">ConfdClient</a> -&gt; <a href="Ganeti-Confd-Types.html#t:ConfdRequestType" title="Ganeti.Confd.Types">ConfdRequestType</a> -&gt; <a href="Ganeti-Confd-Types.html#t:ConfdQuery" title="Ganeti.Confd.Types">ConfdQuery</a> -&gt; IO (Maybe <a href="Ganeti-Confd-Types.html#t:ConfdReply" title="Ganeti.Confd.Types">ConfdReply</a>)</li><li class="src short"><a href="#v:updateConfdReply">updateConfdReply</a> :: <a href="Ganeti-Confd-Types.html#t:ConfdReply" title="Ganeti.Confd.Types">ConfdReply</a> -&gt; Maybe <a href="Ganeti-Confd-Types.html#t:ConfdReply" title="Ganeti.Confd.Types">ConfdReply</a> -&gt; Maybe <a href="Ganeti-Confd-Types.html#t:ConfdReply" title="Ganeti.Confd.Types">ConfdReply</a></li><li class="src short"><a href="#v:queryOneServer">queryOneServer</a> :: MVar () -&gt; MVar (Maybe <a href="Ganeti-Confd-Types.html#t:ConfdReply" title="Ganeti.Confd.Types">ConfdReply</a>) -&gt; <a href="Ganeti-Confd-Types.html#t:ConfdRequestType" title="Ganeti.Confd.Types">ConfdRequestType</a> -&gt; <a href="Ganeti-Confd-Types.html#t:ConfdQuery" title="Ganeti.Confd.Types">ConfdQuery</a> -&gt; <a href="Ganeti-Hash.html#t:HashKey" title="Ganeti.Hash">HashKey</a> -&gt; (String, PortNumber) -&gt; IO ()</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:getConfdClient" class="def">getConfdClient</a> :: Maybe String -&gt; Maybe Int -&gt; IO <a href="Ganeti-Confd-Types.html#t:ConfdClient" title="Ganeti.Confd.Types">ConfdClient</a> <a href="Ganeti/Confd/Client.html#getConfdClient" class="link">Source</a> <a href="#v:getConfdClient" class="selflink">#</a></p><div class="doc"><p>Builds a properly initialized ConfdClient.
 The parameters (an IP address and the port number for the Confd client
 to connect to) are mainly meant for testing purposes. If they are not
 provided, the list of master candidates and the default port number will
 be used.</p></div></div><div class="top"><p class="src"><a id="v:query" class="def">query</a> :: <a href="Ganeti-Confd-Types.html#t:ConfdClient" title="Ganeti.Confd.Types">ConfdClient</a> -&gt; <a href="Ganeti-Confd-Types.html#t:ConfdRequestType" title="Ganeti.Confd.Types">ConfdRequestType</a> -&gt; <a href="Ganeti-Confd-Types.html#t:ConfdQuery" title="Ganeti.Confd.Types">ConfdQuery</a> -&gt; IO (Maybe <a href="Ganeti-Confd-Types.html#t:ConfdReply" title="Ganeti.Confd.Types">ConfdReply</a>) <a href="Ganeti/Confd/Client.html#query" class="link">Source</a> <a href="#v:query" class="selflink">#</a></p><div class="doc"><p>Sends a query to all the Confd servers the client is connected to.
 Returns the most up-to-date result according to the serial number,
 chosen between those received before the timeout.</p></div></div><div class="top"><p class="src"><a id="v:updateConfdReply" class="def">updateConfdReply</a> :: <a href="Ganeti-Confd-Types.html#t:ConfdReply" title="Ganeti.Confd.Types">ConfdReply</a> -&gt; Maybe <a href="Ganeti-Confd-Types.html#t:ConfdReply" title="Ganeti.Confd.Types">ConfdReply</a> -&gt; Maybe <a href="Ganeti-Confd-Types.html#t:ConfdReply" title="Ganeti.Confd.Types">ConfdReply</a> <a href="Ganeti/Confd/Client.html#updateConfdReply" class="link">Source</a> <a href="#v:updateConfdReply" class="selflink">#</a></p><div class="doc"><p>Updates the reply to the query. As per the Confd design document,
 only the reply with the highest serial number is kept.</p></div></div><div class="top"><p class="src"><a id="v:queryOneServer" class="def">queryOneServer</a> <a href="Ganeti/Confd/Client.html#queryOneServer" class="link">Source</a> <a href="#v:queryOneServer" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: MVar ()</td><td class="doc"><p>The semaphore that will be signalled</p></td></tr><tr><td class="src">-&gt; MVar (Maybe <a href="Ganeti-Confd-Types.html#t:ConfdReply" title="Ganeti.Confd.Types">ConfdReply</a>)</td><td class="doc"><p>The shared variable for the result</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Confd-Types.html#t:ConfdRequestType" title="Ganeti.Confd.Types">ConfdRequestType</a></td><td class="doc"><p>The type of the query to be sent</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Confd-Types.html#t:ConfdQuery" title="Ganeti.Confd.Types">ConfdQuery</a></td><td class="doc"><p>The content of the query</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Hash.html#t:HashKey" title="Ganeti.Hash">HashKey</a></td><td class="doc"><p>The hmac key to sign the message</p></td></tr><tr><td class="src">-&gt; (String, PortNumber)</td><td class="doc"><p>The address and port of the server</p></td></tr><tr><td class="src">-&gt; IO ()</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Send a query to a single server, waits for the result and stores it
 in a shared variable. Then, sends a signal on another shared variable
 acting as a semaphore.
 This function is meant to be used as one of multiple threads querying
 multiple servers in parallel.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.23.0</p></div></body></html>