<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Ganeti.THH</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ganeti</span><ul class="links" id="page-menu"><li><a href="Ganeti/THH.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Ganeti.THH</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Exported types</a></li><li><a href="#g:2">Internal types</a></li><li><a href="#g:3">Helper functions</a></li><li><a href="#g:4">Template code for simple raw type-equivalent ADTs</a></li><li><a href="#g:5">Template code for opcodes</a></li><li><a href="#g:6">Python code generation</a></li><li><a href="#g:7">Template code for luxi</a></li><li><a href="#g:8"><a href="Objects.html">Objects</a> functionality</a></li><li><a href="#g:9">Inheritable parameter tables implementation</a></li><li><a href="#g:10">Template code for exceptions</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>TemplateHaskell helper for Ganeti Haskell code.</p><p>As TemplateHaskell require that splices be defined in a separate
module, we combine all the TemplateHaskell functionality that HTools
needs in this module (except the one for unittests).</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:OptionalType">OptionalType</a><ul class="subs"><li>= <a href="#v:NotOptional">NotOptional</a></li><li>| <a href="#v:OptionalOmitNull">OptionalOmitNull</a></li><li>| <a href="#v:OptionalSerializeNull">OptionalSerializeNull</a></li><li>| <a href="#v:AndRestArguments">AndRestArguments</a></li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:Field">Field</a> = <a href="#v:Field">Field</a> {<ul class="subs"><li><a href="#v:fieldName">fieldName</a> :: Text</li><li><a href="#v:fieldType">fieldType</a> :: Q Type</li><li><a href="#v:fieldRead">fieldRead</a> :: Maybe (Q Exp)</li><li><a href="#v:fieldShow">fieldShow</a> :: Maybe (Q Exp)</li><li><a href="#v:fieldExtraKeys">fieldExtraKeys</a> :: [Text]</li><li><a href="#v:fieldDefault">fieldDefault</a> :: Maybe (Q Exp)</li><li><a href="#v:fieldSerializeDefault">fieldSerializeDefault</a> :: Bool</li><li><a href="#v:fieldConstr">fieldConstr</a> :: Maybe Text</li><li><a href="#v:fieldIsOptional">fieldIsOptional</a> :: <a href="Ganeti-THH.html#t:OptionalType" title="Ganeti.THH">OptionalType</a></li><li><a href="#v:fieldDoc">fieldDoc</a> :: Text</li><li><a href="#v:fieldPresentInForthcoming">fieldPresentInForthcoming</a> :: Bool</li></ul>}</li><li class="src short"><a href="#v:simpleField">simpleField</a> :: String -&gt; Q Type -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:andRestArguments">andRestArguments</a> :: String -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:withDoc">withDoc</a> :: String -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:renameField">renameField</a> :: String -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:defaultField">defaultField</a> :: Q Exp -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:notSerializeDefaultField">notSerializeDefaultField</a> :: Q Exp -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:presentInForthcoming">presentInForthcoming</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:optionalField">optionalField</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:optionalNullSerField">optionalNullSerField</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:makeOptional">makeOptional</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:customField">customField</a> :: Name -&gt; Name -&gt; [String] -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:fieldRecordName">fieldRecordName</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; String</li><li class="src short"><a href="#v:fieldVariable">fieldVariable</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; String</li><li class="src short"><a href="#v:actualFieldType">actualFieldType</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Type</li><li class="src short"><a href="#v:checkNonOptDef">checkNonOptDef</a> :: MonadFail m =&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; m ()</li><li class="src short"><a href="#v:parseFn">parseFn</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Exp -&gt; Q Exp</li><li class="src short"><a href="#v:loadFn">loadFn</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Exp -&gt; Q Exp -&gt; Q Exp</li><li class="src short"><a href="#v:loadFnOpt">loadFnOpt</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Exp -&gt; Q Exp -&gt; Q Exp</li><li class="src short"><span class="keyword">type</span> <a href="#t:SimpleField">SimpleField</a> = (String, Q Type)</li><li class="src short"><span class="keyword">type</span> <a href="#t:SimpleConstructor">SimpleConstructor</a> = (String, [<a href="Ganeti-THH.html#t:SimpleField" title="Ganeti.THH">SimpleField</a>])</li><li class="src short"><span class="keyword">type</span> <a href="#t:SimpleObject">SimpleObject</a> = [<a href="Ganeti-THH.html#t:SimpleConstructor" title="Ganeti.THH">SimpleConstructor</a>]</li><li class="src short"><span class="keyword">type</span> <a href="#t:OpCodeConstructor">OpCodeConstructor</a> = (String, Q Type, String, [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>], String)</li><li class="src short"><span class="keyword">type</span> <a href="#t:LuxiConstructor">LuxiConstructor</a> = (String, [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>])</li><li class="src short"><a href="#v:ensureLower">ensureLower</a> :: String -&gt; String</li><li class="src short"><a href="#v:ensureUpper">ensureUpper</a> :: String -&gt; String</li><li class="src short"><a href="#v:fromObjE">fromObjE</a> :: Q Exp</li><li class="src short"><a href="#v:toRawName">toRawName</a> :: String -&gt; Name</li><li class="src short"><a href="#v:fromRawName">fromRawName</a> :: String -&gt; Name</li><li class="src short"><a href="#v:reprE">reprE</a> :: Either String Name -&gt; Q Exp</li><li class="src short"><a href="#v:appCons">appCons</a> :: Name -&gt; [Exp] -&gt; Exp</li><li class="src short"><a href="#v:appConsApp">appConsApp</a> :: Name -&gt; [Exp] -&gt; Exp</li><li class="src short"><a href="#v:buildConsField">buildConsField</a> :: Q Type -&gt; StrictTypeQ</li><li class="src short"><a href="#v:buildSimpleCons">buildSimpleCons</a> :: Name -&gt; <a href="Ganeti-THH.html#t:SimpleObject" title="Ganeti.THH">SimpleObject</a> -&gt; Q Dec</li><li class="src short"><a href="#v:genSaveSimpleObj">genSaveSimpleObj</a> :: Name -&gt; String -&gt; <a href="Ganeti-THH.html#t:SimpleObject" title="Ganeti.THH">SimpleObject</a> -&gt; (<a href="Ganeti-THH.html#t:SimpleConstructor" title="Ganeti.THH">SimpleConstructor</a> -&gt; Q Clause) -&gt; Q (Dec, Dec)</li><li class="src short"><a href="#v:strADTDecl">strADTDecl</a> :: Name -&gt; [String] -&gt; Dec</li><li class="src short"><a href="#v:genToRaw">genToRaw</a> :: Name -&gt; Name -&gt; Name -&gt; [(String, Either String Name)] -&gt; Q [Dec]</li><li class="src short"><a href="#v:genFromRaw">genFromRaw</a> :: Name -&gt; Name -&gt; Name -&gt; [(String, Either String Name)] -&gt; Q [Dec]</li><li class="src short"><a href="#v:declareADT">declareADT</a> :: (a -&gt; Either String Name) -&gt; Name -&gt; String -&gt; [(String, a)] -&gt; Q [Dec]</li><li class="src short"><a href="#v:declareLADT">declareLADT</a> :: Name -&gt; String -&gt; [(String, String)] -&gt; Q [Dec]</li><li class="src short"><a href="#v:declareILADT">declareILADT</a> :: String -&gt; [(String, Int)] -&gt; Q [Dec]</li><li class="src short"><a href="#v:declareIADT">declareIADT</a> :: String -&gt; [(String, Name)] -&gt; Q [Dec]</li><li class="src short"><a href="#v:declareSADT">declareSADT</a> :: String -&gt; [(String, Name)] -&gt; Q [Dec]</li><li class="src short"><a href="#v:genShowJSON">genShowJSON</a> :: String -&gt; Q Dec</li><li class="src short"><a href="#v:genReadJSON">genReadJSON</a> :: String -&gt; Q Dec</li><li class="src short"><a href="#v:makeJSONInstance">makeJSONInstance</a> :: Name -&gt; Q [Dec]</li><li class="src short"><a href="#v:deCamelCase">deCamelCase</a> :: String -&gt; String</li><li class="src short"><a href="#v:camelCase">camelCase</a> :: String -&gt; String</li><li class="src short"><a href="#v:constructorName">constructorName</a> :: Con -&gt; Q Name</li><li class="src short"><a href="#v:reifyConsNames">reifyConsNames</a> :: Name -&gt; Q [String]</li><li class="src short"><a href="#v:genConstrToStr">genConstrToStr</a> :: (String -&gt; Q String) -&gt; Name -&gt; String -&gt; Q [Dec]</li><li class="src short"><a href="#v:genOpID">genOpID</a> :: Name -&gt; String -&gt; Q [Dec]</li><li class="src short"><a href="#v:genOpLowerStrip">genOpLowerStrip</a> :: String -&gt; Name -&gt; String -&gt; Q [Dec]</li><li class="src short"><a href="#v:genAllConstr">genAllConstr</a> :: (String -&gt; String) -&gt; Name -&gt; String -&gt; Q [Dec]</li><li class="src short"><a href="#v:genAllOpIDs">genAllOpIDs</a> :: Name -&gt; String -&gt; Q [Dec]</li><li class="src short"><span class="keyword">data</span> <a href="#t:OpCodeField">OpCodeField</a> = <a href="#v:OpCodeField">OpCodeField</a> {<ul class="subs"><li><a href="#v:ocfName">ocfName</a> :: String</li><li><a href="#v:ocfType">ocfType</a> :: <a href="Ganeti-THH-PyType.html#t:PyType" title="Ganeti.THH.PyType">PyType</a></li><li><a href="#v:ocfDefl">ocfDefl</a> :: Maybe <a href="Ganeti-PyValue.html#t:PyValueEx" title="Ganeti.PyValue">PyValueEx</a></li><li><a href="#v:ocfDoc">ocfDoc</a> :: String</li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:OpCodeDescriptor">OpCodeDescriptor</a> = <a href="#v:OpCodeDescriptor">OpCodeDescriptor</a> {<ul class="subs"><li><a href="#v:ocdName">ocdName</a> :: String</li><li><a href="#v:ocdType">ocdType</a> :: <a href="Ganeti-THH-PyType.html#t:PyType" title="Ganeti.THH.PyType">PyType</a></li><li><a href="#v:ocdDoc">ocdDoc</a> :: String</li><li><a href="#v:ocdFields">ocdFields</a> :: [<a href="Ganeti-THH.html#t:OpCodeField" title="Ganeti.THH">OpCodeField</a>]</li><li><a href="#v:ocdDescr">ocdDescr</a> :: String</li></ul>}</li><li class="src short"><a href="#v:maybeApp">maybeApp</a> :: Maybe (Q Exp) -&gt; Q Type -&gt; Q Exp</li><li class="src short"><a href="#v:genPyType-39-">genPyType'</a> :: <a href="Ganeti-THH.html#t:OptionalType" title="Ganeti.THH">OptionalType</a> -&gt; Q Type -&gt; Q <a href="Ganeti-THH-PyType.html#t:PyType" title="Ganeti.THH.PyType">PyType</a></li><li class="src short"><a href="#v:genPyType">genPyType</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q <a href="Ganeti-THH-PyType.html#t:PyType" title="Ganeti.THH.PyType">PyType</a></li><li class="src short"><a href="#v:genPyDefault">genPyDefault</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Exp</li><li class="src short"><a href="#v:pyField">pyField</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Exp</li><li class="src short"><a href="#v:pyClass">pyClass</a> :: <a href="Ganeti-THH.html#t:OpCodeConstructor" title="Ganeti.THH">OpCodeConstructor</a> -&gt; Q Exp</li><li class="src short"><a href="#v:pyClasses">pyClasses</a> :: [<a href="Ganeti-THH.html#t:OpCodeConstructor" title="Ganeti.THH">OpCodeConstructor</a>] -&gt; Q [Dec]</li><li class="src short"><a href="#v:opcodeConsToLuxiCons">opcodeConsToLuxiCons</a> :: <a href="Ganeti-THH.html#t:OpCodeConstructor" title="Ganeti.THH">OpCodeConstructor</a> -&gt; <a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a></li><li class="src short"><a href="#v:genOpCodeDictObject">genOpCodeDictObject</a> :: Name -&gt; (<a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a> -&gt; Q Clause) -&gt; (<a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a> -&gt; Q Exp) -&gt; [<a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a>] -&gt; Q [Dec]</li><li class="src short"><a href="#v:genOpCode">genOpCode</a> :: String -&gt; [<a href="Ganeti-THH.html#t:OpCodeConstructor" title="Ganeti.THH">OpCodeConstructor</a>] -&gt; Q [Dec]</li><li class="src short"><a href="#v:genOpConsFields">genOpConsFields</a> :: <a href="Ganeti-THH.html#t:OpCodeConstructor" title="Ganeti.THH">OpCodeConstructor</a> -&gt; Clause</li><li class="src short"><a href="#v:genAllOpFields">genAllOpFields</a> :: String -&gt; [<a href="Ganeti-THH.html#t:OpCodeConstructor" title="Ganeti.THH">OpCodeConstructor</a>] -&gt; (Dec, Dec)</li><li class="src short"><a href="#v:saveConstructor">saveConstructor</a> :: <a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a> -&gt; Q Clause</li><li class="src short"><a href="#v:genSaveOpCode">genSaveOpCode</a> :: [<a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a>] -&gt; (<a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a> -&gt; Q Clause) -&gt; Q [Clause]</li><li class="src short"><a href="#v:loadConstructor">loadConstructor</a> :: Name -&gt; (<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Exp) -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q Exp</li><li class="src short"><a href="#v:loadOpConstructor">loadOpConstructor</a> :: <a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a> -&gt; Q Exp</li><li class="src short"><a href="#v:genLoadOpCode">genLoadOpCode</a> :: [<a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a>] -&gt; (<a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a> -&gt; Q Exp) -&gt; Q [Clause]</li><li class="src short"><a href="#v:genStrOfOp">genStrOfOp</a> :: Name -&gt; String -&gt; Q [Dec]</li><li class="src short"><a href="#v:genStrOfKey">genStrOfKey</a> :: Name -&gt; String -&gt; Q [Dec]</li><li class="src short"><a href="#v:genLuxiOp">genLuxiOp</a> :: String -&gt; [<a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a>] -&gt; Q [Dec]</li><li class="src short"><a href="#v:saveLuxiConstructor">saveLuxiConstructor</a> :: <a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a> -&gt; Q Clause</li><li class="src short"><a href="#v:fieldTypeInfo">fieldTypeInfo</a> :: String -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q (Name, Strict, Type)</li><li class="src short"><a href="#v:buildObject">buildObject</a> :: String -&gt; String -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q [Dec]</li><li class="src short"><a href="#v:buildAccessor">buildAccessor</a> :: Name -&gt; String -&gt; Name -&gt; String -&gt; Name -&gt; String -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q [Dec]</li><li class="src short"><a href="#v:buildLens">buildLens</a> :: (Name, Name) -&gt; (Name, Name) -&gt; Name -&gt; String -&gt; Int -&gt; (<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>, Int) -&gt; Q [Dec]</li><li class="src short"><a href="#v:buildObjectWithForthcoming">buildObjectWithForthcoming</a> :: String -&gt; String -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q [Dec]</li><li class="src short"><a href="#v:buildObjectSerialisation">buildObjectSerialisation</a> :: String -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q [Dec]</li><li class="src short"><a href="#v:objVarName">objVarName</a> :: Name</li><li class="src short"><a href="#v:defaultToJSArray">defaultToJSArray</a> :: <a href="Ganeti-JSON.html#t:DictObject" title="Ganeti.JSON">DictObject</a> a =&gt; [String] -&gt; a -&gt; [JSValue]</li><li class="src short"><a href="#v:defaultFromJSArray">defaultFromJSArray</a> :: <a href="Ganeti-JSON.html#t:DictObject" title="Ganeti.JSON">DictObject</a> a =&gt; [String] -&gt; [JSValue] -&gt; Result a</li><li class="src short"><a href="#v:genArrayObjectInstance">genArrayObjectInstance</a> :: Name -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q Dec</li><li class="src short"><a href="#v:genDictObject">genDictObject</a> :: (Name -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Exp) -&gt; (<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Exp) -&gt; String -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q [Dec]</li><li class="src short"><a href="#v:genSaveObject">genSaveObject</a> :: String -&gt; Q [Dec]</li><li class="src short"><a href="#v:saveObjectField">saveObjectField</a> :: Name -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Exp</li><li class="src short"><a href="#v:objectShowJSON">objectShowJSON</a> :: String -&gt; Q Dec</li><li class="src short"><a href="#v:genLoadObject">genLoadObject</a> :: String -&gt; Q (Dec, Dec)</li><li class="src short"><a href="#v:loadObjectField">loadObjectField</a> :: [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Exp</li><li class="src short"><a href="#v:fieldsKeys">fieldsKeys</a> :: [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; [String]</li><li class="src short"><a href="#v:fieldsDictKeys">fieldsDictKeys</a> :: [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Exp</li><li class="src short"><a href="#v:fieldsDictKeysQ">fieldsDictKeysQ</a> :: [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q Exp</li><li class="src short"><a href="#v:fieldsUsedKeysQ">fieldsUsedKeysQ</a> :: [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q Exp</li><li class="src short"><a href="#v:objectReadJSON">objectReadJSON</a> :: String -&gt; Q Dec</li><li class="src short"><a href="#v:paramTypeNames">paramTypeNames</a> :: String -&gt; (String, String)</li><li class="src short"><a href="#v:paramFieldNames">paramFieldNames</a> :: String -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; (Name, Name)</li><li class="src short"><a href="#v:paramFieldTypeInfo">paramFieldTypeInfo</a> :: String -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; VarStrictTypeQ</li><li class="src short"><a href="#v:buildParam">buildParam</a> :: String -&gt; String -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q [Dec]</li><li class="src short"><a href="#v:buildParamAllFields">buildParamAllFields</a> :: String -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; [Dec]</li><li class="src short"><a href="#v:buildPParamSerialisation">buildPParamSerialisation</a> :: String -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q [Dec]</li><li class="src short"><a href="#v:savePParamField">savePParamField</a> :: Name -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Exp</li><li class="src short"><a href="#v:loadPParamField">loadPParamField</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Exp</li><li class="src short"><a href="#v:fillParam">fillParam</a> :: String -&gt; String -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q [Dec]</li><li class="src short"><a href="#v:excErrMsg">excErrMsg</a> :: (String, Q Type)</li><li class="src short"><a href="#v:genException">genException</a> :: String -&gt; <a href="Ganeti-THH.html#t:SimpleObject" title="Ganeti.THH">SimpleObject</a> -&gt; Q [Dec]</li><li class="src short"><a href="#v:saveExcCons">saveExcCons</a> :: String -&gt; [<a href="Ganeti-THH.html#t:SimpleField" title="Ganeti.THH">SimpleField</a>] -&gt; Q Clause</li><li class="src short"><a href="#v:loadExcConstructor">loadExcConstructor</a> :: Name -&gt; String -&gt; [<a href="Ganeti-THH.html#t:SimpleField" title="Ganeti.THH">SimpleField</a>] -&gt; Q Exp</li><li class="src short"><a href="#v:genLoadExc">genLoadExc</a> :: Name -&gt; String -&gt; <a href="Ganeti-THH.html#t:SimpleObject" title="Ganeti.THH">SimpleObject</a> -&gt; Q (Dec, Dec)</li><li class="src short"><a href="#v:ssconfConstructorName">ssconfConstructorName</a> :: String -&gt; String</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Exported types</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:OptionalType" class="def">OptionalType</a> <a href="Ganeti/THH.html#OptionalType" class="link">Source</a> <a href="#t:OptionalType" class="selflink">#</a></p><div class="doc"><p>Optional field information.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:NotOptional" class="def">NotOptional</a></td><td class="doc"><p>Field is not optional</p></td></tr><tr><td class="src"><a id="v:OptionalOmitNull" class="def">OptionalOmitNull</a></td><td class="doc"><p>Field is optional, null is not serialised</p></td></tr><tr><td class="src"><a id="v:OptionalSerializeNull" class="def">OptionalSerializeNull</a></td><td class="doc"><p>Field is optional, null is serialised</p></td></tr><tr><td class="src"><a id="v:AndRestArguments" class="def">AndRestArguments</a></td><td class="doc"><p>Special field capturing all the remaining fields
 as plain JSON values</p></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Field" class="def">Field</a> <a href="Ganeti/THH.html#Field" class="link">Source</a> <a href="#t:Field" class="selflink">#</a></p><div class="doc"><p>Serialised field data type describing how to generate code for the field.
 Each field has a type, which isn't captured in the type of the data type,
 but is saved in the <code>Q</code> monad in <code><a href="Ganeti-THH.html#v:fieldType" title="Ganeti.THH">fieldType</a></code>.</p><p>Let <code>t</code> be a type we want to parametrize the field with. There are the
 following possible types of fields:</p><dl><dt>Mandatory with no default.</dt><dd>Then <code>fieldType</code> holds <code>t</code>,
     <code>fieldDefault = Nothing</code> and <code>fieldIsOptional = NotOptional</code>.</dd><dt>Field with a default value.</dt><dd>Then <code>fieldType</code> holds <code>t</code> and
     <code>fieldDefault = Just exp</code> where <code>exp</code> is an expression of type <code>t</code> and
    <code>fieldIsOptional = NotOptional</code>.</dd><dt>Optional, no default value.</dt><dd>Then <code>fieldType</code> holds <code>Maybe t</code>,
     <code>fieldDefault = Nothing</code> and <code>fieldIsOptional</code> is either
     <code><a href="Ganeti-THH.html#v:OptionalOmitNull" title="Ganeti.THH">OptionalOmitNull</a></code> or <code><a href="Ganeti-THH.html#v:OptionalSerializeNull" title="Ganeti.THH">OptionalSerializeNull</a></code>.</dd></dl><p>Optional fields with a default value are prohibited, as their main
 intention is to represent the information that a request didn't contain
 the field data.</p><p><em>Custom (de)serialization:</em>
 Field can have custom (de)serialization functions that are stored in
 <code><a href="Ganeti-THH.html#v:fieldRead" title="Ganeti.THH">fieldRead</a></code> and <code><a href="Ganeti-THH.html#v:fieldShow" title="Ganeti.THH">fieldShow</a></code>. If they aren't provided, the default is to use
 <code>readJSON</code> and <code>showJSON</code> for the field's type <code>t</code>. If they are provided,
 the type of the contained deserializing expression must be</p><pre>  [(String, JSON.JSValue)] -&gt; JSON.JSValue -&gt; JSON.Result t
</pre><p>where the first argument carries the whole record in the case the
 deserializing function needs to process additional information.</p><p>The type of the contained serializing experssion must be</p><pre>  t -&gt; (JSON.JSValue, [(String, JSON.JSValue)])
</pre><p>where the result can provide extra JSON fields to include in the output
 record (or just return <code>[]</code> if they're not needed).</p><p>Note that for optional fields the type appearing in the custom functions
 is still <code>t</code>. Therefore making a field optional doesn't change the
 functions.</p><p>There is also a special type of optional field <code><a href="Ganeti-THH.html#v:AndRestArguments" title="Ganeti.THH">AndRestArguments</a></code> which
 allows to parse any additional arguments not covered by other fields. There
 can be at most one such special field and it's type must be
 <code>Map String JSON.JSValue</code>. See also <code><a href="Ganeti-THH.html#v:andRestArguments" title="Ganeti.THH">andRestArguments</a></code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Field" class="def">Field</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:fieldName" class="def">fieldName</a> :: Text</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:fieldType" class="def">fieldType</a> :: Q Type</dfn><div class="doc"><p>the type of the field, <code>t</code> for non-optional fields,
 <code>Maybe t</code> for optional ones.</p></div></li><li><dfn class="src"><a id="v:fieldRead" class="def">fieldRead</a> :: Maybe (Q Exp)</dfn><div class="doc"><p>an optional custom deserialization function of type
 <code>[(String, JSON.JSValue)] -&gt; JSON.JSValue -&gt;
 JSON.Result t</code></p></div></li><li><dfn class="src"><a id="v:fieldShow" class="def">fieldShow</a> :: Maybe (Q Exp)</dfn><div class="doc"><p>an optional custom serialization function of type
 <code>t -&gt; (JSON.JSValue, [(String, JSON.JSValue)])</code></p></div></li><li><dfn class="src"><a id="v:fieldExtraKeys" class="def">fieldExtraKeys</a> :: [Text]</dfn><div class="doc"><p>a list of extra keys added by <code><a href="Ganeti-THH.html#v:fieldShow" title="Ganeti.THH">fieldShow</a></code></p></div></li><li><dfn class="src"><a id="v:fieldDefault" class="def">fieldDefault</a> :: Maybe (Q Exp)</dfn><div class="doc"><p>an optional default value of type <code>t</code></p></div></li><li><dfn class="src"><a id="v:fieldSerializeDefault" class="def">fieldSerializeDefault</a> :: Bool</dfn><div class="doc"><p>whether not presented default value will be
 serialized</p></div></li><li><dfn class="src"><a id="v:fieldConstr" class="def">fieldConstr</a> :: Maybe Text</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:fieldIsOptional" class="def">fieldIsOptional</a> :: <a href="Ganeti-THH.html#t:OptionalType" title="Ganeti.THH">OptionalType</a></dfn><div class="doc"><p>determines if a field is optional, and if yes,
 how</p></div></li><li><dfn class="src"><a id="v:fieldDoc" class="def">fieldDoc</a> :: Text</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:fieldPresentInForthcoming" class="def">fieldPresentInForthcoming</a> :: Bool</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><a id="v:simpleField" class="def">simpleField</a> :: String -&gt; Q Type -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> <a href="Ganeti/THH.html#simpleField" class="link">Source</a> <a href="#v:simpleField" class="selflink">#</a></p><div class="doc"><p>Generates a simple field.</p></div></div><div class="top"><p class="src"><a id="v:andRestArguments" class="def">andRestArguments</a> :: String -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> <a href="Ganeti/THH.html#andRestArguments" class="link">Source</a> <a href="#v:andRestArguments" class="selflink">#</a></p><div class="doc"><p>Generate an AndRestArguments catch-all field.</p></div></div><div class="top"><p class="src"><a id="v:withDoc" class="def">withDoc</a> :: String -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> <a href="Ganeti/THH.html#withDoc" class="link">Source</a> <a href="#v:withDoc" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:renameField" class="def">renameField</a> :: String -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> <a href="Ganeti/THH.html#renameField" class="link">Source</a> <a href="#v:renameField" class="selflink">#</a></p><div class="doc"><p>Sets the renamed constructor field.</p></div></div><div class="top"><p class="src"><a id="v:defaultField" class="def">defaultField</a> :: Q Exp -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> <a href="Ganeti/THH.html#defaultField" class="link">Source</a> <a href="#v:defaultField" class="selflink">#</a></p><div class="doc"><p>Sets the default value on a field (makes it optional with a
 default value).</p></div></div><div class="top"><p class="src"><a id="v:notSerializeDefaultField" class="def">notSerializeDefaultField</a> :: Q Exp -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> <a href="Ganeti/THH.html#notSerializeDefaultField" class="link">Source</a> <a href="#v:notSerializeDefaultField" class="selflink">#</a></p><div class="doc"><p>A defaultField which will be serialized only if it's value differs from
 a default value.</p></div></div><div class="top"><p class="src"><a id="v:presentInForthcoming" class="def">presentInForthcoming</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> <a href="Ganeti/THH.html#presentInForthcoming" class="link">Source</a> <a href="#v:presentInForthcoming" class="selflink">#</a></p><div class="doc"><p>Mark a field as present in the forthcoming variant.</p></div></div><div class="top"><p class="src"><a id="v:optionalField" class="def">optionalField</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> <a href="Ganeti/THH.html#optionalField" class="link">Source</a> <a href="#v:optionalField" class="selflink">#</a></p><div class="doc"><p>Marks a field optional (turning its base type into a Maybe).</p></div></div><div class="top"><p class="src"><a id="v:optionalNullSerField" class="def">optionalNullSerField</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> <a href="Ganeti/THH.html#optionalNullSerField" class="link">Source</a> <a href="#v:optionalNullSerField" class="selflink">#</a></p><div class="doc"><p>Marks a field optional (turning its base type into a Maybe), but
 with <code>Nothing</code> serialised explicitly as <em>null</em>.</p></div></div><div class="top"><p class="src"><a id="v:makeOptional" class="def">makeOptional</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> <a href="Ganeti/THH.html#makeOptional" class="link">Source</a> <a href="#v:makeOptional" class="selflink">#</a></p><div class="doc"><p>Make a field optional, if it isn't already.</p></div></div><div class="top"><p class="src"><a id="v:customField" class="def">customField</a> <a href="Ganeti/THH.html#customField" class="link">Source</a> <a href="#v:customField" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: Name</td><td class="doc"><p>The name of the read function</p></td></tr><tr><td class="src">-&gt; Name</td><td class="doc"><p>The name of the show function</p></td></tr><tr><td class="src">-&gt; [String]</td><td class="doc"><p>The name of extra field keys</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></td><td class="doc"><p>The original field</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></td><td class="doc"><p>Updated field</p></td></tr></table></div><div class="doc"><p>Sets custom functions on a field.</p></div></div><div class="top"><p class="src"><a id="v:fieldRecordName" class="def">fieldRecordName</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; String <a href="Ganeti/THH.html#fieldRecordName" class="link">Source</a> <a href="#v:fieldRecordName" class="selflink">#</a></p><div class="doc"><p>Computes the record name for a given field, based on either the
 string value in the JSON serialisation or the custom named if any
 exists.</p></div></div><div class="top"><p class="src"><a id="v:fieldVariable" class="def">fieldVariable</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; String <a href="Ganeti/THH.html#fieldVariable" class="link">Source</a> <a href="#v:fieldVariable" class="selflink">#</a></p><div class="doc"><p>Computes the preferred variable name to use for the value of this
 field. If the field has a specific constructor name, then we use a
 first-letter-lowercased version of that; otherwise, we simply use
 the field name. See also <code><a href="Ganeti-THH.html#v:fieldRecordName" title="Ganeti.THH">fieldRecordName</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:actualFieldType" class="def">actualFieldType</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Type <a href="Ganeti/THH.html#actualFieldType" class="link">Source</a> <a href="#v:actualFieldType" class="selflink">#</a></p><div class="doc"><p>Compute the actual field type (taking into account possible
 optional status).</p></div></div><div class="top"><p class="src"><a id="v:checkNonOptDef" class="def">checkNonOptDef</a> :: MonadFail m =&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; m () <a href="Ganeti/THH.html#checkNonOptDef" class="link">Source</a> <a href="#v:checkNonOptDef" class="selflink">#</a></p><div class="doc"><p>Checks that a given field is not optional (for object types or
 fields which should not allow this case).</p></div></div><div class="top"><p class="src"><a id="v:parseFn" class="def">parseFn</a> <a href="Ganeti/THH.html#parseFn" class="link">Source</a> <a href="#v:parseFn" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></td><td class="doc"><p>The field definition</p></td></tr><tr><td class="src">-&gt; Q Exp</td><td class="doc"><p>The entire object in JSON object format</p></td></tr><tr><td class="src">-&gt; Q Exp</td><td class="doc"><p>The resulting function that parses a JSON message</p></td></tr></table></div><div class="doc"><p>Construct a function that parses a field value. If the field has
 a custom <code><a href="Ganeti-THH.html#v:fieldRead" title="Ganeti.THH">fieldRead</a></code>, it's applied to <code>o</code> and used. Otherwise
 <code>JSON.readJSON</code> is used.</p></div></div><div class="top"><p class="src"><a id="v:loadFn" class="def">loadFn</a> <a href="Ganeti/THH.html#loadFn" class="link">Source</a> <a href="#v:loadFn" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></td><td class="doc"><p>The field definition</p></td></tr><tr><td class="src">-&gt; Q Exp</td><td class="doc"><p>The value of the field as existing in the JSON message</p></td></tr><tr><td class="src">-&gt; Q Exp</td><td class="doc"><p>The entire object in JSON object format</p></td></tr><tr><td class="src">-&gt; Q Exp</td><td class="doc"><p>Resulting expression</p></td></tr></table></div><div class="doc"><p>Produces the expression that will de-serialise a given
 field. Since some custom parsing functions might need to use the
 entire object, we do take and pass the object to any custom read
 functions.</p></div></div><div class="top"><p class="src"><a id="v:loadFnOpt" class="def">loadFnOpt</a> <a href="Ganeti/THH.html#loadFnOpt" class="link">Source</a> <a href="#v:loadFnOpt" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></td><td class="doc"><p>The field definition</p></td></tr><tr><td class="src">-&gt; Q Exp</td><td class="doc"><p>The value of the field as existing in the JSON message
 as Maybe</p></td></tr><tr><td class="src">-&gt; Q Exp</td><td class="doc"><p>The entire object in JSON object format</p></td></tr><tr><td class="src">-&gt; Q Exp</td><td class="doc"><p>Resulting expression</p></td></tr></table></div><div class="doc"><p>Just as <code><a href="Ganeti-THH.html#v:loadFn" title="Ganeti.THH">loadFn</a></code>, but for optional fields.</p></div></div><a href="#g:2" id="g:2"><h1>Internal types</h1></a><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:SimpleField" class="def">SimpleField</a> = (String, Q Type) <a href="Ganeti/THH.html#SimpleField" class="link">Source</a> <a href="#t:SimpleField" class="selflink">#</a></p><div class="doc"><p>A simple field, in constrast to the customisable <code><a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></code> type.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:SimpleConstructor" class="def">SimpleConstructor</a> = (String, [<a href="Ganeti-THH.html#t:SimpleField" title="Ganeti.THH">SimpleField</a>]) <a href="Ganeti/THH.html#SimpleConstructor" class="link">Source</a> <a href="#t:SimpleConstructor" class="selflink">#</a></p><div class="doc"><p>A definition for a single constructor for a simple object.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:SimpleObject" class="def">SimpleObject</a> = [<a href="Ganeti-THH.html#t:SimpleConstructor" title="Ganeti.THH">SimpleConstructor</a>] <a href="Ganeti/THH.html#SimpleObject" class="link">Source</a> <a href="#t:SimpleObject" class="selflink">#</a></p><div class="doc"><p>A definition for ADTs with simple fields.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:OpCodeConstructor" class="def">OpCodeConstructor</a> = (String, Q Type, String, [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>], String) <a href="Ganeti/THH.html#OpCodeConstructor" class="link">Source</a> <a href="#t:OpCodeConstructor" class="selflink">#</a></p><div class="doc"><p>A type alias for an opcode constructor of a regular object.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:LuxiConstructor" class="def">LuxiConstructor</a> = (String, [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>]) <a href="Ganeti/THH.html#LuxiConstructor" class="link">Source</a> <a href="#t:LuxiConstructor" class="selflink">#</a></p><div class="doc"><p>A type alias for a Luxi constructor of a regular object.</p></div></div><a href="#g:3" id="g:3"><h1>Helper functions</h1></a><div class="top"><p class="src"><a id="v:ensureLower" class="def">ensureLower</a> :: String -&gt; String <a href="Ganeti/THH.html#ensureLower" class="link">Source</a> <a href="#v:ensureLower" class="selflink">#</a></p><div class="doc"><p>Ensure first letter is lowercase.</p><p>Used to convert type name to function prefix, e.g. in <code>data Aa -&gt;
 aaToRaw</code>.</p></div></div><div class="top"><p class="src"><a id="v:ensureUpper" class="def">ensureUpper</a> :: String -&gt; String <a href="Ganeti/THH.html#ensureUpper" class="link">Source</a> <a href="#v:ensureUpper" class="selflink">#</a></p><div class="doc"><p>Ensure first letter is uppercase.</p><p>Used to convert constructor name to component</p></div></div><div class="top"><p class="src"><a id="v:fromObjE" class="def">fromObjE</a> :: Q Exp <a href="Ganeti/THH.html#fromObjE" class="link">Source</a> <a href="#v:fromObjE" class="selflink">#</a></p><div class="doc"><p>fromObj (Ganeti specific) as an expression, for reuse.</p></div></div><div class="top"><p class="src"><a id="v:toRawName" class="def">toRawName</a> :: String -&gt; Name <a href="Ganeti/THH.html#toRawName" class="link">Source</a> <a href="#v:toRawName" class="selflink">#</a></p><div class="doc"><p>ToRaw function name.</p></div></div><div class="top"><p class="src"><a id="v:fromRawName" class="def">fromRawName</a> :: String -&gt; Name <a href="Ganeti/THH.html#fromRawName" class="link">Source</a> <a href="#v:fromRawName" class="selflink">#</a></p><div class="doc"><p>FromRaw function name.</p></div></div><div class="top"><p class="src"><a id="v:reprE" class="def">reprE</a> :: Either String Name -&gt; Q Exp <a href="Ganeti/THH.html#reprE" class="link">Source</a> <a href="#v:reprE" class="selflink">#</a></p><div class="doc"><p>Converts a name to it's varE/litE representations.</p></div></div><div class="top"><p class="src"><a id="v:appCons" class="def">appCons</a> :: Name -&gt; [Exp] -&gt; Exp <a href="Ganeti/THH.html#appCons" class="link">Source</a> <a href="#v:appCons" class="selflink">#</a></p><div class="doc"><p>Apply a constructor to a list of expressions</p></div></div><div class="top"><p class="src"><a id="v:appConsApp" class="def">appConsApp</a> :: Name -&gt; [Exp] -&gt; Exp <a href="Ganeti/THH.html#appConsApp" class="link">Source</a> <a href="#v:appConsApp" class="selflink">#</a></p><div class="doc"><p>Apply a constructor to a list of applicative expressions</p></div></div><div class="top"><p class="src"><a id="v:buildConsField" class="def">buildConsField</a> :: Q Type -&gt; StrictTypeQ <a href="Ganeti/THH.html#buildConsField" class="link">Source</a> <a href="#v:buildConsField" class="selflink">#</a></p><div class="doc"><p>Builds a field for a normal constructor.</p></div></div><div class="top"><p class="src"><a id="v:buildSimpleCons" class="def">buildSimpleCons</a> :: Name -&gt; <a href="Ganeti-THH.html#t:SimpleObject" title="Ganeti.THH">SimpleObject</a> -&gt; Q Dec <a href="Ganeti/THH.html#buildSimpleCons" class="link">Source</a> <a href="#v:buildSimpleCons" class="selflink">#</a></p><div class="doc"><p>Builds a constructor based on a simple definition (not field-based).</p></div></div><div class="top"><p class="src"><a id="v:genSaveSimpleObj" class="def">genSaveSimpleObj</a> <a href="Ganeti/THH.html#genSaveSimpleObj" class="link">Source</a> <a href="#v:genSaveSimpleObj" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: Name</td><td class="doc"><p>Object type</p></td></tr><tr><td class="src">-&gt; String</td><td class="doc"><p>Function name</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-THH.html#t:SimpleObject" title="Ganeti.THH">SimpleObject</a></td><td class="doc"><p>Object definition</p></td></tr><tr><td class="src">-&gt; (<a href="Ganeti-THH.html#t:SimpleConstructor" title="Ganeti.THH">SimpleConstructor</a> -&gt; Q Clause)</td><td class="doc"><p>Constructor save fn</p></td></tr><tr><td class="src">-&gt; Q (Dec, Dec)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Generate the save function for a given type.</p></div></div><a href="#g:4" id="g:4"><h1>Template code for simple raw type-equivalent ADTs</h1></a><div class="top"><p class="src"><a id="v:strADTDecl" class="def">strADTDecl</a> :: Name -&gt; [String] -&gt; Dec <a href="Ganeti/THH.html#strADTDecl" class="link">Source</a> <a href="#v:strADTDecl" class="selflink">#</a></p><div class="doc"><p>Generates a data type declaration.</p><p>The type will have a fixed list of instances.</p></div></div><div class="top"><p class="src"><a id="v:genToRaw" class="def">genToRaw</a> :: Name -&gt; Name -&gt; Name -&gt; [(String, Either String Name)] -&gt; Q [Dec] <a href="Ganeti/THH.html#genToRaw" class="link">Source</a> <a href="#v:genToRaw" class="selflink">#</a></p><div class="doc"><p>Generates a toRaw function.</p><p>This generates a simple function of the form:</p><pre>nameToRaw :: Name -&gt; <em>traw</em>
nameToRaw Cons1 = var1
nameToRaw Cons2 = &quot;value2&quot;
</pre></div></div><div class="top"><p class="src"><a id="v:genFromRaw" class="def">genFromRaw</a> :: Name -&gt; Name -&gt; Name -&gt; [(String, Either String Name)] -&gt; Q [Dec] <a href="Ganeti/THH.html#genFromRaw" class="link">Source</a> <a href="#v:genFromRaw" class="selflink">#</a></p><div class="doc"><p>Generates a fromRaw function.</p><p>The function generated is monadic and can fail parsing the
 raw value. It is of the form:</p><pre>nameFromRaw :: (Monad m) =&gt; <em>traw</em> -&gt; m Name
nameFromRaw s | s == var1       = Cons1
              | s == &quot;value2&quot; = Cons2
              | otherwise = fail <em>...</em>
</pre></div></div><div class="top"><p class="src"><a id="v:declareADT" class="def">declareADT</a> :: (a -&gt; Either String Name) -&gt; Name -&gt; String -&gt; [(String, a)] -&gt; Q [Dec] <a href="Ganeti/THH.html#declareADT" class="link">Source</a> <a href="#v:declareADT" class="selflink">#</a></p><div class="doc"><p>Generates a data type from a given raw format.</p><p>The format is expected to multiline. The first line contains the
 type name, and the rest of the lines must contain two words: the
 constructor name and then the string representation of the
 respective constructor.</p><p>The function will generate the data type declaration, and then two
 functions:</p><ul><li><em>name</em>ToRaw, which converts the type to a raw type</li><li><em>name</em>FromRaw, which (monadically) converts from a raw type to the type</li></ul><p>Note that this is basically just a custom show/read instance,
 nothing else.</p></div></div><div class="top"><p class="src"><a id="v:declareLADT" class="def">declareLADT</a> :: Name -&gt; String -&gt; [(String, String)] -&gt; Q [Dec] <a href="Ganeti/THH.html#declareLADT" class="link">Source</a> <a href="#v:declareLADT" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:declareILADT" class="def">declareILADT</a> :: String -&gt; [(String, Int)] -&gt; Q [Dec] <a href="Ganeti/THH.html#declareILADT" class="link">Source</a> <a href="#v:declareILADT" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:declareIADT" class="def">declareIADT</a> :: String -&gt; [(String, Name)] -&gt; Q [Dec] <a href="Ganeti/THH.html#declareIADT" class="link">Source</a> <a href="#v:declareIADT" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:declareSADT" class="def">declareSADT</a> :: String -&gt; [(String, Name)] -&gt; Q [Dec] <a href="Ganeti/THH.html#declareSADT" class="link">Source</a> <a href="#v:declareSADT" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:genShowJSON" class="def">genShowJSON</a> :: String -&gt; Q Dec <a href="Ganeti/THH.html#genShowJSON" class="link">Source</a> <a href="#v:genShowJSON" class="selflink">#</a></p><div class="doc"><p>Creates the showJSON member of a JSON instance declaration.</p><p>This will create what is the equivalent of:</p><pre>showJSON = showJSON . <em>name</em>ToRaw
</pre><p>in an instance JSON <em>name</em> declaration</p></div></div><div class="top"><p class="src"><a id="v:genReadJSON" class="def">genReadJSON</a> :: String -&gt; Q Dec <a href="Ganeti/THH.html#genReadJSON" class="link">Source</a> <a href="#v:genReadJSON" class="selflink">#</a></p><div class="doc"><p>Creates the readJSON member of a JSON instance declaration.</p><p>This will create what is the equivalent of:</p><pre>readJSON s = case readJSON s of
               Ok s' -&gt; <em>name</em>FromRaw s'
               Error e -&gt; Error <em>description</em>
</pre><p>in an instance JSON <em>name</em> declaration</p></div></div><div class="top"><p class="src"><a id="v:makeJSONInstance" class="def">makeJSONInstance</a> :: Name -&gt; Q [Dec] <a href="Ganeti/THH.html#makeJSONInstance" class="link">Source</a> <a href="#v:makeJSONInstance" class="selflink">#</a></p><div class="doc"><p>Generates a JSON instance for a given type.</p><p>This assumes that the <em>name</em>ToRaw and <em>name</em>FromRaw functions
 have been defined as by the <code><a href="Ganeti-THH.html#v:declareSADT" title="Ganeti.THH">declareSADT</a></code> function.</p></div></div><a href="#g:5" id="g:5"><h1>Template code for opcodes</h1></a><div class="top"><p class="src"><a id="v:deCamelCase" class="def">deCamelCase</a> :: String -&gt; String <a href="Ganeti/THH.html#deCamelCase" class="link">Source</a> <a href="#v:deCamelCase" class="selflink">#</a></p><div class="doc"><p>Transforms a CamelCase string into an_underscore_based_one.</p></div></div><div class="top"><p class="src"><a id="v:camelCase" class="def">camelCase</a> :: String -&gt; String <a href="Ganeti/THH.html#camelCase" class="link">Source</a> <a href="#v:camelCase" class="selflink">#</a></p><div class="doc"><p>Transform an underscore_name into a CamelCase one.</p></div></div><div class="top"><p class="src"><a id="v:constructorName" class="def">constructorName</a> :: Con -&gt; Q Name <a href="Ganeti/THH.html#constructorName" class="link">Source</a> <a href="#v:constructorName" class="selflink">#</a></p><div class="doc"><p>Computes the name of a given constructor.</p></div></div><div class="top"><p class="src"><a id="v:reifyConsNames" class="def">reifyConsNames</a> :: Name -&gt; Q [String] <a href="Ganeti/THH.html#reifyConsNames" class="link">Source</a> <a href="#v:reifyConsNames" class="selflink">#</a></p><div class="doc"><p>Extract all constructor names from a given type.</p></div></div><div class="top"><p class="src"><a id="v:genConstrToStr" class="def">genConstrToStr</a> :: (String -&gt; Q String) -&gt; Name -&gt; String -&gt; Q [Dec] <a href="Ganeti/THH.html#genConstrToStr" class="link">Source</a> <a href="#v:genConstrToStr" class="selflink">#</a></p><div class="doc"><p>Builds the generic constructor-to-string function.</p><p>This generates a simple function of the following form:</p><pre>fname (ConStructorOne {}) = trans_fun(<a href="ConStructorOne.html">ConStructorOne</a>)
fname (ConStructorTwo {}) = trans_fun(<a href="ConStructorTwo.html">ConStructorTwo</a>)
</pre><p>This builds a custom list of name/string pairs and then uses
 <code><a href="Ganeti-THH.html#v:genToRaw" title="Ganeti.THH">genToRaw</a></code> to actually generate the function.</p></div></div><div class="top"><p class="src"><a id="v:genOpID" class="def">genOpID</a> :: Name -&gt; String -&gt; Q [Dec] <a href="Ganeti/THH.html#genOpID" class="link">Source</a> <a href="#v:genOpID" class="selflink">#</a></p><div class="doc"><p>Constructor-to-string for OpCode.</p></div></div><div class="top"><p class="src"><a id="v:genOpLowerStrip" class="def">genOpLowerStrip</a> :: String -&gt; Name -&gt; String -&gt; Q [Dec] <a href="Ganeti/THH.html#genOpLowerStrip" class="link">Source</a> <a href="#v:genOpLowerStrip" class="selflink">#</a></p><div class="doc"><p>Strips <code>Op</code> from the constructor name, converts to lower-case
 and adds a given prefix.</p></div></div><div class="top"><p class="src"><a id="v:genAllConstr" class="def">genAllConstr</a> :: (String -&gt; String) -&gt; Name -&gt; String -&gt; Q [Dec] <a href="Ganeti/THH.html#genAllConstr" class="link">Source</a> <a href="#v:genAllConstr" class="selflink">#</a></p><div class="doc"><p>Builds a list with all defined constructor names for a type.</p><pre>vstr :: String
vstr = [...]
</pre><p>Where the actual values of the string are the constructor names
 mapped via <code>trans_fun</code>.</p></div></div><div class="top"><p class="src"><a id="v:genAllOpIDs" class="def">genAllOpIDs</a> :: Name -&gt; String -&gt; Q [Dec] <a href="Ganeti/THH.html#genAllOpIDs" class="link">Source</a> <a href="#v:genAllOpIDs" class="selflink">#</a></p><div class="doc"><p>Generates a list of all defined opcode IDs.</p></div></div><a href="#g:6" id="g:6"><h1>Python code generation</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:OpCodeField" class="def">OpCodeField</a> <a href="Ganeti/THH.html#OpCodeField" class="link">Source</a> <a href="#t:OpCodeField" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:OpCodeField" class="def">OpCodeField</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:ocfName" class="def">ocfName</a> :: String</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:ocfType" class="def">ocfType</a> :: <a href="Ganeti-THH-PyType.html#t:PyType" title="Ganeti.THH.PyType">PyType</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:ocfDefl" class="def">ocfDefl</a> :: Maybe <a href="Ganeti-PyValue.html#t:PyValueEx" title="Ganeti.PyValue">PyValueEx</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:ocfDoc" class="def">ocfDoc</a> :: String</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:OpCodeDescriptor" class="def">OpCodeDescriptor</a> <a href="Ganeti/THH.html#OpCodeDescriptor" class="link">Source</a> <a href="#t:OpCodeDescriptor" class="selflink">#</a></p><div class="doc"><p>Transfers opcode data between the opcode description (through
 <code>genOpCode</code>) and the Python code generation functions.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:OpCodeDescriptor" class="def">OpCodeDescriptor</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:ocdName" class="def">ocdName</a> :: String</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:ocdType" class="def">ocdType</a> :: <a href="Ganeti-THH-PyType.html#t:PyType" title="Ganeti.THH.PyType">PyType</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:ocdDoc" class="def">ocdDoc</a> :: String</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:ocdFields" class="def">ocdFields</a> :: [<a href="Ganeti-THH.html#t:OpCodeField" title="Ganeti.THH">OpCodeField</a>]</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:ocdDescr" class="def">ocdDescr</a> :: String</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><a id="v:maybeApp" class="def">maybeApp</a> :: Maybe (Q Exp) -&gt; Q Type -&gt; Q Exp <a href="Ganeti/THH.html#maybeApp" class="link">Source</a> <a href="#v:maybeApp" class="selflink">#</a></p><div class="doc"><p>Optionally encapsulates default values in <code>PyValueEx</code>.</p><p><code>maybeApp exp typ</code> returns a quoted expression that encapsulates
 the default value <code>exp</code> of an opcode parameter cast to <code>typ</code> in a
 <code>PyValueEx</code>, if <code>exp</code> is <code>Just</code>.  Otherwise, it returns a quoted
 expression with <code>Nothing</code>.</p></div></div><div class="top"><p class="src"><a id="v:genPyType-39-" class="def">genPyType'</a> :: <a href="Ganeti-THH.html#t:OptionalType" title="Ganeti.THH">OptionalType</a> -&gt; Q Type -&gt; Q <a href="Ganeti-THH-PyType.html#t:PyType" title="Ganeti.THH.PyType">PyType</a> <a href="Ganeti/THH.html#genPyType%27" class="link">Source</a> <a href="#v:genPyType-39-" class="selflink">#</a></p><div class="doc"><p>Generates a Python type according to whether the field is
 optional.</p><p>The type of created expression is PyType.</p></div></div><div class="top"><p class="src"><a id="v:genPyType" class="def">genPyType</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q <a href="Ganeti-THH-PyType.html#t:PyType" title="Ganeti.THH.PyType">PyType</a> <a href="Ganeti/THH.html#genPyType" class="link">Source</a> <a href="#v:genPyType" class="selflink">#</a></p><div class="doc"><p>Generates Python types from opcode parameters.</p></div></div><div class="top"><p class="src"><a id="v:genPyDefault" class="def">genPyDefault</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Exp <a href="Ganeti/THH.html#genPyDefault" class="link">Source</a> <a href="#v:genPyDefault" class="selflink">#</a></p><div class="doc"><p>Generates Python default values from opcode parameters.</p></div></div><div class="top"><p class="src"><a id="v:pyField" class="def">pyField</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Exp <a href="Ganeti/THH.html#pyField" class="link">Source</a> <a href="#v:pyField" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:pyClass" class="def">pyClass</a> :: <a href="Ganeti-THH.html#t:OpCodeConstructor" title="Ganeti.THH">OpCodeConstructor</a> -&gt; Q Exp <a href="Ganeti/THH.html#pyClass" class="link">Source</a> <a href="#v:pyClass" class="selflink">#</a></p><div class="doc"><p>Generates a Haskell function call to &quot;showPyClass&quot; with the
 necessary information on how to build the Python class string.</p></div></div><div class="top"><p class="src"><a id="v:pyClasses" class="def">pyClasses</a> :: [<a href="Ganeti-THH.html#t:OpCodeConstructor" title="Ganeti.THH">OpCodeConstructor</a>] -&gt; Q [Dec] <a href="Ganeti/THH.html#pyClasses" class="link">Source</a> <a href="#v:pyClasses" class="selflink">#</a></p><div class="doc"><p>Generates a function called &quot;pyClasses&quot; that holds the list of
 all the opcode descriptors necessary for generating the Python
 opcodes.</p></div></div><div class="top"><p class="src"><a id="v:opcodeConsToLuxiCons" class="def">opcodeConsToLuxiCons</a> :: <a href="Ganeti-THH.html#t:OpCodeConstructor" title="Ganeti.THH">OpCodeConstructor</a> -&gt; <a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a> <a href="Ganeti/THH.html#opcodeConsToLuxiCons" class="link">Source</a> <a href="#v:opcodeConsToLuxiCons" class="selflink">#</a></p><div class="doc"><p>Converts from an opcode constructor to a Luxi constructor.</p></div></div><div class="top"><p class="src"><a id="v:genOpCodeDictObject" class="def">genOpCodeDictObject</a> <a href="Ganeti/THH.html#genOpCodeDictObject" class="link">Source</a> <a href="#v:genOpCodeDictObject" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: Name</td><td class="doc"><p>Type name to use</p></td></tr><tr><td class="src">-&gt; (<a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a> -&gt; Q Clause)</td><td class="doc"><p>saving function</p></td></tr><tr><td class="src">-&gt; (<a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a> -&gt; Q Exp)</td><td class="doc"><p>loading function</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a>]</td><td class="doc"><p>Constructors</p></td></tr><tr><td class="src">-&gt; Q [Dec]</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Generates <code><a href="Ganeti-JSON.html#t:DictObject" title="Ganeti.JSON">DictObject</a></code> instance for an op-code.</p></div></div><div class="top"><p class="src"><a id="v:genOpCode" class="def">genOpCode</a> <a href="Ganeti/THH.html#genOpCode" class="link">Source</a> <a href="#v:genOpCode" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: String</td><td class="doc"><p>Type name to use</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-THH.html#t:OpCodeConstructor" title="Ganeti.THH">OpCodeConstructor</a>]</td><td class="doc"><p>Constructor name and parameters</p></td></tr><tr><td class="src">-&gt; Q [Dec]</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Generates the OpCode data type.</p><p>This takes an opcode logical definition, and builds both the
 datatype and the JSON serialisation out of it. We can't use a
 generic serialisation since we need to be compatible with Ganeti's
 own, so we have a few quirks to work around.</p></div></div><div class="top"><p class="src"><a id="v:genOpConsFields" class="def">genOpConsFields</a> :: <a href="Ganeti-THH.html#t:OpCodeConstructor" title="Ganeti.THH">OpCodeConstructor</a> -&gt; Clause <a href="Ganeti/THH.html#genOpConsFields" class="link">Source</a> <a href="#v:genOpConsFields" class="selflink">#</a></p><div class="doc"><p>Generates the function pattern returning the list of fields for a
 given constructor.</p></div></div><div class="top"><p class="src"><a id="v:genAllOpFields" class="def">genAllOpFields</a> <a href="Ganeti/THH.html#genAllOpFields" class="link">Source</a> <a href="#v:genAllOpFields" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: String</td><td class="doc"><p>Function name</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-THH.html#t:OpCodeConstructor" title="Ganeti.THH">OpCodeConstructor</a>]</td><td class="doc"><p>Object definition</p></td></tr><tr><td class="src">-&gt; (Dec, Dec)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Generates a list of all fields of an opcode constructor.</p></div></div><div class="top"><p class="src"><a id="v:saveConstructor" class="def">saveConstructor</a> <a href="Ganeti/THH.html#saveConstructor" class="link">Source</a> <a href="#v:saveConstructor" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a></td><td class="doc"><p>The constructor</p></td></tr><tr><td class="src">-&gt; Q Clause</td><td class="doc"><p>Resulting clause</p></td></tr></table></div><div class="doc"><p>Generates the &quot;save&quot; clause for an entire opcode constructor.</p><p>This matches the opcode with variables named the same as the
 constructor fields (just so that the spliced in code looks nicer),
 and passes those name plus the parameter definition to <code><a href="Ganeti-THH.html#v:saveObjectField" title="Ganeti.THH">saveObjectField</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:genSaveOpCode" class="def">genSaveOpCode</a> <a href="Ganeti/THH.html#genSaveOpCode" class="link">Source</a> <a href="#v:genSaveOpCode" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: [<a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a>]</td><td class="doc"><p>Object definition</p></td></tr><tr><td class="src">-&gt; (<a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a> -&gt; Q Clause)</td><td class="doc"><p>Constructor save fn</p></td></tr><tr><td class="src">-&gt; Q [Clause]</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Generates the main save opcode function, serializing as a dictionary.</p><p>This builds a per-constructor match clause that contains the
 respective constructor-serialisation code.</p></div></div><div class="top"><p class="src"><a id="v:loadConstructor" class="def">loadConstructor</a> :: Name -&gt; (<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Exp) -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q Exp <a href="Ganeti/THH.html#loadConstructor" class="link">Source</a> <a href="#v:loadConstructor" class="selflink">#</a></p><div class="doc"><p>Generates load code for a single constructor of the opcode data type.
 The type of the resulting expression is <code>WriterT UsedKeys J.Result a</code>.</p></div></div><div class="top"><p class="src"><a id="v:loadOpConstructor" class="def">loadOpConstructor</a> :: <a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a> -&gt; Q Exp <a href="Ganeti/THH.html#loadOpConstructor" class="link">Source</a> <a href="#v:loadOpConstructor" class="selflink">#</a></p><div class="doc"><p>Generates load code for a single constructor of the opcode data type.</p></div></div><div class="top"><p class="src"><a id="v:genLoadOpCode" class="def">genLoadOpCode</a> <a href="Ganeti/THH.html#genLoadOpCode" class="link">Source</a> <a href="#v:genLoadOpCode" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: [<a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a>]</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; (<a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a> -&gt; Q Exp)</td><td class="doc"><p>Constructor load fn</p></td></tr><tr><td class="src">-&gt; Q [Clause]</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Generates the loadOpCode function.</p></div></div><a href="#g:7" id="g:7"><h1>Template code for luxi</h1></a><div class="top"><p class="src"><a id="v:genStrOfOp" class="def">genStrOfOp</a> :: Name -&gt; String -&gt; Q [Dec] <a href="Ganeti/THH.html#genStrOfOp" class="link">Source</a> <a href="#v:genStrOfOp" class="selflink">#</a></p><div class="doc"><p>Constructor-to-string for LuxiOp.</p></div></div><div class="top"><p class="src"><a id="v:genStrOfKey" class="def">genStrOfKey</a> :: Name -&gt; String -&gt; Q [Dec] <a href="Ganeti/THH.html#genStrOfKey" class="link">Source</a> <a href="#v:genStrOfKey" class="selflink">#</a></p><div class="doc"><p>Constructor-to-string for MsgKeys.</p></div></div><div class="top"><p class="src"><a id="v:genLuxiOp" class="def">genLuxiOp</a> :: String -&gt; [<a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a>] -&gt; Q [Dec] <a href="Ganeti/THH.html#genLuxiOp" class="link">Source</a> <a href="#v:genLuxiOp" class="selflink">#</a></p><div class="doc"><p>Generates the LuxiOp data type.</p><p>This takes a Luxi operation definition and builds both the
 datatype and the function transforming the arguments to JSON.
 We can't use anything less generic, because the way different
 operations are serialized differs on both parameter- and top-level.</p><p>There are two things to be defined for each parameter:</p><ul><li>name</li><li>type</li></ul></div></div><div class="top"><p class="src"><a id="v:saveLuxiConstructor" class="def">saveLuxiConstructor</a> :: <a href="Ganeti-THH.html#t:LuxiConstructor" title="Ganeti.THH">LuxiConstructor</a> -&gt; Q Clause <a href="Ganeti/THH.html#saveLuxiConstructor" class="link">Source</a> <a href="#v:saveLuxiConstructor" class="selflink">#</a></p><div class="doc"><p>Generates the &quot;save&quot; clause for entire LuxiOp constructor.</p></div></div><a href="#g:8" id="g:8"><h1><a href="Objects.html">Objects</a> functionality</h1></a><div class="top"><p class="src"><a id="v:fieldTypeInfo" class="def">fieldTypeInfo</a> :: String -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q (Name, Strict, Type) <a href="Ganeti/THH.html#fieldTypeInfo" class="link">Source</a> <a href="#v:fieldTypeInfo" class="selflink">#</a></p><div class="doc"><p>Extract the field's declaration from a Field structure.</p></div></div><div class="top"><p class="src"><a id="v:buildObject" class="def">buildObject</a> :: String -&gt; String -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q [Dec] <a href="Ganeti/THH.html#buildObject" class="link">Source</a> <a href="#v:buildObject" class="selflink">#</a></p><div class="doc"><p>Build an object declaration.</p></div></div><div class="top"><p class="src"><a id="v:buildAccessor" class="def">buildAccessor</a> <a href="Ganeti/THH.html#buildAccessor" class="link">Source</a> <a href="#v:buildAccessor" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: Name</td><td class="doc"><p>name of the forthcoming constructor</p></td></tr><tr><td class="src">-&gt; String</td><td class="doc"><p>prefix for the forthcoming field</p></td></tr><tr><td class="src">-&gt; Name</td><td class="doc"><p>name of the real constructor</p></td></tr><tr><td class="src">-&gt; String</td><td class="doc"><p>prefix for the real field</p></td></tr><tr><td class="src">-&gt; Name</td><td class="doc"><p>name of the generated accessor</p></td></tr><tr><td class="src">-&gt; String</td><td class="doc"><p>prefix of the generated accessor</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></td><td class="doc"><p>field description</p></td></tr><tr><td class="src">-&gt; Q [Dec]</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Build an accessor function for a field of an object
 that can have a forthcoming variant.</p></div></div><div class="top"><p class="src"><a id="v:buildLens" class="def">buildLens</a> <a href="Ganeti/THH.html#buildLens" class="link">Source</a> <a href="#v:buildLens" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (Name, Name)</td><td class="doc"><p>names of the forthcoming constructors</p></td></tr><tr><td class="src">-&gt; (Name, Name)</td><td class="doc"><p>names of the real constructors</p></td></tr><tr><td class="src">-&gt; Name</td><td class="doc"><p>name of the type</p></td></tr><tr><td class="src">-&gt; String</td><td class="doc"><p>the field prefix</p></td></tr><tr><td class="src">-&gt; Int</td><td class="doc"><p>arity</p></td></tr><tr><td class="src">-&gt; (<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>, Int)</td><td class="doc"><p>the Field to generate the lens for, and its
 position</p></td></tr><tr><td class="src">-&gt; Q [Dec]</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Build lense declartions for a field.</p><p>If the type of the field is the same in
 the forthcoming and the real variant, the lens
 will be a simple lens (Lens' s a).</p><p>Otherwise, the type will be (Lens s s (Maybe a) a).
 This is because the field in forthcoming variant
 has type (Maybe a), but the real variant has type a.</p></div></div><div class="top"><p class="src"><a id="v:buildObjectWithForthcoming" class="def">buildObjectWithForthcoming</a> <a href="Ganeti/THH.html#buildObjectWithForthcoming" class="link">Source</a> <a href="#v:buildObjectWithForthcoming" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: String</td><td class="doc"><p>Name of the newly defined type</p></td></tr><tr><td class="src">-&gt; String</td><td class="doc"><p>base prefix for field names; for the real and forthcoming
 variant, with base prefix will be prefixed with &quot;real&quot;
 and forthcoming, respectively.</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>]</td><td class="doc"><p>List of fields in the real version</p></td></tr><tr><td class="src">-&gt; Q [Dec]</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Build an object that can have a forthcoming variant.
 This will create 3 data types: two objects, prefixed by
 <a href="Real.html">Real</a> and <a href="Forthcoming.html">Forthcoming</a>, respectively, and a sum type
 of those. The JSON representation of the latter will
 be a JSON object, dispatching on the &quot;forthcoming&quot; key.</p></div></div><div class="top"><p class="src"><a id="v:buildObjectSerialisation" class="def">buildObjectSerialisation</a> :: String -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q [Dec] <a href="Ganeti/THH.html#buildObjectSerialisation" class="link">Source</a> <a href="#v:buildObjectSerialisation" class="selflink">#</a></p><div class="doc"><p>Generates an object definition: data type and its JSON instance.</p></div></div><div class="top"><p class="src"><a id="v:objVarName" class="def">objVarName</a> :: Name <a href="Ganeti/THH.html#objVarName" class="link">Source</a> <a href="#v:objVarName" class="selflink">#</a></p><div class="doc"><p>An internal name used for naming variables that hold the entire
 object of type <code>[(String,JSValue)]</code>.</p></div></div><div class="top"><p class="src"><a id="v:defaultToJSArray" class="def">defaultToJSArray</a> :: <a href="Ganeti-JSON.html#t:DictObject" title="Ganeti.JSON">DictObject</a> a =&gt; [String] -&gt; a -&gt; [JSValue] <a href="Ganeti/THH.html#defaultToJSArray" class="link">Source</a> <a href="#v:defaultToJSArray" class="selflink">#</a></p><div class="doc"><p>Provides a default <code><a href="Ganeti-JSON.html#v:toJSArray" title="Ganeti.JSON">toJSArray</a></code> for <code><a href="Ganeti-JSON.html#t:ArrayObject" title="Ganeti.JSON">ArrayObject</a></code> instance using its
 existing <code><a href="Ganeti-JSON.html#t:DictObject" title="Ganeti.JSON">DictObject</a></code> instance. The keys are serialized in the order
 they're declared. The list must contain all keys possibly generated by
 <code><a href="Ganeti-JSON.html#v:toDict" title="Ganeti.JSON">toDict</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:defaultFromJSArray" class="def">defaultFromJSArray</a> :: <a href="Ganeti-JSON.html#t:DictObject" title="Ganeti.JSON">DictObject</a> a =&gt; [String] -&gt; [JSValue] -&gt; Result a <a href="Ganeti/THH.html#defaultFromJSArray" class="link">Source</a> <a href="#v:defaultFromJSArray" class="selflink">#</a></p><div class="doc"><p>Provides a default <code><a href="Ganeti-JSON.html#v:fromJSArray" title="Ganeti.JSON">fromJSArray</a></code> for <code><a href="Ganeti-JSON.html#t:ArrayObject" title="Ganeti.JSON">ArrayObject</a></code> instance using its
 existing <code><a href="Ganeti-JSON.html#t:DictObject" title="Ganeti.JSON">DictObject</a></code> instance. The fields are deserialized in the order
 they're declared.</p></div></div><div class="top"><p class="src"><a id="v:genArrayObjectInstance" class="def">genArrayObjectInstance</a> :: Name -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q Dec <a href="Ganeti/THH.html#genArrayObjectInstance" class="link">Source</a> <a href="#v:genArrayObjectInstance" class="selflink">#</a></p><div class="doc"><p>Generates an additional <code><a href="Ganeti-JSON.html#t:ArrayObject" title="Ganeti.JSON">ArrayObject</a></code> instance using its
 existing <code><a href="Ganeti-JSON.html#t:DictObject" title="Ganeti.JSON">DictObject</a></code> instance.</p><p>See <code><a href="Ganeti-THH.html#v:defaultToJSArray" title="Ganeti.THH">defaultToJSArray</a></code> and <code><a href="Ganeti-THH.html#v:defaultFromJSArray" title="Ganeti.THH">defaultFromJSArray</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:genDictObject" class="def">genDictObject</a> <a href="Ganeti/THH.html#genDictObject" class="link">Source</a> <a href="#v:genDictObject" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (Name -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Exp)</td><td class="doc"><p>a saving function</p></td></tr><tr><td class="src">-&gt; (<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Exp)</td><td class="doc"><p>a loading function</p></td></tr><tr><td class="src">-&gt; String</td><td class="doc"><p>an object name</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>]</td><td class="doc"><p>a list of fields</p></td></tr><tr><td class="src">-&gt; Q [Dec]</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Generates <code><a href="Ganeti-JSON.html#t:DictObject" title="Ganeti.JSON">DictObject</a></code> instance.</p></div></div><div class="top"><p class="src"><a id="v:genSaveObject" class="def">genSaveObject</a> :: String -&gt; Q [Dec] <a href="Ganeti/THH.html#genSaveObject" class="link">Source</a> <a href="#v:genSaveObject" class="selflink">#</a></p><div class="doc"><p>Generates the save object functionality.</p></div></div><div class="top"><p class="src"><a id="v:saveObjectField" class="def">saveObjectField</a> :: Name -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Exp <a href="Ganeti/THH.html#saveObjectField" class="link">Source</a> <a href="#v:saveObjectField" class="selflink">#</a></p><div class="doc"><p>Generates the code for saving an object's field, handling the
 various types of fields that we have.</p></div></div><div class="top"><p class="src"><a id="v:objectShowJSON" class="def">objectShowJSON</a> :: String -&gt; Q Dec <a href="Ganeti/THH.html#objectShowJSON" class="link">Source</a> <a href="#v:objectShowJSON" class="selflink">#</a></p><div class="doc"><p>Generates the showJSON clause for a given object name.</p></div></div><div class="top"><p class="src"><a id="v:genLoadObject" class="def">genLoadObject</a> :: String -&gt; Q (Dec, Dec) <a href="Ganeti/THH.html#genLoadObject" class="link">Source</a> <a href="#v:genLoadObject" class="selflink">#</a></p><div class="doc"><p>Generates the load object functionality.</p></div></div><div class="top"><p class="src"><a id="v:loadObjectField" class="def">loadObjectField</a> :: [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Exp <a href="Ganeti/THH.html#loadObjectField" class="link">Source</a> <a href="#v:loadObjectField" class="selflink">#</a></p><div class="doc"><p>Generates code for loading an object's field.</p></div></div><div class="top"><p class="src"><a id="v:fieldsKeys" class="def">fieldsKeys</a> :: [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; [String] <a href="Ganeti/THH.html#fieldsKeys" class="link">Source</a> <a href="#v:fieldsKeys" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:fieldsDictKeys" class="def">fieldsDictKeys</a> :: [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Exp <a href="Ganeti/THH.html#fieldsDictKeys" class="link">Source</a> <a href="#v:fieldsDictKeys" class="selflink">#</a></p><div class="doc"><p>Generates the set of all used JSON dictionary keys for a list of fields
 The equivalent of S.fromList (map T.pack [&quot;f1&quot;, &quot;f2&quot;, &quot;f3&quot;] )</p></div></div><div class="top"><p class="src"><a id="v:fieldsDictKeysQ" class="def">fieldsDictKeysQ</a> :: [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q Exp <a href="Ganeti/THH.html#fieldsDictKeysQ" class="link">Source</a> <a href="#v:fieldsDictKeysQ" class="selflink">#</a></p><div class="doc"><p>Generates the list of all used JSON dictionary keys for a list of fields</p></div></div><div class="top"><p class="src"><a id="v:fieldsUsedKeysQ" class="def">fieldsUsedKeysQ</a> :: [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q Exp <a href="Ganeti/THH.html#fieldsUsedKeysQ" class="link">Source</a> <a href="#v:fieldsUsedKeysQ" class="selflink">#</a></p><div class="doc"><p>Generates the list of all used JSON dictionary keys for a list of fields,
 depending on if any of them has <code><a href="Ganeti-THH.html#v:AndRestArguments" title="Ganeti.THH">AndRestArguments</a></code> flag.</p></div></div><div class="top"><p class="src"><a id="v:objectReadJSON" class="def">objectReadJSON</a> :: String -&gt; Q Dec <a href="Ganeti/THH.html#objectReadJSON" class="link">Source</a> <a href="#v:objectReadJSON" class="selflink">#</a></p><div class="doc"><p>Builds the readJSON instance for a given object name.</p></div></div><a href="#g:9" id="g:9"><h1>Inheritable parameter tables implementation</h1></a><div class="top"><p class="src"><a id="v:paramTypeNames" class="def">paramTypeNames</a> :: String -&gt; (String, String) <a href="Ganeti/THH.html#paramTypeNames" class="link">Source</a> <a href="#v:paramTypeNames" class="selflink">#</a></p><div class="doc"><p>Compute parameter type names.</p></div></div><div class="top"><p class="src"><a id="v:paramFieldNames" class="def">paramFieldNames</a> :: String -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; (Name, Name) <a href="Ganeti/THH.html#paramFieldNames" class="link">Source</a> <a href="#v:paramFieldNames" class="selflink">#</a></p><div class="doc"><p>Compute the name of a full and a partial parameter field.</p></div></div><div class="top"><p class="src"><a id="v:paramFieldTypeInfo" class="def">paramFieldTypeInfo</a> :: String -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; VarStrictTypeQ <a href="Ganeti/THH.html#paramFieldTypeInfo" class="link">Source</a> <a href="#v:paramFieldTypeInfo" class="selflink">#</a></p><div class="doc"><p>Compute information about the type of a parameter field.</p></div></div><div class="top"><p class="src"><a id="v:buildParam" class="def">buildParam</a> :: String -&gt; String -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q [Dec] <a href="Ganeti/THH.html#buildParam" class="link">Source</a> <a href="#v:buildParam" class="selflink">#</a></p><div class="doc"><p>Build a parameter declaration.</p><p>This function builds two different data structures: a <em>filled</em> one,
 in which all fields are required, and a <em>partial</em> one, in which all
 fields are optional. Due to the current record syntax issues, the
 fields need to be named differrently for the two structures, so the
 partial ones get a <em>P</em> suffix.
 Also generate a default value for the partial parameters.</p></div></div><div class="top"><p class="src"><a id="v:buildParamAllFields" class="def">buildParamAllFields</a> :: String -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; [Dec] <a href="Ganeti/THH.html#buildParamAllFields" class="link">Source</a> <a href="#v:buildParamAllFields" class="selflink">#</a></p><div class="doc"><p>Builds a list of all fields of a parameter.</p></div></div><div class="top"><p class="src"><a id="v:buildPParamSerialisation" class="def">buildPParamSerialisation</a> :: String -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q [Dec] <a href="Ganeti/THH.html#buildPParamSerialisation" class="link">Source</a> <a href="#v:buildPParamSerialisation" class="selflink">#</a></p><div class="doc"><p>Generates the serialisation for a partial parameter.</p></div></div><div class="top"><p class="src"><a id="v:savePParamField" class="def">savePParamField</a> :: Name -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Exp <a href="Ganeti/THH.html#savePParamField" class="link">Source</a> <a href="#v:savePParamField" class="selflink">#</a></p><div class="doc"><p>Generates code to save an optional parameter field.</p></div></div><div class="top"><p class="src"><a id="v:loadPParamField" class="def">loadPParamField</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; Q Exp <a href="Ganeti/THH.html#loadPParamField" class="link">Source</a> <a href="#v:loadPParamField" class="selflink">#</a></p><div class="doc"><p>Generates code to load an optional parameter field.</p></div></div><div class="top"><p class="src"><a id="v:fillParam" class="def">fillParam</a> :: String -&gt; String -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q [Dec] <a href="Ganeti/THH.html#fillParam" class="link">Source</a> <a href="#v:fillParam" class="selflink">#</a></p><div class="doc"><p>Builds a function that executes the filling of partial parameter
 from a full copy (similar to Python's fillDict).</p></div></div><a href="#g:10" id="g:10"><h1>Template code for exceptions</h1></a><div class="top"><p class="src"><a id="v:excErrMsg" class="def">excErrMsg</a> :: (String, Q Type) <a href="Ganeti/THH.html#excErrMsg" class="link">Source</a> <a href="#v:excErrMsg" class="selflink">#</a></p><div class="doc"><p>Exception simple error message field.</p></div></div><div class="top"><p class="src"><a id="v:genException" class="def">genException</a> <a href="Ganeti/THH.html#genException" class="link">Source</a> <a href="#v:genException" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: String</td><td class="doc"><p>Name of new type</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-THH.html#t:SimpleObject" title="Ganeti.THH">SimpleObject</a></td><td class="doc"><p>Constructor name and parameters</p></td></tr><tr><td class="src">-&gt; Q [Dec]</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Builds an exception type definition.</p></div></div><div class="top"><p class="src"><a id="v:saveExcCons" class="def">saveExcCons</a> <a href="Ganeti/THH.html#saveExcCons" class="link">Source</a> <a href="#v:saveExcCons" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: String</td><td class="doc"><p>The constructor name</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-THH.html#t:SimpleField" title="Ganeti.THH">SimpleField</a>]</td><td class="doc"><p>The parameter definitions for this
 constructor</p></td></tr><tr><td class="src">-&gt; Q Clause</td><td class="doc"><p>Resulting clause</p></td></tr></table></div><div class="doc"><p>Generates the &quot;save&quot; clause for an entire exception constructor.</p><p>This matches the exception with variables named the same as the
 constructor fields (just so that the spliced in code looks nicer),
 and calls showJSON on it.</p></div></div><div class="top"><p class="src"><a id="v:loadExcConstructor" class="def">loadExcConstructor</a> :: Name -&gt; String -&gt; [<a href="Ganeti-THH.html#t:SimpleField" title="Ganeti.THH">SimpleField</a>] -&gt; Q Exp <a href="Ganeti/THH.html#loadExcConstructor" class="link">Source</a> <a href="#v:loadExcConstructor" class="selflink">#</a></p><div class="doc"><p>Generates load code for a single constructor of an exception.</p><p>Generates the code (if there's only one argument, we will use a
 list, not a tuple:</p><pre>do
 (x1, x2, ...) &lt;- readJSON args
 return $ Cons x1 x2 ...
</pre></div></div><div class="top"><p class="src"><a id="v:genLoadExc" class="def">genLoadExc</a> :: Name -&gt; String -&gt; <a href="Ganeti-THH.html#t:SimpleObject" title="Ganeti.THH">SimpleObject</a> -&gt; Q (Dec, Dec) <a href="Ganeti/THH.html#genLoadExc" class="link">Source</a> <a href="#v:genLoadExc" class="selflink">#</a></p><div class="doc"><p>Generates the loadException function.</p><p>This generates a quite complicated function, along the lines of:</p><pre>loadFn (JSArray [JSString name, args]) = case name of
   <a href="A1.html">A1</a> -&gt; do
     (x1, x2, ...) &lt;- readJSON args
     return $ A1 x1 x2 ...
   &quot;a2&quot; -&gt; ...
   s -&gt; fail $ &quot;Unknown exception&quot; ++ s
loadFn v = fail $ &quot;Expected array but got &quot; ++ show v
</pre></div></div><div class="top"><p class="src"><a id="v:ssconfConstructorName" class="def">ssconfConstructorName</a> :: String -&gt; String <a href="Ganeti/THH.html#ssconfConstructorName" class="link">Source</a> <a href="#v:ssconfConstructorName" class="selflink">#</a></p><div class="doc"><p>Compute the ssconf constructor name from its file name.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.23.0</p></div></body></html>