<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ganeti.THH</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="Ganeti/THH.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ganeti</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Ganeti.THH</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Exported types</a></li><li><a href="#g:2">Internal types</a></li><li><a href="#g:3">Helper functions</a></li><li><a href="#g:4">Template code for simple raw type-equivalent ADTs</a></li><li><a href="#g:5">Template code for opcodes</a></li><li><a href="#g:6">Python code generation</a></li><li><a href="#g:7">Template code for luxi</a></li><li><a href="#g:8"><a href="Objects.html">Objects</a> functionality</a></li><li><a href="#g:9">Inheritable parameter tables implementation</a></li><li><a href="#g:10">Template code for exceptions</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>TemplateHaskell helper for Ganeti Haskell code.</p><p>As TemplateHaskell require that splices be defined in a separate
module, we combine all the TemplateHaskell functionality that HTools
needs in this module (except the one for unittests).</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:Field">Field</a> = <a href="#v:Field">Field</a> {<ul class="subs"><li><a href="#v:fieldName">fieldName</a> :: Text</li><li><a href="#v:fieldType">fieldType</a> :: Q Type</li><li><a href="#v:fieldRead">fieldRead</a> :: Maybe (Q Exp)</li><li><a href="#v:fieldShow">fieldShow</a> :: Maybe (Q Exp)</li><li><a href="#v:fieldExtraKeys">fieldExtraKeys</a> :: [Text]</li><li><a href="#v:fieldDefault">fieldDefault</a> :: Maybe (Q Exp)</li><li><a href="#v:fieldSerializeDefault">fieldSerializeDefault</a> :: Bool</li><li><a href="#v:fieldConstr">fieldConstr</a> :: Maybe Text</li><li><a href="#v:fieldIsOptional">fieldIsOptional</a> :: OptionalType</li><li><a href="#v:fieldDoc">fieldDoc</a> :: Text</li><li><a href="#v:fieldPresentInForthcoming">fieldPresentInForthcoming</a> :: Bool</li></ul>}</li><li class="src short"><a href="#v:simpleField">simpleField</a> :: String -&gt; Q Type -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:andRestArguments">andRestArguments</a> :: String -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:withDoc">withDoc</a> :: String -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:renameField">renameField</a> :: String -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:defaultField">defaultField</a> :: Q Exp -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:notSerializeDefaultField">notSerializeDefaultField</a> :: Q Exp -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:presentInForthcoming">presentInForthcoming</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:optionalField">optionalField</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:optionalNullSerField">optionalNullSerField</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:makeOptional">makeOptional</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:customField">customField</a> :: Name -&gt; Name -&gt; [String] -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></li><li class="src short"><a href="#v:declareLADT">declareLADT</a> :: Name -&gt; String -&gt; [(String, String)] -&gt; Q [Dec]</li><li class="src short"><a href="#v:declareILADT">declareILADT</a> :: String -&gt; [(String, Int)] -&gt; Q [Dec]</li><li class="src short"><a href="#v:declareIADT">declareIADT</a> :: String -&gt; [(String, Name)] -&gt; Q [Dec]</li><li class="src short"><a href="#v:declareSADT">declareSADT</a> :: String -&gt; [(String, Name)] -&gt; Q [Dec]</li><li class="src short"><a href="#v:makeJSONInstance">makeJSONInstance</a> :: Name -&gt; Q [Dec]</li><li class="src short"><a href="#v:deCamelCase">deCamelCase</a> :: String -&gt; String</li><li class="src short"><a href="#v:genOpID">genOpID</a> :: Name -&gt; String -&gt; Q [Dec]</li><li class="src short"><a href="#v:genOpLowerStrip">genOpLowerStrip</a> :: String -&gt; Name -&gt; String -&gt; Q [Dec]</li><li class="src short"><a href="#v:genAllConstr">genAllConstr</a> :: (String -&gt; String) -&gt; Name -&gt; String -&gt; Q [Dec]</li><li class="src short"><a href="#v:genAllOpIDs">genAllOpIDs</a> :: Name -&gt; String -&gt; Q [Dec]</li><li class="src short"><span class="keyword">data</span> <a href="#t:OpCodeField">OpCodeField</a> = <a href="#v:OpCodeField">OpCodeField</a> {<ul class="subs"><li><a href="#v:ocfName">ocfName</a> :: String</li><li><a href="#v:ocfType">ocfType</a> :: <a href="Ganeti-THH-PyType.html#t:PyType" title="Ganeti.THH.PyType">PyType</a></li><li><a href="#v:ocfDefl">ocfDefl</a> :: Maybe <a href="Ganeti-PyValue.html#t:PyValueEx" title="Ganeti.PyValue">PyValueEx</a></li><li><a href="#v:ocfDoc">ocfDoc</a> :: String</li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:OpCodeDescriptor">OpCodeDescriptor</a> = <a href="#v:OpCodeDescriptor">OpCodeDescriptor</a> {<ul class="subs"><li><a href="#v:ocdName">ocdName</a> :: String</li><li><a href="#v:ocdType">ocdType</a> :: <a href="Ganeti-THH-PyType.html#t:PyType" title="Ganeti.THH.PyType">PyType</a></li><li><a href="#v:ocdDoc">ocdDoc</a> :: String</li><li><a href="#v:ocdFields">ocdFields</a> :: [<a href="Ganeti-THH.html#t:OpCodeField" title="Ganeti.THH">OpCodeField</a>]</li><li><a href="#v:ocdDescr">ocdDescr</a> :: String</li></ul>}</li><li class="src short"><a href="#v:genOpCode">genOpCode</a> :: String -&gt; [OpCodeConstructor] -&gt; Q [Dec]</li><li class="src short"><a href="#v:genStrOfOp">genStrOfOp</a> :: Name -&gt; String -&gt; Q [Dec]</li><li class="src short"><a href="#v:genStrOfKey">genStrOfKey</a> :: Name -&gt; String -&gt; Q [Dec]</li><li class="src short"><a href="#v:genLuxiOp">genLuxiOp</a> :: String -&gt; [LuxiConstructor] -&gt; Q [Dec]</li><li class="src short"><a href="#v:buildObject">buildObject</a> :: String -&gt; String -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q [Dec]</li><li class="src short"><a href="#v:buildObjectWithForthcoming">buildObjectWithForthcoming</a> :: String -&gt; String -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q [Dec]</li><li class="src short"><a href="#v:buildObjectSerialisation">buildObjectSerialisation</a> :: String -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q [Dec]</li><li class="src short"><a href="#v:buildParam">buildParam</a> :: String -&gt; String -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q [Dec]</li><li class="src short"><a href="#v:excErrMsg">excErrMsg</a> :: (String, Q Type)</li><li class="src short"><a href="#v:genException">genException</a> :: String -&gt; SimpleObject -&gt; Q [Dec]</li><li class="src short"><a href="#v:ssconfConstructorName">ssconfConstructorName</a> :: String -&gt; String</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Exported types</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Field" class="def">Field</a> <a href="Ganeti/THH.html#Field" class="link">Source</a> <a href="#t:Field" class="selflink">#</a></p><div class="doc"><p>Serialised field data type describing how to generate code for the field.
 Each field has a type, which isn't captured in the type of the data type,
 but is saved in the <code>Q</code> monad in <code><a href="Ganeti-THH.html#v:fieldType" title="Ganeti.THH">fieldType</a></code>.</p><p>Let <code>t</code> be a type we want to parametrize the field with. There are the
 following possible types of fields:</p><dl><dt>Mandatory with no default.</dt><dd>Then <code>fieldType</code> holds <code>t</code>,
     <code>fieldDefault = Nothing</code> and <code>fieldIsOptional = NotOptional</code>.</dd><dt>Field with a default value.</dt><dd>Then <code>fieldType</code> holds <code>t</code> and
     <code>fieldDefault = Just exp</code> where <code>exp</code> is an expression of type <code>t</code> and
    <code>fieldIsOptional = NotOptional</code>.</dd><dt>Optional, no default value.</dt><dd>Then <code>fieldType</code> holds <code>Maybe t</code>,
     <code>fieldDefault = Nothing</code> and <code>fieldIsOptional</code> is either
     <code>OptionalOmitNull</code> or <code>OptionalSerializeNull</code>.</dd></dl><p>Optional fields with a default value are prohibited, as their main
 intention is to represent the information that a request didn't contain
 the field data.</p><p><em>Custom (de)serialization:</em>
 Field can have custom (de)serialization functions that are stored in
 <code><a href="Ganeti-THH.html#v:fieldRead" title="Ganeti.THH">fieldRead</a></code> and <code><a href="Ganeti-THH.html#v:fieldShow" title="Ganeti.THH">fieldShow</a></code>. If they aren't provided, the default is to use
 <code>readJSON</code> and <code>showJSON</code> for the field's type <code>t</code>. If they are provided,
 the type of the contained deserializing expression must be</p><pre>  [(String, JSON.JSValue)] -&gt; JSON.JSValue -&gt; JSON.Result t
</pre><p>where the first argument carries the whole record in the case the
 deserializing function needs to process additional information.</p><p>The type of the contained serializing experssion must be</p><pre>  t -&gt; (JSON.JSValue, [(String, JSON.JSValue)])
</pre><p>where the result can provide extra JSON fields to include in the output
 record (or just return <code>[]</code> if they're not needed).</p><p>Note that for optional fields the type appearing in the custom functions
 is still <code>t</code>. Therefore making a field optional doesn't change the
 functions.</p><p>There is also a special type of optional field <code>AndRestArguments</code> which
 allows to parse any additional arguments not covered by other fields. There
 can be at most one such special field and it's type must be
 <code>Map String JSON.JSValue</code>. See also <code><a href="Ganeti-THH.html#v:andRestArguments" title="Ganeti.THH">andRestArguments</a></code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Field" class="def">Field</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:fieldName" class="def">fieldName</a> :: Text</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:fieldType" class="def">fieldType</a> :: Q Type</dfn><div class="doc"><p>the type of the field, <code>t</code> for non-optional fields,
 <code>Maybe t</code> for optional ones.</p></div></li><li><dfn class="src"><a id="v:fieldRead" class="def">fieldRead</a> :: Maybe (Q Exp)</dfn><div class="doc"><p>an optional custom deserialization function of type
 <code>[(String, JSON.JSValue)] -&gt; JSON.JSValue -&gt;
 JSON.Result t</code></p></div></li><li><dfn class="src"><a id="v:fieldShow" class="def">fieldShow</a> :: Maybe (Q Exp)</dfn><div class="doc"><p>an optional custom serialization function of type
 <code>t -&gt; (JSON.JSValue, [(String, JSON.JSValue)])</code></p></div></li><li><dfn class="src"><a id="v:fieldExtraKeys" class="def">fieldExtraKeys</a> :: [Text]</dfn><div class="doc"><p>a list of extra keys added by <code><a href="Ganeti-THH.html#v:fieldShow" title="Ganeti.THH">fieldShow</a></code></p></div></li><li><dfn class="src"><a id="v:fieldDefault" class="def">fieldDefault</a> :: Maybe (Q Exp)</dfn><div class="doc"><p>an optional default value of type <code>t</code></p></div></li><li><dfn class="src"><a id="v:fieldSerializeDefault" class="def">fieldSerializeDefault</a> :: Bool</dfn><div class="doc"><p>whether not presented default value will be
 serialized</p></div></li><li><dfn class="src"><a id="v:fieldConstr" class="def">fieldConstr</a> :: Maybe Text</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:fieldIsOptional" class="def">fieldIsOptional</a> :: OptionalType</dfn><div class="doc"><p>determines if a field is optional, and if yes,
 how</p></div></li><li><dfn class="src"><a id="v:fieldDoc" class="def">fieldDoc</a> :: Text</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:fieldPresentInForthcoming" class="def">fieldPresentInForthcoming</a> :: Bool</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><a id="v:simpleField" class="def">simpleField</a> :: String -&gt; Q Type -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> <a href="Ganeti/THH.html#simpleField" class="link">Source</a> <a href="#v:simpleField" class="selflink">#</a></p><div class="doc"><p>Generates a simple field.</p></div></div><div class="top"><p class="src"><a id="v:andRestArguments" class="def">andRestArguments</a> :: String -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> <a href="Ganeti/THH.html#andRestArguments" class="link">Source</a> <a href="#v:andRestArguments" class="selflink">#</a></p><div class="doc"><p>Generate an AndRestArguments catch-all field.</p></div></div><div class="top"><p class="src"><a id="v:withDoc" class="def">withDoc</a> :: String -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> <a href="Ganeti/THH.html#withDoc" class="link">Source</a> <a href="#v:withDoc" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:renameField" class="def">renameField</a> :: String -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> <a href="Ganeti/THH.html#renameField" class="link">Source</a> <a href="#v:renameField" class="selflink">#</a></p><div class="doc"><p>Sets the renamed constructor field.</p></div></div><div class="top"><p class="src"><a id="v:defaultField" class="def">defaultField</a> :: Q Exp -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> <a href="Ganeti/THH.html#defaultField" class="link">Source</a> <a href="#v:defaultField" class="selflink">#</a></p><div class="doc"><p>Sets the default value on a field (makes it optional with a
 default value).</p></div></div><div class="top"><p class="src"><a id="v:notSerializeDefaultField" class="def">notSerializeDefaultField</a> :: Q Exp -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> <a href="Ganeti/THH.html#notSerializeDefaultField" class="link">Source</a> <a href="#v:notSerializeDefaultField" class="selflink">#</a></p><div class="doc"><p>A defaultField which will be serialized only if it's value differs from
 a default value.</p></div></div><div class="top"><p class="src"><a id="v:presentInForthcoming" class="def">presentInForthcoming</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> <a href="Ganeti/THH.html#presentInForthcoming" class="link">Source</a> <a href="#v:presentInForthcoming" class="selflink">#</a></p><div class="doc"><p>Mark a field as present in the forthcoming variant.</p></div></div><div class="top"><p class="src"><a id="v:optionalField" class="def">optionalField</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> <a href="Ganeti/THH.html#optionalField" class="link">Source</a> <a href="#v:optionalField" class="selflink">#</a></p><div class="doc"><p>Marks a field optional (turning its base type into a Maybe).</p></div></div><div class="top"><p class="src"><a id="v:optionalNullSerField" class="def">optionalNullSerField</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> <a href="Ganeti/THH.html#optionalNullSerField" class="link">Source</a> <a href="#v:optionalNullSerField" class="selflink">#</a></p><div class="doc"><p>Marks a field optional (turning its base type into a Maybe), but
 with <code>Nothing</code> serialised explicitly as <em>null</em>.</p></div></div><div class="top"><p class="src"><a id="v:makeOptional" class="def">makeOptional</a> :: <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> -&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a> <a href="Ganeti/THH.html#makeOptional" class="link">Source</a> <a href="#v:makeOptional" class="selflink">#</a></p><div class="doc"><p>Make a field optional, if it isn't already.</p></div></div><div class="top"><p class="src"><a id="v:customField" class="def">customField</a> <a href="Ganeti/THH.html#customField" class="link">Source</a> <a href="#v:customField" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: Name</td><td class="doc"><p>The name of the read function</p></td></tr><tr><td class="src">-&gt; Name</td><td class="doc"><p>The name of the show function</p></td></tr><tr><td class="src">-&gt; [String]</td><td class="doc"><p>The name of extra field keys</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></td><td class="doc"><p>The original field</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a></td><td class="doc"><p>Updated field</p></td></tr></table></div><div class="doc"><p>Sets custom functions on a field.</p></div></div><a href="#g:2" id="g:2"><h1>Internal types</h1></a><a href="#g:3" id="g:3"><h1>Helper functions</h1></a><a href="#g:4" id="g:4"><h1>Template code for simple raw type-equivalent ADTs</h1></a><div class="top"><p class="src"><a id="v:declareLADT" class="def">declareLADT</a> :: Name -&gt; String -&gt; [(String, String)] -&gt; Q [Dec] <a href="Ganeti/THH.html#declareLADT" class="link">Source</a> <a href="#v:declareLADT" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:declareILADT" class="def">declareILADT</a> :: String -&gt; [(String, Int)] -&gt; Q [Dec] <a href="Ganeti/THH.html#declareILADT" class="link">Source</a> <a href="#v:declareILADT" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:declareIADT" class="def">declareIADT</a> :: String -&gt; [(String, Name)] -&gt; Q [Dec] <a href="Ganeti/THH.html#declareIADT" class="link">Source</a> <a href="#v:declareIADT" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:declareSADT" class="def">declareSADT</a> :: String -&gt; [(String, Name)] -&gt; Q [Dec] <a href="Ganeti/THH.html#declareSADT" class="link">Source</a> <a href="#v:declareSADT" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:makeJSONInstance" class="def">makeJSONInstance</a> :: Name -&gt; Q [Dec] <a href="Ganeti/THH.html#makeJSONInstance" class="link">Source</a> <a href="#v:makeJSONInstance" class="selflink">#</a></p><div class="doc"><p>Generates a JSON instance for a given type.</p><p>This assumes that the <em>name</em>ToRaw and <em>name</em>FromRaw functions
 have been defined as by the <code><a href="Ganeti-THH.html#v:declareSADT" title="Ganeti.THH">declareSADT</a></code> function.</p></div></div><a href="#g:5" id="g:5"><h1>Template code for opcodes</h1></a><div class="top"><p class="src"><a id="v:deCamelCase" class="def">deCamelCase</a> :: String -&gt; String <a href="Ganeti/THH.html#deCamelCase" class="link">Source</a> <a href="#v:deCamelCase" class="selflink">#</a></p><div class="doc"><p>Transforms a CamelCase string into an_underscore_based_one.</p></div></div><div class="top"><p class="src"><a id="v:genOpID" class="def">genOpID</a> :: Name -&gt; String -&gt; Q [Dec] <a href="Ganeti/THH.html#genOpID" class="link">Source</a> <a href="#v:genOpID" class="selflink">#</a></p><div class="doc"><p>Constructor-to-string for OpCode.</p></div></div><div class="top"><p class="src"><a id="v:genOpLowerStrip" class="def">genOpLowerStrip</a> :: String -&gt; Name -&gt; String -&gt; Q [Dec] <a href="Ganeti/THH.html#genOpLowerStrip" class="link">Source</a> <a href="#v:genOpLowerStrip" class="selflink">#</a></p><div class="doc"><p>Strips <code>Op</code> from the constructor name, converts to lower-case
 and adds a given prefix.</p></div></div><div class="top"><p class="src"><a id="v:genAllConstr" class="def">genAllConstr</a> :: (String -&gt; String) -&gt; Name -&gt; String -&gt; Q [Dec] <a href="Ganeti/THH.html#genAllConstr" class="link">Source</a> <a href="#v:genAllConstr" class="selflink">#</a></p><div class="doc"><p>Builds a list with all defined constructor names for a type.</p><pre>vstr :: String
vstr = [...]
</pre><p>Where the actual values of the string are the constructor names
 mapped via <code>trans_fun</code>.</p></div></div><div class="top"><p class="src"><a id="v:genAllOpIDs" class="def">genAllOpIDs</a> :: Name -&gt; String -&gt; Q [Dec] <a href="Ganeti/THH.html#genAllOpIDs" class="link">Source</a> <a href="#v:genAllOpIDs" class="selflink">#</a></p><div class="doc"><p>Generates a list of all defined opcode IDs.</p></div></div><a href="#g:6" id="g:6"><h1>Python code generation</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:OpCodeField" class="def">OpCodeField</a> <a href="Ganeti/THH.html#OpCodeField" class="link">Source</a> <a href="#t:OpCodeField" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:OpCodeField" class="def">OpCodeField</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:ocfName" class="def">ocfName</a> :: String</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:ocfType" class="def">ocfType</a> :: <a href="Ganeti-THH-PyType.html#t:PyType" title="Ganeti.THH.PyType">PyType</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:ocfDefl" class="def">ocfDefl</a> :: Maybe <a href="Ganeti-PyValue.html#t:PyValueEx" title="Ganeti.PyValue">PyValueEx</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:ocfDoc" class="def">ocfDoc</a> :: String</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:OpCodeDescriptor" class="def">OpCodeDescriptor</a> <a href="Ganeti/THH.html#OpCodeDescriptor" class="link">Source</a> <a href="#t:OpCodeDescriptor" class="selflink">#</a></p><div class="doc"><p>Transfers opcode data between the opcode description (through
 <code>genOpCode</code>) and the Python code generation functions.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:OpCodeDescriptor" class="def">OpCodeDescriptor</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:ocdName" class="def">ocdName</a> :: String</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:ocdType" class="def">ocdType</a> :: <a href="Ganeti-THH-PyType.html#t:PyType" title="Ganeti.THH.PyType">PyType</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:ocdDoc" class="def">ocdDoc</a> :: String</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:ocdFields" class="def">ocdFields</a> :: [<a href="Ganeti-THH.html#t:OpCodeField" title="Ganeti.THH">OpCodeField</a>]</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:ocdDescr" class="def">ocdDescr</a> :: String</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><a id="v:genOpCode" class="def">genOpCode</a> <a href="Ganeti/THH.html#genOpCode" class="link">Source</a> <a href="#v:genOpCode" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: String</td><td class="doc"><p>Type name to use</p></td></tr><tr><td class="src">-&gt; [OpCodeConstructor]</td><td class="doc"><p>Constructor name and parameters</p></td></tr><tr><td class="src">-&gt; Q [Dec]</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Generates the OpCode data type.</p><p>This takes an opcode logical definition, and builds both the
 datatype and the JSON serialisation out of it. We can't use a
 generic serialisation since we need to be compatible with Ganeti's
 own, so we have a few quirks to work around.</p></div></div><a href="#g:7" id="g:7"><h1>Template code for luxi</h1></a><div class="top"><p class="src"><a id="v:genStrOfOp" class="def">genStrOfOp</a> :: Name -&gt; String -&gt; Q [Dec] <a href="Ganeti/THH.html#genStrOfOp" class="link">Source</a> <a href="#v:genStrOfOp" class="selflink">#</a></p><div class="doc"><p>Constructor-to-string for LuxiOp.</p></div></div><div class="top"><p class="src"><a id="v:genStrOfKey" class="def">genStrOfKey</a> :: Name -&gt; String -&gt; Q [Dec] <a href="Ganeti/THH.html#genStrOfKey" class="link">Source</a> <a href="#v:genStrOfKey" class="selflink">#</a></p><div class="doc"><p>Constructor-to-string for MsgKeys.</p></div></div><div class="top"><p class="src"><a id="v:genLuxiOp" class="def">genLuxiOp</a> :: String -&gt; [LuxiConstructor] -&gt; Q [Dec] <a href="Ganeti/THH.html#genLuxiOp" class="link">Source</a> <a href="#v:genLuxiOp" class="selflink">#</a></p><div class="doc"><p>Generates the LuxiOp data type.</p><p>This takes a Luxi operation definition and builds both the
 datatype and the function transforming the arguments to JSON.
 We can't use anything less generic, because the way different
 operations are serialized differs on both parameter- and top-level.</p><p>There are two things to be defined for each parameter:</p><ul><li>name</li><li>type</li></ul></div></div><a href="#g:8" id="g:8"><h1><a href="Objects.html">Objects</a> functionality</h1></a><div class="top"><p class="src"><a id="v:buildObject" class="def">buildObject</a> :: String -&gt; String -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q [Dec] <a href="Ganeti/THH.html#buildObject" class="link">Source</a> <a href="#v:buildObject" class="selflink">#</a></p><div class="doc"><p>Build an object declaration.</p></div></div><div class="top"><p class="src"><a id="v:buildObjectWithForthcoming" class="def">buildObjectWithForthcoming</a> <a href="Ganeti/THH.html#buildObjectWithForthcoming" class="link">Source</a> <a href="#v:buildObjectWithForthcoming" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: String</td><td class="doc"><p>Name of the newly defined type</p></td></tr><tr><td class="src">-&gt; String</td><td class="doc"><p>base prefix for field names; for the real and forthcoming
 variant, with base prefix will be prefixed with &quot;real&quot;
 and forthcoming, respectively.</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>]</td><td class="doc"><p>List of fields in the real version</p></td></tr><tr><td class="src">-&gt; Q [Dec]</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Build an object that can have a forthcoming variant.
 This will create 3 data types: two objects, prefixed by
 <a href="Real.html">Real</a> and <a href="Forthcoming.html">Forthcoming</a>, respectively, and a sum type
 of those. The JSON representation of the latter will
 be a JSON object, dispatching on the &quot;forthcoming&quot; key.</p></div></div><div class="top"><p class="src"><a id="v:buildObjectSerialisation" class="def">buildObjectSerialisation</a> :: String -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q [Dec] <a href="Ganeti/THH.html#buildObjectSerialisation" class="link">Source</a> <a href="#v:buildObjectSerialisation" class="selflink">#</a></p><div class="doc"><p>Generates an object definition: data type and its JSON instance.</p></div></div><a href="#g:9" id="g:9"><h1>Inheritable parameter tables implementation</h1></a><div class="top"><p class="src"><a id="v:buildParam" class="def">buildParam</a> :: String -&gt; String -&gt; [<a href="Ganeti-THH.html#t:Field" title="Ganeti.THH">Field</a>] -&gt; Q [Dec] <a href="Ganeti/THH.html#buildParam" class="link">Source</a> <a href="#v:buildParam" class="selflink">#</a></p><div class="doc"><p>Build a parameter declaration.</p><p>This function builds two different data structures: a <em>filled</em> one,
 in which all fields are required, and a <em>partial</em> one, in which all
 fields are optional. Due to the current record syntax issues, the
 fields need to be named differrently for the two structures, so the
 partial ones get a <em>P</em> suffix.
 Also generate a default value for the partial parameters.</p></div></div><a href="#g:10" id="g:10"><h1>Template code for exceptions</h1></a><div class="top"><p class="src"><a id="v:excErrMsg" class="def">excErrMsg</a> :: (String, Q Type) <a href="Ganeti/THH.html#excErrMsg" class="link">Source</a> <a href="#v:excErrMsg" class="selflink">#</a></p><div class="doc"><p>Exception simple error message field.</p></div></div><div class="top"><p class="src"><a id="v:genException" class="def">genException</a> <a href="Ganeti/THH.html#genException" class="link">Source</a> <a href="#v:genException" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: String</td><td class="doc"><p>Name of new type</p></td></tr><tr><td class="src">-&gt; SimpleObject</td><td class="doc"><p>Constructor name and parameters</p></td></tr><tr><td class="src">-&gt; Q [Dec]</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Builds an exception type definition.</p></div></div><div class="top"><p class="src"><a id="v:ssconfConstructorName" class="def">ssconfConstructorName</a> :: String -&gt; String <a href="Ganeti/THH.html#ssconfConstructorName" class="link">Source</a> <a href="#v:ssconfConstructorName" class="selflink">#</a></p><div class="doc"><p>Compute the ssconf constructor name from its file name.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>