<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ganeti.Utils</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="Ganeti/Utils.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ganeti</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Ganeti.Utils</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Debug functions</a></li><li><a href="#g:2">Miscellaneous</a></li><li><a href="#g:3">Mathematical functions</a></li><li><a href="#g:4">Logical functions</a></li><li><a href="#g:5">Parsing utility functions</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Utility functions. </p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:debug">debug</a> :: Show a =&gt; a -&gt; a</li><li class="src short"><a href="#v:debugFn">debugFn</a> :: Show b =&gt; (a -&gt; b) -&gt; a -&gt; a</li><li class="src short"><a href="#v:debugXy">debugXy</a> :: Show a =&gt; a -&gt; b -&gt; b</li><li class="src short"><a href="#v:applyIf">applyIf</a> :: Bool -&gt; (a -&gt; a) -&gt; a -&gt; a</li><li class="src short"><a href="#v:commaJoin">commaJoin</a> :: [String] -&gt; String</li><li class="src short"><a href="#v:sepSplit">sepSplit</a> :: Eq a =&gt; a -&gt; [a] -&gt; [[a]]</li><li class="src short"><a href="#v:findFirst">findFirst</a> :: (Ord a, Enum a) =&gt; a -&gt; Set a -&gt; a</li><li class="src short"><a href="#v:plural">plural</a> :: Int -&gt; String -&gt; String -&gt; String</li><li class="src short"><a href="#v:ensureQuoted">ensureQuoted</a> :: String -&gt; String</li><li class="src short"><a href="#v:stdDev">stdDev</a> :: [Double] -&gt; Double</li><li class="src short"><a href="#v:if-39-">if'</a> :: Bool -&gt; a -&gt; a -&gt; a</li><li class="src short"><a href="#v:tryRead">tryRead</a> :: (MonadFail m, Read a) =&gt; String -&gt; String -&gt; m a</li><li class="src short"><a href="#v:readMaybe">readMaybe</a> :: Read a =&gt; String -&gt; Maybe a</li><li class="src short"><a href="#v:formatTable">formatTable</a> :: [[String]] -&gt; [Bool] -&gt; [[String]]</li><li class="src short"><a href="#v:printTable">printTable</a> :: String -&gt; [String] -&gt; [[String]] -&gt; [Bool] -&gt; String</li><li class="src short"><a href="#v:parseUnit">parseUnit</a> :: (MonadFail m, Integral a, Read a) =&gt; String -&gt; m a</li><li class="src short"><a href="#v:parseUnitAssumeBinary">parseUnitAssumeBinary</a> :: (MonadFail m, Integral a, Read a) =&gt; String -&gt; m a</li><li class="src short"><a href="#v:exitIfBad">exitIfBad</a> :: String -&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> a -&gt; IO a</li><li class="src short"><a href="#v:exitErr">exitErr</a> :: String -&gt; IO a</li><li class="src short"><a href="#v:exitWhen">exitWhen</a> :: Bool -&gt; String -&gt; IO ()</li><li class="src short"><a href="#v:exitUnless">exitUnless</a> :: Bool -&gt; String -&gt; IO ()</li><li class="src short"><a href="#v:logWarningIfBad">logWarningIfBad</a> :: String -&gt; a -&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> a -&gt; IO a</li><li class="src short"><a href="#v:tryAndLogIOError">tryAndLogIOError</a> :: IO a -&gt; String -&gt; (a -&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> b) -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> b)</li><li class="src short"><a href="#v:withDefaultOnIOError">withDefaultOnIOError</a> :: a -&gt; IO a -&gt; IO a</li><li class="src short"><a href="#v:warn">warn</a> :: String -&gt; IO ()</li><li class="src short"><a href="#v:niceSort">niceSort</a> :: [String] -&gt; [String]</li><li class="src short"><a href="#v:niceSortKey">niceSortKey</a> :: (a -&gt; String) -&gt; [a] -&gt; [a]</li><li class="src short"><a href="#v:rStripSpace">rStripSpace</a> :: String -&gt; String</li><li class="src short"><a href="#v:newUUID">newUUID</a> :: IO String</li><li class="src short"><a href="#v:isUUID">isUUID</a> :: String -&gt; Bool</li><li class="src short"><a href="#v:getCurrentTime">getCurrentTime</a> :: IO Integer</li><li class="src short"><a href="#v:getCurrentTimeUSec">getCurrentTimeUSec</a> :: IO Integer</li><li class="src short"><a href="#v:clockTimeToString">clockTimeToString</a> :: ClockTime -&gt; String</li><li class="src short"><a href="#v:clockTimeToCTime">clockTimeToCTime</a> :: ClockTime -&gt; EpochTime</li><li class="src short"><a href="#v:clockTimeToUSec">clockTimeToUSec</a> :: ClockTime -&gt; Integer</li><li class="src short"><a href="#v:cTimeToClockTime">cTimeToClockTime</a> :: EpochTime -&gt; ClockTime</li><li class="src short"><a href="#v:diffClockTimes">diffClockTimes</a> :: ClockTime -&gt; ClockTime -&gt; TimeDiff</li><li class="src short"><a href="#v:chompPrefix">chompPrefix</a> :: String -&gt; String -&gt; Maybe String</li><li class="src short"><a href="#v:wrap">wrap</a> :: Int -&gt; String -&gt; [String]</li><li class="src short"><a href="#v:trim">trim</a> :: String -&gt; String</li><li class="src short"><a href="#v:defaultHead">defaultHead</a> :: a -&gt; [a] -&gt; a</li><li class="src short"><a href="#v:exitIfEmpty">exitIfEmpty</a> :: String -&gt; [a] -&gt; IO a</li><li class="src short"><a href="#v:monadicThe">monadicThe</a> :: (Eq a, MonadFail m) =&gt; String -&gt; [a] -&gt; m a</li><li class="src short"><a href="#v:splitEithers">splitEithers</a> :: [Either a b] -&gt; ([a], [b], [Bool])</li><li class="src short"><a href="#v:recombineEithers">recombineEithers</a> :: (Show a, Show b) =&gt; [a] -&gt; [b] -&gt; [Bool] -&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> [Either a b]</li><li class="src short"><a href="#v:resolveAddr">resolveAddr</a> :: Int -&gt; String -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> (Family, SockAddr))</li><li class="src short"><a href="#v:setOwnerAndGroupFromNames">setOwnerAndGroupFromNames</a> :: FilePath -&gt; <a href="Ganeti-Runtime.html#t:GanetiDaemon" title="Ganeti.Runtime">GanetiDaemon</a> -&gt; <a href="Ganeti-Runtime.html#t:GanetiGroup" title="Ganeti.Runtime">GanetiGroup</a> -&gt; IO ()</li><li class="src short"><a href="#v:setOwnerWGroupR">setOwnerWGroupR</a> :: FilePath -&gt; IO ()</li><li class="src short"><a href="#v:formatOrdinal">formatOrdinal</a> :: (Integral a, Show a) =&gt; a -&gt; String</li><li class="src short"><a href="#v:lockFile">lockFile</a> :: FilePath -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> Fd)</li><li class="src short"><span class="keyword">type</span> <a href="#t:FStat">FStat</a> = (EpochTime, FileID, FileOffset)</li><li class="src short"><a href="#v:nullFStat">nullFStat</a> :: <a href="Ganeti-Utils.html#t:FStat" title="Ganeti.Utils">FStat</a></li><li class="src short"><a href="#v:getFStat">getFStat</a> :: FilePath -&gt; IO <a href="Ganeti-Utils.html#t:FStat" title="Ganeti.Utils">FStat</a></li><li class="src short"><a href="#v:getFStatSafe">getFStatSafe</a> :: FilePath -&gt; IO <a href="Ganeti-Utils.html#t:FStat" title="Ganeti.Utils">FStat</a></li><li class="src short"><a href="#v:needsReload">needsReload</a> :: <a href="Ganeti-Utils.html#t:FStat" title="Ganeti.Utils">FStat</a> -&gt; FilePath -&gt; IO (Maybe <a href="Ganeti-Utils.html#t:FStat" title="Ganeti.Utils">FStat</a>)</li><li class="src short"><a href="#v:watchFileBy">watchFileBy</a> :: FilePath -&gt; Int -&gt; (a -&gt; Bool) -&gt; IO a -&gt; IO a</li><li class="src short"><a href="#v:watchFile">watchFile</a> :: Eq a =&gt; FilePath -&gt; Int -&gt; a -&gt; IO a -&gt; IO a</li><li class="src short"><span class="keyword">data</span> <a href="#t:FilePermissions">FilePermissions</a> = <a href="#v:FilePermissions">FilePermissions</a> {<ul class="subs"><li><a href="#v:fpOwner">fpOwner</a> :: Maybe <a href="Ganeti-Runtime.html#t:GanetiDaemon" title="Ganeti.Runtime">GanetiDaemon</a></li><li><a href="#v:fpGroup">fpGroup</a> :: Maybe <a href="Ganeti-Runtime.html#t:GanetiGroup" title="Ganeti.Runtime">GanetiGroup</a></li><li><a href="#v:fpPermissions">fpPermissions</a> :: FileMode</li></ul>}</li><li class="src short"><a href="#v:ensurePermissions">ensurePermissions</a> :: FilePath -&gt; <a href="Ganeti-Utils.html#t:FilePermissions" title="Ganeti.Utils">FilePermissions</a> -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> ())</li><li class="src short"><a href="#v:safeRenameFile">safeRenameFile</a> :: <a href="Ganeti-Utils.html#t:FilePermissions" title="Ganeti.Utils">FilePermissions</a> -&gt; FilePath -&gt; FilePath -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> ())</li><li class="src short"><a href="#v:ordNub">ordNub</a> :: Ord a =&gt; [a] -&gt; [a]</li><li class="src short"><a href="#v:frequency">frequency</a> :: Ord t =&gt; [t] -&gt; [(Int, t)]</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Debug functions</h1></a><div class="top"><p class="src"><a id="v:debug" class="def">debug</a> :: Show a =&gt; a -&gt; a <a href="Ganeti/Utils.html#debug" class="link">Source</a> <a href="#v:debug" class="selflink">#</a></p><div class="doc"><p>To be used only for debugging, breaks referential integrity.</p></div></div><div class="top"><p class="src"><a id="v:debugFn" class="def">debugFn</a> :: Show b =&gt; (a -&gt; b) -&gt; a -&gt; a <a href="Ganeti/Utils.html#debugFn" class="link">Source</a> <a href="#v:debugFn" class="selflink">#</a></p><div class="doc"><p>Displays a modified form of the second parameter before returning
 it.</p></div></div><div class="top"><p class="src"><a id="v:debugXy" class="def">debugXy</a> :: Show a =&gt; a -&gt; b -&gt; b <a href="Ganeti/Utils.html#debugXy" class="link">Source</a> <a href="#v:debugXy" class="selflink">#</a></p><div class="doc"><p>Show the first parameter before returning the second one.</p></div></div><a href="#g:2" id="g:2"><h1>Miscellaneous</h1></a><div class="top"><p class="src"><a id="v:applyIf" class="def">applyIf</a> :: Bool -&gt; (a -&gt; a) -&gt; a -&gt; a <a href="Ganeti/Utils.html#applyIf" class="link">Source</a> <a href="#v:applyIf" class="selflink">#</a></p><div class="doc"><p>Apply the function if condition holds, otherwise use default value.</p></div></div><div class="top"><p class="src"><a id="v:commaJoin" class="def">commaJoin</a> :: [String] -&gt; String <a href="Ganeti/Utils.html#commaJoin" class="link">Source</a> <a href="#v:commaJoin" class="selflink">#</a></p><div class="doc"><p>Comma-join a string list.</p></div></div><div class="top"><p class="src"><a id="v:sepSplit" class="def">sepSplit</a> :: Eq a =&gt; a -&gt; [a] -&gt; [[a]] <a href="Ganeti/Utils.html#sepSplit" class="link">Source</a> <a href="#v:sepSplit" class="selflink">#</a></p><div class="doc"><p>Split a list on a separator and return a list of lists.</p></div></div><div class="top"><p class="src"><a id="v:findFirst" class="def">findFirst</a> :: (Ord a, Enum a) =&gt; a -&gt; Set a -&gt; a <a href="Ganeti/Utils.html#findFirst" class="link">Source</a> <a href="#v:findFirst" class="selflink">#</a></p><div class="doc"><p>Finds the first unused element in a set starting from a given base.</p></div></div><div class="top"><p class="src"><a id="v:plural" class="def">plural</a> :: Int -&gt; String -&gt; String -&gt; String <a href="Ganeti/Utils.html#plural" class="link">Source</a> <a href="#v:plural" class="selflink">#</a></p><div class="doc"><p>Simple pluralize helper</p></div></div><div class="top"><p class="src"><a id="v:ensureQuoted" class="def">ensureQuoted</a> :: String -&gt; String <a href="Ganeti/Utils.html#ensureQuoted" class="link">Source</a> <a href="#v:ensureQuoted" class="selflink">#</a></p><div class="doc"><p>Ensure a value is quoted if needed.</p></div></div><a href="#g:3" id="g:3"><h1>Mathematical functions</h1></a><div class="top"><p class="src"><a id="v:stdDev" class="def">stdDev</a> :: [Double] -&gt; Double <a href="Ganeti/Utils.html#stdDev" class="link">Source</a> <a href="#v:stdDev" class="selflink">#</a></p><div class="doc"><p>Standard deviation function.</p></div></div><a href="#g:4" id="g:4"><h1>Logical functions</h1></a><div class="top"><p class="src"><a id="v:if-39-" class="def">if'</a> <a href="Ganeti/Utils.html#if%27" class="link">Source</a> <a href="#v:if-39-" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: Bool</td><td class="doc"><p>condition</p></td></tr><tr><td class="src">-&gt; a</td><td class="doc"><p>&quot;then&quot; result</p></td></tr><tr><td class="src">-&gt; a</td><td class="doc"><p>&quot;else&quot; result</p></td></tr><tr><td class="src">-&gt; a</td><td class="doc"><p>&quot;then&quot; or &quot;else&quot; result depending on the condition</p></td></tr></table></div><div class="doc"><p>&quot;if&quot; as a function, rather than as syntactic sugar.</p></div></div><a href="#g:5" id="g:5"><h1>Parsing utility functions</h1></a><div class="top"><p class="src"><a id="v:tryRead" class="def">tryRead</a> :: (MonadFail m, Read a) =&gt; String -&gt; String -&gt; m a <a href="Ganeti/Utils.html#tryRead" class="link">Source</a> <a href="#v:tryRead" class="selflink">#</a></p><div class="doc"><p>Safe <code>read</code> function returning data encapsulated in a Result.</p></div></div><div class="top"><p class="src"><a id="v:readMaybe" class="def">readMaybe</a> :: Read a =&gt; String -&gt; Maybe a <a href="Ganeti/Utils.html#readMaybe" class="link">Source</a> <a href="#v:readMaybe" class="selflink">#</a></p><div class="doc"><p>Parse a string using the <code>Read</code> instance.
 Succeeds if there is exactly one valid result.</p><p><em>Backport from Text.Read introduced in base-4.6.0.0</em></p></div></div><div class="top"><p class="src"><a id="v:formatTable" class="def">formatTable</a> :: [[String]] -&gt; [Bool] -&gt; [[String]] <a href="Ganeti/Utils.html#formatTable" class="link">Source</a> <a href="#v:formatTable" class="selflink">#</a></p><div class="doc"><p>Format a table of strings to maintain consistent length.</p></div></div><div class="top"><p class="src"><a id="v:printTable" class="def">printTable</a> :: String -&gt; [String] -&gt; [[String]] -&gt; [Bool] -&gt; String <a href="Ganeti/Utils.html#printTable" class="link">Source</a> <a href="#v:printTable" class="selflink">#</a></p><div class="doc"><p>Constructs a printable table from given header and rows</p></div></div><div class="top"><p class="src"><a id="v:parseUnit" class="def">parseUnit</a> :: (MonadFail m, Integral a, Read a) =&gt; String -&gt; m a <a href="Ganeti/Utils.html#parseUnit" class="link">Source</a> <a href="#v:parseUnit" class="selflink">#</a></p><div class="doc"><p>Tries to extract number and scale from the given string.</p><p>Input must be in the format NUMBER+ SPACE* [UNIT]. If no unit is
 specified, it defaults to MiB. Return value is always an integral
 value in MiB.</p></div></div><div class="top"><p class="src"><a id="v:parseUnitAssumeBinary" class="def">parseUnitAssumeBinary</a> :: (MonadFail m, Integral a, Read a) =&gt; String -&gt; m a <a href="Ganeti/Utils.html#parseUnitAssumeBinary" class="link">Source</a> <a href="#v:parseUnitAssumeBinary" class="selflink">#</a></p><div class="doc"><p>Tries to extract a number and scale from a given string, taking
 all kilos to be binary.</p></div></div><div class="top"><p class="src"><a id="v:exitIfBad" class="def">exitIfBad</a> :: String -&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> a -&gt; IO a <a href="Ganeti/Utils.html#exitIfBad" class="link">Source</a> <a href="#v:exitIfBad" class="selflink">#</a></p><div class="doc"><p>Unwraps a <code><a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a></code>, exiting the program if it is a <code><a href="Ganeti-BasicTypes.html#v:Bad" title="Ganeti.BasicTypes">Bad</a></code> value,
 otherwise returning the actual contained value.</p></div></div><div class="top"><p class="src"><a id="v:exitErr" class="def">exitErr</a> :: String -&gt; IO a <a href="Ganeti/Utils.html#exitErr" class="link">Source</a> <a href="#v:exitErr" class="selflink">#</a></p><div class="doc"><p>Exits immediately with an error message.</p></div></div><div class="top"><p class="src"><a id="v:exitWhen" class="def">exitWhen</a> :: Bool -&gt; String -&gt; IO () <a href="Ganeti/Utils.html#exitWhen" class="link">Source</a> <a href="#v:exitWhen" class="selflink">#</a></p><div class="doc"><p>Exits with an error message if the given boolean condition if true.</p></div></div><div class="top"><p class="src"><a id="v:exitUnless" class="def">exitUnless</a> :: Bool -&gt; String -&gt; IO () <a href="Ganeti/Utils.html#exitUnless" class="link">Source</a> <a href="#v:exitUnless" class="selflink">#</a></p><div class="doc"><p>Exits with an error message <em>unless</em> the given boolean condition
 if true, the opposite of <code><a href="Ganeti-Utils.html#v:exitWhen" title="Ganeti.Utils">exitWhen</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:logWarningIfBad" class="def">logWarningIfBad</a> :: String -&gt; a -&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> a -&gt; IO a <a href="Ganeti/Utils.html#logWarningIfBad" class="link">Source</a> <a href="#v:logWarningIfBad" class="selflink">#</a></p><div class="doc"><p>Unwraps a <code><a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a></code>, logging a warning message and then returning a default
 value if it is a <code><a href="Ganeti-BasicTypes.html#v:Bad" title="Ganeti.BasicTypes">Bad</a></code> value, otherwise returning the actual contained value.</p></div></div><div class="top"><p class="src"><a id="v:tryAndLogIOError" class="def">tryAndLogIOError</a> :: IO a -&gt; String -&gt; (a -&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> b) -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> b) <a href="Ganeti/Utils.html#tryAndLogIOError" class="link">Source</a> <a href="#v:tryAndLogIOError" class="selflink">#</a></p><div class="doc"><p>Try an IO interaction, log errors and unfold as a <code><a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:withDefaultOnIOError" class="def">withDefaultOnIOError</a> :: a -&gt; IO a -&gt; IO a <a href="Ganeti/Utils.html#withDefaultOnIOError" class="link">Source</a> <a href="#v:withDefaultOnIOError" class="selflink">#</a></p><div class="doc"><p>Try an IO interaction and return a default value if the interaction
 throws an IOError.</p></div></div><div class="top"><p class="src"><a id="v:warn" class="def">warn</a> :: String -&gt; IO () <a href="Ganeti/Utils.html#warn" class="link">Source</a> <a href="#v:warn" class="selflink">#</a></p><div class="doc"><p>Print a warning, but do not exit.</p></div></div><div class="top"><p class="src"><a id="v:niceSort" class="def">niceSort</a> :: [String] -&gt; [String] <a href="Ganeti/Utils.html#niceSort" class="link">Source</a> <a href="#v:niceSort" class="selflink">#</a></p><div class="doc"><p>Sort a list of strings based on digit and non-digit groupings.</p><p>Given a list of names <code>[<code>a1</code>, <code>a10</code>, <code>a11</code>, <code>a2</code>]</code> this function
will sort the list in the logical order <code>[<code>a1</code>, <code>a2</code>, <code>a10</code>, <code>a11</code>]</code>.</p><p>The sort algorithm breaks each name in groups of either only-digits or
no-digits, and sorts based on each group.</p><p>Internally, this is not implemented via regexes (like the Python
version), but via actual splitting of the string in sequences of
either digits or everything else, and converting the digit sequences
in <em>Left Integer</em> and the non-digit ones in <em>Right String</em>, at which
point sorting becomes trivial due to the built-in <code>Either</code> ordering;
we only need one extra step of dropping the key at the end.</p></div></div><div class="top"><p class="src"><a id="v:niceSortKey" class="def">niceSortKey</a> :: (a -&gt; String) -&gt; [a] -&gt; [a] <a href="Ganeti/Utils.html#niceSortKey" class="link">Source</a> <a href="#v:niceSortKey" class="selflink">#</a></p><div class="doc"><p>Key-version of <code><a href="Ganeti-Utils.html#v:niceSort" title="Ganeti.Utils">niceSort</a></code>. We use <code>sortBy</code> and <code>compare <code>on</code> fst</code>
 since we don't want to add an ordering constraint on the <em>a</em> type,
 hence the need to only compare the first element of the <em>(key, a)</em>
 tuple.</p></div></div><div class="top"><p class="src"><a id="v:rStripSpace" class="def">rStripSpace</a> :: String -&gt; String <a href="Ganeti/Utils.html#rStripSpace" class="link">Source</a> <a href="#v:rStripSpace" class="selflink">#</a></p><div class="doc"><p>Strip space characthers (including newline). As this is
 expensive, should only be run on small strings.</p></div></div><div class="top"><p class="src"><a id="v:newUUID" class="def">newUUID</a> :: IO String <a href="Ganeti/Utils.html#newUUID" class="link">Source</a> <a href="#v:newUUID" class="selflink">#</a></p><div class="doc"><p>Returns a random UUID.
 This is a Linux-specific method as it uses the /proc filesystem.</p></div></div><div class="top"><p class="src"><a id="v:isUUID" class="def">isUUID</a> :: String -&gt; Bool <a href="Ganeti/Utils.html#isUUID" class="link">Source</a> <a href="#v:isUUID" class="selflink">#</a></p><div class="doc"><p>Checks if the string is a valid UUID as in &quot;Ganeti.Constants.uuidRegex&quot;.</p></div></div><div class="top"><p class="src"><a id="v:getCurrentTime" class="def">getCurrentTime</a> :: IO Integer <a href="Ganeti/Utils.html#getCurrentTime" class="link">Source</a> <a href="#v:getCurrentTime" class="selflink">#</a></p><div class="doc"><p>Returns the current time as an <code>Integer</code> representing the number
 of seconds from the Unix epoch.</p></div></div><div class="top"><p class="src"><a id="v:getCurrentTimeUSec" class="def">getCurrentTimeUSec</a> :: IO Integer <a href="Ganeti/Utils.html#getCurrentTimeUSec" class="link">Source</a> <a href="#v:getCurrentTimeUSec" class="selflink">#</a></p><div class="doc"><p>Returns the current time as an <code>Integer</code> representing the number
 of microseconds from the Unix epoch (hence the need for <code>Integer</code>).</p></div></div><div class="top"><p class="src"><a id="v:clockTimeToString" class="def">clockTimeToString</a> :: ClockTime -&gt; String <a href="Ganeti/Utils.html#clockTimeToString" class="link">Source</a> <a href="#v:clockTimeToString" class="selflink">#</a></p><div class="doc"><p>Convert a ClockTime into a (seconds-only) timestamp.</p></div></div><div class="top"><p class="src"><a id="v:clockTimeToCTime" class="def">clockTimeToCTime</a> :: ClockTime -&gt; EpochTime <a href="Ganeti/Utils.html#clockTimeToCTime" class="link">Source</a> <a href="#v:clockTimeToCTime" class="selflink">#</a></p><div class="doc"><p>Convert a ClockTime into a (seconds-only) <code>EpochTime</code> (AKA <code>time_t</code>).</p></div></div><div class="top"><p class="src"><a id="v:clockTimeToUSec" class="def">clockTimeToUSec</a> :: ClockTime -&gt; Integer <a href="Ganeti/Utils.html#clockTimeToUSec" class="link">Source</a> <a href="#v:clockTimeToUSec" class="selflink">#</a></p><div class="doc"><p>Convert a ClockTime the number of microseconds since the epoch.</p></div></div><div class="top"><p class="src"><a id="v:cTimeToClockTime" class="def">cTimeToClockTime</a> :: EpochTime -&gt; ClockTime <a href="Ganeti/Utils.html#cTimeToClockTime" class="link">Source</a> <a href="#v:cTimeToClockTime" class="selflink">#</a></p><div class="doc"><p>Convert a ClockTime into a (seconds-only) <code>EpochTime</code> (AKA <code>time_t</code>).</p></div></div><div class="top"><p class="src"><a id="v:diffClockTimes" class="def">diffClockTimes</a> :: ClockTime -&gt; ClockTime -&gt; TimeDiff <a href="Ganeti/Utils.html#diffClockTimes" class="link">Source</a> <a href="#v:diffClockTimes" class="selflink">#</a></p><div class="doc"><p>A version of <code><a href="Ganeti-Utils.html#v:diffClockTimes" title="Ganeti.Utils">diffClockTimes</a></code> that works around ghc bug #2519.</p></div></div><div class="top"><p class="src"><a id="v:chompPrefix" class="def">chompPrefix</a> :: String -&gt; String -&gt; Maybe String <a href="Ganeti/Utils.html#chompPrefix" class="link">Source</a> <a href="#v:chompPrefix" class="selflink">#</a></p><div class="doc"><p>Strip a prefix from a string, allowing the last character of the prefix
(which is assumed to be a separator) to be absent from the string if the string
terminates there.</p><p>&gt;&gt;&gt; chompPrefix &quot;foo:bar:&quot; &quot;a:b:c&quot;
Nothing</p><p>&gt;&gt;&gt; chompPrefix &quot;foo:bar:&quot; &quot;foo:bar:baz&quot;
Just &quot;baz&quot;</p><p>&gt;&gt;&gt; chompPrefix &quot;foo:bar:&quot; &quot;foo:bar:&quot;
Just &quot;&quot;</p><p>&gt;&gt;&gt; chompPrefix &quot;foo:bar:&quot; &quot;foo:bar&quot;
Just &quot;&quot;</p><p>&gt;&gt;&gt; chompPrefix &quot;foo:bar:&quot; &quot;foo:barbaz&quot;
Nothing</p></div></div><div class="top"><p class="src"><a id="v:wrap" class="def">wrap</a> <a href="Ganeti/Utils.html#wrap" class="link">Source</a> <a href="#v:wrap" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: Int</td><td class="doc"><p>maxWidth</p></td></tr><tr><td class="src">-&gt; String</td><td class="doc"><p>string that needs wrapping</p></td></tr><tr><td class="src">-&gt; [String]</td><td class="doc"><p>string &quot;broken&quot; in lines</p></td></tr></table></div><div class="doc"><p>Breaks a string in lines with length &lt;= maxWidth.</p><p>NOTE: The split is OK if:</p><ul><li>It doesn't break a word, i.e. the next line begins with space
   (<code>isSpace . head $ rest</code>) or the current line ends with space
   (<code>null revExtra</code>);</li><li>It breaks a very big word that doesn't fit anyway (<code>null revLine</code>).</li></ul></div></div><div class="top"><p class="src"><a id="v:trim" class="def">trim</a> :: String -&gt; String <a href="Ganeti/Utils.html#trim" class="link">Source</a> <a href="#v:trim" class="selflink">#</a></p><div class="doc"><p>Removes surrounding whitespace. Should only be used in small
 strings.</p></div></div><div class="top"><p class="src"><a id="v:defaultHead" class="def">defaultHead</a> :: a -&gt; [a] -&gt; a <a href="Ganeti/Utils.html#defaultHead" class="link">Source</a> <a href="#v:defaultHead" class="selflink">#</a></p><div class="doc"><p>A safer head version, with a default value.</p></div></div><div class="top"><p class="src"><a id="v:exitIfEmpty" class="def">exitIfEmpty</a> :: String -&gt; [a] -&gt; IO a <a href="Ganeti/Utils.html#exitIfEmpty" class="link">Source</a> <a href="#v:exitIfEmpty" class="selflink">#</a></p><div class="doc"><p>A <code>head</code> version in the I/O monad, for validating parameters
 without which we cannot continue.</p></div></div><div class="top"><p class="src"><a id="v:monadicThe" class="def">monadicThe</a> :: (Eq a, MonadFail m) =&gt; String -&gt; [a] -&gt; m a <a href="Ganeti/Utils.html#monadicThe" class="link">Source</a> <a href="#v:monadicThe" class="selflink">#</a></p><div class="doc"><p>Obtain the unique element of a list in an arbitrary monad.</p></div></div><div class="top"><p class="src"><a id="v:splitEithers" class="def">splitEithers</a> :: [Either a b] -&gt; ([a], [b], [Bool]) <a href="Ganeti/Utils.html#splitEithers" class="link">Source</a> <a href="#v:splitEithers" class="selflink">#</a></p><div class="doc"><p>Split an <code>Either</code> list into two separate lists (containing the
 <code>Left</code> and <code>Right</code> elements, plus a &quot;trail&quot; list that allows
 recombination later.</p><p>This is splitter; for recombination, look at <code><a href="Ganeti-Utils.html#v:recombineEithers" title="Ganeti.Utils">recombineEithers</a></code>.
 The sum of &quot;left&quot; and &quot;right&quot; lists should be equal to the
 original list length, and the trail list should be the same length
 as well. The entries in the resulting lists are reversed in
 comparison with the original list.</p></div></div><div class="top"><p class="src"><a id="v:recombineEithers" class="def">recombineEithers</a> :: (Show a, Show b) =&gt; [a] -&gt; [b] -&gt; [Bool] -&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> [Either a b] <a href="Ganeti/Utils.html#recombineEithers" class="link">Source</a> <a href="#v:recombineEithers" class="selflink">#</a></p><div class="doc"><p>Recombines two &quot;left&quot; and &quot;right&quot; lists using a &quot;trail&quot;
 list into a single <code>Either</code> list.</p><p>This is the counterpart to <code><a href="Ganeti-Utils.html#v:splitEithers" title="Ganeti.Utils">splitEithers</a></code>. It does the opposite
 transformation, and the output list will be the reverse of the
 input lists. Since <code><a href="Ganeti-Utils.html#v:splitEithers" title="Ganeti.Utils">splitEithers</a></code> also reverses the lists, calling
 these together will result in the original list.</p><p>Mismatches in the structure of the lists (e.g. inconsistent
 lengths) are represented via <code><a href="Ganeti-BasicTypes.html#v:Bad" title="Ganeti.BasicTypes">Bad</a></code>; normally this function should
 not fail, if lists are passed as generated by <code><a href="Ganeti-Utils.html#v:splitEithers" title="Ganeti.Utils">splitEithers</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:resolveAddr" class="def">resolveAddr</a> :: Int -&gt; String -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> (Family, SockAddr)) <a href="Ganeti/Utils.html#resolveAddr" class="link">Source</a> <a href="#v:resolveAddr" class="selflink">#</a></p><div class="doc"><p>Resolves a numeric address.</p></div></div><div class="top"><p class="src"><a id="v:setOwnerAndGroupFromNames" class="def">setOwnerAndGroupFromNames</a> :: FilePath -&gt; <a href="Ganeti-Runtime.html#t:GanetiDaemon" title="Ganeti.Runtime">GanetiDaemon</a> -&gt; <a href="Ganeti-Runtime.html#t:GanetiGroup" title="Ganeti.Runtime">GanetiGroup</a> -&gt; IO () <a href="Ganeti/Utils.html#setOwnerAndGroupFromNames" class="link">Source</a> <a href="#v:setOwnerAndGroupFromNames" class="selflink">#</a></p><div class="doc"><p>Set the owner and the group of a file (given as names, not numeric id).</p></div></div><div class="top"><p class="src"><a id="v:setOwnerWGroupR" class="def">setOwnerWGroupR</a> :: FilePath -&gt; IO () <a href="Ganeti/Utils.html#setOwnerWGroupR" class="link">Source</a> <a href="#v:setOwnerWGroupR" class="selflink">#</a></p><div class="doc"><p>Resets permissions so that the owner can read/write and the group only
 read. All other permissions are cleared.</p></div></div><div class="top"><p class="src"><a id="v:formatOrdinal" class="def">formatOrdinal</a> :: (Integral a, Show a) =&gt; a -&gt; String <a href="Ganeti/Utils.html#formatOrdinal" class="link">Source</a> <a href="#v:formatOrdinal" class="selflink">#</a></p><div class="doc"><p>Formats an integral number, appending a suffix.</p></div></div><div class="top"><p class="src"><a id="v:lockFile" class="def">lockFile</a> :: FilePath -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> Fd) <a href="Ganeti/Utils.html#lockFile" class="link">Source</a> <a href="#v:lockFile" class="selflink">#</a></p><div class="doc"><p>Attempt, in a non-blocking way, to obtain a lock on a given file; report
 back success.
 Returns the file descriptor so that the lock can be released by closing</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:FStat" class="def">FStat</a> = (EpochTime, FileID, FileOffset) <a href="Ganeti/Utils.html#FStat" class="link">Source</a> <a href="#t:FStat" class="selflink">#</a></p><div class="doc"><p>File stat identifier.</p></div></div><div class="top"><p class="src"><a id="v:nullFStat" class="def">nullFStat</a> :: <a href="Ganeti-Utils.html#t:FStat" title="Ganeti.Utils">FStat</a> <a href="Ganeti/Utils.html#nullFStat" class="link">Source</a> <a href="#v:nullFStat" class="selflink">#</a></p><div class="doc"><p>Null <code><a href="Ganeti-Utils.html#t:FStat" title="Ganeti.Utils">FStat</a></code> value.</p></div></div><div class="top"><p class="src"><a id="v:getFStat" class="def">getFStat</a> :: FilePath -&gt; IO <a href="Ganeti-Utils.html#t:FStat" title="Ganeti.Utils">FStat</a> <a href="Ganeti/Utils.html#getFStat" class="link">Source</a> <a href="#v:getFStat" class="selflink">#</a></p><div class="doc"><p>Wrapper over <code>buildFileStatus</code>. This reads the data from the
 filesystem and then builds our cache structure.</p></div></div><div class="top"><p class="src"><a id="v:getFStatSafe" class="def">getFStatSafe</a> :: FilePath -&gt; IO <a href="Ganeti-Utils.html#t:FStat" title="Ganeti.Utils">FStat</a> <a href="Ganeti/Utils.html#getFStatSafe" class="link">Source</a> <a href="#v:getFStatSafe" class="selflink">#</a></p><div class="doc"><p>Safe version of <code><a href="Ganeti-Utils.html#v:getFStat" title="Ganeti.Utils">getFStat</a></code>, that ignores IOErrors.</p></div></div><div class="top"><p class="src"><a id="v:needsReload" class="def">needsReload</a> :: <a href="Ganeti-Utils.html#t:FStat" title="Ganeti.Utils">FStat</a> -&gt; FilePath -&gt; IO (Maybe <a href="Ganeti-Utils.html#t:FStat" title="Ganeti.Utils">FStat</a>) <a href="Ganeti/Utils.html#needsReload" class="link">Source</a> <a href="#v:needsReload" class="selflink">#</a></p><div class="doc"><p>Check if the file needs reloading</p></div></div><div class="top"><p class="src"><a id="v:watchFileBy" class="def">watchFileBy</a> :: FilePath -&gt; Int -&gt; (a -&gt; Bool) -&gt; IO a -&gt; IO a <a href="Ganeti/Utils.html#watchFileBy" class="link">Source</a> <a href="#v:watchFileBy" class="selflink">#</a></p><div class="doc"><p>Within the given timeout (in seconds), wait for for the output
 of the given method to satisfy a given predicate and return the new value;
 make use of the promise that the method will only change its value, if
 the given file changes on disk. If the file does not exist on disk, return
 immediately.</p></div></div><div class="top"><p class="src"><a id="v:watchFile" class="def">watchFile</a> :: Eq a =&gt; FilePath -&gt; Int -&gt; a -&gt; IO a -&gt; IO a <a href="Ganeti/Utils.html#watchFile" class="link">Source</a> <a href="#v:watchFile" class="selflink">#</a></p><div class="doc"><p>Within the given timeout (in seconds), wait for for the output
 of the given method to change and return the new value; make use of
 the promise that the method will only change its value, if
 the given file changes on disk. If the file does not exist on disk, return
 immediately.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:FilePermissions" class="def">FilePermissions</a> <a href="Ganeti/Utils.html#FilePermissions" class="link">Source</a> <a href="#t:FilePermissions" class="selflink">#</a></p><div class="doc"><p>Type describing ownership and permissions of newly generated
 directories and files. All parameters are optional, with nothing
 meaning that the default value should be left untouched.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:FilePermissions" class="def">FilePermissions</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:fpOwner" class="def">fpOwner</a> :: Maybe <a href="Ganeti-Runtime.html#t:GanetiDaemon" title="Ganeti.Runtime">GanetiDaemon</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:fpGroup" class="def">fpGroup</a> :: Maybe <a href="Ganeti-Runtime.html#t:GanetiGroup" title="Ganeti.Runtime">GanetiGroup</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:fpPermissions" class="def">fpPermissions</a> :: FileMode</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><a id="v:ensurePermissions" class="def">ensurePermissions</a> :: FilePath -&gt; <a href="Ganeti-Utils.html#t:FilePermissions" title="Ganeti.Utils">FilePermissions</a> -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> ()) <a href="Ganeti/Utils.html#ensurePermissions" class="link">Source</a> <a href="#v:ensurePermissions" class="selflink">#</a></p><div class="doc"><p>Ensure that a given file or directory has the permissions, and
 possibly ownerships, as required.</p></div></div><div class="top"><p class="src"><a id="v:safeRenameFile" class="def">safeRenameFile</a> :: <a href="Ganeti-Utils.html#t:FilePermissions" title="Ganeti.Utils">FilePermissions</a> -&gt; FilePath -&gt; FilePath -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> ()) <a href="Ganeti/Utils.html#safeRenameFile" class="link">Source</a> <a href="#v:safeRenameFile" class="selflink">#</a></p><div class="doc"><p>Safely rename a file, creating the target directory, if needed.</p></div></div><div class="top"><p class="src"><a id="v:ordNub" class="def">ordNub</a> :: Ord a =&gt; [a] -&gt; [a] <a href="Ganeti/Utils.html#ordNub" class="link">Source</a> <a href="#v:ordNub" class="selflink">#</a></p><div class="doc"><p>Removes duplicates, preserving order.</p></div></div><div class="top"><p class="src"><a id="v:frequency" class="def">frequency</a> :: Ord t =&gt; [t] -&gt; [(Int, t)] <a href="Ganeti/Utils.html#frequency" class="link">Source</a> <a href="#v:frequency" class="selflink">#</a></p><div class="doc"><p>Returns a list of tuples of elements and the number of times they occur
 in a list</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>