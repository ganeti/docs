<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Ganeti.Daemon</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ganeti</span><ul class="links" id="page-menu"><li><a href="Ganeti/Daemon.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Ganeti.Daemon</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Constants</a></li><li><a href="#g:2">Data types</a></li><li><a href="#g:3">Command line options</a></li><li><a href="#g:4">Daemon-related functions</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Implementation of the generic daemon functionality.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:devNull">devNull</a> :: FilePath</li><li class="src short"><a href="#v:daemonStartupErr">daemonStartupErr</a> :: String -&gt; String</li><li class="src short"><span class="keyword">data</span> <a href="#t:DaemonOptions">DaemonOptions</a> = <a href="#v:DaemonOptions">DaemonOptions</a> {<ul class="subs"><li><a href="#v:optShowHelp">optShowHelp</a> :: Bool</li><li><a href="#v:optShowVer">optShowVer</a> :: Bool</li><li><a href="#v:optShowComp">optShowComp</a> :: Bool</li><li><a href="#v:optDaemonize">optDaemonize</a> :: Bool</li><li><a href="#v:optPort">optPort</a> :: Maybe Word16</li><li><a href="#v:optDebug">optDebug</a> :: Bool</li><li><a href="#v:optNoUserChecks">optNoUserChecks</a> :: Bool</li><li><a href="#v:optBindAddress">optBindAddress</a> :: Maybe String</li><li><a href="#v:optSyslogUsage">optSyslogUsage</a> :: Maybe <a href="Ganeti-Logging.html#t:SyslogUsage" title="Ganeti.Logging">SyslogUsage</a></li><li><a href="#v:optForceNode">optForceNode</a> :: Bool</li><li><a href="#v:optNoVoting">optNoVoting</a> :: Bool</li><li><a href="#v:optYesDoIt">optYesDoIt</a> :: Bool</li></ul>}</li><li class="src short"><a href="#v:defaultOptions">defaultOptions</a> :: <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:OptType">OptType</a> = <a href="Ganeti-Common.html#t:GenericOptType" title="Ganeti.Common">GenericOptType</a> <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:CheckFn">CheckFn</a> a = <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; IO (Either ExitCode a)</li><li class="src short"><span class="keyword">type</span> <a href="#t:PrepFn">PrepFn</a> a b = <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; a -&gt; IO b</li><li class="src short"><span class="keyword">type</span> <a href="#t:MainFn">MainFn</a> a b = <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; a -&gt; b -&gt; IO ()</li><li class="src short"><a href="#v:oNoDaemonize">oNoDaemonize</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a></li><li class="src short"><a href="#v:oDebug">oDebug</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a></li><li class="src short"><a href="#v:oNoUserChecks">oNoUserChecks</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a></li><li class="src short"><a href="#v:oPort">oPort</a> :: Int -&gt; <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a></li><li class="src short"><a href="#v:oBindAddress">oBindAddress</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a></li><li class="src short"><a href="#v:oSyslogUsage">oSyslogUsage</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a></li><li class="src short"><a href="#v:oForceNode">oForceNode</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a></li><li class="src short"><a href="#v:oNoVoting">oNoVoting</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a></li><li class="src short"><a href="#v:oYesDoIt">oYesDoIt</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a></li><li class="src short"><a href="#v:genericOpts">genericOpts</a> :: [<a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a>]</li><li class="src short"><a href="#v:ioErrorToResult">ioErrorToResult</a> :: String -&gt; IOError -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> a)</li><li class="src short"><a href="#v:parseArgs">parseArgs</a> :: String -&gt; [<a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a>] -&gt; IO (<a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a>, [String])</li><li class="src short"><a href="#v:pidFileMode">pidFileMode</a> :: FileMode</li><li class="src short"><a href="#v:pidFileFlags">pidFileFlags</a> :: OpenFileFlags</li><li class="src short"><a href="#v:writePidFile">writePidFile</a> :: FilePath -&gt; IO Fd</li><li class="src short"><a href="#v:cleanupSocket">cleanupSocket</a> :: FilePath -&gt; IO ()</li><li class="src short"><a href="#v:setupDaemonEnv">setupDaemonEnv</a> :: FilePath -&gt; FileMode -&gt; IO ()</li><li class="src short"><a href="#v:finalCleanup">finalCleanup</a> :: FilePath -&gt; IO ()</li><li class="src short"><a href="#v:handleSigTerm">handleSigTerm</a> :: ThreadId -&gt; IO ()</li><li class="src short"><a href="#v:handleSigHup">handleSigHup</a> :: FilePath -&gt; IO ()</li><li class="src short"><a href="#v:setupDaemonFDs">setupDaemonFDs</a> :: Maybe FilePath -&gt; IO ()</li><li class="src short"><a href="#v:defaultBindAddr">defaultBindAddr</a> :: Int -&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> Family -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> (Family, SockAddr))</li><li class="src short"><a href="#v:parseAddress">parseAddress</a> :: <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; Int -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> (Family, SockAddr))</li><li class="src short"><a href="#v:vClusterHostNameEnvVar">vClusterHostNameEnvVar</a> :: String</li><li class="src short"><a href="#v:getFQDN-39-">getFQDN'</a> :: Maybe AddrInfo -&gt; IO String</li><li class="src short"><a href="#v:getFQDNwithHints">getFQDNwithHints</a> :: Maybe AddrInfo -&gt; IO String</li><li class="src short"><a href="#v:getFQDN">getFQDN</a> :: IO String</li><li class="src short"><a href="#v:isMaster">isMaster</a> :: IO Bool</li><li class="src short"><a href="#v:ensureNode">ensureNode</a> :: <a href="Ganeti-Runtime.html#t:GanetiDaemon" title="Ganeti.Runtime">GanetiDaemon</a> -&gt; <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; IO ()</li><li class="src short"><a href="#v:describeError">describeError</a> :: String -&gt; Maybe Handle -&gt; Maybe FilePath -&gt; IO a -&gt; IO a</li><li class="src short"><a href="#v:daemonize">daemonize</a> :: FilePath -&gt; (Maybe Fd -&gt; IO ()) -&gt; IO ()</li><li class="src short"><a href="#v:genericMain">genericMain</a> :: <a href="Ganeti-Runtime.html#t:GanetiDaemon" title="Ganeti.Runtime">GanetiDaemon</a> -&gt; [<a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a>] -&gt; <a href="Ganeti-Daemon.html#t:CheckFn" title="Ganeti.Daemon">CheckFn</a> a -&gt; <a href="Ganeti-Daemon.html#t:PrepFn" title="Ganeti.Daemon">PrepFn</a> a b -&gt; <a href="Ganeti-Daemon.html#t:MainFn" title="Ganeti.Daemon">MainFn</a> a b -&gt; IO ()</li><li class="src short"><a href="#v:fullPrep">fullPrep</a> :: <a href="Ganeti-Runtime.html#t:GanetiDaemon" title="Ganeti.Runtime">GanetiDaemon</a> -&gt; <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; <a href="Ganeti-Logging.html#t:SyslogUsage" title="Ganeti.Logging">SyslogUsage</a> -&gt; a -&gt; <a href="Ganeti-Daemon.html#t:PrepFn" title="Ganeti.Daemon">PrepFn</a> a b -&gt; IO (FilePath, b)</li><li class="src short"><a href="#v:innerMain">innerMain</a> :: <a href="Ganeti-Runtime.html#t:GanetiDaemon" title="Ganeti.Runtime">GanetiDaemon</a> -&gt; <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; <a href="Ganeti-Logging.html#t:SyslogUsage" title="Ganeti.Logging">SyslogUsage</a> -&gt; a -&gt; <a href="Ganeti-Daemon.html#t:PrepFn" title="Ganeti.Daemon">PrepFn</a> a b -&gt; <a href="Ganeti-Daemon.html#t:MainFn" title="Ganeti.Daemon">MainFn</a> a b -&gt; Maybe Fd -&gt; IO ()</li><li class="src short"><a href="#v:handlePrepErr">handlePrepErr</a> :: Bool -&gt; Maybe Fd -&gt; IOError -&gt; IO a</li><li class="src short"><a href="#v:maybeCloseFd">maybeCloseFd</a> :: Maybe Fd -&gt; IO ()</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Constants</h1></a><div class="top"><p class="src"><a id="v:devNull" class="def">devNull</a> :: FilePath <a href="Ganeti/Daemon.html#devNull" class="link">Source</a> <a href="#v:devNull" class="selflink">#</a></p><div class="doc"><p>/dev/null path.</p></div></div><div class="top"><p class="src"><a id="v:daemonStartupErr" class="def">daemonStartupErr</a> :: String -&gt; String <a href="Ganeti/Daemon.html#daemonStartupErr" class="link">Source</a> <a href="#v:daemonStartupErr" class="selflink">#</a></p><div class="doc"><p>Error message prefix, used in two separate paths (when forking
 and when not).</p></div></div><a href="#g:2" id="g:2"><h1>Data types</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:DaemonOptions" class="def">DaemonOptions</a> <a href="Ganeti/Daemon.html#DaemonOptions" class="link">Source</a> <a href="#t:DaemonOptions" class="selflink">#</a></p><div class="doc"><p>Command line options structure.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:DaemonOptions" class="def">DaemonOptions</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:optShowHelp" class="def">optShowHelp</a> :: Bool</dfn><div class="doc"><p>Just show the help</p></div></li><li><dfn class="src"><a id="v:optShowVer" class="def">optShowVer</a> :: Bool</dfn><div class="doc"><p>Just show the program version</p></div></li><li><dfn class="src"><a id="v:optShowComp" class="def">optShowComp</a> :: Bool</dfn><div class="doc"><p>Just show the completion info</p></div></li><li><dfn class="src"><a id="v:optDaemonize" class="def">optDaemonize</a> :: Bool</dfn><div class="doc"><p>Whether to daemonize or not</p></div></li><li><dfn class="src"><a id="v:optPort" class="def">optPort</a> :: Maybe Word16</dfn><div class="doc"><p>Override for the network port</p></div></li><li><dfn class="src"><a id="v:optDebug" class="def">optDebug</a> :: Bool</dfn><div class="doc"><p>Enable debug messages</p></div></li><li><dfn class="src"><a id="v:optNoUserChecks" class="def">optNoUserChecks</a> :: Bool</dfn><div class="doc"><p>Ignore user checks</p></div></li><li><dfn class="src"><a id="v:optBindAddress" class="def">optBindAddress</a> :: Maybe String</dfn><div class="doc"><p>Listen on a custom address</p></div></li><li><dfn class="src"><a id="v:optSyslogUsage" class="def">optSyslogUsage</a> :: Maybe <a href="Ganeti-Logging.html#t:SyslogUsage" title="Ganeti.Logging">SyslogUsage</a></dfn><div class="doc"><p>Override for Syslog usage</p></div></li><li><dfn class="src"><a id="v:optForceNode" class="def">optForceNode</a> :: Bool</dfn><div class="doc"><p>Ignore node checks</p></div></li><li><dfn class="src"><a id="v:optNoVoting" class="def">optNoVoting</a> :: Bool</dfn><div class="doc"><p>skip voting for master</p></div></li><li><dfn class="src"><a id="v:optYesDoIt" class="def">optYesDoIt</a> :: Bool</dfn><div class="doc"><p>force dangerous options</p></div></li></ul></div></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:DaemonOptions">Instances</h4><details id="i:DaemonOptions" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:DaemonOptions:StandardOptions:1"></span> <a href="Ganeti-Common.html#t:StandardOptions" title="Ganeti.Common">StandardOptions</a> <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a></span> <a href="#t:DaemonOptions" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:DaemonOptions:StandardOptions:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-Daemon.html">Ganeti.Daemon</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:helpRequested">helpRequested</a> :: <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; Bool <a href="Ganeti/Common.html#helpRequested" class="link">Source</a> <a href="#v:helpRequested" class="selflink">#</a></p><p class="src"><a href="#v:verRequested">verRequested</a> :: <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; Bool <a href="Ganeti/Common.html#verRequested" class="link">Source</a> <a href="#v:verRequested" class="selflink">#</a></p><p class="src"><a href="#v:compRequested">compRequested</a> :: <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; Bool <a href="Ganeti/Common.html#compRequested" class="link">Source</a> <a href="#v:compRequested" class="selflink">#</a></p><p class="src"><a href="#v:requestHelp">requestHelp</a> :: <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> <a href="Ganeti/Common.html#requestHelp" class="link">Source</a> <a href="#v:requestHelp" class="selflink">#</a></p><p class="src"><a href="#v:requestVer">requestVer</a> :: <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> <a href="Ganeti/Common.html#requestVer" class="link">Source</a> <a href="#v:requestVer" class="selflink">#</a></p><p class="src"><a href="#v:requestComp">requestComp</a> :: <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> <a href="Ganeti/Common.html#requestComp" class="link">Source</a> <a href="#v:requestComp" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:defaultOptions" class="def">defaultOptions</a> :: <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> <a href="Ganeti/Daemon.html#defaultOptions" class="link">Source</a> <a href="#v:defaultOptions" class="selflink">#</a></p><div class="doc"><p>Default values for the command line options.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:OptType" class="def">OptType</a> = <a href="Ganeti-Common.html#t:GenericOptType" title="Ganeti.Common">GenericOptType</a> <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> <a href="Ganeti/Daemon.html#OptType" class="link">Source</a> <a href="#t:OptType" class="selflink">#</a></p><div class="doc"><p>Abrreviation for the option type.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:CheckFn" class="def">CheckFn</a> a = <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; IO (Either ExitCode a) <a href="Ganeti/Daemon.html#CheckFn" class="link">Source</a> <a href="#t:CheckFn" class="selflink">#</a></p><div class="doc"><p>Check function type.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:PrepFn" class="def">PrepFn</a> a b = <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; a -&gt; IO b <a href="Ganeti/Daemon.html#PrepFn" class="link">Source</a> <a href="#t:PrepFn" class="selflink">#</a></p><div class="doc"><p>Prepare function type.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:MainFn" class="def">MainFn</a> a b = <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; a -&gt; b -&gt; IO () <a href="Ganeti/Daemon.html#MainFn" class="link">Source</a> <a href="#t:MainFn" class="selflink">#</a></p><div class="doc"><p>Main execution function type.</p></div></div><a href="#g:3" id="g:3"><h1>Command line options</h1></a><div class="top"><p class="src"><a id="v:oNoDaemonize" class="def">oNoDaemonize</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a> <a href="Ganeti/Daemon.html#oNoDaemonize" class="link">Source</a> <a href="#v:oNoDaemonize" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:oDebug" class="def">oDebug</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a> <a href="Ganeti/Daemon.html#oDebug" class="link">Source</a> <a href="#v:oDebug" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:oNoUserChecks" class="def">oNoUserChecks</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a> <a href="Ganeti/Daemon.html#oNoUserChecks" class="link">Source</a> <a href="#v:oNoUserChecks" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:oPort" class="def">oPort</a> :: Int -&gt; <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a> <a href="Ganeti/Daemon.html#oPort" class="link">Source</a> <a href="#v:oPort" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:oBindAddress" class="def">oBindAddress</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a> <a href="Ganeti/Daemon.html#oBindAddress" class="link">Source</a> <a href="#v:oBindAddress" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:oSyslogUsage" class="def">oSyslogUsage</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a> <a href="Ganeti/Daemon.html#oSyslogUsage" class="link">Source</a> <a href="#v:oSyslogUsage" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:oForceNode" class="def">oForceNode</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a> <a href="Ganeti/Daemon.html#oForceNode" class="link">Source</a> <a href="#v:oForceNode" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:oNoVoting" class="def">oNoVoting</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a> <a href="Ganeti/Daemon.html#oNoVoting" class="link">Source</a> <a href="#v:oNoVoting" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:oYesDoIt" class="def">oYesDoIt</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a> <a href="Ganeti/Daemon.html#oYesDoIt" class="link">Source</a> <a href="#v:oYesDoIt" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:genericOpts" class="def">genericOpts</a> :: [<a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a>] <a href="Ganeti/Daemon.html#genericOpts" class="link">Source</a> <a href="#v:genericOpts" class="selflink">#</a></p><div class="doc"><p>Generic options.</p></div></div><div class="top"><p class="src"><a id="v:ioErrorToResult" class="def">ioErrorToResult</a> :: String -&gt; IOError -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> a) <a href="Ganeti/Daemon.html#ioErrorToResult" class="link">Source</a> <a href="#v:ioErrorToResult" class="selflink">#</a></p><div class="doc"><p>Annotates and transforms IOErrors into a Result type. This can be
 used in the error handler argument to <code>catch</code>, for example.</p></div></div><div class="top"><p class="src"><a id="v:parseArgs" class="def">parseArgs</a> :: String -&gt; [<a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a>] -&gt; IO (<a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a>, [String]) <a href="Ganeti/Daemon.html#parseArgs" class="link">Source</a> <a href="#v:parseArgs" class="selflink">#</a></p><div class="doc"><p>Small wrapper over getArgs and <code><a href="Ganeti-Common.html#v:parseOpts" title="Ganeti.Common">parseOpts</a></code>.</p></div></div><a href="#g:4" id="g:4"><h1>Daemon-related functions</h1></a><div class="top"><p class="src"><a id="v:pidFileMode" class="def">pidFileMode</a> :: FileMode <a href="Ganeti/Daemon.html#pidFileMode" class="link">Source</a> <a href="#v:pidFileMode" class="selflink">#</a></p><div class="doc"><p>PID file mode.</p></div></div><div class="top"><p class="src"><a id="v:pidFileFlags" class="def">pidFileFlags</a> :: OpenFileFlags <a href="Ganeti/Daemon.html#pidFileFlags" class="link">Source</a> <a href="#v:pidFileFlags" class="selflink">#</a></p><div class="doc"><p>PID file open flags.</p></div></div><div class="top"><p class="src"><a id="v:writePidFile" class="def">writePidFile</a> :: FilePath -&gt; IO Fd <a href="Ganeti/Daemon.html#writePidFile" class="link">Source</a> <a href="#v:writePidFile" class="selflink">#</a></p><div class="doc"><p>Writes a PID file and locks it.</p></div></div><div class="top"><p class="src"><a id="v:cleanupSocket" class="def">cleanupSocket</a> :: FilePath -&gt; IO () <a href="Ganeti/Daemon.html#cleanupSocket" class="link">Source</a> <a href="#v:cleanupSocket" class="selflink">#</a></p><div class="doc"><p>Helper function to ensure a socket doesn't exist. Should only be
 called once we have locked the pid file successfully.</p></div></div><div class="top"><p class="src"><a id="v:setupDaemonEnv" class="def">setupDaemonEnv</a> :: FilePath -&gt; FileMode -&gt; IO () <a href="Ganeti/Daemon.html#setupDaemonEnv" class="link">Source</a> <a href="#v:setupDaemonEnv" class="selflink">#</a></p><div class="doc"><p>Sets up a daemon's environment.</p></div></div><div class="top"><p class="src"><a id="v:finalCleanup" class="def">finalCleanup</a> :: FilePath -&gt; IO () <a href="Ganeti/Daemon.html#finalCleanup" class="link">Source</a> <a href="#v:finalCleanup" class="selflink">#</a></p><div class="doc"><p>Cleanup function, performing all the operations that need to be done prior
 to shutting down a daemon.</p></div></div><div class="top"><p class="src"><a id="v:handleSigTerm" class="def">handleSigTerm</a> :: ThreadId -&gt; IO () <a href="Ganeti/Daemon.html#handleSigTerm" class="link">Source</a> <a href="#v:handleSigTerm" class="selflink">#</a></p><div class="doc"><p>Signal handler for the termination signal.</p></div></div><div class="top"><p class="src"><a id="v:handleSigHup" class="def">handleSigHup</a> :: FilePath -&gt; IO () <a href="Ganeti/Daemon.html#handleSigHup" class="link">Source</a> <a href="#v:handleSigHup" class="selflink">#</a></p><div class="doc"><p>Signal handler for reopening log files.</p></div></div><div class="top"><p class="src"><a id="v:setupDaemonFDs" class="def">setupDaemonFDs</a> :: Maybe FilePath -&gt; IO () <a href="Ganeti/Daemon.html#setupDaemonFDs" class="link">Source</a> <a href="#v:setupDaemonFDs" class="selflink">#</a></p><div class="doc"><p>Sets up a daemon's standard file descriptors.</p></div></div><div class="top"><p class="src"><a id="v:defaultBindAddr" class="def">defaultBindAddr</a> <a href="Ganeti/Daemon.html#defaultBindAddr" class="link">Source</a> <a href="#v:defaultBindAddr" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: Int</td><td class="doc"><p>The port we want</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> Family</td><td class="doc"><p>The cluster IP family</p></td></tr><tr><td class="src">-&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> (Family, SockAddr))</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Computes the default bind address for a given family.</p></div></div><div class="top"><p class="src"><a id="v:parseAddress" class="def">parseAddress</a> <a href="Ganeti/Daemon.html#parseAddress" class="link">Source</a> <a href="#v:parseAddress" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a></td><td class="doc"><p>Command line options</p></td></tr><tr><td class="src">-&gt; Int</td><td class="doc"><p>Default port for this daemon</p></td></tr><tr><td class="src">-&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> (Family, SockAddr))</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Based on the options, compute the socket address to use for the
 daemon.</p></div></div><div class="top"><p class="src"><a id="v:vClusterHostNameEnvVar" class="def">vClusterHostNameEnvVar</a> :: String <a href="Ganeti/Daemon.html#vClusterHostNameEnvVar" class="link">Source</a> <a href="#v:vClusterHostNameEnvVar" class="selflink">#</a></p><div class="doc"><p>Environment variable to override the assumed host name of the
 current node.</p></div></div><div class="top"><p class="src"><a id="v:getFQDN-39-" class="def">getFQDN'</a> :: Maybe AddrInfo -&gt; IO String <a href="Ganeti/Daemon.html#getFQDN%27" class="link">Source</a> <a href="#v:getFQDN-39-" class="selflink">#</a></p><div class="doc"><p>Get the real full qualified host name.</p></div></div><div class="top"><p class="src"><a id="v:getFQDNwithHints" class="def">getFQDNwithHints</a> :: Maybe AddrInfo -&gt; IO String <a href="Ganeti/Daemon.html#getFQDNwithHints" class="link">Source</a> <a href="#v:getFQDNwithHints" class="selflink">#</a></p><div class="doc"><p>Return the full qualified host name, honoring the vcluster setup
 and hints on the preferred socket type or protocol.</p></div></div><div class="top"><p class="src"><a id="v:getFQDN" class="def">getFQDN</a> :: IO String <a href="Ganeti/Daemon.html#getFQDN" class="link">Source</a> <a href="#v:getFQDN" class="selflink">#</a></p><div class="doc"><p>Return the full qualified host name, honoring the vcluster setup.</p></div></div><div class="top"><p class="src"><a id="v:isMaster" class="def">isMaster</a> :: IO Bool <a href="Ganeti/Daemon.html#isMaster" class="link">Source</a> <a href="#v:isMaster" class="selflink">#</a></p><div class="doc"><p>Returns if the current node is the master node.</p></div></div><div class="top"><p class="src"><a id="v:ensureNode" class="def">ensureNode</a> :: <a href="Ganeti-Runtime.html#t:GanetiDaemon" title="Ganeti.Runtime">GanetiDaemon</a> -&gt; <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; IO () <a href="Ganeti/Daemon.html#ensureNode" class="link">Source</a> <a href="#v:ensureNode" class="selflink">#</a></p><div class="doc"><p>Ensures that the daemon runs on the right node (and exits
 gracefully if it doesnt)</p></div></div><div class="top"><p class="src"><a id="v:describeError" class="def">describeError</a> :: String -&gt; Maybe Handle -&gt; Maybe FilePath -&gt; IO a -&gt; IO a <a href="Ganeti/Daemon.html#describeError" class="link">Source</a> <a href="#v:describeError" class="selflink">#</a></p><div class="doc"><p>Run an I/O action that might throw an I/O error, under a
 handler that will simply annotate and re-throw the exception.</p></div></div><div class="top"><p class="src"><a id="v:daemonize" class="def">daemonize</a> :: FilePath -&gt; (Maybe Fd -&gt; IO ()) -&gt; IO () <a href="Ganeti/Daemon.html#daemonize" class="link">Source</a> <a href="#v:daemonize" class="selflink">#</a></p><div class="doc"><p>Run an I/O action as a daemon.</p><p>WARNING: this only works in single-threaded mode (either using the
 single-threaded runtime, or using the multi-threaded one but with
 only one OS thread, i.e. -N1).</p></div></div><div class="top"><p class="src"><a id="v:genericMain" class="def">genericMain</a> <a href="Ganeti/Daemon.html#genericMain" class="link">Source</a> <a href="#v:genericMain" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-Runtime.html#t:GanetiDaemon" title="Ganeti.Runtime">GanetiDaemon</a></td><td class="doc"><p>The daemon we're running</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a>]</td><td class="doc"><p>The available options</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Daemon.html#t:CheckFn" title="Ganeti.Daemon">CheckFn</a> a</td><td class="doc"><p>Check function</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Daemon.html#t:PrepFn" title="Ganeti.Daemon">PrepFn</a> a b</td><td class="doc"><p>Prepare function</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Daemon.html#t:MainFn" title="Ganeti.Daemon">MainFn</a> a b</td><td class="doc"><p>Execution function</p></td></tr><tr><td class="src">-&gt; IO ()</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Generic daemon startup.</p></div></div><div class="top"><p class="src"><a id="v:fullPrep" class="def">fullPrep</a> <a href="Ganeti/Daemon.html#fullPrep" class="link">Source</a> <a href="#v:fullPrep" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-Runtime.html#t:GanetiDaemon" title="Ganeti.Runtime">GanetiDaemon</a></td><td class="doc"><p>The daemon we're running</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a></td><td class="doc"><p>The options structure, filled from the cmdline</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Logging.html#t:SyslogUsage" title="Ganeti.Logging">SyslogUsage</a></td><td class="doc"><p>Syslog mode</p></td></tr><tr><td class="src">-&gt; a</td><td class="doc"><p>Check results</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Daemon.html#t:PrepFn" title="Ganeti.Daemon">PrepFn</a> a b</td><td class="doc"><p>Prepare function</p></td></tr><tr><td class="src">-&gt; IO (FilePath, b)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Full prepare function.</p><p>This is executed after daemonization, and sets up both the log
 files (a generic functionality) and the custom prepare function of
 the daemon.</p></div></div><div class="top"><p class="src"><a id="v:innerMain" class="def">innerMain</a> <a href="Ganeti/Daemon.html#innerMain" class="link">Source</a> <a href="#v:innerMain" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-Runtime.html#t:GanetiDaemon" title="Ganeti.Runtime">GanetiDaemon</a></td><td class="doc"><p>The daemon we're running</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a></td><td class="doc"><p>The options structure, filled from the cmdline</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Logging.html#t:SyslogUsage" title="Ganeti.Logging">SyslogUsage</a></td><td class="doc"><p>Syslog mode</p></td></tr><tr><td class="src">-&gt; a</td><td class="doc"><p>Check results</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Daemon.html#t:PrepFn" title="Ganeti.Daemon">PrepFn</a> a b</td><td class="doc"><p>Prepare function</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Daemon.html#t:MainFn" title="Ganeti.Daemon">MainFn</a> a b</td><td class="doc"><p>Execution function</p></td></tr><tr><td class="src">-&gt; Maybe Fd</td><td class="doc"><p>Error reporting function</p></td></tr><tr><td class="src">-&gt; IO ()</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Inner daemon function.</p><p>This is executed after daemonization.</p></div></div><div class="top"><p class="src"><a id="v:handlePrepErr" class="def">handlePrepErr</a> :: Bool -&gt; Maybe Fd -&gt; IOError -&gt; IO a <a href="Ganeti/Daemon.html#handlePrepErr" class="link">Source</a> <a href="#v:handlePrepErr" class="selflink">#</a></p><div class="doc"><p>Daemon prepare error handling function.</p></div></div><div class="top"><p class="src"><a id="v:maybeCloseFd" class="def">maybeCloseFd</a> :: Maybe Fd -&gt; IO () <a href="Ganeti/Daemon.html#maybeCloseFd" class="link">Source</a> <a href="#v:maybeCloseFd" class="selflink">#</a></p><div class="doc"><p>Close a file descriptor.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.23.0</p></div></body></html>