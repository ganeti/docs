<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ganeti.Daemon</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="Ganeti/Daemon.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ganeti</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Ganeti.Daemon</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Constants</a></li><li><a href="#g:2">Data types</a></li><li><a href="#g:3">Command line options</a></li><li><a href="#g:4">Daemon-related functions</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Implementation of the generic daemon functionality.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:DaemonOptions">DaemonOptions</a> = <a href="#v:DaemonOptions">DaemonOptions</a> {<ul class="subs"><li><a href="#v:optShowHelp">optShowHelp</a> :: Bool</li><li><a href="#v:optShowVer">optShowVer</a> :: Bool</li><li><a href="#v:optShowComp">optShowComp</a> :: Bool</li><li><a href="#v:optDaemonize">optDaemonize</a> :: Bool</li><li><a href="#v:optPort">optPort</a> :: Maybe Word16</li><li><a href="#v:optDebug">optDebug</a> :: Bool</li><li><a href="#v:optNoUserChecks">optNoUserChecks</a> :: Bool</li><li><a href="#v:optBindAddress">optBindAddress</a> :: Maybe String</li><li><a href="#v:optSyslogUsage">optSyslogUsage</a> :: Maybe <a href="Ganeti-Logging.html#t:SyslogUsage" title="Ganeti.Logging">SyslogUsage</a></li><li><a href="#v:optForceNode">optForceNode</a> :: Bool</li><li><a href="#v:optNoVoting">optNoVoting</a> :: Bool</li><li><a href="#v:optYesDoIt">optYesDoIt</a> :: Bool</li></ul>}</li><li class="src short"><a href="#v:defaultOptions">defaultOptions</a> :: <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:OptType">OptType</a> = <a href="Ganeti-Common.html#t:GenericOptType" title="Ganeti.Common">GenericOptType</a> <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:CheckFn">CheckFn</a> a = <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; IO (Either ExitCode a)</li><li class="src short"><span class="keyword">type</span> <a href="#t:PrepFn">PrepFn</a> a b = <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; a -&gt; IO b</li><li class="src short"><span class="keyword">type</span> <a href="#t:MainFn">MainFn</a> a b = <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; a -&gt; b -&gt; IO ()</li><li class="src short"><a href="#v:oNoDaemonize">oNoDaemonize</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a></li><li class="src short"><a href="#v:oDebug">oDebug</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a></li><li class="src short"><a href="#v:oNoUserChecks">oNoUserChecks</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a></li><li class="src short"><a href="#v:oPort">oPort</a> :: Int -&gt; <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a></li><li class="src short"><a href="#v:oBindAddress">oBindAddress</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a></li><li class="src short"><a href="#v:oSyslogUsage">oSyslogUsage</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a></li><li class="src short"><a href="#v:oForceNode">oForceNode</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a></li><li class="src short"><a href="#v:oNoVoting">oNoVoting</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a></li><li class="src short"><a href="#v:oYesDoIt">oYesDoIt</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a></li><li class="src short"><a href="#v:parseArgs">parseArgs</a> :: String -&gt; [<a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a>] -&gt; IO (<a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a>, [String])</li><li class="src short"><a href="#v:cleanupSocket">cleanupSocket</a> :: FilePath -&gt; IO ()</li><li class="src short"><a href="#v:parseAddress">parseAddress</a> :: <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; Int -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> (Family, SockAddr))</li><li class="src short"><a href="#v:getFQDN">getFQDN</a> :: IO String</li><li class="src short"><a href="#v:describeError">describeError</a> :: String -&gt; Maybe Handle -&gt; Maybe FilePath -&gt; IO a -&gt; IO a</li><li class="src short"><a href="#v:genericMain">genericMain</a> :: <a href="Ganeti-Runtime.html#t:GanetiDaemon" title="Ganeti.Runtime">GanetiDaemon</a> -&gt; [<a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a>] -&gt; <a href="Ganeti-Daemon.html#t:CheckFn" title="Ganeti.Daemon">CheckFn</a> a -&gt; <a href="Ganeti-Daemon.html#t:PrepFn" title="Ganeti.Daemon">PrepFn</a> a b -&gt; <a href="Ganeti-Daemon.html#t:MainFn" title="Ganeti.Daemon">MainFn</a> a b -&gt; IO ()</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Constants</h1></a><a href="#g:2" id="g:2"><h1>Data types</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:DaemonOptions" class="def">DaemonOptions</a> <a href="Ganeti/Daemon.html#DaemonOptions" class="link">Source</a> <a href="#t:DaemonOptions" class="selflink">#</a></p><div class="doc"><p>Command line options structure.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:DaemonOptions" class="def">DaemonOptions</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:optShowHelp" class="def">optShowHelp</a> :: Bool</dfn><div class="doc"><p>Just show the help</p></div></li><li><dfn class="src"><a id="v:optShowVer" class="def">optShowVer</a> :: Bool</dfn><div class="doc"><p>Just show the program version</p></div></li><li><dfn class="src"><a id="v:optShowComp" class="def">optShowComp</a> :: Bool</dfn><div class="doc"><p>Just show the completion info</p></div></li><li><dfn class="src"><a id="v:optDaemonize" class="def">optDaemonize</a> :: Bool</dfn><div class="doc"><p>Whether to daemonize or not</p></div></li><li><dfn class="src"><a id="v:optPort" class="def">optPort</a> :: Maybe Word16</dfn><div class="doc"><p>Override for the network port</p></div></li><li><dfn class="src"><a id="v:optDebug" class="def">optDebug</a> :: Bool</dfn><div class="doc"><p>Enable debug messages</p></div></li><li><dfn class="src"><a id="v:optNoUserChecks" class="def">optNoUserChecks</a> :: Bool</dfn><div class="doc"><p>Ignore user checks</p></div></li><li><dfn class="src"><a id="v:optBindAddress" class="def">optBindAddress</a> :: Maybe String</dfn><div class="doc"><p>Listen on a custom address</p></div></li><li><dfn class="src"><a id="v:optSyslogUsage" class="def">optSyslogUsage</a> :: Maybe <a href="Ganeti-Logging.html#t:SyslogUsage" title="Ganeti.Logging">SyslogUsage</a></dfn><div class="doc"><p>Override for Syslog usage</p></div></li><li><dfn class="src"><a id="v:optForceNode" class="def">optForceNode</a> :: Bool</dfn><div class="doc"><p>Ignore node checks</p></div></li><li><dfn class="src"><a id="v:optNoVoting" class="def">optNoVoting</a> :: Bool</dfn><div class="doc"><p>skip voting for master</p></div></li><li><dfn class="src"><a id="v:optYesDoIt" class="def">optYesDoIt</a> :: Bool</dfn><div class="doc"><p>force dangerous options</p></div></li></ul></div></td></tr></table></div><div class="subs instances"><details id="i:DaemonOptions" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:DaemonOptions:StandardOptions:1"></span> <a href="Ganeti-Common.html#t:StandardOptions" title="Ganeti.Common">StandardOptions</a> <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a></span> <a href="#t:DaemonOptions" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:DaemonOptions:StandardOptions:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-Daemon.html">Ganeti.Daemon</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:helpRequested">helpRequested</a> :: <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; Bool <a href="Ganeti/Common.html#helpRequested" class="link">Source</a> <a href="#v:helpRequested" class="selflink">#</a></p><p class="src"><a href="#v:verRequested">verRequested</a> :: <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; Bool <a href="Ganeti/Common.html#verRequested" class="link">Source</a> <a href="#v:verRequested" class="selflink">#</a></p><p class="src"><a href="#v:compRequested">compRequested</a> :: <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; Bool <a href="Ganeti/Common.html#compRequested" class="link">Source</a> <a href="#v:compRequested" class="selflink">#</a></p><p class="src"><a href="#v:requestHelp">requestHelp</a> :: <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> <a href="Ganeti/Common.html#requestHelp" class="link">Source</a> <a href="#v:requestHelp" class="selflink">#</a></p><p class="src"><a href="#v:requestVer">requestVer</a> :: <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> <a href="Ganeti/Common.html#requestVer" class="link">Source</a> <a href="#v:requestVer" class="selflink">#</a></p><p class="src"><a href="#v:requestComp">requestComp</a> :: <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> <a href="Ganeti/Common.html#requestComp" class="link">Source</a> <a href="#v:requestComp" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:defaultOptions" class="def">defaultOptions</a> :: <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> <a href="Ganeti/Daemon.html#defaultOptions" class="link">Source</a> <a href="#v:defaultOptions" class="selflink">#</a></p><div class="doc"><p>Default values for the command line options.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:OptType" class="def">OptType</a> = <a href="Ganeti-Common.html#t:GenericOptType" title="Ganeti.Common">GenericOptType</a> <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> <a href="Ganeti/Daemon.html#OptType" class="link">Source</a> <a href="#t:OptType" class="selflink">#</a></p><div class="doc"><p>Abrreviation for the option type.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:CheckFn" class="def">CheckFn</a> a = <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; IO (Either ExitCode a) <a href="Ganeti/Daemon.html#CheckFn" class="link">Source</a> <a href="#t:CheckFn" class="selflink">#</a></p><div class="doc"><p>Check function type.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:PrepFn" class="def">PrepFn</a> a b = <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; a -&gt; IO b <a href="Ganeti/Daemon.html#PrepFn" class="link">Source</a> <a href="#t:PrepFn" class="selflink">#</a></p><div class="doc"><p>Prepare function type.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:MainFn" class="def">MainFn</a> a b = <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a> -&gt; a -&gt; b -&gt; IO () <a href="Ganeti/Daemon.html#MainFn" class="link">Source</a> <a href="#t:MainFn" class="selflink">#</a></p><div class="doc"><p>Main execution function type.</p></div></div><a href="#g:3" id="g:3"><h1>Command line options</h1></a><div class="top"><p class="src"><a id="v:oNoDaemonize" class="def">oNoDaemonize</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a> <a href="Ganeti/Daemon.html#oNoDaemonize" class="link">Source</a> <a href="#v:oNoDaemonize" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:oDebug" class="def">oDebug</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a> <a href="Ganeti/Daemon.html#oDebug" class="link">Source</a> <a href="#v:oDebug" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:oNoUserChecks" class="def">oNoUserChecks</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a> <a href="Ganeti/Daemon.html#oNoUserChecks" class="link">Source</a> <a href="#v:oNoUserChecks" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:oPort" class="def">oPort</a> :: Int -&gt; <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a> <a href="Ganeti/Daemon.html#oPort" class="link">Source</a> <a href="#v:oPort" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:oBindAddress" class="def">oBindAddress</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a> <a href="Ganeti/Daemon.html#oBindAddress" class="link">Source</a> <a href="#v:oBindAddress" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:oSyslogUsage" class="def">oSyslogUsage</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a> <a href="Ganeti/Daemon.html#oSyslogUsage" class="link">Source</a> <a href="#v:oSyslogUsage" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:oForceNode" class="def">oForceNode</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a> <a href="Ganeti/Daemon.html#oForceNode" class="link">Source</a> <a href="#v:oForceNode" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:oNoVoting" class="def">oNoVoting</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a> <a href="Ganeti/Daemon.html#oNoVoting" class="link">Source</a> <a href="#v:oNoVoting" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:oYesDoIt" class="def">oYesDoIt</a> :: <a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a> <a href="Ganeti/Daemon.html#oYesDoIt" class="link">Source</a> <a href="#v:oYesDoIt" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:parseArgs" class="def">parseArgs</a> :: String -&gt; [<a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a>] -&gt; IO (<a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a>, [String]) <a href="Ganeti/Daemon.html#parseArgs" class="link">Source</a> <a href="#v:parseArgs" class="selflink">#</a></p><div class="doc"><p>Small wrapper over getArgs and <code><a href="Ganeti-Common.html#v:parseOpts" title="Ganeti.Common">parseOpts</a></code>.</p></div></div><a href="#g:4" id="g:4"><h1>Daemon-related functions</h1></a><div class="top"><p class="src"><a id="v:cleanupSocket" class="def">cleanupSocket</a> :: FilePath -&gt; IO () <a href="Ganeti/Daemon.html#cleanupSocket" class="link">Source</a> <a href="#v:cleanupSocket" class="selflink">#</a></p><div class="doc"><p>Helper function to ensure a socket doesn't exist. Should only be
 called once we have locked the pid file successfully.</p></div></div><div class="top"><p class="src"><a id="v:parseAddress" class="def">parseAddress</a> <a href="Ganeti/Daemon.html#parseAddress" class="link">Source</a> <a href="#v:parseAddress" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-Daemon.html#t:DaemonOptions" title="Ganeti.Daemon">DaemonOptions</a></td><td class="doc"><p>Command line options</p></td></tr><tr><td class="src">-&gt; Int</td><td class="doc"><p>Default port for this daemon</p></td></tr><tr><td class="src">-&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> (Family, SockAddr))</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Based on the options, compute the socket address to use for the
 daemon.</p></div></div><div class="top"><p class="src"><a id="v:getFQDN" class="def">getFQDN</a> :: IO String <a href="Ganeti/Daemon.html#getFQDN" class="link">Source</a> <a href="#v:getFQDN" class="selflink">#</a></p><div class="doc"><p>Return the full qualified host name, honoring the vcluster setup.</p></div></div><div class="top"><p class="src"><a id="v:describeError" class="def">describeError</a> :: String -&gt; Maybe Handle -&gt; Maybe FilePath -&gt; IO a -&gt; IO a <a href="Ganeti/Daemon.html#describeError" class="link">Source</a> <a href="#v:describeError" class="selflink">#</a></p><div class="doc"><p>Run an I/O action that might throw an I/O error, under a
 handler that will simply annotate and re-throw the exception.</p></div></div><div class="top"><p class="src"><a id="v:genericMain" class="def">genericMain</a> <a href="Ganeti/Daemon.html#genericMain" class="link">Source</a> <a href="#v:genericMain" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-Runtime.html#t:GanetiDaemon" title="Ganeti.Runtime">GanetiDaemon</a></td><td class="doc"><p>The daemon we're running</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-Daemon.html#t:OptType" title="Ganeti.Daemon">OptType</a>]</td><td class="doc"><p>The available options</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Daemon.html#t:CheckFn" title="Ganeti.Daemon">CheckFn</a> a</td><td class="doc"><p>Check function</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Daemon.html#t:PrepFn" title="Ganeti.Daemon">PrepFn</a> a b</td><td class="doc"><p>Prepare function</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Daemon.html#t:MainFn" title="Ganeti.Daemon">MainFn</a> a b</td><td class="doc"><p>Execution function</p></td></tr><tr><td class="src">-&gt; IO ()</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Generic daemon startup.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.20.0</p></div></body></html>