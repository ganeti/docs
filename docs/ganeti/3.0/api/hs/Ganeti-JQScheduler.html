<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ganeti.JQScheduler</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="Ganeti/JQScheduler.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ganeti</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Ganeti.JQScheduler</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Implementation of a reader for the job queue.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:JQStatus">JQStatus</a></li><li class="src short"><a href="#v:emptyJQStatus">emptyJQStatus</a> :: IORef (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> <a href="Ganeti-Objects.html#t:ConfigData" title="Ganeti.Objects">ConfigData</a>) -&gt; IO <a href="Ganeti-JQScheduler.html#t:JQStatus" title="Ganeti.JQScheduler">JQStatus</a></li><li class="src short"><a href="#v:selectJobsToRun">selectJobsToRun</a> :: Int -&gt; Set <a href="Ganeti-Objects.html#t:FilterRule" title="Ganeti.Objects">FilterRule</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:Queue" title="Ganeti.JQScheduler.Types">Queue</a> -&gt; (<a href="Ganeti-JQScheduler-Types.html#t:Queue" title="Ganeti.JQScheduler.Types">Queue</a>, [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat" title="Ganeti.JQScheduler.Types">JobWithStat</a>])</li><li class="src short"><a href="#v:scheduleSomeJobs">scheduleSomeJobs</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus" title="Ganeti.JQScheduler">JQStatus</a> -&gt; IO ()</li><li class="src short"><a href="#v:cleanupIfDead">cleanupIfDead</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus" title="Ganeti.JQScheduler">JQStatus</a> -&gt; <a href="Ganeti-Types.html#t:JobId" title="Ganeti.Types">JobId</a> -&gt; IO Bool</li><li class="src short"><a href="#v:updateStatusAndScheduleSomeJobs">updateStatusAndScheduleSomeJobs</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus" title="Ganeti.JQScheduler">JQStatus</a> -&gt; IO ()</li><li class="src short"><a href="#v:initJQScheduler">initJQScheduler</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus" title="Ganeti.JQScheduler">JQStatus</a> -&gt; IO ()</li><li class="src short"><a href="#v:enqueueNewJobs">enqueueNewJobs</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus" title="Ganeti.JQScheduler">JQStatus</a> -&gt; [<a href="Ganeti-JQueue-Objects.html#t:QueuedJob" title="Ganeti.JQueue.Objects">QueuedJob</a>] -&gt; IO ()</li><li class="src short"><a href="#v:dequeueJob">dequeueJob</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus" title="Ganeti.JQScheduler">JQStatus</a> -&gt; <a href="Ganeti-Types.html#t:JobId" title="Ganeti.Types">JobId</a> -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> Bool)</li><li class="src short"><a href="#v:setJobPriority">setJobPriority</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus" title="Ganeti.JQScheduler">JQStatus</a> -&gt; <a href="Ganeti-Types.html#t:JobId" title="Ganeti.Types">JobId</a> -&gt; Int -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> (Maybe <a href="Ganeti-JQueue-Objects.html#t:QueuedJob" title="Ganeti.JQueue.Objects">QueuedJob</a>))</li><li class="src short"><a href="#v:configChangeNeedsRescheduling">configChangeNeedsRescheduling</a> :: <a href="Ganeti-Objects.html#t:ConfigData" title="Ganeti.Objects">ConfigData</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData" title="Ganeti.Objects">ConfigData</a> -&gt; Bool</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:JQStatus" class="def">JQStatus</a> <a href="Ganeti/JQScheduler.html#JQStatus" class="link">Source</a> <a href="#t:JQStatus" class="selflink">#</a></p><div class="doc"><p>Representation of the job queue</p><p>We keep two lists of jobs (together with information about the last
fstat result observed): the jobs that are enqueued, but not yet handed
over for execution, and the jobs already handed over for execution. They
are kept together in a single IORef, so that we can atomically update
both, in particular when scheduling jobs to be handed over for execution.</p></div></div><div class="top"><p class="src"><a id="v:emptyJQStatus" class="def">emptyJQStatus</a> :: IORef (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> <a href="Ganeti-Objects.html#t:ConfigData" title="Ganeti.Objects">ConfigData</a>) -&gt; IO <a href="Ganeti-JQScheduler.html#t:JQStatus" title="Ganeti.JQScheduler">JQStatus</a> <a href="Ganeti/JQScheduler.html#emptyJQStatus" class="link">Source</a> <a href="#v:emptyJQStatus" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:selectJobsToRun" class="def">selectJobsToRun</a> <a href="Ganeti/JQScheduler.html#selectJobsToRun" class="link">Source</a> <a href="#v:selectJobsToRun" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: Int</td><td class="doc"><p>How many jobs are allowed to run at the
 same time.</p></td></tr><tr><td class="src">-&gt; Set <a href="Ganeti-Objects.html#t:FilterRule" title="Ganeti.Objects">FilterRule</a></td><td class="doc"><p>Filter rules to respect for scheduling</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-JQScheduler-Types.html#t:Queue" title="Ganeti.JQScheduler.Types">Queue</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; (<a href="Ganeti-JQScheduler-Types.html#t:Queue" title="Ganeti.JQScheduler.Types">Queue</a>, [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat" title="Ganeti.JQScheduler.Types">JobWithStat</a>])</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Decide on which jobs to schedule next for execution. This is the
 pure function doing the scheduling.</p></div></div><div class="top"><p class="src"><a id="v:scheduleSomeJobs" class="def">scheduleSomeJobs</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus" title="Ganeti.JQScheduler">JQStatus</a> -&gt; IO () <a href="Ganeti/JQScheduler.html#scheduleSomeJobs" class="link">Source</a> <a href="#v:scheduleSomeJobs" class="selflink">#</a></p><div class="doc"><p>Schedule jobs to be run. This is the IO wrapper around the
 pure <code><a href="Ganeti-JQScheduler.html#v:selectJobsToRun" title="Ganeti.JQScheduler">selectJobsToRun</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:cleanupIfDead" class="def">cleanupIfDead</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus" title="Ganeti.JQScheduler">JQStatus</a> -&gt; <a href="Ganeti-Types.html#t:JobId" title="Ganeti.Types">JobId</a> -&gt; IO Bool <a href="Ganeti/JQScheduler.html#cleanupIfDead" class="link">Source</a> <a href="#v:cleanupIfDead" class="selflink">#</a></p><div class="doc"><p>Trigger job detection for the job with the given job id.
 Return True, if the job is dead.</p></div></div><div class="top"><p class="src"><a id="v:updateStatusAndScheduleSomeJobs" class="def">updateStatusAndScheduleSomeJobs</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus" title="Ganeti.JQScheduler">JQStatus</a> -&gt; IO () <a href="Ganeti/JQScheduler.html#updateStatusAndScheduleSomeJobs" class="link">Source</a> <a href="#v:updateStatusAndScheduleSomeJobs" class="selflink">#</a></p><div class="doc"><p>Force the queue to check the state of all jobs.</p></div></div><div class="top"><p class="src"><a id="v:initJQScheduler" class="def">initJQScheduler</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus" title="Ganeti.JQScheduler">JQStatus</a> -&gt; IO () <a href="Ganeti/JQScheduler.html#initJQScheduler" class="link">Source</a> <a href="#v:initJQScheduler" class="selflink">#</a></p><div class="doc"><p>Set up the job scheduler. This will also start the monitoring
 of changes to the running jobs.</p></div></div><div class="top"><p class="src"><a id="v:enqueueNewJobs" class="def">enqueueNewJobs</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus" title="Ganeti.JQScheduler">JQStatus</a> -&gt; [<a href="Ganeti-JQueue-Objects.html#t:QueuedJob" title="Ganeti.JQueue.Objects">QueuedJob</a>] -&gt; IO () <a href="Ganeti/JQScheduler.html#enqueueNewJobs" class="link">Source</a> <a href="#v:enqueueNewJobs" class="selflink">#</a></p><div class="doc"><p>Enqueue new jobs. This will guarantee that the jobs will be executed
 eventually.</p></div></div><div class="top"><p class="src"><a id="v:dequeueJob" class="def">dequeueJob</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus" title="Ganeti.JQScheduler">JQStatus</a> -&gt; <a href="Ganeti-Types.html#t:JobId" title="Ganeti.Types">JobId</a> -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> Bool) <a href="Ganeti/JQScheduler.html#dequeueJob" class="link">Source</a> <a href="#v:dequeueJob" class="selflink">#</a></p><div class="doc"><p>Try to remove a queued job from the job queue. Return True, if
 the job could be removed from the queue before being handed over
 to execution, False if the job already started, and a Bad result
 if the job is unknown.</p></div></div><div class="top"><p class="src"><a id="v:setJobPriority" class="def">setJobPriority</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus" title="Ganeti.JQScheduler">JQStatus</a> -&gt; <a href="Ganeti-Types.html#t:JobId" title="Ganeti.Types">JobId</a> -&gt; Int -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> (Maybe <a href="Ganeti-JQueue-Objects.html#t:QueuedJob" title="Ganeti.JQueue.Objects">QueuedJob</a>)) <a href="Ganeti/JQScheduler.html#setJobPriority" class="link">Source</a> <a href="#v:setJobPriority" class="selflink">#</a></p><div class="doc"><p>Change the priority of a queued job (once the job is handed over
 to execution, the job itself needs to be informed). To avoid the
 job being started unmodified, it is temporarily unqueued during the
 change. Return the modified job, if the job's priority was sucessfully
 modified, Nothing, if the job already started, and a Bad value, if the job
 is unkown.</p></div></div><div class="top"><p class="src"><a id="v:configChangeNeedsRescheduling" class="def">configChangeNeedsRescheduling</a> :: <a href="Ganeti-Objects.html#t:ConfigData" title="Ganeti.Objects">ConfigData</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData" title="Ganeti.Objects">ConfigData</a> -&gt; Bool <a href="Ganeti/JQScheduler.html#configChangeNeedsRescheduling" class="link">Source</a> <a href="#v:configChangeNeedsRescheduling" class="selflink">#</a></p><div class="doc"><p>Given old and new configs, determines if the changes between them should
 trigger the scheduler to run.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.20.0</p></div></body></html>