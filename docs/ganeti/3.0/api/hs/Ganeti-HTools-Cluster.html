<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ganeti.HTools.Cluster</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="Ganeti/HTools/Cluster.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ganeti</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Ganeti.HTools.Cluster</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Types</a></li><li><a href="#g:2">Utility functions</a></li><li><a href="#g:3">Balancing functions</a></li><li><a href="#g:4">Allocation functions</a></li><li><a href="#g:5">Formatting functions</a></li><li><a href="#g:6">Node group functions</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Implementation of cluster-wide logic.</p><p>This module holds all pure cluster-logic; I/O related functionality
goes into the <em>Main</em> module for the individual binaries.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:AllocDetails">AllocDetails</a> = <a href="#v:AllocDetails">AllocDetails</a> Int (Maybe String)</li><li class="src short"><span class="keyword">type</span> <a href="#t:AllocResult">AllocResult</a> = (<a href="Ganeti-HTools-Types.html#t:FailStats" title="Ganeti.HTools.Types">FailStats</a>, <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a>, <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a>, [<a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a>], [<a href="Ganeti-HTools-Cluster.html#t:CStats" title="Ganeti.HTools.Cluster">CStats</a>])</li><li class="src short"><span class="keyword">type</span> <a href="#t:GenericAllocSolutionList">GenericAllocSolutionList</a> a = [(<a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a>, <a href="Ganeti-HTools-Cluster-AllocationSolution.html#t:GenericAllocSolution" title="Ganeti.HTools.Cluster.AllocationSolution">GenericAllocSolution</a> a)]</li><li class="src short"><span class="keyword">type</span> <a href="#t:AllocSolutionList">AllocSolutionList</a> = <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolutionList" title="Ganeti.HTools.Cluster">GenericAllocSolutionList</a> <a href="Ganeti-HTools-Types.html#t:Score" title="Ganeti.HTools.Types">Score</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:AllocNodes">AllocNodes</a> = Either [<a href="Ganeti-HTools-Types.html#t:Ndx" title="Ganeti.HTools.Types">Ndx</a>] [(<a href="Ganeti-HTools-Types.html#t:Ndx" title="Ganeti.HTools.Types">Ndx</a>, [<a href="Ganeti-HTools-Types.html#t:Ndx" title="Ganeti.HTools.Types">Ndx</a>])]</li><li class="src short"><span class="keyword">data</span> <a href="#t:Table">Table</a> = <a href="#v:Table">Table</a> <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a> <a href="Ganeti-HTools-Types.html#t:Score" title="Ganeti.HTools.Types">Score</a> [<a href="Ganeti-HTools-Types.html#t:Placement" title="Ganeti.HTools.Types">Placement</a>]</li><li class="src short"><span class="keyword">data</span> <a href="#t:CStats">CStats</a> = <a href="#v:CStats">CStats</a> {<ul class="subs"><li><a href="#v:csFmem">csFmem</a> :: Integer</li><li><a href="#v:csFdsk">csFdsk</a> :: Integer</li><li><a href="#v:csFspn">csFspn</a> :: Integer</li><li><a href="#v:csAmem">csAmem</a> :: Integer</li><li><a href="#v:csAdsk">csAdsk</a> :: Integer</li><li><a href="#v:csAcpu">csAcpu</a> :: Integer</li><li><a href="#v:csMmem">csMmem</a> :: Integer</li><li><a href="#v:csMdsk">csMdsk</a> :: Integer</li><li><a href="#v:csMcpu">csMcpu</a> :: Integer</li><li><a href="#v:csImem">csImem</a> :: Integer</li><li><a href="#v:csIdsk">csIdsk</a> :: Integer</li><li><a href="#v:csIspn">csIspn</a> :: Integer</li><li><a href="#v:csIcpu">csIcpu</a> :: Integer</li><li><a href="#v:csTmem">csTmem</a> :: Double</li><li><a href="#v:csTdsk">csTdsk</a> :: Double</li><li><a href="#v:csTspn">csTspn</a> :: Double</li><li><a href="#v:csTcpu">csTcpu</a> :: Double</li><li><a href="#v:csVcpu">csVcpu</a> :: Integer</li><li><a href="#v:csNcpu">csNcpu</a> :: Double</li><li><a href="#v:csXmem">csXmem</a> :: Integer</li><li><a href="#v:csNmem">csNmem</a> :: Integer</li><li><a href="#v:csScore">csScore</a> :: <a href="Ganeti-HTools-Types.html#t:Score" title="Ganeti.HTools.Types">Score</a></li><li><a href="#v:csNinst">csNinst</a> :: Int</li></ul>}</li><li class="src short"><span class="keyword">type</span> <a href="#t:AllocMethod">AllocMethod</a> = <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a> -&gt; Maybe Int -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocNodes" title="Ganeti.HTools.Cluster">AllocNodes</a> -&gt; [<a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a>] -&gt; [<a href="Ganeti-HTools-Cluster.html#t:CStats" title="Ganeti.HTools.Cluster">CStats</a>] -&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> <a href="Ganeti-HTools-Cluster.html#t:AllocResult" title="Ganeti.HTools.Cluster">AllocResult</a></li><li class="src short"><a href="#v:computeBadItems">computeBadItems</a> :: <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a> -&gt; ([<a href="Ganeti-HTools-Node.html#t:Node" title="Ganeti.HTools.Node">Node</a>], [<a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a>])</li><li class="src short"><a href="#v:totalResources">totalResources</a> :: <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:CStats" title="Ganeti.HTools.Cluster">CStats</a></li><li class="src short"><a href="#v:computeAllocationDelta">computeAllocationDelta</a> :: <a href="Ganeti-HTools-Cluster.html#t:CStats" title="Ganeti.HTools.Cluster">CStats</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:CStats" title="Ganeti.HTools.Cluster">CStats</a> -&gt; <a href="Ganeti-HTools-Types.html#t:AllocStats" title="Ganeti.HTools.Types">AllocStats</a></li><li class="src short"><a href="#v:doNextBalance">doNextBalance</a> :: <a href="Ganeti-HTools-Cluster.html#t:Table" title="Ganeti.HTools.Cluster">Table</a> -&gt; Int -&gt; <a href="Ganeti-HTools-Types.html#t:Score" title="Ganeti.HTools.Types">Score</a> -&gt; Bool</li><li class="src short"><a href="#v:tryBalance">tryBalance</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions" title="Ganeti.HTools.AlgorithmParams">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:Table" title="Ganeti.HTools.Cluster">Table</a> -&gt; Maybe <a href="Ganeti-HTools-Cluster.html#t:Table" title="Ganeti.HTools.Cluster">Table</a></li><li class="src short"><a href="#v:genAllocNodes">genAllocNodes</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions" title="Ganeti.HTools.AlgorithmParams">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Group.html#t:List" title="Ganeti.HTools.Group">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> -&gt; Int -&gt; Bool -&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> <a href="Ganeti-HTools-Cluster.html#t:AllocNodes" title="Ganeti.HTools.Cluster">AllocNodes</a></li><li class="src short"><a href="#v:tryAlloc">tryAlloc</a> :: MonadFail m =&gt; <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions" title="Ganeti.HTools.AlgorithmParams">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocNodes" title="Ganeti.HTools.Cluster">AllocNodes</a> -&gt; m <a href="Ganeti-HTools-Cluster-AllocationSolution.html#t:AllocSolution" title="Ganeti.HTools.Cluster.AllocationSolution">AllocSolution</a></li><li class="src short"><a href="#v:filterMGResults">filterMGResults</a> :: [(<a href="Ganeti-HTools-Group.html#t:Group" title="Ganeti.HTools.Group">Group</a>, <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> (<a href="Ganeti-HTools-Cluster-AllocationSolution.html#t:GenericAllocSolution" title="Ganeti.HTools.Cluster.AllocationSolution">GenericAllocSolution</a> a))] -&gt; [(<a href="Ganeti-HTools-Group.html#t:Group" title="Ganeti.HTools.Group">Group</a>, <a href="Ganeti-HTools-Cluster-AllocationSolution.html#t:GenericAllocSolution" title="Ganeti.HTools.Cluster.AllocationSolution">GenericAllocSolution</a> a)]</li><li class="src short"><a href="#v:sortMGResults">sortMGResults</a> :: Ord a =&gt; [(<a href="Ganeti-HTools-Group.html#t:Group" title="Ganeti.HTools.Group">Group</a>, <a href="Ganeti-HTools-Cluster-AllocationSolution.html#t:GenericAllocSolution" title="Ganeti.HTools.Cluster.AllocationSolution">GenericAllocSolution</a> a)] -&gt; [(<a href="Ganeti-HTools-Group.html#t:Group" title="Ganeti.HTools.Group">Group</a>, <a href="Ganeti-HTools-Cluster-AllocationSolution.html#t:GenericAllocSolution" title="Ganeti.HTools.Cluster.AllocationSolution">GenericAllocSolution</a> a)]</li><li class="src short"><a href="#v:hasRequiredNetworks">hasRequiredNetworks</a> :: <a href="Ganeti-HTools-Group.html#t:Group" title="Ganeti.HTools.Group">Group</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a> -&gt; Bool</li><li class="src short"><a href="#v:tryMGAlloc">tryMGAlloc</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions" title="Ganeti.HTools.AlgorithmParams">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Group.html#t:List" title="Ganeti.HTools.Group">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a> -&gt; Int -&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> <a href="Ganeti-HTools-Cluster-AllocationSolution.html#t:AllocSolution" title="Ganeti.HTools.Cluster.AllocationSolution">AllocSolution</a></li><li class="src short"><a href="#v:tryGroupAlloc">tryGroupAlloc</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions" title="Ganeti.HTools.AlgorithmParams">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Group.html#t:List" title="Ganeti.HTools.Group">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a> -&gt; String -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a> -&gt; Int -&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> <a href="Ganeti-HTools-Cluster-AllocationSolution.html#t:AllocSolution" title="Ganeti.HTools.Cluster.AllocationSolution">AllocSolution</a></li><li class="src short"><a href="#v:allocList">allocList</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions" title="Ganeti.HTools.AlgorithmParams">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Group.html#t:List" title="Ganeti.HTools.Group">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a> -&gt; [(<a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a>, <a href="Ganeti-HTools-Cluster.html#t:AllocDetails" title="Ganeti.HTools.Cluster">AllocDetails</a>)] -&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocSolutionList" title="Ganeti.HTools.Cluster">AllocSolutionList</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> (<a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a>, <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a>, <a href="Ganeti-HTools-Cluster.html#t:AllocSolutionList" title="Ganeti.HTools.Cluster">AllocSolutionList</a>)</li><li class="src short"><a href="#v:tryChangeGroup">tryChangeGroup</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions" title="Ganeti.HTools.AlgorithmParams">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Group.html#t:List" title="Ganeti.HTools.Group">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a> -&gt; [<a href="Ganeti-HTools-Types.html#t:Gdx" title="Ganeti.HTools.Types">Gdx</a>] -&gt; [<a href="Ganeti-HTools-Types.html#t:Idx" title="Ganeti.HTools.Types">Idx</a>] -&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> (<a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a>, <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a>, <a href="Ganeti-HTools-Cluster-Evacuate.html#t:EvacSolution" title="Ganeti.HTools.Cluster.Evacuate">EvacSolution</a>)</li><li class="src short"><a href="#v:iterateAlloc">iterateAlloc</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions" title="Ganeti.HTools.AlgorithmParams">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocMethod" title="Ganeti.HTools.Cluster">AllocMethod</a></li><li class="src short"><a href="#v:tieredAlloc">tieredAlloc</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions" title="Ganeti.HTools.AlgorithmParams">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocMethod" title="Ganeti.HTools.Cluster">AllocMethod</a></li><li class="src short"><a href="#v:printSolutionLine">printSolutionLine</a> :: <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a> -&gt; Int -&gt; Int -&gt; <a href="Ganeti-HTools-Types.html#t:Placement" title="Ganeti.HTools.Types">Placement</a> -&gt; Int -&gt; (String, [String])</li><li class="src short"><a href="#v:involvedNodes">involvedNodes</a> :: <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a> -&gt; <a href="Ganeti-HTools-Types.html#t:Placement" title="Ganeti.HTools.Types">Placement</a> -&gt; [<a href="Ganeti-HTools-Types.html#t:Ndx" title="Ganeti.HTools.Types">Ndx</a>]</li><li class="src short"><a href="#v:getMoves">getMoves</a> :: (<a href="Ganeti-HTools-Cluster.html#t:Table" title="Ganeti.HTools.Cluster">Table</a>, <a href="Ganeti-HTools-Cluster.html#t:Table" title="Ganeti.HTools.Cluster">Table</a>) -&gt; [<a href="Ganeti-HTools-Types.html#t:MoveJob" title="Ganeti.HTools.Types">MoveJob</a>]</li><li class="src short"><a href="#v:splitJobs">splitJobs</a> :: [<a href="Ganeti-HTools-Types.html#t:MoveJob" title="Ganeti.HTools.Types">MoveJob</a>] -&gt; [<a href="Ganeti-HTools-Types.html#t:JobSet" title="Ganeti.HTools.Types">JobSet</a>]</li><li class="src short"><a href="#v:formatCmds">formatCmds</a> :: [<a href="Ganeti-HTools-Types.html#t:JobSet" title="Ganeti.HTools.Types">JobSet</a>] -&gt; String</li><li class="src short"><a href="#v:printNodes">printNodes</a> :: <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> -&gt; [String] -&gt; String</li><li class="src short"><a href="#v:printInsts">printInsts</a> :: <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a> -&gt; String</li><li class="src short"><a href="#v:instanceGroup">instanceGroup</a> :: <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> <a href="Ganeti-HTools-Types.html#t:Gdx" title="Ganeti.HTools.Types">Gdx</a></li><li class="src short"><a href="#v:findSplitInstances">findSplitInstances</a> :: <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a> -&gt; [<a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a>]</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Types</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:AllocDetails" class="def">AllocDetails</a> <a href="Ganeti/HTools/Cluster.html#AllocDetails" class="link">Source</a> <a href="#t:AllocDetails" class="selflink">#</a></p><div class="doc"><p>Allocation details for an instance, specifying
 required number of nodes, and
 an optional group (name) to allocate to</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:AllocDetails" class="def">AllocDetails</a> Int (Maybe String)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><details id="i:AllocDetails" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:AllocDetails:Show:1"></span> Show <a href="Ganeti-HTools-Cluster.html#t:AllocDetails" title="Ganeti.HTools.Cluster">AllocDetails</a></span> <a href="#t:AllocDetails" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:AllocDetails:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-HTools-Cluster.html">Ganeti.HTools.Cluster</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: Int -&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocDetails" title="Ganeti.HTools.Cluster">AllocDetails</a> -&gt; ShowS</p><p class="src"><a href="#v:show">show</a> :: <a href="Ganeti-HTools-Cluster.html#t:AllocDetails" title="Ganeti.HTools.Cluster">AllocDetails</a> -&gt; String</p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Ganeti-HTools-Cluster.html#t:AllocDetails" title="Ganeti.HTools.Cluster">AllocDetails</a>] -&gt; ShowS</p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:AllocResult" class="def">AllocResult</a> = (<a href="Ganeti-HTools-Types.html#t:FailStats" title="Ganeti.HTools.Types">FailStats</a>, <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a>, <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a>, [<a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a>], [<a href="Ganeti-HTools-Cluster.html#t:CStats" title="Ganeti.HTools.Cluster">CStats</a>]) <a href="Ganeti/HTools/Cluster.html#AllocResult" class="link">Source</a> <a href="#t:AllocResult" class="selflink">#</a></p><div class="doc"><p>Allocation results, as used in <code><a href="Ganeti-HTools-Cluster.html#v:iterateAlloc" title="Ganeti.HTools.Cluster">iterateAlloc</a></code> and <code><a href="Ganeti-HTools-Cluster.html#v:tieredAlloc" title="Ganeti.HTools.Cluster">tieredAlloc</a></code>.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:GenericAllocSolutionList" class="def">GenericAllocSolutionList</a> a = [(<a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a>, <a href="Ganeti-HTools-Cluster-AllocationSolution.html#t:GenericAllocSolution" title="Ganeti.HTools.Cluster.AllocationSolution">GenericAllocSolution</a> a)] <a href="Ganeti/HTools/Cluster.html#GenericAllocSolutionList" class="link">Source</a> <a href="#t:GenericAllocSolutionList" class="selflink">#</a></p><div class="doc"><p>Type alias for easier handling.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:AllocSolutionList" class="def">AllocSolutionList</a> = <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolutionList" title="Ganeti.HTools.Cluster">GenericAllocSolutionList</a> <a href="Ganeti-HTools-Types.html#t:Score" title="Ganeti.HTools.Types">Score</a> <a href="Ganeti/HTools/Cluster.html#AllocSolutionList" class="link">Source</a> <a href="#t:AllocSolutionList" class="selflink">#</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:AllocNodes" class="def">AllocNodes</a> = Either [<a href="Ganeti-HTools-Types.html#t:Ndx" title="Ganeti.HTools.Types">Ndx</a>] [(<a href="Ganeti-HTools-Types.html#t:Ndx" title="Ganeti.HTools.Types">Ndx</a>, [<a href="Ganeti-HTools-Types.html#t:Ndx" title="Ganeti.HTools.Types">Ndx</a>])] <a href="Ganeti/HTools/Cluster.html#AllocNodes" class="link">Source</a> <a href="#t:AllocNodes" class="selflink">#</a></p><div class="doc"><p>A type denoting the valid allocation mode/pairs.</p><p>For a one-node allocation, this will be a <code>Left [<code><a href="Ganeti-HTools-Types.html#t:Ndx" title="Ganeti.HTools.Types">Ndx</a></code>]</code>, whereas
 for a two-node allocation, this will be a <code>Right [(<code><a href="Ganeti-HTools-Types.html#t:Ndx" title="Ganeti.HTools.Types">Ndx</a></code>,
 [<code><a href="Ganeti-HTools-Types.html#t:Ndx" title="Ganeti.HTools.Types">Ndx</a></code>])]</code>. In the latter case, the list is basically an
 association list, grouped by primary node and holding the potential
 secondary nodes in the sub-list.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Table" class="def">Table</a> <a href="Ganeti/HTools/Cluster.html#Table" class="link">Source</a> <a href="#t:Table" class="selflink">#</a></p><div class="doc"><p>The complete state for the balancing solution.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Table" class="def">Table</a> <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a> <a href="Ganeti-HTools-Types.html#t:Score" title="Ganeti.HTools.Types">Score</a> [<a href="Ganeti-HTools-Types.html#t:Placement" title="Ganeti.HTools.Types">Placement</a>]</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><details id="i:Table" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Table:Show:1"></span> Show <a href="Ganeti-HTools-Cluster.html#t:Table" title="Ganeti.HTools.Cluster">Table</a></span> <a href="#t:Table" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Table:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-HTools-Cluster.html">Ganeti.HTools.Cluster</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: Int -&gt; <a href="Ganeti-HTools-Cluster.html#t:Table" title="Ganeti.HTools.Cluster">Table</a> -&gt; ShowS</p><p class="src"><a href="#v:show">show</a> :: <a href="Ganeti-HTools-Cluster.html#t:Table" title="Ganeti.HTools.Cluster">Table</a> -&gt; String</p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Ganeti-HTools-Cluster.html#t:Table" title="Ganeti.HTools.Cluster">Table</a>] -&gt; ShowS</p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:CStats" class="def">CStats</a> <a href="Ganeti/HTools/Cluster.html#CStats" class="link">Source</a> <a href="#t:CStats" class="selflink">#</a></p><div class="doc"><p>Cluster statistics data type.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:CStats" class="def">CStats</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:csFmem" class="def">csFmem</a> :: Integer</dfn><div class="doc"><p>Cluster free mem</p></div></li><li><dfn class="src"><a id="v:csFdsk" class="def">csFdsk</a> :: Integer</dfn><div class="doc"><p>Cluster free disk</p></div></li><li><dfn class="src"><a id="v:csFspn" class="def">csFspn</a> :: Integer</dfn><div class="doc"><p>Cluster free spindles</p></div></li><li><dfn class="src"><a id="v:csAmem" class="def">csAmem</a> :: Integer</dfn><div class="doc"><p>Cluster allocatable mem</p></div></li><li><dfn class="src"><a id="v:csAdsk" class="def">csAdsk</a> :: Integer</dfn><div class="doc"><p>Cluster allocatable disk</p></div></li><li><dfn class="src"><a id="v:csAcpu" class="def">csAcpu</a> :: Integer</dfn><div class="doc"><p>Cluster allocatable cpus</p></div></li><li><dfn class="src"><a id="v:csMmem" class="def">csMmem</a> :: Integer</dfn><div class="doc"><p>Max node allocatable mem</p></div></li><li><dfn class="src"><a id="v:csMdsk" class="def">csMdsk</a> :: Integer</dfn><div class="doc"><p>Max node allocatable disk</p></div></li><li><dfn class="src"><a id="v:csMcpu" class="def">csMcpu</a> :: Integer</dfn><div class="doc"><p>Max node allocatable cpu</p></div></li><li><dfn class="src"><a id="v:csImem" class="def">csImem</a> :: Integer</dfn><div class="doc"><p>Instance used mem</p></div></li><li><dfn class="src"><a id="v:csIdsk" class="def">csIdsk</a> :: Integer</dfn><div class="doc"><p>Instance used disk</p></div></li><li><dfn class="src"><a id="v:csIspn" class="def">csIspn</a> :: Integer</dfn><div class="doc"><p>Instance used spindles</p></div></li><li><dfn class="src"><a id="v:csIcpu" class="def">csIcpu</a> :: Integer</dfn><div class="doc"><p>Instance used cpu</p></div></li><li><dfn class="src"><a id="v:csTmem" class="def">csTmem</a> :: Double</dfn><div class="doc"><p>Cluster total mem</p></div></li><li><dfn class="src"><a id="v:csTdsk" class="def">csTdsk</a> :: Double</dfn><div class="doc"><p>Cluster total disk</p></div></li><li><dfn class="src"><a id="v:csTspn" class="def">csTspn</a> :: Double</dfn><div class="doc"><p>Cluster total spindles</p></div></li><li><dfn class="src"><a id="v:csTcpu" class="def">csTcpu</a> :: Double</dfn><div class="doc"><p>Cluster total cpus</p></div></li><li><dfn class="src"><a id="v:csVcpu" class="def">csVcpu</a> :: Integer</dfn><div class="doc"><p>Cluster total virtual cpus</p></div></li><li><dfn class="src"><a id="v:csNcpu" class="def">csNcpu</a> :: Double</dfn><div class="doc"><p>Equivalent to <code><a href="Ganeti-HTools-Cluster.html#v:csIcpu" title="Ganeti.HTools.Cluster">csIcpu</a></code> but in terms of
 physical CPUs, i.e. normalised used phys CPUs</p></div></li><li><dfn class="src"><a id="v:csXmem" class="def">csXmem</a> :: Integer</dfn><div class="doc"><p>Unnacounted for mem</p></div></li><li><dfn class="src"><a id="v:csNmem" class="def">csNmem</a> :: Integer</dfn><div class="doc"><p>Node own memory</p></div></li><li><dfn class="src"><a id="v:csScore" class="def">csScore</a> :: <a href="Ganeti-HTools-Types.html#t:Score" title="Ganeti.HTools.Types">Score</a></dfn><div class="doc"><p>The cluster score</p></div></li><li><dfn class="src"><a id="v:csNinst" class="def">csNinst</a> :: Int</dfn><div class="doc"><p>The total number of instances</p></div></li></ul></div></td></tr></table></div><div class="subs instances"><details id="i:CStats" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:CStats:Show:1"></span> Show <a href="Ganeti-HTools-Cluster.html#t:CStats" title="Ganeti.HTools.Cluster">CStats</a></span> <a href="#t:CStats" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:CStats:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-HTools-Cluster.html">Ganeti.HTools.Cluster</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: Int -&gt; <a href="Ganeti-HTools-Cluster.html#t:CStats" title="Ganeti.HTools.Cluster">CStats</a> -&gt; ShowS</p><p class="src"><a href="#v:show">show</a> :: <a href="Ganeti-HTools-Cluster.html#t:CStats" title="Ganeti.HTools.Cluster">CStats</a> -&gt; String</p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Ganeti-HTools-Cluster.html#t:CStats" title="Ganeti.HTools.Cluster">CStats</a>] -&gt; ShowS</p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:AllocMethod" class="def">AllocMethod</a> <a href="Ganeti/HTools/Cluster.html#AllocMethod" class="link">Source</a> <a href="#t:AllocMethod" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">&nbsp;= <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a></td><td class="doc"><p>Node list</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a></td><td class="doc"><p>Instance list</p></td></tr><tr><td class="src">-&gt; Maybe Int</td><td class="doc"><p>Optional allocation limit</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a></td><td class="doc"><p>Instance spec for allocation</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocNodes" title="Ganeti.HTools.Cluster">AllocNodes</a></td><td class="doc"><p>Which nodes we should allocate on</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a>]</td><td class="doc"><p>Allocated instances</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-HTools-Cluster.html#t:CStats" title="Ganeti.HTools.Cluster">CStats</a>]</td><td class="doc"><p>Running cluster stats</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> <a href="Ganeti-HTools-Cluster.html#t:AllocResult" title="Ganeti.HTools.Cluster">AllocResult</a></td><td class="doc"><p>Allocation result</p></td></tr></table></div><div class="doc"><p>A simple type for allocation functions.</p></div></div><a href="#g:2" id="g:2"><h1>Utility functions</h1></a><div class="top"><p class="src"><a id="v:computeBadItems" class="def">computeBadItems</a> :: <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a> -&gt; ([<a href="Ganeti-HTools-Node.html#t:Node" title="Ganeti.HTools.Node">Node</a>], [<a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a>]) <a href="Ganeti/HTools/Cluster.html#computeBadItems" class="link">Source</a> <a href="#v:computeBadItems" class="selflink">#</a></p><div class="doc"><p>Computes the pair of bad nodes and instances.</p><p>The bad node list is computed via a simple <code>verifyN1</code> check, and the
bad instance list is the list of primary and secondary instances of
those nodes.</p></div></div><div class="top"><p class="src"><a id="v:totalResources" class="def">totalResources</a> :: <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:CStats" title="Ganeti.HTools.Cluster">CStats</a> <a href="Ganeti/HTools/Cluster.html#totalResources" class="link">Source</a> <a href="#v:totalResources" class="selflink">#</a></p><div class="doc"><p>Compute the total free disk and memory in the cluster.</p></div></div><div class="top"><p class="src"><a id="v:computeAllocationDelta" class="def">computeAllocationDelta</a> :: <a href="Ganeti-HTools-Cluster.html#t:CStats" title="Ganeti.HTools.Cluster">CStats</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:CStats" title="Ganeti.HTools.Cluster">CStats</a> -&gt; <a href="Ganeti-HTools-Types.html#t:AllocStats" title="Ganeti.HTools.Types">AllocStats</a> <a href="Ganeti/HTools/Cluster.html#computeAllocationDelta" class="link">Source</a> <a href="#v:computeAllocationDelta" class="selflink">#</a></p><div class="doc"><p>Compute the delta between two cluster state.</p><p>This is used when doing allocations, to understand better the
 available cluster resources. The return value is a triple of the
 current used values, the delta that was still allocated, and what
 was left unallocated.</p></div></div><a href="#g:3" id="g:3"><h1>Balancing functions</h1></a><div class="top"><p class="src"><a id="v:doNextBalance" class="def">doNextBalance</a> <a href="Ganeti/HTools/Cluster.html#doNextBalance" class="link">Source</a> <a href="#v:doNextBalance" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-Cluster.html#t:Table" title="Ganeti.HTools.Cluster">Table</a></td><td class="doc"><p>The starting table</p></td></tr><tr><td class="src">-&gt; Int</td><td class="doc"><p>Remaining length</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Types.html#t:Score" title="Ganeti.HTools.Types">Score</a></td><td class="doc"><p>Score at which to stop</p></td></tr><tr><td class="src">-&gt; Bool</td><td class="doc"><p>The resulting table and commands</p></td></tr></table></div><div class="doc"><p>Check if we are allowed to go deeper in the balancing.</p></div></div><div class="top"><p class="src"><a id="v:tryBalance" class="def">tryBalance</a> <a href="Ganeti/HTools/Cluster.html#tryBalance" class="link">Source</a> <a href="#v:tryBalance" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions" title="Ganeti.HTools.AlgorithmParams">AlgorithmOptions</a></td><td class="doc"><p>Algorithmic options for balancing</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Cluster.html#t:Table" title="Ganeti.HTools.Cluster">Table</a></td><td class="doc"><p>The starting table</p></td></tr><tr><td class="src">-&gt; Maybe <a href="Ganeti-HTools-Cluster.html#t:Table" title="Ganeti.HTools.Cluster">Table</a></td><td class="doc"><p>The resulting table and commands</p></td></tr></table></div><div class="doc"><p>Run a balance move.</p></div></div><a href="#g:4" id="g:4"><h1>Allocation functions</h1></a><div class="top"><p class="src"><a id="v:genAllocNodes" class="def">genAllocNodes</a> <a href="Ganeti/HTools/Cluster.html#genAllocNodes" class="link">Source</a> <a href="#v:genAllocNodes" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions" title="Ganeti.HTools.AlgorithmParams">AlgorithmOptions</a></td><td class="doc"><p>algorithmic options to honor</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Group.html#t:List" title="Ganeti.HTools.Group">List</a></td><td class="doc"><p>Group list</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a></td><td class="doc"><p>The node map</p></td></tr><tr><td class="src">-&gt; Int</td><td class="doc"><p>The number of nodes required</p></td></tr><tr><td class="src">-&gt; Bool</td><td class="doc"><p>Whether to drop or not
 unallocable nodes</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> <a href="Ganeti-HTools-Cluster.html#t:AllocNodes" title="Ganeti.HTools.Cluster">AllocNodes</a></td><td class="doc"><p>The (monadic) result</p></td></tr></table></div><div class="doc"><p>Generate the valid node allocation singles or pairs for a new instance.</p></div></div><div class="top"><p class="src"><a id="v:tryAlloc" class="def">tryAlloc</a> <a href="Ganeti/HTools/Cluster.html#tryAlloc" class="link">Source</a> <a href="#v:tryAlloc" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: MonadFail m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions" title="Ganeti.HTools.AlgorithmParams">AlgorithmOptions</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a></td><td class="doc"><p>The node list</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a></td><td class="doc"><p>The instance list</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a></td><td class="doc"><p>The instance to allocate</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocNodes" title="Ganeti.HTools.Cluster">AllocNodes</a></td><td class="doc"><p>The allocation targets</p></td></tr><tr><td class="src">-&gt; m <a href="Ganeti-HTools-Cluster-AllocationSolution.html#t:AllocSolution" title="Ganeti.HTools.Cluster.AllocationSolution">AllocSolution</a></td><td class="doc"><p>Possible solution list</p></td></tr></table></div><div class="doc"><p>Try to allocate an instance on the cluster.</p></div></div><div class="top"><p class="src"><a id="v:filterMGResults" class="def">filterMGResults</a> :: [(<a href="Ganeti-HTools-Group.html#t:Group" title="Ganeti.HTools.Group">Group</a>, <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> (<a href="Ganeti-HTools-Cluster-AllocationSolution.html#t:GenericAllocSolution" title="Ganeti.HTools.Cluster.AllocationSolution">GenericAllocSolution</a> a))] -&gt; [(<a href="Ganeti-HTools-Group.html#t:Group" title="Ganeti.HTools.Group">Group</a>, <a href="Ganeti-HTools-Cluster-AllocationSolution.html#t:GenericAllocSolution" title="Ganeti.HTools.Cluster.AllocationSolution">GenericAllocSolution</a> a)] <a href="Ganeti/HTools/Cluster.html#filterMGResults" class="link">Source</a> <a href="#v:filterMGResults" class="selflink">#</a></p><div class="doc"><p>From a list of possibly bad and possibly empty solutions, filter
 only the groups with a valid result. Note that the result will be
 reversed compared to the original list.</p></div></div><div class="top"><p class="src"><a id="v:sortMGResults" class="def">sortMGResults</a> :: Ord a =&gt; [(<a href="Ganeti-HTools-Group.html#t:Group" title="Ganeti.HTools.Group">Group</a>, <a href="Ganeti-HTools-Cluster-AllocationSolution.html#t:GenericAllocSolution" title="Ganeti.HTools.Cluster.AllocationSolution">GenericAllocSolution</a> a)] -&gt; [(<a href="Ganeti-HTools-Group.html#t:Group" title="Ganeti.HTools.Group">Group</a>, <a href="Ganeti-HTools-Cluster-AllocationSolution.html#t:GenericAllocSolution" title="Ganeti.HTools.Cluster.AllocationSolution">GenericAllocSolution</a> a)] <a href="Ganeti/HTools/Cluster.html#sortMGResults" class="link">Source</a> <a href="#v:sortMGResults" class="selflink">#</a></p><div class="doc"><p>Sort multigroup results based on policy and score.</p></div></div><div class="top"><p class="src"><a id="v:hasRequiredNetworks" class="def">hasRequiredNetworks</a> :: <a href="Ganeti-HTools-Group.html#t:Group" title="Ganeti.HTools.Group">Group</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a> -&gt; Bool <a href="Ganeti/HTools/Cluster.html#hasRequiredNetworks" class="link">Source</a> <a href="#v:hasRequiredNetworks" class="selflink">#</a></p><div class="doc"><p>Determines if a group is connected to the networks required by the
 | instance.</p></div></div><div class="top"><p class="src"><a id="v:tryMGAlloc" class="def">tryMGAlloc</a> <a href="Ganeti/HTools/Cluster.html#tryMGAlloc" class="link">Source</a> <a href="#v:tryMGAlloc" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions" title="Ganeti.HTools.AlgorithmParams">AlgorithmOptions</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Group.html#t:List" title="Ganeti.HTools.Group">List</a></td><td class="doc"><p>The group list</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a></td><td class="doc"><p>The node list</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a></td><td class="doc"><p>The instance list</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a></td><td class="doc"><p>The instance to allocate</p></td></tr><tr><td class="src">-&gt; Int</td><td class="doc"><p>Required number of nodes</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> <a href="Ganeti-HTools-Cluster-AllocationSolution.html#t:AllocSolution" title="Ganeti.HTools.Cluster.AllocationSolution">AllocSolution</a></td><td class="doc"><p>Possible solution list</p></td></tr></table></div><div class="doc"><p>Try to allocate an instance on a multi-group cluster.</p></div></div><div class="top"><p class="src"><a id="v:tryGroupAlloc" class="def">tryGroupAlloc</a> <a href="Ganeti/HTools/Cluster.html#tryGroupAlloc" class="link">Source</a> <a href="#v:tryGroupAlloc" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions" title="Ganeti.HTools.AlgorithmParams">AlgorithmOptions</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Group.html#t:List" title="Ganeti.HTools.Group">List</a></td><td class="doc"><p>The group list</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a></td><td class="doc"><p>The node list</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a></td><td class="doc"><p>The instance list</p></td></tr><tr><td class="src">-&gt; String</td><td class="doc"><p>The allocation group (name)</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a></td><td class="doc"><p>The instance to allocate</p></td></tr><tr><td class="src">-&gt; Int</td><td class="doc"><p>Required number of nodes</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> <a href="Ganeti-HTools-Cluster-AllocationSolution.html#t:AllocSolution" title="Ganeti.HTools.Cluster.AllocationSolution">AllocSolution</a></td><td class="doc"><p>Solution</p></td></tr></table></div><div class="doc"><p>Try to allocate an instance to a group.</p></div></div><div class="top"><p class="src"><a id="v:allocList" class="def">allocList</a> <a href="Ganeti/HTools/Cluster.html#allocList" class="link">Source</a> <a href="#v:allocList" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions" title="Ganeti.HTools.AlgorithmParams">AlgorithmOptions</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Group.html#t:List" title="Ganeti.HTools.Group">List</a></td><td class="doc"><p>The group list</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a></td><td class="doc"><p>The node list</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a></td><td class="doc"><p>The instance list</p></td></tr><tr><td class="src">-&gt; [(<a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a>, <a href="Ganeti-HTools-Cluster.html#t:AllocDetails" title="Ganeti.HTools.Cluster">AllocDetails</a>)]</td><td class="doc"><p>The instance to
   allocate</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocSolutionList" title="Ganeti.HTools.Cluster">AllocSolutionList</a></td><td class="doc"><p>Possible solution
   list</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> (<a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a>, <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a>, <a href="Ganeti-HTools-Cluster.html#t:AllocSolutionList" title="Ganeti.HTools.Cluster">AllocSolutionList</a>)</td><td class="doc"><p>The final solution
   list</p></td></tr></table></div><div class="doc"><p>Try to allocate a list of instances on a multi-group cluster.</p></div></div><div class="top"><p class="src"><a id="v:tryChangeGroup" class="def">tryChangeGroup</a> <a href="Ganeti/HTools/Cluster.html#tryChangeGroup" class="link">Source</a> <a href="#v:tryChangeGroup" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions" title="Ganeti.HTools.AlgorithmParams">AlgorithmOptions</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Group.html#t:List" title="Ganeti.HTools.Group">List</a></td><td class="doc"><p>The cluster groups</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a></td><td class="doc"><p>The node list (cluster-wide)</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a></td><td class="doc"><p>Instance list (cluster-wide)</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-HTools-Types.html#t:Gdx" title="Ganeti.HTools.Types">Gdx</a>]</td><td class="doc"><p>Target groups; if empty, any
 groups not being evacuated</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-HTools-Types.html#t:Idx" title="Ganeti.HTools.Types">Idx</a>]</td><td class="doc"><p>List of instance (indices) to be evacuated</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> (<a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a>, <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a>, <a href="Ganeti-HTools-Cluster-Evacuate.html#t:EvacSolution" title="Ganeti.HTools.Cluster.Evacuate">EvacSolution</a>)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Change-group IAllocator mode main function.</p><p>This is very similar to <code>tryNodeEvac</code>, the only difference is that
 we don't choose as target group the current instance group, but
 instead:</p><ol><li>at the start of the function, we compute which are the target
   groups; either no groups were passed in, in which case we choose
   all groups out of which we don't evacuate instance, or there were
   some groups passed, in which case we use those</li><li>for each instance, we use <code>findBestAllocGroup</code> to choose the
   best group to hold the instance, and then we do what
   <code>tryNodeEvac</code> does, except for this group instead of the current
   instance group.</li></ol><p>Note that the correct behaviour of this function relies on the
 function <code><a href="Ganeti-HTools-Cluster-Evacuate.html#v:nodeEvacInstance" title="Ganeti.HTools.Cluster.Evacuate">nodeEvacInstance</a></code> to be able to do correctly both
 intra-group and inter-group moves when passed the <code><a href="Ganeti-Types.html#v:ChangeAll" title="Ganeti.Types">ChangeAll</a></code> mode.</p></div></div><div class="top"><p class="src"><a id="v:iterateAlloc" class="def">iterateAlloc</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions" title="Ganeti.HTools.AlgorithmParams">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocMethod" title="Ganeti.HTools.Cluster">AllocMethod</a> <a href="Ganeti/HTools/Cluster.html#iterateAlloc" class="link">Source</a> <a href="#v:iterateAlloc" class="selflink">#</a></p><div class="doc"><p>A speed-up version of <code>iterateAllocSmallStep</code>.</p></div></div><div class="top"><p class="src"><a id="v:tieredAlloc" class="def">tieredAlloc</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions" title="Ganeti.HTools.AlgorithmParams">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocMethod" title="Ganeti.HTools.Cluster">AllocMethod</a> <a href="Ganeti/HTools/Cluster.html#tieredAlloc" class="link">Source</a> <a href="#v:tieredAlloc" class="selflink">#</a></p><div class="doc"><p>Tiered allocation method.</p><p>This places instances on the cluster, and decreases the spec until
 we can allocate again. The result will be a list of decreasing
 instance specs.</p></div></div><a href="#g:5" id="g:5"><h1>Formatting functions</h1></a><div class="top"><p class="src"><a id="v:printSolutionLine" class="def">printSolutionLine</a> <a href="Ganeti/HTools/Cluster.html#printSolutionLine" class="link">Source</a> <a href="#v:printSolutionLine" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a></td><td class="doc"><p>The node list</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a></td><td class="doc"><p>The instance list</p></td></tr><tr><td class="src">-&gt; Int</td><td class="doc"><p>Maximum node name length</p></td></tr><tr><td class="src">-&gt; Int</td><td class="doc"><p>Maximum instance name length</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Types.html#t:Placement" title="Ganeti.HTools.Types">Placement</a></td><td class="doc"><p>The current placement</p></td></tr><tr><td class="src">-&gt; Int</td><td class="doc"><p>The index of the placement in
 the solution</p></td></tr><tr><td class="src">-&gt; (String, [String])</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Converts a placement to string format.</p></div></div><div class="top"><p class="src"><a id="v:involvedNodes" class="def">involvedNodes</a> <a href="Ganeti/HTools/Cluster.html#involvedNodes" class="link">Source</a> <a href="#v:involvedNodes" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a></td><td class="doc"><p>Instance list, used for retrieving
 the instance from its index; note
 that this <em>must</em> be the original
 instance list, so that we can
 retrieve the old nodes</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Types.html#t:Placement" title="Ganeti.HTools.Types">Placement</a></td><td class="doc"><p>The placement we're investigating,
 containing the new nodes and
 instance index</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-HTools-Types.html#t:Ndx" title="Ganeti.HTools.Types">Ndx</a>]</td><td class="doc"><p>Resulting list of node indices</p></td></tr></table></div><div class="doc"><p>Return the instance and involved nodes in an instance move.</p><p>Note that the output list length can vary, and is not required nor
 guaranteed to be of any specific length.</p></div></div><div class="top"><p class="src"><a id="v:getMoves" class="def">getMoves</a> :: (<a href="Ganeti-HTools-Cluster.html#t:Table" title="Ganeti.HTools.Cluster">Table</a>, <a href="Ganeti-HTools-Cluster.html#t:Table" title="Ganeti.HTools.Cluster">Table</a>) -&gt; [<a href="Ganeti-HTools-Types.html#t:MoveJob" title="Ganeti.HTools.Types">MoveJob</a>] <a href="Ganeti/HTools/Cluster.html#getMoves" class="link">Source</a> <a href="#v:getMoves" class="selflink">#</a></p><div class="doc"><p>From two adjacent cluster tables get the list of moves that transitions
 from to the other</p></div></div><div class="top"><p class="src"><a id="v:splitJobs" class="def">splitJobs</a> :: [<a href="Ganeti-HTools-Types.html#t:MoveJob" title="Ganeti.HTools.Types">MoveJob</a>] -&gt; [<a href="Ganeti-HTools-Types.html#t:JobSet" title="Ganeti.HTools.Types">JobSet</a>] <a href="Ganeti/HTools/Cluster.html#splitJobs" class="link">Source</a> <a href="#v:splitJobs" class="selflink">#</a></p><div class="doc"><p>Break a list of moves into independent groups. Note that this
 will reverse the order of jobs.</p></div></div><div class="top"><p class="src"><a id="v:formatCmds" class="def">formatCmds</a> :: [<a href="Ganeti-HTools-Types.html#t:JobSet" title="Ganeti.HTools.Types">JobSet</a>] -&gt; String <a href="Ganeti/HTools/Cluster.html#formatCmds" class="link">Source</a> <a href="#v:formatCmds" class="selflink">#</a></p><div class="doc"><p>Given a list of commands, prefix them with <code>gnt-instance</code> and
 also beautify the display a little.</p></div></div><div class="top"><p class="src"><a id="v:printNodes" class="def">printNodes</a> :: <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> -&gt; [String] -&gt; String <a href="Ganeti/HTools/Cluster.html#printNodes" class="link">Source</a> <a href="#v:printNodes" class="selflink">#</a></p><div class="doc"><p>Print the node list.</p></div></div><div class="top"><p class="src"><a id="v:printInsts" class="def">printInsts</a> :: <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a> -&gt; String <a href="Ganeti/HTools/Cluster.html#printInsts" class="link">Source</a> <a href="#v:printInsts" class="selflink">#</a></p><div class="doc"><p>Print the instance list.</p></div></div><a href="#g:6" id="g:6"><h1>Node group functions</h1></a><div class="top"><p class="src"><a id="v:instanceGroup" class="def">instanceGroup</a> :: <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> <a href="Ganeti-HTools-Types.html#t:Gdx" title="Ganeti.HTools.Types">Gdx</a> <a href="Ganeti/HTools/Cluster.html#instanceGroup" class="link">Source</a> <a href="#v:instanceGroup" class="selflink">#</a></p><div class="doc"><p>Computes the group of an instance.</p></div></div><div class="top"><p class="src"><a id="v:findSplitInstances" class="def">findSplitInstances</a> :: <a href="Ganeti-HTools-Node.html#t:List" title="Ganeti.HTools.Node">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List" title="Ganeti.HTools.Instance">List</a> -&gt; [<a href="Ganeti-HTools-Instance.html#t:Instance" title="Ganeti.HTools.Instance">Instance</a>] <a href="Ganeti/HTools/Cluster.html#findSplitInstances" class="link">Source</a> <a href="#v:findSplitInstances" class="selflink">#</a></p><div class="doc"><p>Compute the list of badly allocated instances (split across node
 groups).</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>