<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Ganeti.WConfd.Monad</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ganeti</span><ul class="links" id="page-menu"><li><a href="Ganeti/WConfd/Monad.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Ganeti.WConfd.Monad</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Monoid of the locations to flush the configuration to</a></li><li><a href="#g:2">Pure data types used in the monad</a></li><li><a href="#g:3">The monad and its instances</a></li><li><a href="#g:4">Basic functions in the monad</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>All RPC calls are run within this monad.</p><p>It encapsulates:</p><ul><li>IO operations,</li><li>failures,</li><li>working with the daemon state.</li></ul><p>Code that is specific either to the configuration or the lock management, should
go into their corresponding dedicated modules.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:DistributionTarget">DistributionTarget</a><ul class="subs"><li>= <a href="#v:Everywhere">Everywhere</a></li><li>| <a href="#v:ToGroups">ToGroups</a> (Set String)</li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:DaemonState">DaemonState</a> = <a href="#v:DaemonState">DaemonState</a> {<ul class="subs"><li><a href="#v:dsConfigState">dsConfigState</a> :: <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a></li><li><a href="#v:dsLockWaiting">dsLockWaiting</a> :: <a href="Ganeti-Locking-Locks.html#t:GanetiLockWaiting" title="Ganeti.Locking.Locks">GanetiLockWaiting</a></li><li><a href="#v:dsTempRes">dsTempRes</a> :: <a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a></li></ul>}</li><li class="src short"><a href="#v:dsTempResL">dsTempResL</a> :: Lens' <a href="Ganeti-WConfd-Monad.html#t:DaemonState" title="Ganeti.WConfd.Monad">DaemonState</a> <a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a></li><li class="src short"><a href="#v:dsLockWaitingL">dsLockWaitingL</a> :: Lens' <a href="Ganeti-WConfd-Monad.html#t:DaemonState" title="Ganeti.WConfd.Monad">DaemonState</a> <a href="Ganeti-Locking-Locks.html#t:GanetiLockWaiting" title="Ganeti.Locking.Locks">GanetiLockWaiting</a></li><li class="src short"><a href="#v:dsConfigStateL">dsConfigStateL</a> :: Lens' <a href="Ganeti-WConfd-Monad.html#t:DaemonState" title="Ganeti.WConfd.Monad">DaemonState</a> <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:DaemonHandle">DaemonHandle</a> = <a href="#v:DaemonHandle">DaemonHandle</a> {<ul class="subs"><li><a href="#v:dhDaemonState">dhDaemonState</a> :: IORef <a href="Ganeti-WConfd-Monad.html#t:DaemonState" title="Ganeti.WConfd.Monad">DaemonState</a></li><li><a href="#v:dhConfigPath">dhConfigPath</a> :: FilePath</li><li><a href="#v:dhSaveConfigWorker">dhSaveConfigWorker</a> :: <a href="Ganeti-Utils-AsyncWorker.html#t:AsyncWorker" title="Ganeti.Utils.AsyncWorker">AsyncWorker</a> (Any, <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a>) ()</li><li><a href="#v:dhSaveLocksWorker">dhSaveLocksWorker</a> :: <a href="Ganeti-Utils-AsyncWorker.html#t:AsyncWorker" title="Ganeti.Utils.AsyncWorker">AsyncWorker</a> () ()</li><li><a href="#v:dhSaveTempResWorker">dhSaveTempResWorker</a> :: <a href="Ganeti-Utils-AsyncWorker.html#t:AsyncWorker" title="Ganeti.Utils.AsyncWorker">AsyncWorker</a> () ()</li><li><a href="#v:dhLivelock">dhLivelock</a> :: <a href="Ganeti-Utils-Livelock.html#t:Livelock" title="Ganeti.Utils.Livelock">Livelock</a></li></ul>}</li><li class="src short"><a href="#v:mkDaemonHandle">mkDaemonHandle</a> :: FilePath -&gt; <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; <a href="Ganeti-Locking-Locks.html#t:GanetiLockWaiting" title="Ganeti.Locking.Locks">GanetiLockWaiting</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> -&gt; (IO <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; [<a href="Ganeti-Utils-AsyncWorker.html#t:AsyncWorker" title="Ganeti.Utils.AsyncWorker">AsyncWorker</a> <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a> ()] -&gt; <a href="Ganeti-Errors.html#t:ResultG" title="Ganeti.Errors">ResultG</a> (<a href="Ganeti-Utils-AsyncWorker.html#t:AsyncWorker" title="Ganeti.Utils.AsyncWorker">AsyncWorker</a> (Any, <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a>) ())) -&gt; (IO <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; <a href="Ganeti-Errors.html#t:ResultG" title="Ganeti.Errors">ResultG</a> (<a href="Ganeti-Utils-AsyncWorker.html#t:AsyncWorker" title="Ganeti.Utils.AsyncWorker">AsyncWorker</a> <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a> ())) -&gt; (IO <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; <a href="Ganeti-Errors.html#t:ResultG" title="Ganeti.Errors">ResultG</a> (<a href="Ganeti-Utils-AsyncWorker.html#t:AsyncWorker" title="Ganeti.Utils.AsyncWorker">AsyncWorker</a> <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a> ())) -&gt; (IO <a href="Ganeti-Locking-Locks.html#t:GanetiLockWaiting" title="Ganeti.Locking.Locks">GanetiLockWaiting</a> -&gt; <a href="Ganeti-Errors.html#t:ResultG" title="Ganeti.Errors">ResultG</a> (<a href="Ganeti-Utils-AsyncWorker.html#t:AsyncWorker" title="Ganeti.Utils.AsyncWorker">AsyncWorker</a> () ())) -&gt; (IO <a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> -&gt; <a href="Ganeti-Errors.html#t:ResultG" title="Ganeti.Errors">ResultG</a> (<a href="Ganeti-Utils-AsyncWorker.html#t:AsyncWorker" title="Ganeti.Utils.AsyncWorker">AsyncWorker</a> () ())) -&gt; <a href="Ganeti-Utils-Livelock.html#t:Livelock" title="Ganeti.Utils.Livelock">Livelock</a> -&gt; <a href="Ganeti-Errors.html#t:ResultG" title="Ganeti.Errors">ResultG</a> <a href="Ganeti-WConfd-Monad.html#t:DaemonHandle" title="Ganeti.WConfd.Monad">DaemonHandle</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:WConfdMonadIntType">WConfdMonadIntType</a> = ReaderT <a href="Ganeti-WConfd-Monad.html#t:DaemonHandle" title="Ganeti.WConfd.Monad">DaemonHandle</a> IO</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:WConfdMonadInt">WConfdMonadInt</a> a = <a href="#v:WConfdMonadInt">WConfdMonadInt</a> {<ul class="subs"><li><a href="#v:getWConfdMonadInt">getWConfdMonadInt</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadIntType" title="Ganeti.WConfd.Monad">WConfdMonadIntType</a> a</li></ul>}</li><li class="src short"><a href="#v:runWConfdMonadInt">runWConfdMonadInt</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> a -&gt; <a href="Ganeti-WConfd-Monad.html#t:DaemonHandle" title="Ganeti.WConfd.Monad">DaemonHandle</a> -&gt; IO a</li><li class="src short"><span class="keyword">type</span> <a href="#t:WConfdMonad">WConfdMonad</a> = <a href="Ganeti-BasicTypes.html#t:ResultT" title="Ganeti.BasicTypes">ResultT</a> <a href="Ganeti-Errors.html#t:GanetiException" title="Ganeti.Errors">GanetiException</a> <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:AtomicModifyMonad">AtomicModifyMonad</a> a = <a href="Ganeti-BasicTypes.html#t:ResultT" title="Ganeti.BasicTypes">ResultT</a> <a href="Ganeti-Errors.html#t:GanetiException" title="Ganeti.Errors">GanetiException</a> <a href="Ganeti-Logging-WriterLog.html#t:WriterLog" title="Ganeti.Logging.WriterLog">WriterLog</a> a</li><li class="src short"><a href="#v:daemonHandle">daemonHandle</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> <a href="Ganeti-WConfd-Monad.html#t:DaemonHandle" title="Ganeti.WConfd.Monad">DaemonHandle</a></li><li class="src short"><a href="#v:readConfigState">readConfigState</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a></li><li class="src short"><a href="#v:unpackConfigResult">unpackConfigResult</a> :: ClockTime -&gt; <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; (a, <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a>) -&gt; ((a, Bool, Bool), <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a>)</li><li class="src short"><a href="#v:modifyConfigStateErrWithImmediate">modifyConfigStateErrWithImmediate</a> :: (<a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> -&gt; <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:AtomicModifyMonad" title="Ganeti.WConfd.Monad">AtomicModifyMonad</a> (a, <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a>)) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> () -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> a</li><li class="src short"><a href="#v:modifyConfigStateErr">modifyConfigStateErr</a> :: (<a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> -&gt; <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:AtomicModifyMonad" title="Ganeti.WConfd.Monad">AtomicModifyMonad</a> (a, <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a>)) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> a</li><li class="src short"><a href="#v:modifyConfigStateErr_">modifyConfigStateErr_</a> :: (<a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> -&gt; <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:AtomicModifyMonad" title="Ganeti.WConfd.Monad">AtomicModifyMonad</a> <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a>) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:modifyConfigState">modifyConfigState</a> :: (<a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; (a, <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a>)) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> a</li><li class="src short"><a href="#v:modifyConfigStateWithImmediate">modifyConfigStateWithImmediate</a> :: (<a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; (a, <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a>)) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> () -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> a</li><li class="src short"><a href="#v:forceConfigStateDistribution">forceConfigStateDistribution</a> :: <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:modifyConfigDataErr_">modifyConfigDataErr_</a> :: (<a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData" title="Ganeti.Objects">ConfigData</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:AtomicModifyMonad" title="Ganeti.WConfd.Monad">AtomicModifyMonad</a> <a href="Ganeti-Objects.html#t:ConfigData" title="Ganeti.Objects">ConfigData</a>) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:modifyTempResStateErr">modifyTempResStateErr</a> :: (<a href="Ganeti-Objects.html#t:ConfigData" title="Ganeti.Objects">ConfigData</a> -&gt; StateT <a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> <a href="Ganeti-Errors.html#t:ErrorResult" title="Ganeti.Errors">ErrorResult</a> a) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> a</li><li class="src short"><a href="#v:modifyTempResState">modifyTempResState</a> :: (<a href="Ganeti-Objects.html#t:ConfigData" title="Ganeti.Objects">ConfigData</a> -&gt; State <a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> a) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> a</li><li class="src short"><a href="#v:readTempResState">readTempResState</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> (<a href="Ganeti-Objects.html#t:ConfigData" title="Ganeti.Objects">ConfigData</a>, <a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a>)</li><li class="src short"><a href="#v:modifyLockWaiting">modifyLockWaiting</a> :: (<a href="Ganeti-Locking-Locks.html#t:GanetiLockWaiting" title="Ganeti.Locking.Locks">GanetiLockWaiting</a> -&gt; (<a href="Ganeti-Locking-Locks.html#t:GanetiLockWaiting" title="Ganeti.Locking.Locks">GanetiLockWaiting</a>, (a, Set <a href="Ganeti-Locking-Locks.html#t:ClientId" title="Ganeti.Locking.Locks">ClientId</a>))) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> a</li><li class="src short"><a href="#v:modifyLockWaiting_">modifyLockWaiting_</a> :: (<a href="Ganeti-Locking-Locks.html#t:GanetiLockWaiting" title="Ganeti.Locking.Locks">GanetiLockWaiting</a> -&gt; (<a href="Ganeti-Locking-Locks.html#t:GanetiLockWaiting" title="Ganeti.Locking.Locks">GanetiLockWaiting</a>, Set <a href="Ganeti-Locking-Locks.html#t:ClientId" title="Ganeti.Locking.Locks">ClientId</a>)) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:readLockWaiting">readLockWaiting</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> <a href="Ganeti-Locking-Locks.html#t:GanetiLockWaiting" title="Ganeti.Locking.Locks">GanetiLockWaiting</a></li><li class="src short"><a href="#v:readLockAllocation">readLockAllocation</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> <a href="Ganeti-Locking-Locks.html#t:GanetiLocks" title="Ganeti.Locking.Locks">GanetiLocks</a> <a href="Ganeti-Locking-Locks.html#t:ClientId" title="Ganeti.Locking.Locks">ClientId</a>)</li><li class="src short"><a href="#v:modifyConfigAndReturnWithLock">modifyConfigAndReturnWithLock</a> :: (<a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> -&gt; <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:AtomicModifyMonad" title="Ganeti.WConfd.Monad">AtomicModifyMonad</a> (a, <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a>)) -&gt; State <a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> () -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> (Maybe a)</li><li class="src short"><a href="#v:modifyConfigWithLock">modifyConfigWithLock</a> :: (<a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> -&gt; <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:AtomicModifyMonad" title="Ganeti.WConfd.Monad">AtomicModifyMonad</a> <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a>) -&gt; State <a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> () -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> (Maybe ())</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Monoid of the locations to flush the configuration to</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:DistributionTarget" class="def">DistributionTarget</a> <a href="Ganeti/WConfd/Monad.html#DistributionTarget" class="link">Source</a> <a href="#t:DistributionTarget" class="selflink">#</a></p><div class="doc"><p>Data type describing where the configuration has to be distributed to.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Everywhere" class="def">Everywhere</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:ToGroups" class="def">ToGroups</a> (Set String)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:DistributionTarget">Instances</h4><details id="i:DistributionTarget" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:DistributionTarget:Show:1"></span> Show <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a></span> <a href="#t:DistributionTarget" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:DistributionTarget:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-WConfd-Monad.html">Ganeti.WConfd.Monad</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: Int -&gt; <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a> -&gt; ShowS</p><p class="src"><a href="#v:show">show</a> :: <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a> -&gt; String</p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a>] -&gt; ShowS</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:DistributionTarget:Semigroup:2"></span> Semigroup <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a></span> <a href="#t:DistributionTarget" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:DistributionTarget:Semigroup:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-WConfd-Monad.html">Ganeti.WConfd.Monad</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-60--62-">(&lt;&gt;)</a> :: <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a></p><p class="src"><a href="#v:sconcat">sconcat</a> :: NonEmpty <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a></p><p class="src"><a href="#v:stimes">stimes</a> :: Integral b =&gt; b -&gt; <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:DistributionTarget:Monoid:3"></span> Monoid <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a></span> <a href="#t:DistributionTarget" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:DistributionTarget:Monoid:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-WConfd-Monad.html">Ganeti.WConfd.Monad</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:mempty">mempty</a> :: <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a></p><p class="src"><a href="#v:mappend">mappend</a> :: <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a></p><p class="src"><a href="#v:mconcat">mconcat</a> :: [<a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a>] -&gt; <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a></p></div></details></td></tr></table></details></div></div><a href="#g:2" id="g:2"><h1>Pure data types used in the monad</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:DaemonState" class="def">DaemonState</a> <a href="Ganeti/WConfd/Monad.html#DaemonState" class="link">Source</a> <a href="#t:DaemonState" class="selflink">#</a></p><div class="doc"><p>The state of the daemon, capturing both the configuration state and the
 locking state.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:DaemonState" class="def">DaemonState</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:dsConfigState" class="def">dsConfigState</a> :: <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:dsLockWaiting" class="def">dsLockWaiting</a> :: <a href="Ganeti-Locking-Locks.html#t:GanetiLockWaiting" title="Ganeti.Locking.Locks">GanetiLockWaiting</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:dsTempRes" class="def">dsTempRes</a> :: <a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a></dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><a id="v:dsTempResL" class="def">dsTempResL</a> :: Lens' <a href="Ganeti-WConfd-Monad.html#t:DaemonState" title="Ganeti.WConfd.Monad">DaemonState</a> <a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> <a href="Ganeti/WConfd/Monad.html#dsTempResL" class="link">Source</a> <a href="#v:dsTempResL" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:dsLockWaitingL" class="def">dsLockWaitingL</a> :: Lens' <a href="Ganeti-WConfd-Monad.html#t:DaemonState" title="Ganeti.WConfd.Monad">DaemonState</a> <a href="Ganeti-Locking-Locks.html#t:GanetiLockWaiting" title="Ganeti.Locking.Locks">GanetiLockWaiting</a> <a href="Ganeti/WConfd/Monad.html#dsLockWaitingL" class="link">Source</a> <a href="#v:dsLockWaitingL" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:dsConfigStateL" class="def">dsConfigStateL</a> :: Lens' <a href="Ganeti-WConfd-Monad.html#t:DaemonState" title="Ganeti.WConfd.Monad">DaemonState</a> <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> <a href="Ganeti/WConfd/Monad.html#dsConfigStateL" class="link">Source</a> <a href="#v:dsConfigStateL" class="selflink">#</a></p></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:DaemonHandle" class="def">DaemonHandle</a> <a href="Ganeti/WConfd/Monad.html#DaemonHandle" class="link">Source</a> <a href="#t:DaemonHandle" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:DaemonHandle" class="def">DaemonHandle</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:dhDaemonState" class="def">dhDaemonState</a> :: IORef <a href="Ganeti-WConfd-Monad.html#t:DaemonState" title="Ganeti.WConfd.Monad">DaemonState</a></dfn><div class="doc"><p>The current state of the daemon</p></div></li><li><dfn class="src"><a id="v:dhConfigPath" class="def">dhConfigPath</a> :: FilePath</dfn><div class="doc"><p>The configuration file path
 all static information that doesn't change during the life-time of the
 daemon should go here;
 all IDs of threads that do asynchronous work should probably also go here</p></div></li><li><dfn class="src"><a id="v:dhSaveConfigWorker" class="def">dhSaveConfigWorker</a> :: <a href="Ganeti-Utils-AsyncWorker.html#t:AsyncWorker" title="Ganeti.Utils.AsyncWorker">AsyncWorker</a> (Any, <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a>) ()</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:dhSaveLocksWorker" class="def">dhSaveLocksWorker</a> :: <a href="Ganeti-Utils-AsyncWorker.html#t:AsyncWorker" title="Ganeti.Utils.AsyncWorker">AsyncWorker</a> () ()</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:dhSaveTempResWorker" class="def">dhSaveTempResWorker</a> :: <a href="Ganeti-Utils-AsyncWorker.html#t:AsyncWorker" title="Ganeti.Utils.AsyncWorker">AsyncWorker</a> () ()</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:dhLivelock" class="def">dhLivelock</a> :: <a href="Ganeti-Utils-Livelock.html#t:Livelock" title="Ganeti.Utils.Livelock">Livelock</a></dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><a id="v:mkDaemonHandle" class="def">mkDaemonHandle</a> <a href="Ganeti/WConfd/Monad.html#mkDaemonHandle" class="link">Source</a> <a href="#v:mkDaemonHandle" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: FilePath</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Ganeti-Locking-Locks.html#t:GanetiLockWaiting" title="Ganeti.Locking.Locks">GanetiLockWaiting</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; (IO <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; [<a href="Ganeti-Utils-AsyncWorker.html#t:AsyncWorker" title="Ganeti.Utils.AsyncWorker">AsyncWorker</a> <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a> ()] -&gt; <a href="Ganeti-Errors.html#t:ResultG" title="Ganeti.Errors">ResultG</a> (<a href="Ganeti-Utils-AsyncWorker.html#t:AsyncWorker" title="Ganeti.Utils.AsyncWorker">AsyncWorker</a> (Any, <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a>) ()))</td><td class="doc"><p>A function that creates a worker that asynchronously
 saves the configuration to the master file.</p></td></tr><tr><td class="src">-&gt; (IO <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; <a href="Ganeti-Errors.html#t:ResultG" title="Ganeti.Errors">ResultG</a> (<a href="Ganeti-Utils-AsyncWorker.html#t:AsyncWorker" title="Ganeti.Utils.AsyncWorker">AsyncWorker</a> <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a> ()))</td><td class="doc"><p>A function that creates a worker that asynchronously
 distributes the configuration to master candidates</p></td></tr><tr><td class="src">-&gt; (IO <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; <a href="Ganeti-Errors.html#t:ResultG" title="Ganeti.Errors">ResultG</a> (<a href="Ganeti-Utils-AsyncWorker.html#t:AsyncWorker" title="Ganeti.Utils.AsyncWorker">AsyncWorker</a> <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a> ()))</td><td class="doc"><p>A function that creates a worker that asynchronously
 distributes SSConf to nodes</p></td></tr><tr><td class="src">-&gt; (IO <a href="Ganeti-Locking-Locks.html#t:GanetiLockWaiting" title="Ganeti.Locking.Locks">GanetiLockWaiting</a> -&gt; <a href="Ganeti-Errors.html#t:ResultG" title="Ganeti.Errors">ResultG</a> (<a href="Ganeti-Utils-AsyncWorker.html#t:AsyncWorker" title="Ganeti.Utils.AsyncWorker">AsyncWorker</a> () ()))</td><td class="doc"><p>A function that creates a worker that asynchronously
 saves the lock allocation state.</p></td></tr><tr><td class="src">-&gt; (IO <a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> -&gt; <a href="Ganeti-Errors.html#t:ResultG" title="Ganeti.Errors">ResultG</a> (<a href="Ganeti-Utils-AsyncWorker.html#t:AsyncWorker" title="Ganeti.Utils.AsyncWorker">AsyncWorker</a> () ()))</td><td class="doc"><p>A function that creates a worker that asynchronously
 saves the temporary reservations state.</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Utils-Livelock.html#t:Livelock" title="Ganeti.Utils.Livelock">Livelock</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Ganeti-Errors.html#t:ResultG" title="Ganeti.Errors">ResultG</a> <a href="Ganeti-WConfd-Monad.html#t:DaemonHandle" title="Ganeti.WConfd.Monad">DaemonHandle</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div><a href="#g:3" id="g:3"><h1>The monad and its instances</h1></a><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:WConfdMonadIntType" class="def">WConfdMonadIntType</a> = ReaderT <a href="Ganeti-WConfd-Monad.html#t:DaemonHandle" title="Ganeti.WConfd.Monad">DaemonHandle</a> IO <a href="Ganeti/WConfd/Monad.html#WConfdMonadIntType" class="link">Source</a> <a href="#t:WConfdMonadIntType" class="selflink">#</a></p><div class="doc"><p>A type alias for easier referring to the actual content of the monad
 when implementing its instances.</p></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a id="t:WConfdMonadInt" class="def">WConfdMonadInt</a> a <a href="Ganeti/WConfd/Monad.html#WConfdMonadInt" class="link">Source</a> <a href="#t:WConfdMonadInt" class="selflink">#</a></p><div class="doc"><p>The internal part of the monad without error handling.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:WConfdMonadInt" class="def">WConfdMonadInt</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:getWConfdMonadInt" class="def">getWConfdMonadInt</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadIntType" title="Ganeti.WConfd.Monad">WConfdMonadIntType</a> a</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:WConfdMonadInt">Instances</h4><details id="i:WConfdMonadInt" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:WConfdMonadInt:Monad:1"></span> Monad <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a></span> <a href="#t:WConfdMonadInt" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:WConfdMonadInt:Monad:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-WConfd-Monad.html">Ganeti.WConfd.Monad</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-62--62--61-">(&gt;&gt;=)</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> a -&gt; (a -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> b) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> b</p><p class="src"><a href="#v:-62--62-">(&gt;&gt;)</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> a -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> b -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> b</p><p class="src"><a href="#v:return">return</a> :: a -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> a</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:WConfdMonadInt:Functor:2"></span> Functor <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a></span> <a href="#t:WConfdMonadInt" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:WConfdMonadInt:Functor:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-WConfd-Monad.html">Ganeti.WConfd.Monad</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:fmap">fmap</a> :: (a -&gt; b) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> a -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> b</p><p class="src"><a href="#v:-60--36-">(&lt;$)</a> :: a -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> b -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> a</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:WConfdMonadInt:Applicative:3"></span> Applicative <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a></span> <a href="#t:WConfdMonadInt" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:WConfdMonadInt:Applicative:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-WConfd-Monad.html">Ganeti.WConfd.Monad</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:pure">pure</a> :: a -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> a</p><p class="src"><a href="#v:-60--42--62-">(&lt;*&gt;)</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> (a -&gt; b) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> a -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> b</p><p class="src"><a href="#v:liftA2">liftA2</a> :: (a -&gt; b -&gt; c) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> a -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> b -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> c</p><p class="src"><a href="#v:-42--62-">(*&gt;)</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> a -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> b -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> b</p><p class="src"><a href="#v:-60--42-">(&lt;*)</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> a -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> b -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> a</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:WConfdMonadInt:MonadIO:4"></span> MonadIO <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a></span> <a href="#t:WConfdMonadInt" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:WConfdMonadInt:MonadIO:4"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-WConfd-Monad.html">Ganeti.WConfd.Monad</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:liftIO">liftIO</a> :: IO a -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> a</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:WConfdMonadInt:MonadLog:5"></span> <a href="Ganeti-Logging.html#t:MonadLog" title="Ganeti.Logging">MonadLog</a> <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a></span> <a href="#t:WConfdMonadInt" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:WConfdMonadInt:MonadLog:5"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-WConfd-Monad.html">Ganeti.WConfd.Monad</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:logAt">logAt</a> :: Priority -&gt; String -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> () <a href="Ganeti/Logging.html#logAt" class="link">Source</a> <a href="#v:logAt" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:WConfdMonadInt:MonadBase:6"></span> MonadBase IO <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a></span> <a href="#t:WConfdMonadInt" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:WConfdMonadInt:MonadBase:6"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-WConfd-Monad.html">Ganeti.WConfd.Monad</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:liftBase">liftBase</a> :: IO &#945; -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> &#945;</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:WConfdMonadInt:MonadBaseControl:7"></span> MonadBaseControl IO <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a></span> <a href="#t:WConfdMonadInt" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:WConfdMonadInt:MonadBaseControl:7"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-WConfd-Monad.html">Ganeti.WConfd.Monad</a></p> <div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> StM <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> a</p></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:liftBaseWith">liftBaseWith</a> :: (RunInBase <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> IO -&gt; IO a) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> a</p><p class="src"><a href="#v:restoreM">restoreM</a> :: StM <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> a -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> a</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:WConfdMonadInt:StM:8"></span> <span class="keyword">type</span> StM <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> b</span> <a href="#t:WConfdMonadInt" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:WConfdMonadInt:StM:8"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-WConfd-Monad.html">Ganeti.WConfd.Monad</a></p> <div class="src"><span class="keyword">type</span> StM <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> b</div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:runWConfdMonadInt" class="def">runWConfdMonadInt</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> a -&gt; <a href="Ganeti-WConfd-Monad.html#t:DaemonHandle" title="Ganeti.WConfd.Monad">DaemonHandle</a> -&gt; IO a <a href="Ganeti/WConfd/Monad.html#runWConfdMonadInt" class="link">Source</a> <a href="#v:runWConfdMonadInt" class="selflink">#</a></p><div class="doc"><p>Runs the internal part of the WConfdMonad monad on a given daemon
 handle.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:WConfdMonad" class="def">WConfdMonad</a> = <a href="Ganeti-BasicTypes.html#t:ResultT" title="Ganeti.BasicTypes">ResultT</a> <a href="Ganeti-Errors.html#t:GanetiException" title="Ganeti.Errors">GanetiException</a> <a href="Ganeti-WConfd-Monad.html#t:WConfdMonadInt" title="Ganeti.WConfd.Monad">WConfdMonadInt</a> <a href="Ganeti/WConfd/Monad.html#WConfdMonad" class="link">Source</a> <a href="#t:WConfdMonad" class="selflink">#</a></p><div class="doc"><p>The complete monad with error handling.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:AtomicModifyMonad" class="def">AtomicModifyMonad</a> a = <a href="Ganeti-BasicTypes.html#t:ResultT" title="Ganeti.BasicTypes">ResultT</a> <a href="Ganeti-Errors.html#t:GanetiException" title="Ganeti.Errors">GanetiException</a> <a href="Ganeti-Logging-WriterLog.html#t:WriterLog" title="Ganeti.Logging.WriterLog">WriterLog</a> a <a href="Ganeti/WConfd/Monad.html#AtomicModifyMonad" class="link">Source</a> <a href="#t:AtomicModifyMonad" class="selflink">#</a></p><div class="doc"><p>A pure monad that logs and reports errors used for atomic modifications.</p></div></div><a href="#g:4" id="g:4"><h1>Basic functions in the monad</h1></a><div class="top"><p class="src"><a id="v:daemonHandle" class="def">daemonHandle</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> <a href="Ganeti-WConfd-Monad.html#t:DaemonHandle" title="Ganeti.WConfd.Monad">DaemonHandle</a> <a href="Ganeti/WConfd/Monad.html#daemonHandle" class="link">Source</a> <a href="#v:daemonHandle" class="selflink">#</a></p><div class="doc"><p>Returns the daemon handle.</p></div></div><div class="top"><p class="src"><a id="v:readConfigState" class="def">readConfigState</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> <a href="Ganeti/WConfd/Monad.html#readConfigState" class="link">Source</a> <a href="#v:readConfigState" class="selflink">#</a></p><div class="doc"><p>Returns the current configuration, given a handle</p></div></div><div class="top"><p class="src"><a id="v:unpackConfigResult" class="def">unpackConfigResult</a> :: ClockTime -&gt; <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; (a, <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a>) -&gt; ((a, Bool, Bool), <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a>) <a href="Ganeti/WConfd/Monad.html#unpackConfigResult" class="link">Source</a> <a href="#v:unpackConfigResult" class="selflink">#</a></p><div class="doc"><p>From a result of a configuration change, determine if the
 configuration was changed and if full distribution is needed.
 If so, also bump the serial number.</p></div></div><div class="top"><p class="src"><a id="v:modifyConfigStateErrWithImmediate" class="def">modifyConfigStateErrWithImmediate</a> :: (<a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> -&gt; <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:AtomicModifyMonad" title="Ganeti.WConfd.Monad">AtomicModifyMonad</a> (a, <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a>)) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> () -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> a <a href="Ganeti/WConfd/Monad.html#modifyConfigStateErrWithImmediate" class="link">Source</a> <a href="#v:modifyConfigStateErrWithImmediate" class="selflink">#</a></p><div class="doc"><p>Atomically modifies the configuration state in the WConfdMonad
 with a computation that can possibly fail; immediately afterwards,
 while config write is still going on, do the followup action. Return
 only after replication is finished.</p></div></div><div class="top"><p class="src"><a id="v:modifyConfigStateErr" class="def">modifyConfigStateErr</a> :: (<a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> -&gt; <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:AtomicModifyMonad" title="Ganeti.WConfd.Monad">AtomicModifyMonad</a> (a, <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a>)) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> a <a href="Ganeti/WConfd/Monad.html#modifyConfigStateErr" class="link">Source</a> <a href="#v:modifyConfigStateErr" class="selflink">#</a></p><div class="doc"><p>Atomically modifies the configuration state in the WConfdMonad
 with a computation that can possibly fail.</p></div></div><div class="top"><p class="src"><a id="v:modifyConfigStateErr_" class="def">modifyConfigStateErr_</a> :: (<a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> -&gt; <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:AtomicModifyMonad" title="Ganeti.WConfd.Monad">AtomicModifyMonad</a> <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a>) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> () <a href="Ganeti/WConfd/Monad.html#modifyConfigStateErr_" class="link">Source</a> <a href="#v:modifyConfigStateErr_" class="selflink">#</a></p><div class="doc"><p>Atomically modifies the configuration state in the WConfdMonad
 with a computation that can possibly fail.</p></div></div><div class="top"><p class="src"><a id="v:modifyConfigState" class="def">modifyConfigState</a> :: (<a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; (a, <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a>)) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> a <a href="Ganeti/WConfd/Monad.html#modifyConfigState" class="link">Source</a> <a href="#v:modifyConfigState" class="selflink">#</a></p><div class="doc"><p>Atomically modifies the configuration state in the WConfdMonad.</p></div></div><div class="top"><p class="src"><a id="v:modifyConfigStateWithImmediate" class="def">modifyConfigStateWithImmediate</a> :: (<a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; (a, <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a>)) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> () -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> a <a href="Ganeti/WConfd/Monad.html#modifyConfigStateWithImmediate" class="link">Source</a> <a href="#v:modifyConfigStateWithImmediate" class="selflink">#</a></p><div class="doc"><p>Atomically modifies the configuration state in WConfdMonad; immediately
 afterwards (while the config write-out is not necessarily finished) do
 another acation.</p></div></div><div class="top"><p class="src"><a id="v:forceConfigStateDistribution" class="def">forceConfigStateDistribution</a> :: <a href="Ganeti-WConfd-Monad.html#t:DistributionTarget" title="Ganeti.WConfd.Monad">DistributionTarget</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> () <a href="Ganeti/WConfd/Monad.html#forceConfigStateDistribution" class="link">Source</a> <a href="#v:forceConfigStateDistribution" class="selflink">#</a></p><div class="doc"><p>Force the distribution of configuration without actually modifying it.</p><p>We need a separate call for this operation, because <code><a href="Ganeti-WConfd-Monad.html#v:modifyConfigState" title="Ganeti.WConfd.Monad">modifyConfigState</a></code> only
 triggers the distribution when the configuration changes.</p></div></div><div class="top"><p class="src"><a id="v:modifyConfigDataErr_" class="def">modifyConfigDataErr_</a> :: (<a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData" title="Ganeti.Objects">ConfigData</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:AtomicModifyMonad" title="Ganeti.WConfd.Monad">AtomicModifyMonad</a> <a href="Ganeti-Objects.html#t:ConfigData" title="Ganeti.Objects">ConfigData</a>) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> () <a href="Ganeti/WConfd/Monad.html#modifyConfigDataErr_" class="link">Source</a> <a href="#v:modifyConfigDataErr_" class="selflink">#</a></p><div class="doc"><p>Atomically modifies the configuration data in the WConfdMonad
 with a computation that can possibly fail.</p></div></div><div class="top"><p class="src"><a id="v:modifyTempResStateErr" class="def">modifyTempResStateErr</a> :: (<a href="Ganeti-Objects.html#t:ConfigData" title="Ganeti.Objects">ConfigData</a> -&gt; StateT <a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> <a href="Ganeti-Errors.html#t:ErrorResult" title="Ganeti.Errors">ErrorResult</a> a) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> a <a href="Ganeti/WConfd/Monad.html#modifyTempResStateErr" class="link">Source</a> <a href="#v:modifyTempResStateErr" class="selflink">#</a></p><div class="doc"><p>Atomically modifies the state of temporary reservations in
 WConfdMonad in the presence of possible errors.</p></div></div><div class="top"><p class="src"><a id="v:modifyTempResState" class="def">modifyTempResState</a> :: (<a href="Ganeti-Objects.html#t:ConfigData" title="Ganeti.Objects">ConfigData</a> -&gt; State <a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> a) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> a <a href="Ganeti/WConfd/Monad.html#modifyTempResState" class="link">Source</a> <a href="#v:modifyTempResState" class="selflink">#</a></p><div class="doc"><p>Atomically modifies the state of temporary reservations in
 WConfdMonad.</p></div></div><div class="top"><p class="src"><a id="v:readTempResState" class="def">readTempResState</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> (<a href="Ganeti-Objects.html#t:ConfigData" title="Ganeti.Objects">ConfigData</a>, <a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a>) <a href="Ganeti/WConfd/Monad.html#readTempResState" class="link">Source</a> <a href="#v:readTempResState" class="selflink">#</a></p><div class="doc"><p>Reads the state of of the configuration and temporary reservations
 in WConfdMonad.</p></div></div><div class="top"><p class="src"><a id="v:modifyLockWaiting" class="def">modifyLockWaiting</a> :: (<a href="Ganeti-Locking-Locks.html#t:GanetiLockWaiting" title="Ganeti.Locking.Locks">GanetiLockWaiting</a> -&gt; (<a href="Ganeti-Locking-Locks.html#t:GanetiLockWaiting" title="Ganeti.Locking.Locks">GanetiLockWaiting</a>, (a, Set <a href="Ganeti-Locking-Locks.html#t:ClientId" title="Ganeti.Locking.Locks">ClientId</a>))) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> a <a href="Ganeti/WConfd/Monad.html#modifyLockWaiting" class="link">Source</a> <a href="#v:modifyLockWaiting" class="selflink">#</a></p><div class="doc"><p>Atomically modifies the lock waiting state in WConfdMonad.</p></div></div><div class="top"><p class="src"><a id="v:modifyLockWaiting_" class="def">modifyLockWaiting_</a> :: (<a href="Ganeti-Locking-Locks.html#t:GanetiLockWaiting" title="Ganeti.Locking.Locks">GanetiLockWaiting</a> -&gt; (<a href="Ganeti-Locking-Locks.html#t:GanetiLockWaiting" title="Ganeti.Locking.Locks">GanetiLockWaiting</a>, Set <a href="Ganeti-Locking-Locks.html#t:ClientId" title="Ganeti.Locking.Locks">ClientId</a>)) -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> () <a href="Ganeti/WConfd/Monad.html#modifyLockWaiting_" class="link">Source</a> <a href="#v:modifyLockWaiting_" class="selflink">#</a></p><div class="doc"><p>Atomically modifies the lock allocation state in WConfdMonad, not
 producing any result</p></div></div><div class="top"><p class="src"><a id="v:readLockWaiting" class="def">readLockWaiting</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> <a href="Ganeti-Locking-Locks.html#t:GanetiLockWaiting" title="Ganeti.Locking.Locks">GanetiLockWaiting</a> <a href="Ganeti/WConfd/Monad.html#readLockWaiting" class="link">Source</a> <a href="#v:readLockWaiting" class="selflink">#</a></p><div class="doc"><p>Read the lock waiting state in WConfdMonad.</p></div></div><div class="top"><p class="src"><a id="v:readLockAllocation" class="def">readLockAllocation</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> <a href="Ganeti-Locking-Locks.html#t:GanetiLocks" title="Ganeti.Locking.Locks">GanetiLocks</a> <a href="Ganeti-Locking-Locks.html#t:ClientId" title="Ganeti.Locking.Locks">ClientId</a>) <a href="Ganeti/WConfd/Monad.html#readLockAllocation" class="link">Source</a> <a href="#v:readLockAllocation" class="selflink">#</a></p><div class="doc"><p>Read the underlying lock allocation.</p></div></div><div class="top"><p class="src"><a id="v:modifyConfigAndReturnWithLock" class="def">modifyConfigAndReturnWithLock</a> :: (<a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> -&gt; <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:AtomicModifyMonad" title="Ganeti.WConfd.Monad">AtomicModifyMonad</a> (a, <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a>)) -&gt; State <a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> () -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> (Maybe a) <a href="Ganeti/WConfd/Monad.html#modifyConfigAndReturnWithLock" class="link">Source</a> <a href="#v:modifyConfigAndReturnWithLock" class="selflink">#</a></p><div class="doc"><p>Modify the configuration while temporarily acquiring
 the configuration lock. If the configuration lock is held by
 someone else, nothing is changed and Nothing is returned.</p></div></div><div class="top"><p class="src"><a id="v:modifyConfigWithLock" class="def">modifyConfigWithLock</a> :: (<a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> -&gt; <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:AtomicModifyMonad" title="Ganeti.WConfd.Monad">AtomicModifyMonad</a> <a href="Ganeti-WConfd-ConfigState.html#t:ConfigState" title="Ganeti.WConfd.ConfigState">ConfigState</a>) -&gt; State <a href="Ganeti-WConfd-TempRes.html#t:TempResState" title="Ganeti.WConfd.TempRes">TempResState</a> () -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad" title="Ganeti.WConfd.Monad">WConfdMonad</a> (Maybe ()) <a href="Ganeti/WConfd/Monad.html#modifyConfigWithLock" class="link">Source</a> <a href="#v:modifyConfigWithLock" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.23.0</p></div></body></html>