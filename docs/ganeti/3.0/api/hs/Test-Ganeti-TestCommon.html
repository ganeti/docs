<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Test.Ganeti.TestCommon</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ganeti</span><ul class="links" id="page-menu"><li><a href="Test/Ganeti/TestCommon.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Test.Ganeti.TestCommon</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Compatibility instances</a></li><li><a href="#g:2">Arbitrary orphan instances</a></li><li><a href="#g:3">Constants</a></li><li><a href="#g:4">Helper functions</a></li><li><a href="#g:5">Arbitrary instances</a></li><li><a href="#g:6">Generators</a></li><li><a href="#g:7">Helper functions</a></li><li><a href="#section.orphans">Orphan instances</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Common helper functions and instances for all Ganeti tests.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:maxMem">maxMem</a> :: Int</li><li class="src short"><a href="#v:maxDsk">maxDsk</a> :: Int</li><li class="src short"><a href="#v:maxCpu">maxCpu</a> :: Int</li><li class="src short"><a href="#v:maxSpindles">maxSpindles</a> :: Int</li><li class="src short"><a href="#v:maxVcpuRatio">maxVcpuRatio</a> :: Double</li><li class="src short"><a href="#v:maxSpindleRatio">maxSpindleRatio</a> :: Double</li><li class="src short"><a href="#v:maxNodes">maxNodes</a> :: Int</li><li class="src short"><a href="#v:maxOpCodes">maxOpCodes</a> :: Int</li><li class="src short"><a href="#v:-61--61--63-">(==?)</a> :: (Show a, Eq a) =&gt; a -&gt; a -&gt; Property</li><li class="src short"><a href="#v:-47--61--63-">(/=?)</a> :: (Show a, Eq a) =&gt; a -&gt; a -&gt; Property</li><li class="src short"><a href="#v:failTest">failTest</a> :: String -&gt; Property</li><li class="src short"><a href="#v:passTest">passTest</a> :: Property</li><li class="src short"><a href="#v:cover-39-">cover'</a> :: Testable prop =&gt; Double -&gt; Bool -&gt; String -&gt; prop -&gt; Property</li><li class="src short"><a href="#v:stableCover">stableCover</a> :: Testable prop =&gt; Bool -&gt; Double -&gt; String -&gt; prop -&gt; Property</li><li class="src short"><a href="#v:pythonCmd">pythonCmd</a> :: IO String</li><li class="src short"><a href="#v:runPython">runPython</a> :: String -&gt; String -&gt; IO (ExitCode, String, String)</li><li class="src short"><a href="#v:checkPythonResult">checkPythonResult</a> :: (ExitCode, String, String) -&gt; IO String</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:DNSChar">DNSChar</a> = <a href="#v:DNSChar">DNSChar</a> {<ul class="subs"><li><a href="#v:dnsGetChar">dnsGetChar</a> :: Char</li></ul>}</li><li class="src short"><a href="#v:genPrintableAsciiChar">genPrintableAsciiChar</a> :: Gen Char</li><li class="src short"><a href="#v:genPrintableAsciiString">genPrintableAsciiString</a> :: Gen String</li><li class="src short"><a href="#v:genPrintableAsciiStringNE">genPrintableAsciiStringNE</a> :: Gen <a href="Ganeti-Types.html#t:NonEmptyString" title="Ganeti.Types">NonEmptyString</a></li><li class="src short"><a href="#v:genPrintableByteString">genPrintableByteString</a> :: Gen ByteString</li><li class="src short"><a href="#v:genName">genName</a> :: Gen String</li><li class="src short"><a href="#v:genFQDN">genFQDN</a> :: Gen String</li><li class="src short"><a href="#v:genUUID">genUUID</a> :: Gen String</li><li class="src short"><a href="#v:genMaybe">genMaybe</a> :: Gen a -&gt; Gen (Maybe a)</li><li class="src short"><a href="#v:genSublist">genSublist</a> :: [a] -&gt; Gen [a]</li><li class="src short"><a href="#v:genMap">genMap</a> :: (Ord k, Ord v) =&gt; Gen k -&gt; Gen v -&gt; Gen (Map k v)</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:TagChar">TagChar</a> = <a href="#v:TagChar">TagChar</a> {<ul class="subs"><li><a href="#v:tagGetChar">tagGetChar</a> :: Char</li></ul>}</li><li class="src short"><a href="#v:tagChar">tagChar</a> :: String</li><li class="src short"><a href="#v:genTag">genTag</a> :: Gen [<a href="Test-Ganeti-TestCommon.html#t:TagChar" title="Test.Ganeti.TestCommon">TagChar</a>]</li><li class="src short"><a href="#v:genTags">genTags</a> :: Gen [String]</li><li class="src short"><a href="#v:genFields">genFields</a> :: Gen [String]</li><li class="src short"><a href="#v:genUniquesList">genUniquesList</a> :: (Eq a, Arbitrary a, Ord a) =&gt; Int -&gt; Gen a -&gt; Gen [a]</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:SmallRatio">SmallRatio</a> = <a href="#v:SmallRatio">SmallRatio</a> Double</li><li class="src short"><a href="#v:genSetHelper">genSetHelper</a> :: Ord a =&gt; [a] -&gt; Maybe Int -&gt; Gen (Set a)</li><li class="src short"><a href="#v:genSet">genSet</a> :: (Ord a, Bounded a, Enum a) =&gt; Maybe Int -&gt; Gen (Set a)</li><li class="src short"><a href="#v:genListSet">genListSet</a> :: (Ord a, Bounded a, Enum a) =&gt; Maybe Int -&gt; Gen (<a href="Ganeti-BasicTypes.html#t:ListSet" title="Ganeti.BasicTypes">ListSet</a> a)</li><li class="src short"><a href="#v:genAndRestArguments">genAndRestArguments</a> :: Gen (Map String JSValue)</li><li class="src short"><a href="#v:genIPv4">genIPv4</a> :: Gen String</li><li class="src short"><a href="#v:genIPv4Address">genIPv4Address</a> :: Gen <a href="Ganeti-Types.html#t:IPv4Address" title="Ganeti.Types">IPv4Address</a></li><li class="src short"><a href="#v:genIPv4AddrRange">genIPv4AddrRange</a> :: Gen String</li><li class="src short"><a href="#v:genIPv4Network">genIPv4Network</a> :: Gen <a href="Ganeti-Types.html#t:IPv4Network" title="Ganeti.Types">IPv4Network</a></li><li class="src short"><a href="#v:netmask2NumHosts">netmask2NumHosts</a> :: Word8 -&gt; Int</li><li class="src short"><a href="#v:genIp6Addr">genIp6Addr</a> :: Gen String</li><li class="src short"><a href="#v:ip6AddressFromNumber">ip6AddressFromNumber</a> :: Integer -&gt; [Char]</li><li class="src short"><a href="#v:genIp6Net">genIp6Net</a> :: Gen String</li><li class="src short"><a href="#v:genOpCodesTagName">genOpCodesTagName</a> :: <a href="Ganeti-Types.html#t:TagKind" title="Ganeti.Types">TagKind</a> -&gt; Gen (Maybe String)</li><li class="src short"><a href="#v:genLuxiTagName">genLuxiTagName</a> :: <a href="Ganeti-Types.html#t:TagKind" title="Ganeti.Types">TagKind</a> -&gt; Gen String</li><li class="src short"><a href="#v:testSerialisation">testSerialisation</a> :: (Eq a, Show a, JSON a) =&gt; a -&gt; Property</li><li class="src short"><a href="#v:testArraySerialisation">testArraySerialisation</a> :: (Eq a, Show a, <a href="Ganeti-JSON.html#t:ArrayObject" title="Ganeti.JSON">ArrayObject</a> a) =&gt; a -&gt; Property</li><li class="src short"><a href="#v:testDeserialisationFail">testDeserialisationFail</a> :: (Eq a, Show a, JSON a) =&gt; a -&gt; JSValue -&gt; Property</li><li class="src short"><a href="#v:resultProp">resultProp</a> :: Show a =&gt; <a href="Ganeti-BasicTypes.html#t:GenericResult" title="Ganeti.BasicTypes">GenericResult</a> a b -&gt; PropertyM IO b</li><li class="src short"><a href="#v:getSourceDir">getSourceDir</a> :: IO FilePath</li><li class="src short"><a href="#v:testDataFilename">testDataFilename</a> :: String -&gt; String -&gt; IO FilePath</li><li class="src short"><a href="#v:readTestData">readTestData</a> :: String -&gt; IO String</li><li class="src short"><a href="#v:genSample">genSample</a> :: Gen a -&gt; IO a</li><li class="src short"><a href="#v:testParser">testParser</a> :: (Show a, Eq a) =&gt; Parser a -&gt; String -&gt; a -&gt; Assertion</li><li class="src short"><a href="#v:genPropParser">genPropParser</a> :: (Show a, Eq a) =&gt; Parser a -&gt; String -&gt; a -&gt; Property</li><li class="src short"><a href="#v:genNonNegative">genNonNegative</a> :: Gen Int</li><li class="src short"><a href="#v:relativeError">relativeError</a> :: Double -&gt; Double -&gt; Double</li><li class="src short"><a href="#v:getTempFileName">getTempFileName</a> :: String -&gt; IO FilePath</li><li class="src short"><a href="#v:listOfUniqueBy">listOfUniqueBy</a> :: Ord b =&gt; Gen a -&gt; (a -&gt; b) -&gt; [a] -&gt; Gen [a]</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Compatibility instances</h1></a><a href="#g:2" id="g:2"><h1>Arbitrary orphan instances</h1></a><a href="#g:3" id="g:3"><h1>Constants</h1></a><div class="top"><p class="src"><a id="v:maxMem" class="def">maxMem</a> :: Int <a href="Test/Ganeti/TestCommon.html#maxMem" class="link">Source</a> <a href="#v:maxMem" class="selflink">#</a></p><div class="doc"><p>Maximum memory (1TiB, somewhat random value).</p></div></div><div class="top"><p class="src"><a id="v:maxDsk" class="def">maxDsk</a> :: Int <a href="Test/Ganeti/TestCommon.html#maxDsk" class="link">Source</a> <a href="#v:maxDsk" class="selflink">#</a></p><div class="doc"><p>Maximum disk (8TiB, somewhat random value).</p></div></div><div class="top"><p class="src"><a id="v:maxCpu" class="def">maxCpu</a> :: Int <a href="Test/Ganeti/TestCommon.html#maxCpu" class="link">Source</a> <a href="#v:maxCpu" class="selflink">#</a></p><div class="doc"><p>Max CPUs (1024, somewhat random value).</p></div></div><div class="top"><p class="src"><a id="v:maxSpindles" class="def">maxSpindles</a> :: Int <a href="Test/Ganeti/TestCommon.html#maxSpindles" class="link">Source</a> <a href="#v:maxSpindles" class="selflink">#</a></p><div class="doc"><p>Max spindles (1024, somewhat random value).</p></div></div><div class="top"><p class="src"><a id="v:maxVcpuRatio" class="def">maxVcpuRatio</a> :: Double <a href="Test/Ganeti/TestCommon.html#maxVcpuRatio" class="link">Source</a> <a href="#v:maxVcpuRatio" class="selflink">#</a></p><div class="doc"><p>Max vcpu ratio (random value).</p></div></div><div class="top"><p class="src"><a id="v:maxSpindleRatio" class="def">maxSpindleRatio</a> :: Double <a href="Test/Ganeti/TestCommon.html#maxSpindleRatio" class="link">Source</a> <a href="#v:maxSpindleRatio" class="selflink">#</a></p><div class="doc"><p>Max spindle ratio (random value).</p></div></div><div class="top"><p class="src"><a id="v:maxNodes" class="def">maxNodes</a> :: Int <a href="Test/Ganeti/TestCommon.html#maxNodes" class="link">Source</a> <a href="#v:maxNodes" class="selflink">#</a></p><div class="doc"><p>Max nodes, used just to limit arbitrary instances for smaller
 opcode definitions (e.g. list of nodes in OpTestDelay).</p></div></div><div class="top"><p class="src"><a id="v:maxOpCodes" class="def">maxOpCodes</a> :: Int <a href="Test/Ganeti/TestCommon.html#maxOpCodes" class="link">Source</a> <a href="#v:maxOpCodes" class="selflink">#</a></p><div class="doc"><p>Max opcodes or jobs in a submit job and submit many jobs.</p></div></div><a href="#g:4" id="g:4"><h1>Helper functions</h1></a><div class="top"><p class="src"><a id="v:-61--61--63-" class="def">(==?)</a> :: (Show a, Eq a) =&gt; a -&gt; a -&gt; Property <span class="fixity">infix 3</span><span class="rightedge"></span> <a href="Test/Ganeti/TestCommon.html#%3D%3D%3F" class="link">Source</a> <a href="#v:-61--61--63-" class="selflink">#</a></p><div class="doc"><p>Checks for equality with proper annotation. The first argument is
 the computed value, the second one the expected value.</p></div></div><div class="top"><p class="src"><a id="v:-47--61--63-" class="def">(/=?)</a> :: (Show a, Eq a) =&gt; a -&gt; a -&gt; Property <span class="fixity">infix 3</span><span class="rightedge"></span> <a href="Test/Ganeti/TestCommon.html#%2F%3D%3F" class="link">Source</a> <a href="#v:-47--61--63-" class="selflink">#</a></p><div class="doc"><p>Checks for inequality with proper annotation. The first argument
 is the computed value, the second one the expected (not equal)
 value.</p></div></div><div class="top"><p class="src"><a id="v:failTest" class="def">failTest</a> :: String -&gt; Property <a href="Test/Ganeti/TestCommon.html#failTest" class="link">Source</a> <a href="#v:failTest" class="selflink">#</a></p><div class="doc"><p>Show a message and fail the test.</p></div></div><div class="top"><p class="src"><a id="v:passTest" class="def">passTest</a> :: Property <a href="Test/Ganeti/TestCommon.html#passTest" class="link">Source</a> <a href="#v:passTest" class="selflink">#</a></p><div class="doc"><p>A <code>True</code> property.</p></div></div><div class="top"><p class="src"><a id="v:cover-39-" class="def">cover'</a> :: Testable prop =&gt; Double -&gt; Bool -&gt; String -&gt; prop -&gt; Property <a href="Test/Ganeti/TestCommon.html#cover%27" class="link">Source</a> <a href="#v:cover-39-" class="selflink">#</a></p><div class="doc"><p>QuickCheck 2.12 swapped the order of the first two arguments, so provide a
 compatibility function here</p></div></div><div class="top"><p class="src"><a id="v:stableCover" class="def">stableCover</a> :: Testable prop =&gt; Bool -&gt; Double -&gt; String -&gt; prop -&gt; Property <a href="Test/Ganeti/TestCommon.html#stableCover" class="link">Source</a> <a href="#v:stableCover" class="selflink">#</a></p><div class="doc"><p>A stable version of QuickCheck's <code>cover</code>. In its current implementation,
 cover will not detect insufficient coverage if the actual coverage in the
 sample is 0. Work around this by lifting the probability to at least
 10 percent.
 The underlying issue is tracked at
 <a href="https://github.com/nick8325/quickcheck/issues/26">https://github.com/nick8325/quickcheck/issues/26</a></p></div></div><div class="top"><p class="src"><a id="v:pythonCmd" class="def">pythonCmd</a> :: IO String <a href="Test/Ganeti/TestCommon.html#pythonCmd" class="link">Source</a> <a href="#v:pythonCmd" class="selflink">#</a></p><div class="doc"><p>Return the python binary to use. If the PYTHON environment
 variable is defined, use its value, otherwise use just &quot;python3&quot;.</p></div></div><div class="top"><p class="src"><a id="v:runPython" class="def">runPython</a> :: String -&gt; String -&gt; IO (ExitCode, String, String) <a href="Test/Ganeti/TestCommon.html#runPython" class="link">Source</a> <a href="#v:runPython" class="selflink">#</a></p><div class="doc"><p>Run Python with an expression, returning the exit code, standard
 output and error.</p></div></div><div class="top"><p class="src"><a id="v:checkPythonResult" class="def">checkPythonResult</a> :: (ExitCode, String, String) -&gt; IO String <a href="Test/Ganeti/TestCommon.html#checkPythonResult" class="link">Source</a> <a href="#v:checkPythonResult" class="selflink">#</a></p><div class="doc"><p>Check python exit code, and fail via HUnit assertions if
 non-zero. Otherwise, return the standard output.</p></div></div><a href="#g:5" id="g:5"><h1>Arbitrary instances</h1></a><div class="top"><p class="src"><span class="keyword">newtype</span> <a id="t:DNSChar" class="def">DNSChar</a> <a href="Test/Ganeti/TestCommon.html#DNSChar" class="link">Source</a> <a href="#t:DNSChar" class="selflink">#</a></p><div class="doc"><p>Defines a DNS name.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:DNSChar" class="def">DNSChar</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:dnsGetChar" class="def">dnsGetChar</a> :: Char</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:DNSChar">Instances</h4><details id="i:DNSChar" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:DNSChar:Show:1"></span> Show <a href="Test-Ganeti-TestCommon.html#t:DNSChar" title="Test.Ganeti.TestCommon">DNSChar</a></span> <a href="#t:DNSChar" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:DNSChar:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Test-Ganeti-TestCommon.html">Test.Ganeti.TestCommon</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: Int -&gt; <a href="Test-Ganeti-TestCommon.html#t:DNSChar" title="Test.Ganeti.TestCommon">DNSChar</a> -&gt; ShowS</p><p class="src"><a href="#v:show">show</a> :: <a href="Test-Ganeti-TestCommon.html#t:DNSChar" title="Test.Ganeti.TestCommon">DNSChar</a> -&gt; String</p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Test-Ganeti-TestCommon.html#t:DNSChar" title="Test.Ganeti.TestCommon">DNSChar</a>] -&gt; ShowS</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:DNSChar:Arbitrary:2"></span> Arbitrary <a href="Test-Ganeti-TestCommon.html#t:DNSChar" title="Test.Ganeti.TestCommon">DNSChar</a></span> <a href="#t:DNSChar" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:DNSChar:Arbitrary:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Test-Ganeti-TestCommon.html">Test.Ganeti.TestCommon</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:arbitrary">arbitrary</a> :: Gen <a href="Test-Ganeti-TestCommon.html#t:DNSChar" title="Test.Ganeti.TestCommon">DNSChar</a></p><p class="src"><a href="#v:shrink">shrink</a> :: <a href="Test-Ganeti-TestCommon.html#t:DNSChar" title="Test.Ganeti.TestCommon">DNSChar</a> -&gt; [<a href="Test-Ganeti-TestCommon.html#t:DNSChar" title="Test.Ganeti.TestCommon">DNSChar</a>]</p></div></details></td></tr></table></details></div></div><a href="#g:6" id="g:6"><h1>Generators</h1></a><div class="top"><p class="src"><a id="v:genPrintableAsciiChar" class="def">genPrintableAsciiChar</a> :: Gen Char <a href="Test/Ganeti/TestCommon.html#genPrintableAsciiChar" class="link">Source</a> <a href="#v:genPrintableAsciiChar" class="selflink">#</a></p><div class="doc"><p>Generates printable ASCII characters (from ' ' to '~').</p></div></div><div class="top"><p class="src"><a id="v:genPrintableAsciiString" class="def">genPrintableAsciiString</a> :: Gen String <a href="Test/Ganeti/TestCommon.html#genPrintableAsciiString" class="link">Source</a> <a href="#v:genPrintableAsciiString" class="selflink">#</a></p><div class="doc"><p>Generates a short string (0 &lt;= n &lt;= 40 chars) from printable ASCII.</p></div></div><div class="top"><p class="src"><a id="v:genPrintableAsciiStringNE" class="def">genPrintableAsciiStringNE</a> :: Gen <a href="Ganeti-Types.html#t:NonEmptyString" title="Ganeti.Types">NonEmptyString</a> <a href="Test/Ganeti/TestCommon.html#genPrintableAsciiStringNE" class="link">Source</a> <a href="#v:genPrintableAsciiStringNE" class="selflink">#</a></p><div class="doc"><p>Generates a short string (1 &lt;= n &lt;= 40 chars) from printable ASCII.</p></div></div><div class="top"><p class="src"><a id="v:genPrintableByteString" class="def">genPrintableByteString</a> :: Gen ByteString <a href="Test/Ganeti/TestCommon.html#genPrintableByteString" class="link">Source</a> <a href="#v:genPrintableByteString" class="selflink">#</a></p><div class="doc"><p>Generates a printable Unicode ByteString</p></div></div><div class="top"><p class="src"><a id="v:genName" class="def">genName</a> :: Gen String <a href="Test/Ganeti/TestCommon.html#genName" class="link">Source</a> <a href="#v:genName" class="selflink">#</a></p><div class="doc"><p>Generates a single name component.</p></div></div><div class="top"><p class="src"><a id="v:genFQDN" class="def">genFQDN</a> :: Gen String <a href="Test/Ganeti/TestCommon.html#genFQDN" class="link">Source</a> <a href="#v:genFQDN" class="selflink">#</a></p><div class="doc"><p>Generates an entire FQDN.</p></div></div><div class="top"><p class="src"><a id="v:genUUID" class="def">genUUID</a> :: Gen String <a href="Test/Ganeti/TestCommon.html#genUUID" class="link">Source</a> <a href="#v:genUUID" class="selflink">#</a></p><div class="doc"><p>Generates a UUID-like string.</p><p>Only to be used for QuickCheck testing. For obtaining actual UUIDs use
 the newUUID function in Ganeti.Utils</p></div></div><div class="top"><p class="src"><a id="v:genMaybe" class="def">genMaybe</a> :: Gen a -&gt; Gen (Maybe a) <a href="Test/Ganeti/TestCommon.html#genMaybe" class="link">Source</a> <a href="#v:genMaybe" class="selflink">#</a></p><div class="doc"><p>Combinator that generates a <code>Maybe</code> using a sub-combinator.</p></div></div><div class="top"><p class="src"><a id="v:genSublist" class="def">genSublist</a> :: [a] -&gt; Gen [a] <a href="Test/Ganeti/TestCommon.html#genSublist" class="link">Source</a> <a href="#v:genSublist" class="selflink">#</a></p><div class="doc"><p>Generates a sublist of a given list, keeping the ordering.
 The generated elements are always a subset of the list.</p><p>In order to better support corner cases, the size of the sublist is
 chosen to have the uniform distribution.</p></div></div><div class="top"><p class="src"><a id="v:genMap" class="def">genMap</a> :: (Ord k, Ord v) =&gt; Gen k -&gt; Gen v -&gt; Gen (Map k v) <a href="Test/Ganeti/TestCommon.html#genMap" class="link">Source</a> <a href="#v:genMap" class="selflink">#</a></p><div class="doc"><p>Generates a map given generators for keys and values.</p></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a id="t:TagChar" class="def">TagChar</a> <a href="Test/Ganeti/TestCommon.html#TagChar" class="link">Source</a> <a href="#t:TagChar" class="selflink">#</a></p><div class="doc"><p>Defines a tag type.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:TagChar" class="def">TagChar</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:tagGetChar" class="def">tagGetChar</a> :: Char</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><a id="v:tagChar" class="def">tagChar</a> :: String <a href="Test/Ganeti/TestCommon.html#tagChar" class="link">Source</a> <a href="#v:tagChar" class="selflink">#</a></p><div class="doc"><p>All valid tag chars. This doesn't need to match _exactly_
 Ganeti's own tag regex, just enough for it to be close.</p></div></div><div class="top"><p class="src"><a id="v:genTag" class="def">genTag</a> :: Gen [<a href="Test-Ganeti-TestCommon.html#t:TagChar" title="Test.Ganeti.TestCommon">TagChar</a>] <a href="Test/Ganeti/TestCommon.html#genTag" class="link">Source</a> <a href="#v:genTag" class="selflink">#</a></p><div class="doc"><p>Generates a tag</p></div></div><div class="top"><p class="src"><a id="v:genTags" class="def">genTags</a> :: Gen [String] <a href="Test/Ganeti/TestCommon.html#genTags" class="link">Source</a> <a href="#v:genTags" class="selflink">#</a></p><div class="doc"><p>Generates a list of tags (correctly upper bounded).</p></div></div><div class="top"><p class="src"><a id="v:genFields" class="def">genFields</a> :: Gen [String] <a href="Test/Ganeti/TestCommon.html#genFields" class="link">Source</a> <a href="#v:genFields" class="selflink">#</a></p><div class="doc"><p>Generates a fields list. This uses the same character set as a
 DNS name (just for simplicity).</p></div></div><div class="top"><p class="src"><a id="v:genUniquesList" class="def">genUniquesList</a> :: (Eq a, Arbitrary a, Ord a) =&gt; Int -&gt; Gen a -&gt; Gen [a] <a href="Test/Ganeti/TestCommon.html#genUniquesList" class="link">Source</a> <a href="#v:genUniquesList" class="selflink">#</a></p><div class="doc"><p>Generates a list of a given size with non-duplicate elements.</p></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a id="t:SmallRatio" class="def">SmallRatio</a> <a href="Test/Ganeti/TestCommon.html#SmallRatio" class="link">Source</a> <a href="#t:SmallRatio" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:SmallRatio" class="def">SmallRatio</a> Double</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:SmallRatio">Instances</h4><details id="i:SmallRatio" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:SmallRatio:Show:1"></span> Show <a href="Test-Ganeti-TestCommon.html#t:SmallRatio" title="Test.Ganeti.TestCommon">SmallRatio</a></span> <a href="#t:SmallRatio" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:SmallRatio:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Test-Ganeti-TestCommon.html">Test.Ganeti.TestCommon</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: Int -&gt; <a href="Test-Ganeti-TestCommon.html#t:SmallRatio" title="Test.Ganeti.TestCommon">SmallRatio</a> -&gt; ShowS</p><p class="src"><a href="#v:show">show</a> :: <a href="Test-Ganeti-TestCommon.html#t:SmallRatio" title="Test.Ganeti.TestCommon">SmallRatio</a> -&gt; String</p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Test-Ganeti-TestCommon.html#t:SmallRatio" title="Test.Ganeti.TestCommon">SmallRatio</a>] -&gt; ShowS</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:SmallRatio:Arbitrary:2"></span> Arbitrary <a href="Test-Ganeti-TestCommon.html#t:SmallRatio" title="Test.Ganeti.TestCommon">SmallRatio</a></span> <a href="#t:SmallRatio" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:SmallRatio:Arbitrary:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Test-Ganeti-TestCommon.html">Test.Ganeti.TestCommon</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:arbitrary">arbitrary</a> :: Gen <a href="Test-Ganeti-TestCommon.html#t:SmallRatio" title="Test.Ganeti.TestCommon">SmallRatio</a></p><p class="src"><a href="#v:shrink">shrink</a> :: <a href="Test-Ganeti-TestCommon.html#t:SmallRatio" title="Test.Ganeti.TestCommon">SmallRatio</a> -&gt; [<a href="Test-Ganeti-TestCommon.html#t:SmallRatio" title="Test.Ganeti.TestCommon">SmallRatio</a>]</p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:genSetHelper" class="def">genSetHelper</a> :: Ord a =&gt; [a] -&gt; Maybe Int -&gt; Gen (Set a) <a href="Test/Ganeti/TestCommon.html#genSetHelper" class="link">Source</a> <a href="#v:genSetHelper" class="selflink">#</a></p><div class="doc"><p>Helper for <code><a href="Test-Ganeti-TestCommon.html#v:genSet" title="Test.Ganeti.TestCommon">genSet</a></code>, declared separately due to type constraints.</p></div></div><div class="top"><p class="src"><a id="v:genSet" class="def">genSet</a> :: (Ord a, Bounded a, Enum a) =&gt; Maybe Int -&gt; Gen (Set a) <a href="Test/Ganeti/TestCommon.html#genSet" class="link">Source</a> <a href="#v:genSet" class="selflink">#</a></p><div class="doc"><p>Generates a <code>Set</code> of arbitrary elements.</p></div></div><div class="top"><p class="src"><a id="v:genListSet" class="def">genListSet</a> :: (Ord a, Bounded a, Enum a) =&gt; Maybe Int -&gt; Gen (<a href="Ganeti-BasicTypes.html#t:ListSet" title="Ganeti.BasicTypes">ListSet</a> a) <a href="Test/Ganeti/TestCommon.html#genListSet" class="link">Source</a> <a href="#v:genListSet" class="selflink">#</a></p><div class="doc"><p>Generates a <code>Set</code> of arbitrary elements wrapped in a <code>ListSet</code></p></div></div><div class="top"><p class="src"><a id="v:genAndRestArguments" class="def">genAndRestArguments</a> :: Gen (Map String JSValue) <a href="Test/Ganeti/TestCommon.html#genAndRestArguments" class="link">Source</a> <a href="#v:genAndRestArguments" class="selflink">#</a></p><div class="doc"><p>Generate an arbitrary element of and AndRestArguments field.</p></div></div><div class="top"><p class="src"><a id="v:genIPv4" class="def">genIPv4</a> :: Gen String <a href="Test/Ganeti/TestCommon.html#genIPv4" class="link">Source</a> <a href="#v:genIPv4" class="selflink">#</a></p><div class="doc"><p>Generate an arbitrary IPv4 address in textual form.</p></div></div><div class="top"><p class="src"><a id="v:genIPv4Address" class="def">genIPv4Address</a> :: Gen <a href="Ganeti-Types.html#t:IPv4Address" title="Ganeti.Types">IPv4Address</a> <a href="Test/Ganeti/TestCommon.html#genIPv4Address" class="link">Source</a> <a href="#v:genIPv4Address" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:genIPv4AddrRange" class="def">genIPv4AddrRange</a> :: Gen String <a href="Test/Ganeti/TestCommon.html#genIPv4AddrRange" class="link">Source</a> <a href="#v:genIPv4AddrRange" class="selflink">#</a></p><div class="doc"><p>Generate an arbitrary IPv4 network in textual form.</p></div></div><div class="top"><p class="src"><a id="v:genIPv4Network" class="def">genIPv4Network</a> :: Gen <a href="Ganeti-Types.html#t:IPv4Network" title="Ganeti.Types">IPv4Network</a> <a href="Test/Ganeti/TestCommon.html#genIPv4Network" class="link">Source</a> <a href="#v:genIPv4Network" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:netmask2NumHosts" class="def">netmask2NumHosts</a> :: Word8 -&gt; Int <a href="Test/Ganeti/TestCommon.html#netmask2NumHosts" class="link">Source</a> <a href="#v:netmask2NumHosts" class="selflink">#</a></p><div class="doc"><p>Helper function to compute the number of hosts in a network
 given the netmask. (For IPv4 only.)</p></div></div><div class="top"><p class="src"><a id="v:genIp6Addr" class="def">genIp6Addr</a> :: Gen String <a href="Test/Ganeti/TestCommon.html#genIp6Addr" class="link">Source</a> <a href="#v:genIp6Addr" class="selflink">#</a></p><div class="doc"><p>Generates an arbitrary IPv6 network address in textual form.
 The generated address is not simpflified, e. g. an address like
 &quot;2607:f0d0:1002:0051:0000:0000:0000:0004&quot; does not become
 &quot;2607:f0d0:1002:51::4&quot;</p></div></div><div class="top"><p class="src"><a id="v:ip6AddressFromNumber" class="def">ip6AddressFromNumber</a> :: Integer -&gt; [Char] <a href="Test/Ganeti/TestCommon.html#ip6AddressFromNumber" class="link">Source</a> <a href="#v:ip6AddressFromNumber" class="selflink">#</a></p><div class="doc"><p>Helper function to convert an integer in to an IPv6 address in textual
 form</p></div></div><div class="top"><p class="src"><a id="v:genIp6Net" class="def">genIp6Net</a> :: Gen String <a href="Test/Ganeti/TestCommon.html#genIp6Net" class="link">Source</a> <a href="#v:genIp6Net" class="selflink">#</a></p><div class="doc"><p>Generates an arbitrary IPv6 network in textual form.</p></div></div><div class="top"><p class="src"><a id="v:genOpCodesTagName" class="def">genOpCodesTagName</a> :: <a href="Ganeti-Types.html#t:TagKind" title="Ganeti.Types">TagKind</a> -&gt; Gen (Maybe String) <a href="Test/Ganeti/TestCommon.html#genOpCodesTagName" class="link">Source</a> <a href="#v:genOpCodesTagName" class="selflink">#</a></p><div class="doc"><p>Generates a valid, arbitrary tag name with respect to the given
 <code><a href="Ganeti-Types.html#t:TagKind" title="Ganeti.Types">TagKind</a></code> for opcodes.</p></div></div><div class="top"><p class="src"><a id="v:genLuxiTagName" class="def">genLuxiTagName</a> :: <a href="Ganeti-Types.html#t:TagKind" title="Ganeti.Types">TagKind</a> -&gt; Gen String <a href="Test/Ganeti/TestCommon.html#genLuxiTagName" class="link">Source</a> <a href="#v:genLuxiTagName" class="selflink">#</a></p><div class="doc"><p>Generates a valid, arbitrary tag name with respect to the given
 <code><a href="Ganeti-Types.html#t:TagKind" title="Ganeti.Types">TagKind</a></code> for Luxi.</p></div></div><a href="#g:7" id="g:7"><h1>Helper functions</h1></a><div class="top"><p class="src"><a id="v:testSerialisation" class="def">testSerialisation</a> :: (Eq a, Show a, JSON a) =&gt; a -&gt; Property <a href="Test/Ganeti/TestCommon.html#testSerialisation" class="link">Source</a> <a href="#v:testSerialisation" class="selflink">#</a></p><div class="doc"><p>Checks for serialisation idempotence.</p></div></div><div class="top"><p class="src"><a id="v:testArraySerialisation" class="def">testArraySerialisation</a> :: (Eq a, Show a, <a href="Ganeti-JSON.html#t:ArrayObject" title="Ganeti.JSON">ArrayObject</a> a) =&gt; a -&gt; Property <a href="Test/Ganeti/TestCommon.html#testArraySerialisation" class="link">Source</a> <a href="#v:testArraySerialisation" class="selflink">#</a></p><div class="doc"><p>Checks for array serialisation idempotence.</p></div></div><div class="top"><p class="src"><a id="v:testDeserialisationFail" class="def">testDeserialisationFail</a> :: (Eq a, Show a, JSON a) =&gt; a -&gt; JSValue -&gt; Property <a href="Test/Ganeti/TestCommon.html#testDeserialisationFail" class="link">Source</a> <a href="#v:testDeserialisationFail" class="selflink">#</a></p><div class="doc"><p>Checks if the deserializer doesn't accept forbidden values.
 The first argument is ignored, it just enforces the correct type.</p></div></div><div class="top"><p class="src"><a id="v:resultProp" class="def">resultProp</a> :: Show a =&gt; <a href="Ganeti-BasicTypes.html#t:GenericResult" title="Ganeti.BasicTypes">GenericResult</a> a b -&gt; PropertyM IO b <a href="Test/Ganeti/TestCommon.html#resultProp" class="link">Source</a> <a href="#v:resultProp" class="selflink">#</a></p><div class="doc"><p>Result to PropertyM IO.</p></div></div><div class="top"><p class="src"><a id="v:getSourceDir" class="def">getSourceDir</a> :: IO FilePath <a href="Test/Ganeti/TestCommon.html#getSourceDir" class="link">Source</a> <a href="#v:getSourceDir" class="selflink">#</a></p><div class="doc"><p>Return the source directory of Ganeti.</p></div></div><div class="top"><p class="src"><a id="v:testDataFilename" class="def">testDataFilename</a> :: String -&gt; String -&gt; IO FilePath <a href="Test/Ganeti/TestCommon.html#testDataFilename" class="link">Source</a> <a href="#v:testDataFilename" class="selflink">#</a></p><div class="doc"><p>Returns the path of a file in the test data directory, given its name.</p></div></div><div class="top"><p class="src"><a id="v:readTestData" class="def">readTestData</a> :: String -&gt; IO String <a href="Test/Ganeti/TestCommon.html#readTestData" class="link">Source</a> <a href="#v:readTestData" class="selflink">#</a></p><div class="doc"><p>Returns the content of the specified haskell test data file.</p></div></div><div class="top"><p class="src"><a id="v:genSample" class="def">genSample</a> :: Gen a -&gt; IO a <a href="Test/Ganeti/TestCommon.html#genSample" class="link">Source</a> <a href="#v:genSample" class="selflink">#</a></p><div class="doc"><p>Generate arbitrary values in the IO monad. This is a simple
 wrapper over <code>sample'</code>.</p></div></div><div class="top"><p class="src"><a id="v:testParser" class="def">testParser</a> :: (Show a, Eq a) =&gt; Parser a -&gt; String -&gt; a -&gt; Assertion <a href="Test/Ganeti/TestCommon.html#testParser" class="link">Source</a> <a href="#v:testParser" class="selflink">#</a></p><div class="doc"><p>Function for testing whether a file is parsed correctly.</p></div></div><div class="top"><p class="src"><a id="v:genPropParser" class="def">genPropParser</a> :: (Show a, Eq a) =&gt; Parser a -&gt; String -&gt; a -&gt; Property <a href="Test/Ganeti/TestCommon.html#genPropParser" class="link">Source</a> <a href="#v:genPropParser" class="selflink">#</a></p><div class="doc"><p>Generate a property test for parsers.</p></div></div><div class="top"><p class="src"><a id="v:genNonNegative" class="def">genNonNegative</a> :: Gen Int <a href="Test/Ganeti/TestCommon.html#genNonNegative" class="link">Source</a> <a href="#v:genNonNegative" class="selflink">#</a></p><div class="doc"><p>Generate an arbitrary non negative integer number</p></div></div><div class="top"><p class="src"><a id="v:relativeError" class="def">relativeError</a> :: Double -&gt; Double -&gt; Double <a href="Test/Ganeti/TestCommon.html#relativeError" class="link">Source</a> <a href="#v:relativeError" class="selflink">#</a></p><div class="doc"><p>Computes the relative error of two <code>Double</code> numbers.</p><p>This is the &quot;relative error&quot; algorithm in
 http://randomascii.wordpress.com/2012/02/25/
 comparing-floating-point-numbers-2012-edition (URL split due to too
 long line).</p></div></div><div class="top"><p class="src"><a id="v:getTempFileName" class="def">getTempFileName</a> :: String -&gt; IO FilePath <a href="Test/Ganeti/TestCommon.html#getTempFileName" class="link">Source</a> <a href="#v:getTempFileName" class="selflink">#</a></p><div class="doc"><p>Helper to a get a temporary file name.</p></div></div><div class="top"><p class="src"><a id="v:listOfUniqueBy" class="def">listOfUniqueBy</a> :: Ord b =&gt; Gen a -&gt; (a -&gt; b) -&gt; [a] -&gt; Gen [a] <a href="Test/Ganeti/TestCommon.html#listOfUniqueBy" class="link">Source</a> <a href="#v:listOfUniqueBy" class="selflink">#</a></p><div class="doc"><p><code>listOfUniqueBy gen keyFun forbidden</code>: Generates a list of random length,
 where all generated elements will be unique by the keying function
 <code>keyFun</code>. They will also be distinct from all elements in <code>forbidden</code> by
 the keying function.</p><p>As for <code>listOf</code>, the maximum output length depends on the size parameter.</p><p>Example:</p><pre>listOfUniqueBy (arbitrary :: Gen String) (length) [&quot;hey&quot;]
-- Generates a list of strings of different length, but not of length 3.</pre><p>The passed <code>gen</code> should not make key collisions too likely, since the
 implementation uses <code>suchThat</code>, looping until enough unique elements
 have been generated. If the <code>gen</code> makes collisions likely, this function
 will consequently be slow, or not terminate if it is not possible to
 generate enough elements, like in:</p><pre>listOfUniqueBy (arbitrary :: Gen Int) (`mod` 2) []
-- May not terminate depending on the size parameter of the Gen,
-- since there are only 2 unique keys (0 and 1).</pre></div></div><h1>Orphan instances</h1><div id="section.orphans"><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:o:ic:MonadFail:MonadFail:1"></span> MonadFail Gen</span> <a href="#v:-36-fMonadFailGen" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:o:ic:MonadFail:MonadFail:1"><summary class="hide-when-js-enabled">Instance details</summary><p></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:fail">fail</a> :: String -&gt; Gen a</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:o:ic:Arbitrary:Arbitrary:2"></span> Arbitrary <a href="Ganeti-THH-Field.html#t:TagSet" title="Ganeti.THH.Field">TagSet</a></span> <a href="#v:-36-fArbitraryTagSet" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:o:ic:Arbitrary:Arbitrary:2"><summary class="hide-when-js-enabled">Instance details</summary><p></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:arbitrary">arbitrary</a> :: Gen <a href="Ganeti-THH-Field.html#t:TagSet" title="Ganeti.THH.Field">TagSet</a></p><p class="src"><a href="#v:shrink">shrink</a> :: <a href="Ganeti-THH-Field.html#t:TagSet" title="Ganeti.THH.Field">TagSet</a> -&gt; [<a href="Ganeti-THH-Field.html#t:TagSet" title="Ganeti.THH.Field">TagSet</a>]</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:o:ic:MonadFail:MonadFail:3"></span> MonadFail (Either String)</span> <a href="#v:-36-fMonadFailEither" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:o:ic:MonadFail:MonadFail:3"><summary class="hide-when-js-enabled">Instance details</summary><p></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:fail">fail</a> :: String -&gt; Either String a</p></div></details></td></tr></table></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.23.0</p></div></body></html>