<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Test.Ganeti.Locking.Waiting</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ganeti</span><ul class="links" id="page-menu"><li><a href="Test/Ganeti/Locking/Waiting.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Test.Ganeti.Locking.Waiting</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#section.orphans">Orphan instances</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Tests for lock waiting structure.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:UpdateRequest">UpdateRequest</a> a b c<ul class="subs"><li>= <a href="#v:Update">Update</a> b [<a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a]</li><li>| <a href="#v:UpdateWaiting">UpdateWaiting</a> c b [<a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a]</li><li>| <a href="#v:RemovePending">RemovePending</a> b</li><li>| <a href="#v:IntersectRequest">IntersectRequest</a> b [a]</li><li>| <a href="#v:OpportunisticUnion">OpportunisticUnion</a> b [(a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a>)]</li></ul></li><li class="src short"><a href="#v:asWaitingTrans">asWaitingTrans</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock" title="Ganeti.Locking.Types">Lock</a> a, Ord b, Ord c) =&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting" title="Ganeti.Locking.Waiting">LockWaiting</a> a b c -&gt; <a href="Test-Ganeti-Locking-Waiting.html#t:UpdateRequest" title="Test.Ganeti.Locking.Waiting">UpdateRequest</a> a b c -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting" title="Ganeti.Locking.Waiting">LockWaiting</a> a b c</li><li class="src short"><a href="#v:foldUpdates">foldUpdates</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock" title="Ganeti.Locking.Types">Lock</a> a, Ord b, Ord c) =&gt; [<a href="Test-Ganeti-Locking-Waiting.html#t:UpdateRequest" title="Test.Ganeti.Locking.Waiting">UpdateRequest</a> a b c] -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting" title="Ganeti.Locking.Waiting">LockWaiting</a> a b c</li><li class="src short"><a href="#v:prop_NoActionWithPendingRequests">prop_NoActionWithPendingRequests</a> :: Property</li><li class="src short"><a href="#v:forAllBlocked">forAllBlocked</a> :: Testable prop =&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting" title="Ganeti.Locking.Waiting">LockWaiting</a> <a href="Test-Ganeti-Locking-Allocation.html#t:TestLock" title="Test.Ganeti.Locking.Allocation">TestLock</a> <a href="Test-Ganeti-Locking-Allocation.html#t:TestOwner" title="Test.Ganeti.Locking.Allocation">TestOwner</a> Integer -&gt; <a href="Test-Ganeti-Locking-Allocation.html#t:TestOwner" title="Test.Ganeti.Locking.Allocation">TestOwner</a> -&gt; Integer -&gt; [<a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> <a href="Test-Ganeti-Locking-Allocation.html#t:TestLock" title="Test.Ganeti.Locking.Allocation">TestLock</a>] -&gt; prop) -&gt; Property</li><li class="src short"><a href="#v:prop_WaitingRequestsGetPending">prop_WaitingRequestsGetPending</a> :: Property</li><li class="src short"><a href="#v:prop_PendingGetFulfilledEventually">prop_PendingGetFulfilledEventually</a> :: Property</li><li class="src short"><a href="#v:prop_PendingGetNotifiedEventually">prop_PendingGetNotifiedEventually</a> :: Property</li><li class="src short"><a href="#v:prop_Progress">prop_Progress</a> :: Property</li><li class="src short"><a href="#v:prop_ProgressSound">prop_ProgressSound</a> :: Property</li><li class="src short"><a href="#v:prop_PendingJustified">prop_PendingJustified</a> :: Property</li><li class="src short"><a href="#v:prop_UpdateIdempotent">prop_UpdateIdempotent</a> :: Property</li><li class="src short"><a href="#v:prop_extReprPreserved">prop_extReprPreserved</a> :: Property</li><li class="src short"><a href="#v:prop_SimulateUpdateLocks">prop_SimulateUpdateLocks</a> :: Property</li><li class="src short"><a href="#v:prop_SimulateUpdateLocksWaiting">prop_SimulateUpdateLocksWaiting</a> :: Property</li><li class="src short"><a href="#v:prop_SafeUpdateWaitingCorrect">prop_SafeUpdateWaitingCorrect</a> :: Property</li><li class="src short"><a href="#v:prop_SafeUpdateWaitingIdempotent">prop_SafeUpdateWaitingIdempotent</a> :: Property</li><li class="src short"><a href="#v:prop_ReadShow">prop_ReadShow</a> :: Property</li><li class="src short"><a href="#v:prop_OpportunisticMonotone">prop_OpportunisticMonotone</a> :: Property</li><li class="src short"><a href="#v:prop_OpportunisticAnswer">prop_OpportunisticAnswer</a> :: Property</li><li class="src short"><a href="#v:testLocking_Waiting">testLocking_Waiting</a> :: Test</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:UpdateRequest" class="def">UpdateRequest</a> a b c <a href="Test/Ganeti/Locking/Waiting.html#UpdateRequest" class="link">Source</a> <a href="#t:UpdateRequest" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Update" class="def">Update</a> b [<a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a]</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:UpdateWaiting" class="def">UpdateWaiting</a> c b [<a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a]</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:RemovePending" class="def">RemovePending</a> b</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:IntersectRequest" class="def">IntersectRequest</a> b [a]</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:OpportunisticUnion" class="def">OpportunisticUnion</a> b [(a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a>)]</td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><a id="v:asWaitingTrans" class="def">asWaitingTrans</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock" title="Ganeti.Locking.Types">Lock</a> a, Ord b, Ord c) =&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting" title="Ganeti.Locking.Waiting">LockWaiting</a> a b c -&gt; <a href="Test-Ganeti-Locking-Waiting.html#t:UpdateRequest" title="Test.Ganeti.Locking.Waiting">UpdateRequest</a> a b c -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting" title="Ganeti.Locking.Waiting">LockWaiting</a> a b c <a href="Test/Ganeti/Locking/Waiting.html#asWaitingTrans" class="link">Source</a> <a href="#v:asWaitingTrans" class="selflink">#</a></p><div class="doc"><p>Transform an UpdateRequest into the corresponding state transformer.</p></div></div><div class="top"><p class="src"><a id="v:foldUpdates" class="def">foldUpdates</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock" title="Ganeti.Locking.Types">Lock</a> a, Ord b, Ord c) =&gt; [<a href="Test-Ganeti-Locking-Waiting.html#t:UpdateRequest" title="Test.Ganeti.Locking.Waiting">UpdateRequest</a> a b c] -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting" title="Ganeti.Locking.Waiting">LockWaiting</a> a b c <a href="Test/Ganeti/Locking/Waiting.html#foldUpdates" class="link">Source</a> <a href="#v:foldUpdates" class="selflink">#</a></p><div class="doc"><p>Fold a sequence of requests to transform a waiting strucutre onto the
 empty waiting. As we consider all exported transformations, any waiting
 structure can be obtained this way.</p></div></div><div class="top"><p class="src"><a id="v:prop_NoActionWithPendingRequests" class="def">prop_NoActionWithPendingRequests</a> :: Property <a href="Test/Ganeti/Locking/Waiting.html#prop_NoActionWithPendingRequests" class="link">Source</a> <a href="#v:prop_NoActionWithPendingRequests" class="selflink">#</a></p><div class="doc"><p>Verify that an owner with a pending request cannot make any
 changes to the lock structure.</p></div></div><div class="top"><p class="src"><a id="v:forAllBlocked" class="def">forAllBlocked</a> :: Testable prop =&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting" title="Ganeti.Locking.Waiting">LockWaiting</a> <a href="Test-Ganeti-Locking-Allocation.html#t:TestLock" title="Test.Ganeti.Locking.Allocation">TestLock</a> <a href="Test-Ganeti-Locking-Allocation.html#t:TestOwner" title="Test.Ganeti.Locking.Allocation">TestOwner</a> Integer -&gt; <a href="Test-Ganeti-Locking-Allocation.html#t:TestOwner" title="Test.Ganeti.Locking.Allocation">TestOwner</a> -&gt; Integer -&gt; [<a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> <a href="Test-Ganeti-Locking-Allocation.html#t:TestLock" title="Test.Ganeti.Locking.Allocation">TestLock</a>] -&gt; prop) -&gt; Property <a href="Test/Ganeti/Locking/Waiting.html#forAllBlocked" class="link">Source</a> <a href="#v:forAllBlocked" class="selflink">#</a></p><div class="doc"><p>Quantifier for blocked requests. Quantifies over the generic situation
 that there is a state, an owner, and a request that is blocked for that
 owner. To obtain such a situation, we use the fact that there must be a
 different owner having at least one lock.</p></div></div><div class="top"><p class="src"><a id="v:prop_WaitingRequestsGetPending" class="def">prop_WaitingRequestsGetPending</a> :: Property <a href="Test/Ganeti/Locking/Waiting.html#prop_WaitingRequestsGetPending" class="link">Source</a> <a href="#v:prop_WaitingRequestsGetPending" class="selflink">#</a></p><div class="doc"><p>Verify that an owner has a pending request after a waiting request
 not fullfilled immediately.</p></div></div><div class="top"><p class="src"><a id="v:prop_PendingGetFulfilledEventually" class="def">prop_PendingGetFulfilledEventually</a> :: Property <a href="Test/Ganeti/Locking/Waiting.html#prop_PendingGetFulfilledEventually" class="link">Source</a> <a href="#v:prop_PendingGetFulfilledEventually" class="selflink">#</a></p><div class="doc"><p>Verify that pending requests get fullfilled once all blockers release
 their resources.</p></div></div><div class="top"><p class="src"><a id="v:prop_PendingGetNotifiedEventually" class="def">prop_PendingGetNotifiedEventually</a> :: Property <a href="Test/Ganeti/Locking/Waiting.html#prop_PendingGetNotifiedEventually" class="link">Source</a> <a href="#v:prop_PendingGetNotifiedEventually" class="selflink">#</a></p><div class="doc"><p>Verify that the owner of a pending request gets notified once all blockers
 release their resources.</p></div></div><div class="top"><p class="src"><a id="v:prop_Progress" class="def">prop_Progress</a> :: Property <a href="Test/Ganeti/Locking/Waiting.html#prop_Progress" class="link">Source</a> <a href="#v:prop_Progress" class="selflink">#</a></p><div class="doc"><p>Verify that some progress is made after the direct blockers give up their
 locks. Note that we cannot guarantee that the original requester gets its
 request granted, as someone else might have a more important priority.</p></div></div><div class="top"><p class="src"><a id="v:prop_ProgressSound" class="def">prop_ProgressSound</a> :: Property <a href="Test/Ganeti/Locking/Waiting.html#prop_ProgressSound" class="link">Source</a> <a href="#v:prop_ProgressSound" class="selflink">#</a></p><div class="doc"><p>Verify that the notifications send out are sound, i.e., upon notification
 the requests actually are fulfilled. To be sure to have at least one
 notification we, again, use the scenario that a request is blocked and then
 all the blockers release their resources.</p></div></div><div class="top"><p class="src"><a id="v:prop_PendingJustified" class="def">prop_PendingJustified</a> :: Property <a href="Test/Ganeti/Locking/Waiting.html#prop_PendingJustified" class="link">Source</a> <a href="#v:prop_PendingJustified" class="selflink">#</a></p><div class="doc"><p>Verify that all pending requests are valid and cannot be fulfilled in
 the underlying lock allocation.</p></div></div><div class="top"><p class="src"><a id="v:prop_UpdateIdempotent" class="def">prop_UpdateIdempotent</a> :: Property <a href="Test/Ganeti/Locking/Waiting.html#prop_UpdateIdempotent" class="link">Source</a> <a href="#v:prop_UpdateIdempotent" class="selflink">#</a></p><div class="doc"><p>Verify that <code><a href="Ganeti-Locking-Waiting.html#v:updateLocks" title="Ganeti.Locking.Waiting">updateLocks</a></code> is idempotent, except that in the repetition,
 no waiters are notified.</p></div></div><div class="top"><p class="src"><a id="v:prop_extReprPreserved" class="def">prop_extReprPreserved</a> :: Property <a href="Test/Ganeti/Locking/Waiting.html#prop_extReprPreserved" class="link">Source</a> <a href="#v:prop_extReprPreserved" class="selflink">#</a></p><div class="doc"><p>Verify that extRepr . fromExtRepr = id for all valid extensional
 representations.</p></div></div><div class="top"><p class="src"><a id="v:prop_SimulateUpdateLocks" class="def">prop_SimulateUpdateLocks</a> :: Property <a href="Test/Ganeti/Locking/Waiting.html#prop_SimulateUpdateLocks" class="link">Source</a> <a href="#v:prop_SimulateUpdateLocks" class="selflink">#</a></p><div class="doc"><p>Verify that any state is indistinguishable from its canonical version
 (i.e., the one obtained from the extensional representation) with respect
 to updateLocks.</p></div></div><div class="top"><p class="src"><a id="v:prop_SimulateUpdateLocksWaiting" class="def">prop_SimulateUpdateLocksWaiting</a> :: Property <a href="Test/Ganeti/Locking/Waiting.html#prop_SimulateUpdateLocksWaiting" class="link">Source</a> <a href="#v:prop_SimulateUpdateLocksWaiting" class="selflink">#</a></p><div class="doc"><p>Verify that any state is indistinguishable from its canonical version
 (i.e., the one obtained from the extensional representation) with respect
 to updateLocksWaiting.</p></div></div><div class="top"><p class="src"><a id="v:prop_SafeUpdateWaitingCorrect" class="def">prop_SafeUpdateWaitingCorrect</a> :: Property <a href="Test/Ganeti/Locking/Waiting.html#prop_SafeUpdateWaitingCorrect" class="link">Source</a> <a href="#v:prop_SafeUpdateWaitingCorrect" class="selflink">#</a></p><div class="doc"><p>Verify that if a requestor has no pending requests, <code>safeUpdateWaiting</code>
 conincides with <code><a href="Ganeti-Locking-Waiting.html#v:updateLocksWaiting" title="Ganeti.Locking.Waiting">updateLocksWaiting</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:prop_SafeUpdateWaitingIdempotent" class="def">prop_SafeUpdateWaitingIdempotent</a> :: Property <a href="Test/Ganeti/Locking/Waiting.html#prop_SafeUpdateWaitingIdempotent" class="link">Source</a> <a href="#v:prop_SafeUpdateWaitingIdempotent" class="selflink">#</a></p><div class="doc"><p>Verify that <code><a href="Ganeti-Locking-Waiting.html#v:safeUpdateLocksWaiting" title="Ganeti.Locking.Waiting">safeUpdateLocksWaiting</a></code> is idempotent, that in the repetition
 no notifications are done.</p></div></div><div class="top"><p class="src"><a id="v:prop_ReadShow" class="def">prop_ReadShow</a> :: Property <a href="Test/Ganeti/Locking/Waiting.html#prop_ReadShow" class="link">Source</a> <a href="#v:prop_ReadShow" class="selflink">#</a></p><div class="doc"><p>Verify that for LockWaiting we have readJSON . showJSON is extensionally
 equivalent to Ok.</p></div></div><div class="top"><p class="src"><a id="v:prop_OpportunisticMonotone" class="def">prop_OpportunisticMonotone</a> :: Property <a href="Test/Ganeti/Locking/Waiting.html#prop_OpportunisticMonotone" class="link">Source</a> <a href="#v:prop_OpportunisticMonotone" class="selflink">#</a></p><div class="doc"><p>Verify that opportunistic union only increases the locks held.</p></div></div><div class="top"><p class="src"><a id="v:prop_OpportunisticAnswer" class="def">prop_OpportunisticAnswer</a> :: Property <a href="Test/Ganeti/Locking/Waiting.html#prop_OpportunisticAnswer" class="link">Source</a> <a href="#v:prop_OpportunisticAnswer" class="selflink">#</a></p><div class="doc"><p>Verify the result list of the opportunistic union: if a lock is not in
 the result that, than its state has not changed, and if it is, it is as
 requested. The latter property is tested in that liberal way, so that we
 really can take arbitrary requests, including those that require both, shared
 and exlusive state for the same lock.</p></div></div><div class="top"><p class="src"><a id="v:testLocking_Waiting" class="def">testLocking_Waiting</a> :: Test <a href="Test/Ganeti/Locking/Waiting.html#testLocking_Waiting" class="link">Source</a> <a href="#v:testLocking_Waiting" class="selflink">#</a></p></div><h1>Orphan instances</h1><div id="section.orphans"><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:o:ic:Arbitrary:Arbitrary:1"></span> (Arbitrary a, <a href="Ganeti-Locking-Types.html#t:Lock" title="Ganeti.Locking.Types">Lock</a> a, Arbitrary b, Ord b, Arbitrary c, Ord c) =&gt; Arbitrary (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting" title="Ganeti.Locking.Waiting">LockWaiting</a> a b c)</span> <a href="#v:-36-fArbitraryLockWaiting" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:o:ic:Arbitrary:Arbitrary:1"><summary class="hide-when-js-enabled">Instance details</summary><p></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:arbitrary">arbitrary</a> :: Gen (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting" title="Ganeti.Locking.Waiting">LockWaiting</a> a b c)</p><p class="src"><a href="#v:shrink">shrink</a> :: <a href="Ganeti-Locking-Waiting.html#t:LockWaiting" title="Ganeti.Locking.Waiting">LockWaiting</a> a b c -&gt; [<a href="Ganeti-Locking-Waiting.html#t:LockWaiting" title="Ganeti.Locking.Waiting">LockWaiting</a> a b c]</p></div></details></td></tr></table></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.23.0</p></div></body></html>