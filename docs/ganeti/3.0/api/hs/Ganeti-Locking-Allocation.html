<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Ganeti.Locking.Allocation</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ganeti</span><ul class="links" id="page-menu"><li><a href="Ganeti/Locking/Allocation.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Ganeti.Locking.Allocation</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Implementation of lock allocation.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:OwnerState">OwnerState</a><ul class="subs"><li>= <a href="#v:OwnShared">OwnShared</a></li><li>| <a href="#v:OwnExclusive">OwnExclusive</a></li></ul></li><li class="src short"><span class="keyword">type</span> <a href="#t:IndirectOwners">IndirectOwners</a> a b = Map (a, b) <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:AllocationState">AllocationState</a> a b<ul class="subs"><li>= <a href="#v:Exclusive">Exclusive</a> b (<a href="Ganeti-Locking-Allocation.html#t:IndirectOwners" title="Ganeti.Locking.Allocation">IndirectOwners</a> a b)</li><li>| <a href="#v:Shared">Shared</a> (Set b) (<a href="Ganeti-Locking-Allocation.html#t:IndirectOwners" title="Ganeti.Locking.Allocation">IndirectOwners</a> a b)</li></ul></li><li class="src short"><a href="#v:indirectOwners">indirectOwners</a> :: (Ord a, Ord b) =&gt; Map (a, b) <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; Set b</li><li class="src short"><a href="#v:indirectExclusives">indirectExclusives</a> :: (Ord a, Ord b) =&gt; Map (a, b) <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; Set b</li><li class="src short"><span class="keyword">data</span> <a href="#t:LockAllocation">LockAllocation</a> a b = <a href="#v:LockAllocation">LockAllocation</a> {<ul class="subs"><li><a href="#v:laLocks">laLocks</a> :: Map a (<a href="Ganeti-Locking-Allocation.html#t:AllocationState" title="Ganeti.Locking.Allocation">AllocationState</a> a b)</li><li><a href="#v:laOwned">laOwned</a> :: Map b (Map a <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a>)</li></ul>}</li><li class="src short"><a href="#v:emptyAllocation">emptyAllocation</a> :: (Ord a, Ord b) =&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b</li><li class="src short"><a href="#v:lockOwners">lockOwners</a> :: Ord b =&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; [b]</li><li class="src short"><a href="#v:listLocks">listLocks</a> :: Ord b =&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; Map a <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a></li><li class="src short"><a href="#v:listAllLocks">listAllLocks</a> :: Ord b =&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; [a]</li><li class="src short"><a href="#v:toOwnersList">toOwnersList</a> :: <a href="Ganeti-Locking-Allocation.html#t:AllocationState" title="Ganeti.Locking.Allocation">AllocationState</a> a b -&gt; [(b, <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a>)]</li><li class="src short"><a href="#v:listAllLocksOwners">listAllLocksOwners</a> :: <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; [(a, [(b, <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a>)])]</li><li class="src short"><a href="#v:holdsLock">holdsLock</a> :: (Ord a, Ord b) =&gt; b -&gt; a -&gt; <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; Bool</li><li class="src short"><span class="keyword">data</span> <a href="#t:LockRequest">LockRequest</a> a = <a href="#v:LockRequest">LockRequest</a> {<ul class="subs"><li><a href="#v:lockAffected">lockAffected</a> :: a</li><li><a href="#v:lockRequestType">lockRequestType</a> :: Maybe <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a></li></ul>}</li><li class="src short"><a href="#v:requestExclusive">requestExclusive</a> :: a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a</li><li class="src short"><a href="#v:requestShared">requestShared</a> :: a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a</li><li class="src short"><a href="#v:requestRelease">requestRelease</a> :: a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a</li><li class="src short"><a href="#v:updateAllocState">updateAllocState</a> :: (Ord a, Ord b) =&gt; (Maybe (<a href="Ganeti-Locking-Allocation.html#t:AllocationState" title="Ganeti.Locking.Allocation">AllocationState</a> a b) -&gt; <a href="Ganeti-Locking-Allocation.html#t:AllocationState" title="Ganeti.Locking.Allocation">AllocationState</a> a b) -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b</li><li class="src short"><a href="#v:updateLock">updateLock</a> :: (Ord a, Ord b) =&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b</li><li class="src short"><a href="#v:updateIndirectSet">updateIndirectSet</a> :: (Ord a, Ord b) =&gt; (<a href="Ganeti-Locking-Allocation.html#t:IndirectOwners" title="Ganeti.Locking.Allocation">IndirectOwners</a> a b -&gt; <a href="Ganeti-Locking-Allocation.html#t:IndirectOwners" title="Ganeti.Locking.Allocation">IndirectOwners</a> a b) -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b</li><li class="src short"><a href="#v:updateIndirects">updateIndirects</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock" title="Ganeti.Locking.Types">Lock</a> a, Ord b) =&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b</li><li class="src short"><a href="#v:updateLocks">updateLocks</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock" title="Ganeti.Locking.Types">Lock</a> a, Ord b) =&gt; b -&gt; [<a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a] -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b, <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> (Set b))</li><li class="src short"><a href="#v:manipulateLocksPredicate">manipulateLocksPredicate</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock" title="Ganeti.Locking.Types">Lock</a> a, Ord b) =&gt; (a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a) -&gt; (a -&gt; Bool) -&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b</li><li class="src short"><a href="#v:freeLocksPredicate">freeLocksPredicate</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock" title="Ganeti.Locking.Types">Lock</a> a, Ord b) =&gt; (a -&gt; Bool) -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b</li><li class="src short"><a href="#v:freeLocks">freeLocks</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock" title="Ganeti.Locking.Types">Lock</a> a, Ord b) =&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b</li><li class="src short"><a href="#v:readLockOwnerstate">readLockOwnerstate</a> :: JSON a =&gt; JSValue -&gt; Result (a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a>)</li><li class="src short"><a href="#v:readOwnerLock">readOwnerLock</a> :: (JSON a, JSON b) =&gt; JSValue -&gt; Result (b, [(a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a>)])</li><li class="src short"><a href="#v:toRequest">toRequest</a> :: (a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a>) -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a</li><li class="src short"><a href="#v:allocationFromOwners">allocationFromOwners</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock" title="Ganeti.Locking.Types">Lock</a> a, Ord b, Show b) =&gt; [(b, [(a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a>)])] -&gt; Result (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b)</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:OwnerState" class="def">OwnerState</a> <a href="Ganeti/Locking/Allocation.html#OwnerState" class="link">Source</a> <a href="#t:OwnerState" class="selflink">#</a></p><div class="doc"><p>Data type describing the way a lock can be owned.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:OwnShared" class="def">OwnShared</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:OwnExclusive" class="def">OwnExclusive</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:OwnerState">Instances</h4><details id="i:OwnerState" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:OwnerState:Eq:1"></span> Eq <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a></span> <a href="#t:OwnerState" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:OwnerState:Eq:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-Locking-Allocation.html">Ganeti.Locking.Allocation</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; Bool</p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; Bool</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:OwnerState:Ord:2"></span> Ord <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a></span> <a href="#t:OwnerState" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:OwnerState:Ord:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-Locking-Allocation.html">Ganeti.Locking.Allocation</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:compare">compare</a> :: <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; Ordering</p><p class="src"><a href="#v:-60-">(&lt;)</a> :: <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; Bool</p><p class="src"><a href="#v:-60--61-">(&lt;=)</a> :: <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; Bool</p><p class="src"><a href="#v:-62-">(&gt;)</a> :: <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; Bool</p><p class="src"><a href="#v:-62--61-">(&gt;=)</a> :: <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; Bool</p><p class="src"><a href="#v:max">max</a> :: <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a></p><p class="src"><a href="#v:min">min</a> :: <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:OwnerState:Show:3"></span> Show <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a></span> <a href="#t:OwnerState" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:OwnerState:Show:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-Locking-Allocation.html">Ganeti.Locking.Allocation</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: Int -&gt; <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; ShowS</p><p class="src"><a href="#v:show">show</a> :: <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; String</p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a>] -&gt; ShowS</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:OwnerState:JSON:4"></span> JSON <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a></span> <a href="#t:OwnerState" class="selflink">#</a></td><td class="doc"><p>Serializaiton of Lock Allocations</p><p>To serialize a lock allocation, we only remember which owner holds
which locks at which level (shared or exclusive). From this information,
everything else can be reconstructed, simply using updateLocks.</p></td></tr><tr><td colspan="2"><details id="i:id:OwnerState:JSON:4"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-Locking-Allocation.html">Ganeti.Locking.Allocation</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:readJSON">readJSON</a> :: JSValue -&gt; Result <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a></p><p class="src"><a href="#v:showJSON">showJSON</a> :: <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; JSValue</p><p class="src"><a href="#v:readJSONs">readJSONs</a> :: JSValue -&gt; Result [<a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a>]</p><p class="src"><a href="#v:showJSONs">showJSONs</a> :: [<a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a>] -&gt; JSValue</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:OwnerState:Arbitrary:5"></span> Arbitrary <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a></span></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:OwnerState:Arbitrary:5"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Test-Ganeti-Locking-Allocation.html">Test.Ganeti.Locking.Allocation</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:arbitrary">arbitrary</a> :: Gen <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a></p><p class="src"><a href="#v:shrink">shrink</a> :: <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; [<a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a>]</p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:IndirectOwners" class="def">IndirectOwners</a> a b = Map (a, b) <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> <a href="Ganeti/Locking/Allocation.html#IndirectOwners" class="link">Source</a> <a href="#t:IndirectOwners" class="selflink">#</a></p><div class="doc"><p>Type describing indirect ownership on a lock. We keep the set
 of all (lock, owner)-pairs for locks that are implied in the given
 lock, annotated with the type of ownership (shared or exclusive).</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:AllocationState" class="def">AllocationState</a> a b <a href="Ganeti/Locking/Allocation.html#AllocationState" class="link">Source</a> <a href="#t:AllocationState" class="selflink">#</a></p><div class="doc"><p>The state of a lock that is taken. Besides the state of the lock
 itself, we also keep track of all other lock allocation that affect
 the given lock by means of implication.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Exclusive" class="def">Exclusive</a> b (<a href="Ganeti-Locking-Allocation.html#t:IndirectOwners" title="Ganeti.Locking.Allocation">IndirectOwners</a> a b)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:Shared" class="def">Shared</a> (Set b) (<a href="Ganeti-Locking-Allocation.html#t:IndirectOwners" title="Ganeti.Locking.Allocation">IndirectOwners</a> a b)</td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><a id="v:indirectOwners" class="def">indirectOwners</a> :: (Ord a, Ord b) =&gt; Map (a, b) <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; Set b <a href="Ganeti/Locking/Allocation.html#indirectOwners" class="link">Source</a> <a href="#v:indirectOwners" class="selflink">#</a></p><div class="doc"><p>Compute the set of indirect owners from the information about
 indirect ownership.</p></div></div><div class="top"><p class="src"><a id="v:indirectExclusives" class="def">indirectExclusives</a> :: (Ord a, Ord b) =&gt; Map (a, b) <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; Set b <a href="Ganeti/Locking/Allocation.html#indirectExclusives" class="link">Source</a> <a href="#v:indirectExclusives" class="selflink">#</a></p><div class="doc"><p>Compute the (zero or one-elment) set of exclusive indirect owners.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:LockAllocation" class="def">LockAllocation</a> a b <a href="Ganeti/Locking/Allocation.html#LockAllocation" class="link">Source</a> <a href="#t:LockAllocation" class="selflink">#</a></p><div class="doc"><p>Representation of a Lock allocation</p><p>To keep queries for locks efficient, we keep two
associations, with the invariant that they fit
together: the association from locks to their
allocation state, and the association from an
owner to the set of locks owned. As we do not
export the constructor, the problem of keeping
this invariant reduces to only exporting functions
that keep the invariant.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:LockAllocation" class="def">LockAllocation</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:laLocks" class="def">laLocks</a> :: Map a (<a href="Ganeti-Locking-Allocation.html#t:AllocationState" title="Ganeti.Locking.Allocation">AllocationState</a> a b)</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:laOwned" class="def">laOwned</a> :: Map b (Map a <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a>)</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:LockAllocation">Instances</h4><details id="i:LockAllocation" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:LockAllocation:Eq:1"></span> (Eq a, Eq b) =&gt; Eq (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b)</span> <a href="#t:LockAllocation" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:LockAllocation:Eq:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-Locking-Allocation.html">Ganeti.Locking.Allocation</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; Bool</p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; Bool</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:LockAllocation:Show:2"></span> (Show a, Show b) =&gt; Show (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b)</span> <a href="#t:LockAllocation" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:LockAllocation:Show:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-Locking-Allocation.html">Ganeti.Locking.Allocation</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: Int -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; ShowS</p><p class="src"><a href="#v:show">show</a> :: <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; String</p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b] -&gt; ShowS</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:LockAllocation:JSON:3"></span> (<a href="Ganeti-Locking-Types.html#t:Lock" title="Ganeti.Locking.Types">Lock</a> a, JSON a, Ord b, JSON b, Show b) =&gt; JSON (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b)</span> <a href="#t:LockAllocation" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:LockAllocation:JSON:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-Locking-Allocation.html">Ganeti.Locking.Allocation</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:readJSON">readJSON</a> :: JSValue -&gt; Result (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b)</p><p class="src"><a href="#v:showJSON">showJSON</a> :: <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; JSValue</p><p class="src"><a href="#v:readJSONs">readJSONs</a> :: JSValue -&gt; Result [<a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b]</p><p class="src"><a href="#v:showJSONs">showJSONs</a> :: [<a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b] -&gt; JSValue</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:LockAllocation:Arbitrary:4"></span> (Arbitrary a, <a href="Ganeti-Locking-Types.html#t:Lock" title="Ganeti.Locking.Types">Lock</a> a, Arbitrary b, Ord b, Show b) =&gt; Arbitrary (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:LockAllocation:Arbitrary:4"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Test-Ganeti-Locking-Allocation.html">Test.Ganeti.Locking.Allocation</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:arbitrary">arbitrary</a> :: Gen (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b)</p><p class="src"><a href="#v:shrink">shrink</a> :: <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; [<a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b]</p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:emptyAllocation" class="def">emptyAllocation</a> :: (Ord a, Ord b) =&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b <a href="Ganeti/Locking/Allocation.html#emptyAllocation" class="link">Source</a> <a href="#v:emptyAllocation" class="selflink">#</a></p><div class="doc"><p>A state with all locks being free.</p></div></div><div class="top"><p class="src"><a id="v:lockOwners" class="def">lockOwners</a> :: Ord b =&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; [b] <a href="Ganeti/Locking/Allocation.html#lockOwners" class="link">Source</a> <a href="#v:lockOwners" class="selflink">#</a></p><div class="doc"><p>Obtain the list of all owners holding at least a single lock.</p></div></div><div class="top"><p class="src"><a id="v:listLocks" class="def">listLocks</a> :: Ord b =&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; Map a <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> <a href="Ganeti/Locking/Allocation.html#listLocks" class="link">Source</a> <a href="#v:listLocks" class="selflink">#</a></p><div class="doc"><p>Obtain the locks held by a given owner. The locks are reported
 as a map from the owned locks to the form of ownership (OwnShared
 or OwnExclusive).</p></div></div><div class="top"><p class="src"><a id="v:listAllLocks" class="def">listAllLocks</a> :: Ord b =&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; [a] <a href="Ganeti/Locking/Allocation.html#listAllLocks" class="link">Source</a> <a href="#v:listAllLocks" class="selflink">#</a></p><div class="doc"><p>List all locks currently (directly or indirectly) owned by someone.</p></div></div><div class="top"><p class="src"><a id="v:toOwnersList" class="def">toOwnersList</a> :: <a href="Ganeti-Locking-Allocation.html#t:AllocationState" title="Ganeti.Locking.Allocation">AllocationState</a> a b -&gt; [(b, <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a>)] <a href="Ganeti/Locking/Allocation.html#toOwnersList" class="link">Source</a> <a href="#v:toOwnersList" class="selflink">#</a></p><div class="doc"><p>Map an AllocationState to a list of pairs of owners and type of
 ownership, showing the direct owners only.</p></div></div><div class="top"><p class="src"><a id="v:listAllLocksOwners" class="def">listAllLocksOwners</a> :: <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; [(a, [(b, <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a>)])] <a href="Ganeti/Locking/Allocation.html#listAllLocksOwners" class="link">Source</a> <a href="#v:listAllLocksOwners" class="selflink">#</a></p><div class="doc"><p>List all locks currently (directly of indirectly) in use together
 with the direct owners.</p></div></div><div class="top"><p class="src"><a id="v:holdsLock" class="def">holdsLock</a> :: (Ord a, Ord b) =&gt; b -&gt; a -&gt; <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a> -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; Bool <a href="Ganeti/Locking/Allocation.html#holdsLock" class="link">Source</a> <a href="#v:holdsLock" class="selflink">#</a></p><div class="doc"><p>Returns <code>True</code> if the given owner holds the given lock at the given
 ownership level or higher. This means that querying for a shared lock
 returns <code>True</code> of the owner holds the lock in shared or exlusive mode.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:LockRequest" class="def">LockRequest</a> a <a href="Ganeti/Locking/Allocation.html#LockRequest" class="link">Source</a> <a href="#t:LockRequest" class="selflink">#</a></p><div class="doc"><p>Data Type describing a change request on a single lock.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:LockRequest" class="def">LockRequest</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:lockAffected" class="def">lockAffected</a> :: a</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:lockRequestType" class="def">lockRequestType</a> :: Maybe <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a></dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:LockRequest">Instances</h4><details id="i:LockRequest" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:LockRequest:Eq:1"></span> Eq a =&gt; Eq (<a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a)</span> <a href="#t:LockRequest" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:LockRequest:Eq:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-Locking-Allocation.html">Ganeti.Locking.Allocation</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; Bool</p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; Bool</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:LockRequest:Ord:2"></span> Ord a =&gt; Ord (<a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a)</span> <a href="#t:LockRequest" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:LockRequest:Ord:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-Locking-Allocation.html">Ganeti.Locking.Allocation</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:compare">compare</a> :: <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; Ordering</p><p class="src"><a href="#v:-60-">(&lt;)</a> :: <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; Bool</p><p class="src"><a href="#v:-60--61-">(&lt;=)</a> :: <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; Bool</p><p class="src"><a href="#v:-62-">(&gt;)</a> :: <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; Bool</p><p class="src"><a href="#v:-62--61-">(&gt;=)</a> :: <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; Bool</p><p class="src"><a href="#v:max">max</a> :: <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a</p><p class="src"><a href="#v:min">min</a> :: <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:LockRequest:Show:3"></span> Show a =&gt; Show (<a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a)</span> <a href="#t:LockRequest" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:LockRequest:Show:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-Locking-Allocation.html">Ganeti.Locking.Allocation</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: Int -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; ShowS</p><p class="src"><a href="#v:show">show</a> :: <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; String</p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a] -&gt; ShowS</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:LockRequest:JSON:4"></span> JSON a =&gt; JSON (<a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a)</span> <a href="#t:LockRequest" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:LockRequest:JSON:4"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ganeti-Locking-Allocation.html">Ganeti.Locking.Allocation</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:readJSON">readJSON</a> :: JSValue -&gt; Result (<a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a)</p><p class="src"><a href="#v:showJSON">showJSON</a> :: <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; JSValue</p><p class="src"><a href="#v:readJSONs">readJSONs</a> :: JSValue -&gt; Result [<a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a]</p><p class="src"><a href="#v:showJSONs">showJSONs</a> :: [<a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a] -&gt; JSValue</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:LockRequest:Arbitrary:5"></span> Arbitrary a =&gt; Arbitrary (<a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:LockRequest:Arbitrary:5"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Test-Ganeti-Locking-Allocation.html">Test.Ganeti.Locking.Allocation</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:arbitrary">arbitrary</a> :: Gen (<a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a)</p><p class="src"><a href="#v:shrink">shrink</a> :: <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; [<a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a]</p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:requestExclusive" class="def">requestExclusive</a> :: a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a <a href="Ganeti/Locking/Allocation.html#requestExclusive" class="link">Source</a> <a href="#v:requestExclusive" class="selflink">#</a></p><div class="doc"><p>Lock request for an exclusive lock.</p></div></div><div class="top"><p class="src"><a id="v:requestShared" class="def">requestShared</a> :: a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a <a href="Ganeti/Locking/Allocation.html#requestShared" class="link">Source</a> <a href="#v:requestShared" class="selflink">#</a></p><div class="doc"><p>Lock request for a shared lock.</p></div></div><div class="top"><p class="src"><a id="v:requestRelease" class="def">requestRelease</a> :: a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a <a href="Ganeti/Locking/Allocation.html#requestRelease" class="link">Source</a> <a href="#v:requestRelease" class="selflink">#</a></p><div class="doc"><p>Request to release a lock.</p></div></div><div class="top"><p class="src"><a id="v:updateAllocState" class="def">updateAllocState</a> :: (Ord a, Ord b) =&gt; (Maybe (<a href="Ganeti-Locking-Allocation.html#t:AllocationState" title="Ganeti.Locking.Allocation">AllocationState</a> a b) -&gt; <a href="Ganeti-Locking-Allocation.html#t:AllocationState" title="Ganeti.Locking.Allocation">AllocationState</a> a b) -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b <a href="Ganeti/Locking/Allocation.html#updateAllocState" class="link">Source</a> <a href="#v:updateAllocState" class="selflink">#</a></p><div class="doc"><p>Update the Allocation state of a lock according to a given
 function.</p></div></div><div class="top"><p class="src"><a id="v:updateLock" class="def">updateLock</a> :: (Ord a, Ord b) =&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b <a href="Ganeti/Locking/Allocation.html#updateLock" class="link">Source</a> <a href="#v:updateLock" class="selflink">#</a></p><div class="doc"><p>Internal function to update the state according to a single
 lock request, assuming all prerequisites are met.</p></div></div><div class="top"><p class="src"><a id="v:updateIndirectSet" class="def">updateIndirectSet</a> :: (Ord a, Ord b) =&gt; (<a href="Ganeti-Locking-Allocation.html#t:IndirectOwners" title="Ganeti.Locking.Allocation">IndirectOwners</a> a b -&gt; <a href="Ganeti-Locking-Allocation.html#t:IndirectOwners" title="Ganeti.Locking.Allocation">IndirectOwners</a> a b) -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b <a href="Ganeti/Locking/Allocation.html#updateIndirectSet" class="link">Source</a> <a href="#v:updateIndirectSet" class="selflink">#</a></p><div class="doc"><p>Update the set of indirect ownerships of a lock by the given function.</p></div></div><div class="top"><p class="src"><a id="v:updateIndirects" class="def">updateIndirects</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock" title="Ganeti.Locking.Types">Lock</a> a, Ord b) =&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b <a href="Ganeti/Locking/Allocation.html#updateIndirects" class="link">Source</a> <a href="#v:updateIndirects" class="selflink">#</a></p><div class="doc"><p>Update all indirect onwerships of a given lock.</p></div></div><div class="top"><p class="src"><a id="v:updateLocks" class="def">updateLocks</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock" title="Ganeti.Locking.Types">Lock</a> a, Ord b) =&gt; b -&gt; [<a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a] -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b, <a href="Ganeti-BasicTypes.html#t:Result" title="Ganeti.BasicTypes">Result</a> (Set b)) <a href="Ganeti/Locking/Allocation.html#updateLocks" class="link">Source</a> <a href="#v:updateLocks" class="selflink">#</a></p><div class="doc"><p>Update the locks of an owner according to the given request. Return
 the pair of the new state and the result of the operation, which is the
 the set of owners on which the operation was blocked on. so an empty set is
 success, and the state is updated if, and only if, the returned set is emtpy.
 In that way, it can be used in atomicModifyIORef.</p></div></div><div class="top"><p class="src"><a id="v:manipulateLocksPredicate" class="def">manipulateLocksPredicate</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock" title="Ganeti.Locking.Types">Lock</a> a, Ord b) =&gt; (a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a) -&gt; (a -&gt; Bool) -&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b <a href="Ganeti/Locking/Allocation.html#manipulateLocksPredicate" class="link">Source</a> <a href="#v:manipulateLocksPredicate" class="selflink">#</a></p><div class="doc"><p>Manipluate all locks of the owner with a given property.</p></div></div><div class="top"><p class="src"><a id="v:freeLocksPredicate" class="def">freeLocksPredicate</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock" title="Ganeti.Locking.Types">Lock</a> a, Ord b) =&gt; (a -&gt; Bool) -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b <a href="Ganeti/Locking/Allocation.html#freeLocksPredicate" class="link">Source</a> <a href="#v:freeLocksPredicate" class="selflink">#</a></p><div class="doc"><p>Compute the state after an owner releases all its locks that
 satisfy a certain property.</p></div></div><div class="top"><p class="src"><a id="v:freeLocks" class="def">freeLocks</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock" title="Ganeti.Locking.Types">Lock</a> a, Ord b) =&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b -&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b <a href="Ganeti/Locking/Allocation.html#freeLocks" class="link">Source</a> <a href="#v:freeLocks" class="selflink">#</a></p><div class="doc"><p>Compute the state after an onwer releases all its locks.</p></div></div><div class="top"><p class="src"><a id="v:readLockOwnerstate" class="def">readLockOwnerstate</a> :: JSON a =&gt; JSValue -&gt; Result (a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a>) <a href="Ganeti/Locking/Allocation.html#readLockOwnerstate" class="link">Source</a> <a href="#v:readLockOwnerstate" class="selflink">#</a></p><div class="doc"><p>Read a lock-ownerstate pair from JSON.</p></div></div><div class="top"><p class="src"><a id="v:readOwnerLock" class="def">readOwnerLock</a> :: (JSON a, JSON b) =&gt; JSValue -&gt; Result (b, [(a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a>)]) <a href="Ganeti/Locking/Allocation.html#readOwnerLock" class="link">Source</a> <a href="#v:readOwnerLock" class="selflink">#</a></p><div class="doc"><p>Read an owner-lock pair from JSON.</p></div></div><div class="top"><p class="src"><a id="v:toRequest" class="def">toRequest</a> :: (a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a>) -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest" title="Ganeti.Locking.Allocation">LockRequest</a> a <a href="Ganeti/Locking/Allocation.html#toRequest" class="link">Source</a> <a href="#v:toRequest" class="selflink">#</a></p><div class="doc"><p>Transform a lock-ownerstate pair into a LockRequest.</p></div></div><div class="top"><p class="src"><a id="v:allocationFromOwners" class="def">allocationFromOwners</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock" title="Ganeti.Locking.Types">Lock</a> a, Ord b, Show b) =&gt; [(b, [(a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState" title="Ganeti.Locking.Allocation">OwnerState</a>)])] -&gt; Result (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation" title="Ganeti.Locking.Allocation">LockAllocation</a> a b) <a href="Ganeti/Locking/Allocation.html#allocationFromOwners" class="link">Source</a> <a href="#v:allocationFromOwners" class="selflink">#</a></p><div class="doc"><p>Obtain a LockAllocation from a given owner-locks list.
 The obtained allocation is the one obtained if the respective owners
 requested their locks sequentially.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.23.0</p></div></body></html>