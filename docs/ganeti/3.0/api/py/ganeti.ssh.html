<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "DTD/xhtml1-strict.dtd">
<html>
  

  <head>
    
    <title>ganeti.ssh</title>
    <meta name="generator" content="pydoctor 22.9.1"> 
        
    </meta>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1 maximum-scale=1" />
    <link rel="stylesheet" type="text/css" href="bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="apidocs.css" />
    <link rel="stylesheet" type="text/css" href="extra.css" />
</head>

  <body>

    

    <nav class="navbar navbar-default mainnavbar">
      
  
  <div class="container-fluid">


    <div class="navbar-header">
      
      <div class="navlinks">
        <span class="navbar-brand">
          ganeti/server <a href="index.html">API Documentation</a>
        </span>

        <a href="moduleIndex.html">
          Modules
        </a>

        <a href="classIndex.html">
          Classes
        </a>

        <a href="nameIndex.html">
          Names
        </a>

        <div id="search-box-container">
          <div class="input-group">
            <input id="search-box" type="search" name="search-query" placeholder="Search..." aria-label="Search" minlength="2" class="form-control" autocomplete="off" />
            
            <span class="input-group-btn">
              <a style="display: none;" class="btn btn-default" id="search-clear-button" title="Clear" onclick="clearSearch()"><img src="fonts/x-circle.svg" alt="Clear" /></a>
              <a class="btn btn-default" id="search-help-button" title="Help" onclick="toggleSearchHelpText()"><img src="fonts/info.svg" alt="Help" /></a>
            </span>
          </div>
        </div>

      </div>

      <div id="search-results-container" style="display: none;">
        
        <div id="search-buttons">
          <span class="label label-default" id="search-docstrings-button">
          <label class="checkbox-inline">
            <input type="checkbox" id="toggle-search-in-docstrings-checkbox" value="false" onclick="toggleSearchInDocstrings()">
              search in docstrings
            </input>
          </label>
          </span>
          
        </div>
        
        <noscript>
            <h1>Cannot search: JavaScript is not supported/enabled in your browser.</h1>
        </noscript>

        <div class="hint" id="search-help-box">
          <p class="rst-last">
      
            Search bar offers the following options:
            <ul>   
                <li>
                  <strong>Term presence.</strong> The below example searches for documents that 
                    must contain “foo”, might contain “bar” and must not contain “baz”: <code>+foo bar -baz</code>
                </li> 

                <li>
                  <strong>Wildcards.</strong> The below example searches for documents with words beginning with “foo”: <code>foo*</code>
                </li> 

                <li>
                  <strong>Search in specific fields.</strong> The following search matches all objects 
                  in "twisted.mail" that matches “search”: <code>+qname:twisted.mail.* +search</code>

                  <p>
                    Possible fields: 'name', 'qname' (fully qualified name), 'docstring', and 'kind'.
                    Last two fields are only applicable if "search in docstrings" is enabled.
                  </p>
                </li>

                <li>
                  <strong>Fuzzy matches.</strong> The following search matches all documents 
                  that have a word within 1 edit distance of “foo”: <code>foo~1</code>
                </li>
            </ul>

          </p>
        </div>

        <div id="search-status"> </div>

        <div class="warning" id="search-warn-box" style="display: none;">
          <p class="rst-last"><span id="search-warn"></span></p>
        </div>

        <table id="search-results">
          <!-- Filled dynamically by JS -->
        </table>
        
        <div style="margin-top: 8px;">
          <p>Results provided by <a href="https://lunrjs.com">Lunr.js</a></p>
        </div>
      </div>

    </div>


  </div>
</nav>
    
    <div class="container-fluid">

      <!-- Side navigation -->
      <div class="sidebarcontainer" style="display: none;">
        
        <div class="sidebar"><nav class="sidebar">
  

  <div>

      <div class="thingTitle">
        <span>Module</span>
        <code class="thisobject"><a href="ganeti.ssh.html" class="internal-link" title="This module">ssh</a></code> 
      </div>
      
      <div>
        

        
         

        <div class="childrenKindTitle">Classes</div>
        <ul>
    
    <li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.ssh.SshRunner.html" class="internal-link" title="ganeti.ssh.SshRunner"><wbr></wbr>Ssh<wbr></wbr>Runner</a></code>
            </div>
        

    </li>
</ul>

        <div class="childrenKindTitle">Functions</div>
        <ul>
    
    <li class="">
        
        
        

        
            <div class="itemName"><code><a href="#AddAuthorizedKey" class="internal-link" title="ganeti.ssh.AddAuthorizedKey"><wbr></wbr>Add<wbr></wbr>Authorized<wbr></wbr>Key</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#AddAuthorizedKeys" class="internal-link" title="ganeti.ssh.AddAuthorizedKeys"><wbr></wbr>Add<wbr></wbr>Authorized<wbr></wbr>Keys</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#AddPublicKey" class="internal-link" title="ganeti.ssh.AddPublicKey"><wbr></wbr>Add<wbr></wbr>Public<wbr></wbr>Key</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#CheckForMultipleKeys" class="internal-link" title="ganeti.ssh.CheckForMultipleKeys"><wbr></wbr>Check<wbr></wbr>For<wbr></wbr>Multiple<wbr></wbr>Keys</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#ClearPubKeyFile" class="internal-link" title="ganeti.ssh.ClearPubKeyFile"><wbr></wbr>Clear<wbr></wbr>Pub<wbr></wbr>Key<wbr></wbr>File</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#DetermineKeyBits" class="internal-link" title="ganeti.ssh.DetermineKeyBits"><wbr></wbr>Determine<wbr></wbr>Key<wbr></wbr>Bits</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#GetAllUserFiles" class="internal-link" title="ganeti.ssh.GetAllUserFiles"><wbr></wbr>Get<wbr></wbr>All<wbr></wbr>User<wbr></wbr>Files</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#GetUserFiles" class="internal-link" title="ganeti.ssh.GetUserFiles"><wbr></wbr>Get<wbr></wbr>User<wbr></wbr>Files</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#HasAuthorizedKey" class="internal-link" title="ganeti.ssh.HasAuthorizedKey"><wbr></wbr>Has<wbr></wbr>Authorized<wbr></wbr>Key</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#InitPubKeyFile" class="internal-link" title="ganeti.ssh.InitPubKeyFile"><wbr></wbr>Init<wbr></wbr>Pub<wbr></wbr>Key<wbr></wbr>File</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#InitSSHSetup" class="internal-link" title="ganeti.ssh.InitSSHSetup"><wbr></wbr>Init<wbr></wbr>SSHSetup</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#OverridePubKeyFile" class="internal-link" title="ganeti.ssh.OverridePubKeyFile"><wbr></wbr>Override<wbr></wbr>Pub<wbr></wbr>Key<wbr></wbr>File</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#QueryPubKeyFile" class="internal-link" title="ganeti.ssh.QueryPubKeyFile"><wbr></wbr>Query<wbr></wbr>Pub<wbr></wbr>Key<wbr></wbr>File</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#ReadRemoteSshPubKeys" class="internal-link" title="ganeti.ssh.ReadRemoteSshPubKeys"><wbr></wbr>Read<wbr></wbr>Remote<wbr></wbr>Ssh<wbr></wbr>Pub<wbr></wbr>Keys</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#RemoveAuthorizedKey" class="internal-link" title="ganeti.ssh.RemoveAuthorizedKey"><wbr></wbr>Remove<wbr></wbr>Authorized<wbr></wbr>Key</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#RemoveAuthorizedKeys" class="internal-link" title="ganeti.ssh.RemoveAuthorizedKeys"><wbr></wbr>Remove<wbr></wbr>Authorized<wbr></wbr>Keys</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#RemovePublicKey" class="internal-link" title="ganeti.ssh.RemovePublicKey"><wbr></wbr>Remove<wbr></wbr>Public<wbr></wbr>Key</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#ReplaceNameByUuid" class="internal-link" title="ganeti.ssh.ReplaceNameByUuid"><wbr></wbr>Replace<wbr></wbr>Name<wbr></wbr>By<wbr></wbr>Uuid</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#RunSshCmdWithStdin" class="internal-link" title="ganeti.ssh.RunSshCmdWithStdin"><wbr></wbr>Run<wbr></wbr>Ssh<wbr></wbr>Cmd<wbr></wbr>With<wbr></wbr>Stdin</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#WriteKnownHostsFile" class="internal-link" title="ganeti.ssh.WriteKnownHostsFile"><wbr></wbr>Write<wbr></wbr>Known<wbr></wbr>Hosts<wbr></wbr>File</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="#_AddPublicKeyElse" class="internal-link" title="ganeti.ssh._AddPublicKeyElse">_<wbr></wbr>Add<wbr></wbr>Public<wbr></wbr>Key<wbr></wbr>Else</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="#_AddPublicKeyProcessLine" class="internal-link" title="ganeti.ssh._AddPublicKeyProcessLine">_<wbr></wbr>Add<wbr></wbr>Public<wbr></wbr>Key<wbr></wbr>Process<wbr></wbr>Line</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="#_EnsureCorrectGanetiVersion" class="internal-link" title="ganeti.ssh._EnsureCorrectGanetiVersion">_<wbr></wbr>Ensure<wbr></wbr>Correct<wbr></wbr>Ganeti<wbr></wbr>Version</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="#_ManipulatePubKeyFile" class="internal-link" title="ganeti.ssh._ManipulatePubKeyFile">_<wbr></wbr>Manipulate<wbr></wbr>Pub<wbr></wbr>Key<wbr></wbr>File</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="#_ParseKeyLine" class="internal-link" title="ganeti.ssh._ParseKeyLine">_<wbr></wbr>Parse<wbr></wbr>Key<wbr></wbr>Line</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="#_RemovePublicKeyElse" class="internal-link" title="ganeti.ssh._RemovePublicKeyElse">_<wbr></wbr>Remove<wbr></wbr>Public<wbr></wbr>Key<wbr></wbr>Else</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="#_RemovePublicKeyProcessLine" class="internal-link" title="ganeti.ssh._RemovePublicKeyProcessLine">_<wbr></wbr>Remove<wbr></wbr>Public<wbr></wbr>Key<wbr></wbr>Process<wbr></wbr>Line</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="#_ReplaceNameByUuidElse" class="internal-link" title="ganeti.ssh._ReplaceNameByUuidElse">_<wbr></wbr>Replace<wbr></wbr>Name<wbr></wbr>By<wbr></wbr>Uuid<wbr></wbr>Else</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="#_ReplaceNameByUuidProcessLine" class="internal-link" title="ganeti.ssh._ReplaceNameByUuidProcessLine">_<wbr></wbr>Replace<wbr></wbr>Name<wbr></wbr>By<wbr></wbr>Uuid<wbr></wbr>Process<wbr></wbr>Line</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="#_SplitSshKey" class="internal-link" title="ganeti.ssh._SplitSshKey">_<wbr></wbr>Split<wbr></wbr>Ssh<wbr></wbr>Key</a></code>
            </div>
        

    </li>
</ul> 

        
         

        <div class="childrenKindTitle">Variables</div>
        <ul>
    
    <li class="">
        
        
        

        
            <div class="itemName"><code><a href="#SSH_KEY_VALID_BITS" class="internal-link" title="ganeti.ssh.SSH_KEY_VALID_BITS">SSH<wbr></wbr>_KEY<wbr></wbr>_VALID<wbr></wbr>_BITS</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#KeyBitInfo" class="internal-link" title="ganeti.ssh.KeyBitInfo"><wbr></wbr>Key<wbr></wbr>Bit<wbr></wbr>Info</a></code>
            </div>
        

    </li>
</ul> 

        
         
        
      </div>
  </div><div>

      <div class="thingTitle">
        <span>Package</span>
        <code><a href="ganeti.html" class="internal-link" title="The parent of this module">ganeti</a></code> 
      </div>
      
      <div>
        

        <div class="childrenKindTitle">Modules</div>
        <ul>
    
    <li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.build.html" class="internal-link" title="ganeti.build">build</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.client.html" class="internal-link" title="ganeti.client">client</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.cmdlib.html" class="internal-link" title="ganeti.cmdlib">cmdlib</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.confd.html" class="internal-link" title="ganeti.confd">confd</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.config.html" class="internal-link" title="ganeti.config">config</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.http.html" class="internal-link" title="ganeti.http">http</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.hypervisor.html" class="internal-link" title="ganeti.hypervisor">hypervisor</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.impexpd.html" class="internal-link" title="ganeti.impexpd">impexpd</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.jqueue.html" class="internal-link" title="ganeti.jqueue">jqueue</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.masterd.html" class="internal-link" title="ganeti.masterd">masterd</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.rapi.html" class="internal-link" title="ganeti.rapi">rapi</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.rpc.html" class="internal-link" title="ganeti.rpc">rpc</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.server.html" class="internal-link" title="ganeti.server">server</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.storage.html" class="internal-link" title="ganeti.storage">storage</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.tools.html" class="internal-link" title="ganeti.tools">tools</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.utils.html" class="internal-link" title="ganeti.utils">utils</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.watcher.html" class="internal-link" title="ganeti.watcher">watcher</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.asyncnotifier.html" class="internal-link" title="ganeti.asyncnotifier">asyncnotifier</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.backend.html" class="internal-link" title="ganeti.backend">backend</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.bootstrap.html" class="internal-link" title="ganeti.bootstrap">bootstrap</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.cli.html" class="internal-link" title="ganeti.cli">cli</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.cli_opts.html" class="internal-link" title="ganeti.cli_opts">cli<wbr></wbr>_opts</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.compat.html" class="internal-link" title="ganeti.compat">compat</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.constants.html" class="internal-link" title="ganeti.constants">constants</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.daemon.html" class="internal-link" title="ganeti.daemon">daemon</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.errors.html" class="internal-link" title="ganeti.errors">errors</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.hooksmaster.html" class="internal-link" title="ganeti.hooksmaster">hooksmaster</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.ht.html" class="internal-link" title="ganeti.ht">ht</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.jstore.html" class="internal-link" title="ganeti.jstore">jstore</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.locking.html" class="internal-link" title="ganeti.locking">locking</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.luxi.html" class="internal-link" title="ganeti.luxi">luxi</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.mcpu.html" class="internal-link" title="ganeti.mcpu">mcpu</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.metad.html" class="internal-link" title="ganeti.metad">metad</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.netutils.html" class="internal-link" title="ganeti.netutils">netutils</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.network.html" class="internal-link" title="ganeti.network">network</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.objects.html" class="internal-link" title="ganeti.objects">objects</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.opcodes.html" class="internal-link" title="ganeti.opcodes">opcodes</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.opcodes_base.html" class="internal-link" title="ganeti.opcodes_base">opcodes<wbr></wbr>_base</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.outils.html" class="internal-link" title="ganeti.outils">outils</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.ovf.html" class="internal-link" title="ganeti.ovf">ovf</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.pathutils.html" class="internal-link" title="ganeti.pathutils">pathutils</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.qlang.html" class="internal-link" title="ganeti.qlang">qlang</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.query.html" class="internal-link" title="ganeti.query">query</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.rpc_defs.html" class="internal-link" title="ganeti.rpc_defs">rpc<wbr></wbr>_defs</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.runtime.html" class="internal-link" title="ganeti.runtime">runtime</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.serializer.html" class="internal-link" title="ganeti.serializer">serializer</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.ssconf.html" class="internal-link" title="ganeti.ssconf">ssconf</a></code>
            </div>
        

    </li><li class=" thisobject">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.ssh.html" class="internal-link" title="ganeti.ssh">ssh</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.uidpool.html" class="internal-link" title="ganeti.uidpool">uidpool</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.vcluster.html" class="internal-link" title="ganeti.vcluster">vcluster</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.wconfd.html" class="internal-link" title="ganeti.wconfd">wconfd</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.workerpool.html" class="internal-link" title="ganeti.workerpool">workerpool</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="ganeti._constants.html" class="internal-link" title="ganeti._constants">_constants</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="ganeti._generated_rpc.html" class="internal-link" title="ganeti._generated_rpc">_generated<wbr></wbr>_rpc</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="ganeti._vcsversion.html" class="internal-link" title="ganeti._vcsversion">_vcsversion</a></code>
            </div>
        

    </li>
</ul> 

        
        

        
         

        
         

        
         

        
         
        
      </div>
  </div>

</nav>
        </div>
        <div id="collapseSideBar">
          <a class="btn btn-link" onclick="toggleSideBarCollapse()" title="Toggle Sidebar Collapse">
          </a>
        </div> 
        <script src="sidebartoggle.js" type="text/javascript"></script>
       
      </div>

      <div id="main" class="">
        

        

        <div class="page-header">
          <h1 class="module"><code><code><a href="ganeti.html" class="internal-link">ganeti</a></code><wbr></wbr>.<code><a href="ganeti.ssh.html" class="internal-link" title="ganeti.ssh">ssh</a></code></code></h1>
          <div id="showPrivate">
            <button class="btn btn-link" onclick="togglePrivate()">Toggle Private API</button>
          </div>
        </div>

        <div class="categoryHeader">
          module documentation
        </div>

        <div class="extrasDocstring">
          
          <p></p>
        </div>

        <div class="moduleDocstring">
          <div><p>Module encapsulating ssh functionality.</p>
</div>
        </div>

        <div id="splitTables">
          <table class="children sortable" id="id1278">
  
  
  <tr class="class">
    
    <td>Class</td>
    <td><code><a href="ganeti.ssh.SshRunner.html" class="internal-link" title="ganeti.ssh.SshRunner"><wbr></wbr>Ssh<wbr></wbr>Runner</a></code></td>
    <td>Wrapper for SSH commands.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#AddAuthorizedKey" class="internal-link" title="ganeti.ssh.AddAuthorizedKey"><wbr></wbr>Add<wbr></wbr>Authorized<wbr></wbr>Key</a></code></td>
    <td>Adds an SSH public key to an authorized_keys file.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#AddAuthorizedKeys" class="internal-link" title="ganeti.ssh.AddAuthorizedKeys"><wbr></wbr>Add<wbr></wbr>Authorized<wbr></wbr>Keys</a></code></td>
    <td>Adds a list of SSH public key to an authorized_keys file.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#AddPublicKey" class="internal-link" title="ganeti.ssh.AddPublicKey"><wbr></wbr>Add<wbr></wbr>Public<wbr></wbr>Key</a></code></td>
    <td>Adds a new key to the list of public keys.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#CheckForMultipleKeys" class="internal-link" title="ganeti.ssh.CheckForMultipleKeys"><wbr></wbr>Check<wbr></wbr>For<wbr></wbr>Multiple<wbr></wbr>Keys</a></code></td>
    <td>Check if there is at most one key per host in 'authorized_keys' file.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#ClearPubKeyFile" class="internal-link" title="ganeti.ssh.ClearPubKeyFile"><wbr></wbr>Clear<wbr></wbr>Pub<wbr></wbr>Key<wbr></wbr>File</a></code></td>
    <td>Resets the content of the public key file.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#DetermineKeyBits" class="internal-link" title="ganeti.ssh.DetermineKeyBits"><wbr></wbr>Determine<wbr></wbr>Key<wbr></wbr>Bits</a></code></td>
    <td>Checks the key bits to be used for a given key type, or provides defaults.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#GetAllUserFiles" class="internal-link" title="ganeti.ssh.GetAllUserFiles"><wbr></wbr>Get<wbr></wbr>All<wbr></wbr>User<wbr></wbr>Files</a></code></td>
    <td>Wrapper over <code><a href="ganeti.ssh.html#GetUserFiles" class="internal-link" title="ganeti.ssh.GetUserFiles">GetUserFiles</a></code> to retrieve files for all SSH key types.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#GetUserFiles" class="internal-link" title="ganeti.ssh.GetUserFiles"><wbr></wbr>Get<wbr></wbr>User<wbr></wbr>Files</a></code></td>
    <td>Return the paths of a user's SSH files.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#HasAuthorizedKey" class="internal-link" title="ganeti.ssh.HasAuthorizedKey"><wbr></wbr>Has<wbr></wbr>Authorized<wbr></wbr>Key</a></code></td>
    <td>Check if a particular key is in the 'authorized_keys' file.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#InitPubKeyFile" class="internal-link" title="ganeti.ssh.InitPubKeyFile"><wbr></wbr>Init<wbr></wbr>Pub<wbr></wbr>Key<wbr></wbr>File</a></code></td>
    <td>Creates the public key file and adds the master node's SSH key.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#InitSSHSetup" class="internal-link" title="ganeti.ssh.InitSSHSetup"><wbr></wbr>Init<wbr></wbr>SSHSetup</a></code></td>
    <td>Setup the SSH configuration for the node.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#OverridePubKeyFile" class="internal-link" title="ganeti.ssh.OverridePubKeyFile"><wbr></wbr>Override<wbr></wbr>Pub<wbr></wbr>Key<wbr></wbr>File</a></code></td>
    <td>Overrides the public key file with a list of given keys.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#QueryPubKeyFile" class="internal-link" title="ganeti.ssh.QueryPubKeyFile"><wbr></wbr>Query<wbr></wbr>Pub<wbr></wbr>Key<wbr></wbr>File</a></code></td>
    <td>Retrieves a map of keys for the requested node UUIDs.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#ReadRemoteSshPubKeys" class="internal-link" title="ganeti.ssh.ReadRemoteSshPubKeys"><wbr></wbr>Read<wbr></wbr>Remote<wbr></wbr>Ssh<wbr></wbr>Pub<wbr></wbr>Keys</a></code></td>
    <td>Fetches a public SSH key from a node via SSH.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#RemoveAuthorizedKey" class="internal-link" title="ganeti.ssh.RemoveAuthorizedKey"><wbr></wbr>Remove<wbr></wbr>Authorized<wbr></wbr>Key</a></code></td>
    <td>Removes an SSH public key from an authorized_keys file.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#RemoveAuthorizedKeys" class="internal-link" title="ganeti.ssh.RemoveAuthorizedKeys"><wbr></wbr>Remove<wbr></wbr>Authorized<wbr></wbr>Keys</a></code></td>
    <td>Removes public SSH keys from an authorized_keys file.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#RemovePublicKey" class="internal-link" title="ganeti.ssh.RemovePublicKey"><wbr></wbr>Remove<wbr></wbr>Public<wbr></wbr>Key</a></code></td>
    <td>Removes a key from the list of public keys.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#ReplaceNameByUuid" class="internal-link" title="ganeti.ssh.ReplaceNameByUuid"><wbr></wbr>Replace<wbr></wbr>Name<wbr></wbr>By<wbr></wbr>Uuid</a></code></td>
    <td>Replaces a host name with the node's corresponding UUID.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#RunSshCmdWithStdin" class="internal-link" title="ganeti.ssh.RunSshCmdWithStdin"><wbr></wbr>Run<wbr></wbr>Ssh<wbr></wbr>Cmd<wbr></wbr>With<wbr></wbr>Stdin</a></code></td>
    <td>Runs a command on a remote machine via SSH and provides input in stdin.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#WriteKnownHostsFile" class="internal-link" title="ganeti.ssh.WriteKnownHostsFile"><wbr></wbr>Write<wbr></wbr>Known<wbr></wbr>Hosts<wbr></wbr>File</a></code></td>
    <td>Writes the cluster-wide equally known_hosts file.</td>
  </tr><tr class="constant">
    
    <td>Constant</td>
    <td><code><a href="#SSH_KEY_VALID_BITS" class="internal-link" title="ganeti.ssh.SSH_KEY_VALID_BITS">SSH<wbr></wbr>_KEY<wbr></wbr>_VALID<wbr></wbr>_BITS</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="variable">
    
    <td>Variable</td>
    <td><code><a href="#KeyBitInfo" class="internal-link" title="ganeti.ssh.KeyBitInfo"><wbr></wbr>Key<wbr></wbr>Bit<wbr></wbr>Info</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="function private">
    
    <td>Function</td>
    <td><code><a href="#_AddPublicKeyElse" class="internal-link" title="ganeti.ssh._AddPublicKeyElse">_<wbr></wbr>Add<wbr></wbr>Public<wbr></wbr>Key<wbr></wbr>Else</a></code></td>
    <td>Adds a new SSH key to the key file if it did not exist already.</td>
  </tr><tr class="function private">
    
    <td>Function</td>
    <td><code><a href="#_AddPublicKeyProcessLine" class="internal-link" title="ganeti.ssh._AddPublicKeyProcessLine">_<wbr></wbr>Add<wbr></wbr>Public<wbr></wbr>Key<wbr></wbr>Process<wbr></wbr>Line</a></code></td>
    <td>Processes one line of the public key file when adding a key.</td>
  </tr><tr class="function private">
    
    <td>Function</td>
    <td><code><a href="#_EnsureCorrectGanetiVersion" class="internal-link" title="ganeti.ssh._EnsureCorrectGanetiVersion">_<wbr></wbr>Ensure<wbr></wbr>Correct<wbr></wbr>Ganeti<wbr></wbr>Version</a></code></td>
    <td>Ensured the correct Ganeti version before running a command via SSH.</td>
  </tr><tr class="function private">
    
    <td>Function</td>
    <td><code><a href="#_ManipulatePubKeyFile" class="internal-link" title="ganeti.ssh._ManipulatePubKeyFile">_<wbr></wbr>Manipulate<wbr></wbr>Pub<wbr></wbr>Key<wbr></wbr>File</a></code></td>
    <td>Manipulates the list of public SSH keys of the cluster.</td>
  </tr><tr class="function private">
    
    <td>Function</td>
    <td><code><a href="#_ParseKeyLine" class="internal-link" title="ganeti.ssh._ParseKeyLine">_<wbr></wbr>Parse<wbr></wbr>Key<wbr></wbr>Line</a></code></td>
    <td>Parses a line of the public key file.</td>
  </tr><tr class="function private">
    
    <td>Function</td>
    <td><code><a href="#_RemovePublicKeyElse" class="internal-link" title="ganeti.ssh._RemovePublicKeyElse">_<wbr></wbr>Remove<wbr></wbr>Public<wbr></wbr>Key<wbr></wbr>Else</a></code></td>
    <td>Logs when we tried to remove a key that does not exist.</td>
  </tr><tr class="function private">
    
    <td>Function</td>
    <td><code><a href="#_RemovePublicKeyProcessLine" class="internal-link" title="ganeti.ssh._RemovePublicKeyProcessLine">_<wbr></wbr>Remove<wbr></wbr>Public<wbr></wbr>Key<wbr></wbr>Process<wbr></wbr>Line</a></code></td>
    <td>Processes a line in the public key file when aiming for removing a key.</td>
  </tr><tr class="function private">
    
    <td>Function</td>
    <td><code><a href="#_ReplaceNameByUuidElse" class="internal-link" title="ganeti.ssh._ReplaceNameByUuidElse">_<wbr></wbr>Replace<wbr></wbr>Name<wbr></wbr>By<wbr></wbr>Uuid<wbr></wbr>Else</a></code></td>
    <td>Logs a debug message when we try to replace a key that is not there.</td>
  </tr><tr class="function private">
    
    <td>Function</td>
    <td><code><a href="#_ReplaceNameByUuidProcessLine" class="internal-link" title="ganeti.ssh._ReplaceNameByUuidProcessLine">_<wbr></wbr>Replace<wbr></wbr>Name<wbr></wbr>By<wbr></wbr>Uuid<wbr></wbr>Process<wbr></wbr>Line</a></code></td>
    <td>Replaces a node's name with its UUID on a matching line in the key file.</td>
  </tr><tr class="function private">
    
    <td>Function</td>
    <td><code><a href="#_SplitSshKey" class="internal-link" title="ganeti.ssh._SplitSshKey">_<wbr></wbr>Split<wbr></wbr>Ssh<wbr></wbr>Key</a></code></td>
    <td>Splits a line for SSH's <tt class="rst-docutils literal">authorized_keys</tt> file.</td>
  </tr>
</table>
          

            
        </div>

        <div id="childList">
          <div class="basefunction">
  
  
  <a name="ganeti.ssh.AddAuthorizedKey">
    
  </a>
  <a name="AddAuthorizedKey">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">AddAuthorizedKey</span>(file_obj, key):
    
    <a class="headerLink" href="#AddAuthorizedKey" title="ganeti.ssh.AddAuthorizedKey">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Adds an SSH public key to an authorized_keys file.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">file<wbr></wbr>_obj:</span>str or file handle</td><td class="fieldArgDesc">path to authorized_keys file</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">key:</span>str</td><td class="fieldArgDesc">string containing key</td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.ssh.AddAuthorizedKeys">
    
  </a>
  <a name="AddAuthorizedKeys">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">AddAuthorizedKeys</span>(file_obj, keys):
    
    <a class="headerLink" href="#AddAuthorizedKeys" title="ganeti.ssh.AddAuthorizedKeys">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Adds a list of SSH public key to an authorized_keys file.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">file<wbr></wbr>_obj:</span>str or file handle</td><td class="fieldArgDesc">path to authorized_keys file</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">keys:</span>list of str</td><td class="fieldArgDesc">list of strings containing keys</td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.ssh.AddPublicKey">
    
  </a>
  <a name="AddPublicKey">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">AddPublicKey</span>(new_uuid, new_key, key_file=<a href="ganeti.pathutils.html#SSH_PUB_KEYS" class="internal-link" title="ganeti.pathutils.SSH_PUB_KEYS">pathutils.SSH_PUB_KEYS</a>, error_fn=<a href="ganeti.errors.ProgrammerError.html" class="internal-link" title="ganeti.errors.ProgrammerError">errors.ProgrammerError</a>):
    
    <a class="headerLink" href="#AddPublicKey" title="ganeti.ssh.AddPublicKey">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Adds a new key to the list of public keys.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">See Also</td></tr><tr><td colspan="2">_ManipulatePubKeyFile for parameter descriptions.</td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.ssh.CheckForMultipleKeys">
    
  </a>
  <a name="CheckForMultipleKeys">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">CheckForMultipleKeys</span>(file_obj, node_names):
    
    <a class="headerLink" href="#CheckForMultipleKeys" title="ganeti.ssh.CheckForMultipleKeys">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Check if there is at most one key per host in 'authorized_keys' file.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">file<wbr></wbr>_obj:</span>str or file handle</td><td class="fieldArgDesc">path to authorized_keys file</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">node<wbr></wbr>_names:</span>list of str</td><td class="fieldArgDesc">list of names of nodes of the cluster</td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td colspan="2">a dictionary with hostnames which occur more than once</td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.ssh.ClearPubKeyFile">
    
  </a>
  <a name="ClearPubKeyFile">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">ClearPubKeyFile</span>(key_file=<a href="ganeti.pathutils.html#SSH_PUB_KEYS" class="internal-link" title="ganeti.pathutils.SSH_PUB_KEYS">pathutils.SSH_PUB_KEYS</a>, mode=384):
    
    <a class="headerLink" href="#ClearPubKeyFile" title="ganeti.ssh.ClearPubKeyFile">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Resets the content of the public key file.</p>
</div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.ssh.DetermineKeyBits">
    
  </a>
  <a name="DetermineKeyBits">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">DetermineKeyBits</span>(key_type, key_bits, old_key_type, old_key_bits):
    
    <a class="headerLink" href="#DetermineKeyBits" title="ganeti.ssh.DetermineKeyBits">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Checks the key bits to be used for a given key type, or provides defaults.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">key<wbr></wbr>_type:</span>one of <code><a href="ganeti._constants.html#SSHK_ALL" class="internal-link" title="ganeti._constants.SSHK_ALL">constants.SSHK_ALL</a></code></td><td class="fieldArgDesc">The key type to use.</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">key<wbr></wbr>_bits:</span>positive int or None</td><td class="fieldArgDesc">The number of bits to use, if supplied by user.</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">old<wbr></wbr>_key<wbr></wbr>_type:</span>one of <code><a href="ganeti._constants.html#SSHK_ALL" class="internal-link" title="ganeti._constants.SSHK_ALL">constants.SSHK_ALL</a></code> or None</td><td class="fieldArgDesc">The previously used key type, if any.</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">old<wbr></wbr>_key<wbr></wbr>_bits:</span>positive int or None</td><td class="fieldArgDesc">The previously used number of bits, if any.</td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer">positive int</td><td class="fieldArgDesc">The number of bits to use.</td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.ssh.GetAllUserFiles">
    
  </a>
  <a name="GetAllUserFiles">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">GetAllUserFiles</span>(user, mkdir=False, dircheck=True, _homedir_fn=None):
    
    <a class="headerLink" href="#GetAllUserFiles" title="ganeti.ssh.GetAllUserFiles">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Wrapper over <code><a href="#GetUserFiles" class="internal-link" title="ganeti.ssh.GetUserFiles">GetUserFiles</a></code> to retrieve files for all SSH key types.</p>
<p>See <code><a href="#GetUserFiles" class="internal-link" title="ganeti.ssh.GetUserFiles">GetUserFiles</a></code> for details.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer">tuple; (string, dict with string as key, tuple of (string, string) as value)</td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.ssh.GetUserFiles">
    
  </a>
  <a name="GetUserFiles">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">GetUserFiles</span>(user, mkdir=False, dircheck=True, kind=<a href="ganeti._constants.html#SSHK_DSA" class="internal-link" title="ganeti._constants.SSHK_DSA">constants.SSHK_DSA</a>, _homedir_fn=None):
    
    <a class="headerLink" href="#GetUserFiles" title="ganeti.ssh.GetUserFiles">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Return the paths of a user's SSH files.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">user:</span>string</td><td class="fieldArgDesc">Username</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">mkdir:</span>bool</td><td class="fieldArgDesc">Whether to create ".ssh" directory if it doesn't exist</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">dircheck:</span>bool</td><td class="fieldArgDesc">Whether to check if ".ssh" directory exists</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">kind:</span>string</td><td class="fieldArgDesc">One of <code><a href="ganeti._constants.html#SSHK_ALL" class="internal-link" title="ganeti._constants.SSHK_ALL">constants.SSHK_ALL</a></code></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">_homedir<wbr></wbr>_fn</span></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer">tuple; (string, string, string)</td><td class="fieldArgDesc">Tuple containing three file system paths; the private SSH key file, the public SSH key file and the user's <tt class="rst-docutils literal">authorized_keys</tt> file</td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Raises</td></tr><tr><td class="fieldArgContainer"><code><a href="ganeti.errors.OpExecError.html" class="internal-link" title="ganeti.errors.OpExecError">errors.OpExecError</a></code></td><td>When home directory of the user can not be determined</td></tr><tr><td class="fieldArgContainer"><code><a href="ganeti.errors.OpExecError.html" class="internal-link" title="ganeti.errors.OpExecError">errors.OpExecError</a></code></td><td>Regardless of the <tt class="rst-docutils literal">mkdir</tt> parameters, this exception is raised if <tt class="rst-docutils literal"><span class="pre">~$user/.ssh</span></tt> is not a directory and <tt class="rst-docutils literal">dircheck</tt> is set to <tt class="rst-docutils literal">True</tt></td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.ssh.HasAuthorizedKey">
    
  </a>
  <a name="HasAuthorizedKey">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">HasAuthorizedKey</span>(file_obj, key):
    
    <a class="headerLink" href="#HasAuthorizedKey" title="ganeti.ssh.HasAuthorizedKey">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Check if a particular key is in the 'authorized_keys' file.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">file<wbr></wbr>_obj:</span>str or file handle</td><td class="fieldArgDesc">path to authorized_keys file</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">key:</span>str</td><td class="fieldArgDesc">string containing key</td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.ssh.InitPubKeyFile">
    
  </a>
  <a name="InitPubKeyFile">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">InitPubKeyFile</span>(master_uuid, key_type, key_file=<a href="ganeti.pathutils.html#SSH_PUB_KEYS" class="internal-link" title="ganeti.pathutils.SSH_PUB_KEYS">pathutils.SSH_PUB_KEYS</a>):
    
    <a class="headerLink" href="#InitPubKeyFile" title="ganeti.ssh.InitPubKeyFile">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Creates the public key file and adds the master node's SSH key.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">master<wbr></wbr>_uuid:</span>str</td><td class="fieldArgDesc">the master node's UUID</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">key<wbr></wbr>_type:</span>one of <code><a href="ganeti._constants.html#SSHK_ALL" class="internal-link" title="ganeti._constants.SSHK_ALL">constants.SSHK_ALL</a></code></td><td class="fieldArgDesc">the type of ssh key to be used</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">key<wbr></wbr>_file:</span>str</td><td class="fieldArgDesc">name of the file containing the public keys</td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.ssh.InitSSHSetup">
    
  </a>
  <a name="InitSSHSetup">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">InitSSHSetup</span>(key_type, key_bits, error_fn=<a href="ganeti.errors.OpPrereqError.html" class="internal-link" title="ganeti.errors.OpPrereqError">errors.OpPrereqError</a>, _homedir_fn=None, _suffix=<span class="rst-variable-quote">'</span><span class="rst-variable-string"></span><span class="rst-variable-quote">'</span>):
    
    <a class="headerLink" href="#InitSSHSetup" title="ganeti.ssh.InitSSHSetup">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Setup the SSH configuration for the node.</p>
<p>This generates a dsa keypair for root, adds the pub key to the permitted hosts and adds the hostkey to its own known hosts.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">key<wbr></wbr>_type</span></td><td class="fieldArgDesc">the type of SSH keypair to be generated</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">key<wbr></wbr>_bits</span></td><td class="fieldArgDesc">the key length, in bits, to be used</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">error<wbr></wbr>_fn</span></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">_homedir<wbr></wbr>_fn</span></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">_suffix</span></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.ssh.OverridePubKeyFile">
    
  </a>
  <a name="OverridePubKeyFile">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">OverridePubKeyFile</span>(key_map, key_file=<a href="ganeti.pathutils.html#SSH_PUB_KEYS" class="internal-link" title="ganeti.pathutils.SSH_PUB_KEYS">pathutils.SSH_PUB_KEYS</a>):
    
    <a class="headerLink" href="#OverridePubKeyFile" title="ganeti.ssh.OverridePubKeyFile">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Overrides the public key file with a list of given keys.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">key<wbr></wbr>_map:</span>dict from str to list of str</td><td class="fieldArgDesc">dictionary mapping uuids to lists of SSH keys</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">key<wbr></wbr>_file</span></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.ssh.QueryPubKeyFile">
    
  </a>
  <a name="QueryPubKeyFile">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">QueryPubKeyFile</span>(target_uuids, key_file=<a href="ganeti.pathutils.html#SSH_PUB_KEYS" class="internal-link" title="ganeti.pathutils.SSH_PUB_KEYS">pathutils.SSH_PUB_KEYS</a>, error_fn=<a href="ganeti.errors.ProgrammerError.html" class="internal-link" title="ganeti.errors.ProgrammerError">errors.ProgrammerError</a>):
    
    <a class="headerLink" href="#QueryPubKeyFile" title="ganeti.ssh.QueryPubKeyFile">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Retrieves a map of keys for the requested node UUIDs.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">target<wbr></wbr>_uuids:</span>str or list of str</td><td class="fieldArgDesc">UUID of the node to retrieve the key for or a list of UUIDs of nodes to retrieve the keys for</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">key<wbr></wbr>_file:</span>str</td><td class="fieldArgDesc">filename of the file of public node keys (optional parameter for testing)</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">error<wbr></wbr>_fn:</span>function</td><td class="fieldArgDesc">Function that returns an exception, used to customize exception types depending on the calling context</td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer">dict mapping strings to list of strings</td><td class="fieldArgDesc">dictionary mapping node uuids to their ssh keys</td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.ssh.ReadRemoteSshPubKeys">
    
  </a>
  <a name="ReadRemoteSshPubKeys">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">ReadRemoteSshPubKeys</span>(pub_key_file, node, cluster_name, port, ask_key, strict_host_check):
    
    <a class="headerLink" href="#ReadRemoteSshPubKeys" title="ganeti.ssh.ReadRemoteSshPubKeys">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Fetches a public SSH key from a node via SSH.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">pub<wbr></wbr>_key<wbr></wbr>_file:</span>string</td><td class="fieldArgDesc">a tuple consisting of the file name of the public DSA key</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">node</span></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">cluster<wbr></wbr>_name</span></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">port</span></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">ask<wbr></wbr>_key</span></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">strict<wbr></wbr>_host<wbr></wbr>_check</span></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.ssh.RemoveAuthorizedKey">
    
  </a>
  <a name="RemoveAuthorizedKey">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">RemoveAuthorizedKey</span>(file_name, key):
    
    <a class="headerLink" href="#RemoveAuthorizedKey" title="ganeti.ssh.RemoveAuthorizedKey">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Removes an SSH public key from an authorized_keys file.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">file<wbr></wbr>_name:</span>str</td><td class="fieldArgDesc">path to authorized_keys file</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">key:</span>str</td><td class="fieldArgDesc">string containing key</td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.ssh.RemoveAuthorizedKeys">
    
  </a>
  <a name="RemoveAuthorizedKeys">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">RemoveAuthorizedKeys</span>(file_name, keys):
    
    <a class="headerLink" href="#RemoveAuthorizedKeys" title="ganeti.ssh.RemoveAuthorizedKeys">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Removes public SSH keys from an authorized_keys file.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">file<wbr></wbr>_name:</span>str</td><td class="fieldArgDesc">path to authorized_keys file</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">keys:</span>list of str</td><td class="fieldArgDesc">list of strings containing keys</td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.ssh.RemovePublicKey">
    
  </a>
  <a name="RemovePublicKey">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">RemovePublicKey</span>(target_uuid, key_file=<a href="ganeti.pathutils.html#SSH_PUB_KEYS" class="internal-link" title="ganeti.pathutils.SSH_PUB_KEYS">pathutils.SSH_PUB_KEYS</a>, error_fn=<a href="ganeti.errors.ProgrammerError.html" class="internal-link" title="ganeti.errors.ProgrammerError">errors.ProgrammerError</a>):
    
    <a class="headerLink" href="#RemovePublicKey" title="ganeti.ssh.RemovePublicKey">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Removes a key from the list of public keys.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">See Also</td></tr><tr><td colspan="2">_ManipulatePubKeyFile for parameter descriptions.</td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.ssh.ReplaceNameByUuid">
    
  </a>
  <a name="ReplaceNameByUuid">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">ReplaceNameByUuid</span>(node_uuid, node_name, key_file=<a href="ganeti.pathutils.html#SSH_PUB_KEYS" class="internal-link" title="ganeti.pathutils.SSH_PUB_KEYS">pathutils.SSH_PUB_KEYS</a>, error_fn=<a href="ganeti.errors.ProgrammerError.html" class="internal-link" title="ganeti.errors.ProgrammerError">errors.ProgrammerError</a>):
    
    <a class="headerLink" href="#ReplaceNameByUuid" title="ganeti.ssh.ReplaceNameByUuid">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Replaces a host name with the node's corresponding UUID.</p>
<p>When a node is added to the cluster, we don't know it's UUID yet. So first its SSH key gets added to the public key file and in a second step, the node's name gets replaced with the node's UUID as soon as we know the UUID.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">node<wbr></wbr>_uuid:</span>string</td><td class="fieldArgDesc">the node's UUID to replace the node's name</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">node<wbr></wbr>_name:</span>string</td><td class="fieldArgDesc">the node's name to be replaced by the node's UUID</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">key<wbr></wbr>_file</span></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">error<wbr></wbr>_fn</span></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">See Also</td></tr><tr><td colspan="2">_ManipulatePubKeyFile for the other parameter descriptions.</td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.ssh.RunSshCmdWithStdin">
    
  </a>
  <a name="RunSshCmdWithStdin">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">RunSshCmdWithStdin</span>(cluster_name, node, basecmd, port, data, debug=False, verbose=False, use_cluster_key=False, ask_key=False, strict_host_check=False, ensure_version=False):
    
    <a class="headerLink" href="#RunSshCmdWithStdin" title="ganeti.ssh.RunSshCmdWithStdin">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Runs a command on a remote machine via SSH and provides input in stdin.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">cluster<wbr></wbr>_name:</span>string</td><td class="fieldArgDesc">Cluster name</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">node:</span>string</td><td class="fieldArgDesc">Node name</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">basecmd:</span>string</td><td class="fieldArgDesc">Base command (path on the remote machine)</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">port:</span>int</td><td class="fieldArgDesc">The SSH port of the remote machine or None for the default</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">data</span></td><td class="fieldArgDesc">JSON-serializable input data for script (passed to stdin)</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">debug:</span>bool</td><td class="fieldArgDesc">Enable debug output</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">verbose:</span>bool</td><td class="fieldArgDesc">Enable verbose output</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">use<wbr></wbr>_cluster<wbr></wbr>_key:</span>bool</td><td class="fieldArgDesc">See <code><a href="ganeti.ssh.SshRunner.html#BuildCmd" class="internal-link" title="ganeti.ssh.SshRunner.BuildCmd">ssh.SshRunner.BuildCmd</a></code></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">ask<wbr></wbr>_key:</span>bool</td><td class="fieldArgDesc">See <code><a href="ganeti.ssh.SshRunner.html#BuildCmd" class="internal-link" title="ganeti.ssh.SshRunner.BuildCmd">ssh.SshRunner.BuildCmd</a></code></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">strict<wbr></wbr>_host<wbr></wbr>_check:</span>bool</td><td class="fieldArgDesc">See <code><a href="ganeti.ssh.SshRunner.html#BuildCmd" class="internal-link" title="ganeti.ssh.SshRunner.BuildCmd">ssh.SshRunner.BuildCmd</a></code></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">ensure<wbr></wbr>_version</span></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.ssh.WriteKnownHostsFile">
    
  </a>
  <a name="WriteKnownHostsFile">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">WriteKnownHostsFile</span>(cfg, file_name):
    
    <a class="headerLink" href="#WriteKnownHostsFile" title="ganeti.ssh.WriteKnownHostsFile">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Writes the cluster-wide equally known_hosts file.</p>
</div>
  </div>
</div><div class="baseconstant">
  
  
  <a name="ganeti.ssh.SSH_KEY_VALID_BITS">
    
  </a>
  <a name="SSH_KEY_VALID_BITS">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-defname">SSH_KEY_VALID_BITS</span> =
    
    <a class="headerLink" href="#SSH_KEY_VALID_BITS" title="ganeti.ssh.SSH_KEY_VALID_BITS">
      
      
      ¶
    </a>
  </div>
  <div class="functionBody">
    
    <div><p class="undocumented">Undocumented</p></div>
    <table class="valueTable"><tr class="fieldStart"><td class="fieldName">Value</td></tr><tr><td><pre class="constant-value"><code>{<wbr></wbr><a href="ganeti._constants.html#SSHK_DSA" class="internal-link" title="ganeti._constants.SSHK_DSA">constants.SSHK_DSA</a>: <a href="#KeyBitInfo" class="internal-link" title="ganeti.ssh.KeyBitInfo">KeyBitInfo</a>(<wbr></wbr>1024, <wbr></wbr>(lambda b: b == 1024)),
 <wbr></wbr><a href="ganeti._constants.html#SSHK_RSA" class="internal-link" title="ganeti._constants.SSHK_RSA">constants.SSHK_RSA</a>: <a href="#KeyBitInfo" class="internal-link" title="ganeti.ssh.KeyBitInfo">KeyBitInfo</a>(<wbr></wbr>2048, <wbr></wbr>(lambda b: b &gt;= 768)),
 <wbr></wbr><a href="ganeti._constants.html#SSHK_ECDSA" class="internal-link" title="ganeti._constants.SSHK_ECDSA">constants.SSHK_ECDSA</a>: <a href="#KeyBitInfo" class="internal-link" title="ganeti.ssh.KeyBitInfo">KeyBitInfo</a>(<wbr></wbr>384, <wbr></wbr>(lambda b: b in [256, 384, 521]))}</code></pre></td></tr></table>
  </div>
</div><div class="basevariable">
  
  
  <a name="ganeti.ssh.KeyBitInfo">
    
  </a>
  <a name="KeyBitInfo">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-defname">KeyBitInfo</span> =
    
    <a class="headerLink" href="#KeyBitInfo" title="ganeti.ssh.KeyBitInfo">
      
      
      ¶
    </a>
  </div>
  <div class="functionBody">
    
    <div><p class="undocumented">Undocumented</p></div>
    
  </div>
</div><div class="basefunction private">
  
  
  <a name="ganeti.ssh._AddPublicKeyElse">
    
  </a>
  <a name="_AddPublicKeyElse">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">_AddPublicKeyElse</span>(new_uuid, new_key):
    
    <a class="headerLink" href="#_AddPublicKeyElse" title="ganeti.ssh._AddPublicKeyElse">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Adds a new SSH key to the key file if it did not exist already.</p>
<p>This is an auxiliary function for <tt class="rst-docutils literal">_ManipulatePublicKeyFile</tt> which is carried out when a new key is added to the public key file and after processing the whole file, we found out that the key does not exist in the file yet but needs to be appended at the end.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">new<wbr></wbr>_uuid:</span>string</td><td class="fieldArgDesc">the UUID of the node whose key is added</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">new<wbr></wbr>_key:</span>string</td><td class="fieldArgDesc">the SSH key to be added</td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer">string</td><td class="fieldArgDesc">a new line to be added to the file</td></tr></table></div>
  </div>
</div><div class="basefunction private">
  
  
  <a name="ganeti.ssh._AddPublicKeyProcessLine">
    
  </a>
  <a name="_AddPublicKeyProcessLine">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">_AddPublicKeyProcessLine</span>(new_uuid, new_key, line_uuid, line_key, found):
    
    <a class="headerLink" href="#_AddPublicKeyProcessLine" title="ganeti.ssh._AddPublicKeyProcessLine">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Processes one line of the public key file when adding a key.</p>
<p>This is a sub function that can be called within the <tt class="rst-docutils literal">_ManipulatePublicKeyFile</tt> function. It processes one line of the public key file, checks if this line contains the key to add already and if so, notes the occurrence in the return value.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">new<wbr></wbr>_uuid:</span>string</td><td class="fieldArgDesc">the node UUID of the node whose key is added</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">new<wbr></wbr>_key:</span>string</td><td class="fieldArgDesc">the SSH key to be added</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">line<wbr></wbr>_uuid:</span>the UUID of the node whose line in the public key file is processed in this function call</td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">line<wbr></wbr>_key</span></td><td class="fieldArgDesc">the SSH key of the node whose line in the public key file is processed in this function call</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">found:</span>boolean</td><td class="fieldArgDesc">whether or not the (UUID, key) pair of the node whose key is being added was found in the public key file already.</td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer">(boolean, string)</td><td class="fieldArgDesc">a possibly updated value of <tt class="rst-docutils literal">found</tt> and the processed line</td></tr></table></div>
  </div>
</div><div class="basefunction private">
  
  
  <a name="ganeti.ssh._EnsureCorrectGanetiVersion">
    
  </a>
  <a name="_EnsureCorrectGanetiVersion">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">_EnsureCorrectGanetiVersion</span>(cmd):
    
    <a class="headerLink" href="#_EnsureCorrectGanetiVersion" title="ganeti.ssh._EnsureCorrectGanetiVersion">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Ensured the correct Ganeti version before running a command via SSH.</p>
<p>Before a command is run on a node via SSH, it makes sense in some situations to ensure that this node is indeed running the correct version of Ganeti like the rest of the cluster.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">cmd:</span>string</td><td class="fieldArgDesc">string</td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer">list of strings</td><td class="fieldArgDesc">a list of commands with the newly added ones at the beginning</td></tr></table></div>
  </div>
</div><div class="basefunction private">
  
  
  <a name="ganeti.ssh._ManipulatePubKeyFile">
    
  </a>
  <a name="_ManipulatePubKeyFile">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">_ManipulatePubKeyFile</span>(target_identifier, target_key, key_file=<a href="ganeti.pathutils.html#SSH_PUB_KEYS" class="internal-link" title="ganeti.pathutils.SSH_PUB_KEYS">pathutils.SSH_PUB_KEYS</a>, error_fn=<a href="ganeti.errors.ProgrammerError.html" class="internal-link" title="ganeti.errors.ProgrammerError">errors.ProgrammerError</a>, process_line_fn=None, process_else_fn=None):
    
    <a class="headerLink" href="#_ManipulatePubKeyFile" title="ganeti.ssh._ManipulatePubKeyFile">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Manipulates the list of public SSH keys of the cluster.</p>
<p>This is a general function to manipulate the public key file. It needs two auxiliary functions <tt class="rst-docutils literal">process_line_fn</tt> and <tt class="rst-docutils literal">process_else_fn</tt> to work. Generally, the public key file is processed as follows: 1) The function processes each line of the original ganeti public key file, applies the <tt class="rst-docutils literal">process_line_fn</tt> function on it, which returns a possibly manipulated line and an indicator whether the line in question was found. If a line is returned, it is added to a list of lines for later writing to the file. 2) If all lines are processed and the 'found' variable is False, the seconds auxiliary function <tt class="rst-docutils literal">process_else_fn</tt> is called to possibly add more lines to the list of lines. 3) Finally, the list of lines is assembled to a string and written atomically to the public key file, thereby overriding it.</p>
<p>If the public key file does not exist, we create it. This is necessary for a smooth transition after an upgrade.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">target<wbr></wbr>_identifier:</span>str</td><td class="fieldArgDesc">identifier of the node whose key is added; in most cases this is the node's UUID, but in some it is the node's host name</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">target<wbr></wbr>_key:</span>str</td><td class="fieldArgDesc">string containing a public SSH key (a complete line possibly including more parameters than just the key)</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">key<wbr></wbr>_file:</span>str</td><td class="fieldArgDesc">filename of the file of public node keys (optional parameter for testing)</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">error<wbr></wbr>_fn:</span>function</td><td class="fieldArgDesc">Function that returns an exception, used to customize exception types depending on the calling context</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">process<wbr></wbr>_line<wbr></wbr>_fn:</span>function</td><td class="fieldArgDesc">function to process one line of the public key file</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">process<wbr></wbr>_else<wbr></wbr>_fn:</span>function</td><td class="fieldArgDesc">function to be called if no line of the key file matches the target uuid</td></tr></table></div>
  </div>
</div><div class="basefunction private">
  
  
  <a name="ganeti.ssh._ParseKeyLine">
    
  </a>
  <a name="_ParseKeyLine">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">_ParseKeyLine</span>(line, error_fn):
    
    <a class="headerLink" href="#_ParseKeyLine" title="ganeti.ssh._ParseKeyLine">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Parses a line of the public key file.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">line:</span>string</td><td class="fieldArgDesc">line of the public key file</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">error<wbr></wbr>_fn:</span>function</td><td class="fieldArgDesc">function to process error messages</td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer">tuple (string, string)</td><td class="fieldArgDesc">a tuple containing the UUID of the node and a string containing the SSH key and possible more parameters for the key</td></tr></table></div>
  </div>
</div><div class="basefunction private">
  
  
  <a name="ganeti.ssh._RemovePublicKeyElse">
    
  </a>
  <a name="_RemovePublicKeyElse">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">_RemovePublicKeyElse</span>(target_uuid, _target_key):
    
    <a class="headerLink" href="#_RemovePublicKeyElse" title="ganeti.ssh._RemovePublicKeyElse">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Logs when we tried to remove a key that does not exist.</p>
<p>This is an auxiliary function for <tt class="rst-docutils literal">_ManipulatePublicKeyFile</tt> which is run after we have processed the complete public key file and did not find the key to be removed.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">target<wbr></wbr>_uuid:</span>string</td><td class="fieldArgDesc">the UUID of the node whose key was supposed to be removed</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">_target<wbr></wbr>_key:</span>string</td><td class="fieldArgDesc">the key of the node which was supposed to be removed (not used)</td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer">string</td><td class="fieldArgDesc">in this case, always None</td></tr></table></div>
  </div>
</div><div class="basefunction private">
  
  
  <a name="ganeti.ssh._RemovePublicKeyProcessLine">
    
  </a>
  <a name="_RemovePublicKeyProcessLine">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">_RemovePublicKeyProcessLine</span>(target_uuid, _target_key, line_uuid, line_key, found):
    
    <a class="headerLink" href="#_RemovePublicKeyProcessLine" title="ganeti.ssh._RemovePublicKeyProcessLine">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Processes a line in the public key file when aiming for removing a key.</p>
<p>This is an auxiliary function for <tt class="rst-docutils literal">_ManipulatePublicKeyFile</tt> when we are removing a key from the public key file. This particular function only checks if the current line contains the UUID of the node in question and writes the line to the temporary file otherwise.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">target<wbr></wbr>_uuid:</span>string</td><td class="fieldArgDesc">UUID of the node whose key is being removed</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">_target<wbr></wbr>_key:</span>string</td><td class="fieldArgDesc">SSH key of the node (not used)</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">line<wbr></wbr>_uuid:</span>string</td><td class="fieldArgDesc">UUID of the node whose line is processed in this call</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">line<wbr></wbr>_key:</span>string</td><td class="fieldArgDesc">SSH key of the nodes whose line is processed in this call</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">found:</span>boolean</td><td class="fieldArgDesc">whether or not the UUID was already found.</td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer">(boolean, string)</td><td class="fieldArgDesc">a tuple, indicating if the target line was found and the processed line; the line is 'None', if the original line is removed</td></tr></table></div>
  </div>
</div><div class="basefunction private">
  
  
  <a name="ganeti.ssh._ReplaceNameByUuidElse">
    
  </a>
  <a name="_ReplaceNameByUuidElse">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">_ReplaceNameByUuidElse</span>(node_uuid, node_name, _key):
    
    <a class="headerLink" href="#_ReplaceNameByUuidElse" title="ganeti.ssh._ReplaceNameByUuidElse">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Logs a debug message when we try to replace a key that is not there.</p>
<p>This is an implementation of the auxiliary <tt class="rst-docutils literal">process_else_fn</tt> function for the <tt class="rst-docutils literal">_ManipulatePubKeyFile</tt> function when we use it to replace a line in the public key file that is indexed by the node's name instead of the node's UUID.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">node<wbr></wbr>_uuid:</span>string</td><td class="fieldArgDesc">the node's UUID</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">node<wbr></wbr>_name:</span>string</td><td class="fieldArgDesc">the node's UUID</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">_key:</span>string (not used)</td><td class="fieldArgDesc">the node's SSH key (not used)</td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer">string</td><td class="fieldArgDesc">in this case, always None</td></tr></table></div>
  </div>
</div><div class="basefunction private">
  
  
  <a name="ganeti.ssh._ReplaceNameByUuidProcessLine">
    
  </a>
  <a name="_ReplaceNameByUuidProcessLine">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">_ReplaceNameByUuidProcessLine</span>(node_name, _key, line_identifier, line_key, found, node_uuid=None):
    
    <a class="headerLink" href="#_ReplaceNameByUuidProcessLine" title="ganeti.ssh._ReplaceNameByUuidProcessLine">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Replaces a node's name with its UUID on a matching line in the key file.</p>
<p>This is an auxiliary function for <tt class="rst-docutils literal">_ManipulatePublicKeyFile</tt> which processes a line of the ganeti public key file. If the line in question matches the node's name, the name will be replaced by the node's UUID.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">node<wbr></wbr>_name:</span>string</td><td class="fieldArgDesc">name of the node to be replaced by the UUID</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">_key:</span>string</td><td class="fieldArgDesc">SSH key of the node (not used)</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">line<wbr></wbr>_identifier:</span>string</td><td class="fieldArgDesc">an identifier of a node in a line of the public key file. This can be either a node name or a node UUID, depending on if it got replaced already or not.</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">line<wbr></wbr>_key:</span>string</td><td class="fieldArgDesc">SSH key of the node whose line is processed</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">found:</span>boolean</td><td class="fieldArgDesc">whether or not the line matches the node's name</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">node<wbr></wbr>_uuid:</span>string</td><td class="fieldArgDesc">the node's UUID which will replace the node name</td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer">(boolean, string)</td><td class="fieldArgDesc">a tuple indicating whether the target line was found and the processed line</td></tr></table></div>
  </div>
</div><div class="basefunction private">
  
  
  <a name="ganeti.ssh._SplitSshKey">
    
  </a>
  <a name="_SplitSshKey">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">_SplitSshKey</span>(key):
    
    <a class="headerLink" href="#_SplitSshKey" title="ganeti.ssh._SplitSshKey">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Splits a line for SSH's <tt class="rst-docutils literal">authorized_keys</tt> file.</p>
<p>If the line has no options (e.g. no <tt class="rst-docutils literal"><span class="pre">command="..."</span></tt>), only the significant parts, the key type and its hash, are used. Otherwise the whole line is used (split at whitespace).</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">key:</span>string</td><td class="fieldArgDesc">Key line</td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer">tuple</td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr></table></div>
  </div>
</div>
        </div>
      
      </div>
    </div>

    <footer class="navbar navbar-default">

  
  <div class="container">
    <a href="index.html">API Documentation</a> for ganeti/server,
  generated by <a href="https://github.com/twisted/pydoctor/">pydoctor</a>
    22.9.1 at 2024-05-06 13:21:37.
  </div>

  <!-- Search related scripts needs to be loaded at the end of HTML 
    parsing not to introduce overhead and display HTML data asap -->
  <script src="ajax.js" type="text/javascript"></script>
  <script src="searchlib.js" type="text/javascript"></script>
  <script src="search.js" type="text/javascript"></script>

</footer>
  
    <script src="pydoctor.js" type="text/javascript"></script>

  </body>
</html>