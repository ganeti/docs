<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "DTD/xhtml1-strict.dtd">
<html>
  

  <head>
    
    <title>ganeti.server.noded</title>
    <meta name="generator" content="pydoctor 22.9.1"> 
        
    </meta>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1 maximum-scale=1" />
    <link rel="stylesheet" type="text/css" href="bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="apidocs.css" />
    <link rel="stylesheet" type="text/css" href="extra.css" />
</head>

  <body>

    

    <nav class="navbar navbar-default mainnavbar">
      
  
  <div class="container-fluid">


    <div class="navbar-header">
      
      <div class="navlinks">
        <span class="navbar-brand">
          ganeti/server <a href="index.html">API Documentation</a>
        </span>

        <a href="moduleIndex.html">
          Modules
        </a>

        <a href="classIndex.html">
          Classes
        </a>

        <a href="nameIndex.html">
          Names
        </a>

        <div id="search-box-container">
          <div class="input-group">
            <input id="search-box" type="search" name="search-query" placeholder="Search..." aria-label="Search" minlength="2" class="form-control" autocomplete="off" />
            
            <span class="input-group-btn">
              <a style="display: none;" class="btn btn-default" id="search-clear-button" title="Clear" onclick="clearSearch()"><img src="fonts/x-circle.svg" alt="Clear" /></a>
              <a class="btn btn-default" id="search-help-button" title="Help" onclick="toggleSearchHelpText()"><img src="fonts/info.svg" alt="Help" /></a>
            </span>
          </div>
        </div>

      </div>

      <div id="search-results-container" style="display: none;">
        
        <div id="search-buttons">
          <span class="label label-default" id="search-docstrings-button">
          <label class="checkbox-inline">
            <input type="checkbox" id="toggle-search-in-docstrings-checkbox" value="false" onclick="toggleSearchInDocstrings()">
              search in docstrings
            </input>
          </label>
          </span>
          
        </div>
        
        <noscript>
            <h1>Cannot search: JavaScript is not supported/enabled in your browser.</h1>
        </noscript>

        <div class="hint" id="search-help-box">
          <p class="rst-last">
      
            Search bar offers the following options:
            <ul>   
                <li>
                  <strong>Term presence.</strong> The below example searches for documents that 
                    must contain “foo”, might contain “bar” and must not contain “baz”: <code>+foo bar -baz</code>
                </li> 

                <li>
                  <strong>Wildcards.</strong> The below example searches for documents with words beginning with “foo”: <code>foo*</code>
                </li> 

                <li>
                  <strong>Search in specific fields.</strong> The following search matches all objects 
                  in "twisted.mail" that matches “search”: <code>+qname:twisted.mail.* +search</code>

                  <p>
                    Possible fields: 'name', 'qname' (fully qualified name), 'docstring', and 'kind'.
                    Last two fields are only applicable if "search in docstrings" is enabled.
                  </p>
                </li>

                <li>
                  <strong>Fuzzy matches.</strong> The following search matches all documents 
                  that have a word within 1 edit distance of “foo”: <code>foo~1</code>
                </li>
            </ul>

          </p>
        </div>

        <div id="search-status"> </div>

        <div class="warning" id="search-warn-box" style="display: none;">
          <p class="rst-last"><span id="search-warn"></span></p>
        </div>

        <table id="search-results">
          <!-- Filled dynamically by JS -->
        </table>
        
        <div style="margin-top: 8px;">
          <p>Results provided by <a href="https://lunrjs.com">Lunr.js</a></p>
        </div>
      </div>

    </div>


  </div>
</nav>
    
    <div class="container-fluid">

      <!-- Side navigation -->
      <div class="sidebarcontainer" style="display: none;">
        
        <div class="sidebar"><nav class="sidebar">
  

  <div>

      <div class="thingTitle">
        <span>Module</span>
        <code class="thisobject"><a href="ganeti.server.noded.html" class="internal-link" title="This module">noded</a></code> 
      </div>
      
      <div>
        

        
         

        <div class="childrenKindTitle">Classes</div>
        <ul>
    
    <li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.server.noded.MlockallRequestExecutor.html" class="internal-link" title="ganeti.server.noded.MlockallRequestExecutor"><wbr></wbr>Mlockall<wbr></wbr>Request<wbr></wbr>Executor</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.server.noded.NodeRequestHandler.html" class="internal-link" title="ganeti.server.noded.NodeRequestHandler"><wbr></wbr>Node<wbr></wbr>Request<wbr></wbr>Handler</a></code>
            </div>
        

    </li>
</ul>

        <div class="childrenKindTitle">Functions</div>
        <ul>
    
    <li class="">
        
        
        

        
            <div class="itemName"><code><a href="#CheckNoded" class="internal-link" title="ganeti.server.noded.CheckNoded"><wbr></wbr>Check<wbr></wbr>Noded</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#ExecNoded" class="internal-link" title="ganeti.server.noded.ExecNoded"><wbr></wbr>Exec<wbr></wbr>Noded</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#Main" class="internal-link" title="ganeti.server.noded.Main"><wbr></wbr>Main</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#PrepNoded" class="internal-link" title="ganeti.server.noded.PrepNoded"><wbr></wbr>Prep<wbr></wbr>Noded</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#SSLVerifyPeer" class="internal-link" title="ganeti.server.noded.SSLVerifyPeer"><wbr></wbr>SSLVerify<wbr></wbr>Peer</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="#_DecodeImportExportIO" class="internal-link" title="ganeti.server.noded._DecodeImportExportIO">_<wbr></wbr>Decode<wbr></wbr>Import<wbr></wbr>Export<wbr></wbr>IO</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="#_DefaultAlternative" class="internal-link" title="ganeti.server.noded._DefaultAlternative">_<wbr></wbr>Default<wbr></wbr>Alternative</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="#_extendReasonTrail" class="internal-link" title="ganeti.server.noded._extendReasonTrail">_extend<wbr></wbr>Reason<wbr></wbr>Trail</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="#_PrepareQueueLock" class="internal-link" title="ganeti.server.noded._PrepareQueueLock">_<wbr></wbr>Prepare<wbr></wbr>Queue<wbr></wbr>Lock</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="#_RequireJobQueueLock" class="internal-link" title="ganeti.server.noded._RequireJobQueueLock">_<wbr></wbr>Require<wbr></wbr>Job<wbr></wbr>Queue<wbr></wbr>Lock</a></code>
            </div>
        

    </li>
</ul> 

        
         

        <div class="childrenKindTitle">Variables</div>
        <ul>
    
    <li class="">
        
        
        

        
            <div class="itemName"><code><a href="#queue_lock" class="internal-link" title="ganeti.server.noded.queue_lock">queue<wbr></wbr>_lock</a></code>
            </div>
        

    </li>
</ul> 

        
         
        
      </div>
  </div><div>

      <div class="thingTitle">
        <span>Package</span>
        <code><a href="ganeti.server.html" class="internal-link" title="The parent of this module">server</a></code> 
      </div>
      
      <div>
        

        <div class="childrenKindTitle">Modules</div>
        <ul>
    
    <li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.server.masterd.html" class="internal-link" title="ganeti.server.masterd">masterd</a></code>
            </div>
        

    </li><li class=" thisobject">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.server.noded.html" class="internal-link" title="ganeti.server.noded">noded</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="ganeti.server.rapi.html" class="internal-link" title="ganeti.server.rapi">rapi</a></code>
            </div>
        

    </li>
</ul> 

        
        

        
         

        
         

        
         

        
         
        
      </div>
  </div>

</nav>
        </div>
        <div id="collapseSideBar">
          <a class="btn btn-link" onclick="toggleSideBarCollapse()" title="Toggle Sidebar Collapse">
          </a>
        </div> 
        <script src="sidebartoggle.js" type="text/javascript"></script>
       
      </div>

      <div id="main" class="">
        

        

        <div class="page-header">
          <h1 class="module"><code><code><a href="ganeti.html" class="internal-link">ganeti</a></code><wbr></wbr>.<code><a href="ganeti.server.html" class="internal-link" title="ganeti.server">server</a></code><wbr></wbr>.<code><a href="ganeti.server.noded.html" class="internal-link" title="ganeti.server.noded">noded</a></code></code></h1>
          <div id="showPrivate">
            <button class="btn btn-link" onclick="togglePrivate()">Toggle Private API</button>
          </div>
        </div>

        <div class="categoryHeader">
          module documentation
        </div>

        <div class="extrasDocstring">
          
          <p></p>
        </div>

        <div class="moduleDocstring">
          <div><p>Ganeti node daemon</p>
</div>
        </div>

        <div id="splitTables">
          <table class="children sortable" id="id1264">
  
  
  <tr class="class">
    
    <td>Class</td>
    <td><code><a href="ganeti.server.noded.MlockallRequestExecutor.html" class="internal-link" title="ganeti.server.noded.MlockallRequestExecutor"><wbr></wbr>Mlockall<wbr></wbr>Request<wbr></wbr>Executor</a></code></td>
    <td>Subclass ensuring request handlers are locked in RAM.</td>
  </tr><tr class="class">
    
    <td>Class</td>
    <td><code><a href="ganeti.server.noded.NodeRequestHandler.html" class="internal-link" title="ganeti.server.noded.NodeRequestHandler"><wbr></wbr>Node<wbr></wbr>Request<wbr></wbr>Handler</a></code></td>
    <td>The server implementation.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#CheckNoded" class="internal-link" title="ganeti.server.noded.CheckNoded"><wbr></wbr>Check<wbr></wbr>Noded</a></code></td>
    <td>Initial checks whether to run or exit with a failure.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#ExecNoded" class="internal-link" title="ganeti.server.noded.ExecNoded"><wbr></wbr>Exec<wbr></wbr>Noded</a></code></td>
    <td>Main node daemon function, executed with the PID file held.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#Main" class="internal-link" title="ganeti.server.noded.Main"><wbr></wbr>Main</a></code></td>
    <td>Main function for the node daemon.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#PrepNoded" class="internal-link" title="ganeti.server.noded.PrepNoded"><wbr></wbr>Prep<wbr></wbr>Noded</a></code></td>
    <td>Preparation node daemon function, executed with the PID file held.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#SSLVerifyPeer" class="internal-link" title="ganeti.server.noded.SSLVerifyPeer"><wbr></wbr>SSLVerify<wbr></wbr>Peer</a></code></td>
    <td>Callback function to verify a peer against the candidate cert map.</td>
  </tr><tr class="variable">
    
    <td>Variable</td>
    <td><code><a href="#queue_lock" class="internal-link" title="ganeti.server.noded.queue_lock">queue<wbr></wbr>_lock</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="function private">
    
    <td>Function</td>
    <td><code><a href="#_DecodeImportExportIO" class="internal-link" title="ganeti.server.noded._DecodeImportExportIO">_<wbr></wbr>Decode<wbr></wbr>Import<wbr></wbr>Export<wbr></wbr>IO</a></code></td>
    <td>Decodes import/export I/O information.</td>
  </tr><tr class="function private">
    
    <td>Function</td>
    <td><code><a href="#_DefaultAlternative" class="internal-link" title="ganeti.server.noded._DefaultAlternative">_<wbr></wbr>Default<wbr></wbr>Alternative</a></code></td>
    <td>Returns value or, if evaluating to False, a default value.</td>
  </tr><tr class="function private">
    
    <td>Function</td>
    <td><code><a href="#_extendReasonTrail" class="internal-link" title="ganeti.server.noded._extendReasonTrail">_extend<wbr></wbr>Reason<wbr></wbr>Trail</a></code></td>
    <td>Extend the reason trail with noded information</td>
  </tr><tr class="function private">
    
    <td>Function</td>
    <td><code><a href="#_PrepareQueueLock" class="internal-link" title="ganeti.server.noded._PrepareQueueLock">_<wbr></wbr>Prepare<wbr></wbr>Queue<wbr></wbr>Lock</a></code></td>
    <td>Try to prepare the queue lock.</td>
  </tr><tr class="function private">
    
    <td>Function</td>
    <td><code><a href="#_RequireJobQueueLock" class="internal-link" title="ganeti.server.noded._RequireJobQueueLock">_<wbr></wbr>Require<wbr></wbr>Job<wbr></wbr>Queue<wbr></wbr>Lock</a></code></td>
    <td>Decorator for job queue manipulating functions.</td>
  </tr>
</table>
          

            
        </div>

        <div id="childList">
          <div class="basefunction">
  
  
  <a name="ganeti.server.noded.CheckNoded">
    
  </a>
  <a name="CheckNoded">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">CheckNoded</span>(options, args):
    
    <a class="headerLink" href="#CheckNoded" title="ganeti.server.noded.CheckNoded">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Initial checks whether to run or exit with a failure.</p>
</div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.server.noded.ExecNoded">
    
  </a>
  <a name="ExecNoded">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">ExecNoded</span>(options, args, prep_data):
    
    <a class="headerLink" href="#ExecNoded" title="ganeti.server.noded.ExecNoded">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Main node daemon function, executed with the PID file held.</p>
</div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.server.noded.Main">
    
  </a>
  <a name="Main">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">Main</span>():
    
    <a class="headerLink" href="#Main" title="ganeti.server.noded.Main">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Main function for the node daemon.</p>
</div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.server.noded.PrepNoded">
    
  </a>
  <a name="PrepNoded">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">PrepNoded</span>(options, _):
    
    <a class="headerLink" href="#PrepNoded" title="ganeti.server.noded.PrepNoded">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Preparation node daemon function, executed with the PID file held.</p>
</div>
  </div>
</div><div class="basefunction">
  
  
  <a name="ganeti.server.noded.SSLVerifyPeer">
    
  </a>
  <a name="SSLVerifyPeer">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">SSLVerifyPeer</span>(conn, cert, errnum, errdepth, ok):
    
    <a class="headerLink" href="#SSLVerifyPeer" title="ganeti.server.noded.SSLVerifyPeer">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Callback function to verify a peer against the candidate cert map.</p>
<p>Note that we have a chicken-and-egg problem during cluster init and upgrade. This method checks whether the incoming connection comes from a master candidate by comparing it to the master certificate map in the cluster configuration. However, during cluster init and cluster upgrade there are various RPC calls done to the master node itself, before the candidate certificate list is established and the cluster configuration is written. In this case, we cannot check against the master candidate map.</p>
<p>This problem is solved by checking whether the candidate map is empty. An initialized 2.11 or higher cluster has at least one entry for the master node in the candidate map. If the map is empty, we know that we are still in the bootstrap/upgrade phase. In this case, we read the server certificate digest and compare it to the incoming request.</p>
<p>This means that after an upgrade of Ganeti, the system continues to operate like before, using server certificates only. After the client certificates are generated with ``gnt-cluster renew-crypto --new-node-certificates``, RPC communication is switched to using client certificates and the trick of using server certificates does not work anymore.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">conn:</span><tt class="rst-docutils literal">OpenSSL.SSL.Connection</tt></td><td class="fieldArgDesc">the OpenSSL connection object</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">cert:</span><tt class="rst-docutils literal">OpenSSL.X509</tt></td><td class="fieldArgDesc">the peer's SSL certificate</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">errnum</span></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">errdepth:</span>integer</td><td class="fieldArgDesc">number of the step in the certificate chain starting at 0 for the actual client certificate.</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">ok</span></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr></table></div>
  </div>
</div><div class="basevariable">
  
  
  <a name="ganeti.server.noded.queue_lock">
    
  </a>
  <a name="queue_lock">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-defname">queue_lock</span> =
    
    <a class="headerLink" href="#queue_lock" title="ganeti.server.noded.queue_lock">
      
      
      ¶
    </a>
  </div>
  <div class="functionBody">
    
    <div><p class="undocumented">Undocumented</p></div>
    
  </div>
</div><div class="basefunction private">
  
  
  <a name="ganeti.server.noded._DecodeImportExportIO">
    
  </a>
  <a name="_DecodeImportExportIO">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">_DecodeImportExportIO</span>(ieio, ieioargs):
    
    <a class="headerLink" href="#_DecodeImportExportIO" title="ganeti.server.noded._DecodeImportExportIO">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Decodes import/export I/O information.</p>
</div>
  </div>
</div><div class="basefunction private">
  
  
  <a name="ganeti.server.noded._DefaultAlternative">
    
  </a>
  <a name="_DefaultAlternative">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">_DefaultAlternative</span>(value, default):
    
    <a class="headerLink" href="#_DefaultAlternative" title="ganeti.server.noded._DefaultAlternative">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Returns value or, if evaluating to False, a default value.</p>
<p>Returns the given value, unless it evaluates to False. In the latter case the default value is returned.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">value</span></td><td class="fieldArgDesc">Value to return if it doesn't evaluate to False</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">default</span></td><td class="fieldArgDesc">Default value</td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td colspan="2">Given value or the default</td></tr></table></div>
  </div>
</div><div class="basefunction private">
  
  
  <a name="ganeti.server.noded._extendReasonTrail">
    
  </a>
  <a name="_extendReasonTrail">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">_extendReasonTrail</span>(trail, source, reason=<span class="rst-variable-quote">'</span><span class="rst-variable-string"></span><span class="rst-variable-quote">'</span>):
    
    <a class="headerLink" href="#_extendReasonTrail" title="ganeti.server.noded._extendReasonTrail">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Extend the reason trail with noded information</p>
<p>The trail is extended by appending the name of the noded functionality</p>
</div>
  </div>
</div><div class="basefunction private">
  
  
  <a name="ganeti.server.noded._PrepareQueueLock">
    
  </a>
  <a name="_PrepareQueueLock">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">_PrepareQueueLock</span>():
    
    <a class="headerLink" href="#_PrepareQueueLock" title="ganeti.server.noded._PrepareQueueLock">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Try to prepare the queue lock.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td colspan="2">None for success, otherwise an exception object</td></tr></table></div>
  </div>
</div><div class="basefunction private">
  
  
  <a name="ganeti.server.noded._RequireJobQueueLock">
    
  </a>
  <a name="_RequireJobQueueLock">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">_RequireJobQueueLock</span>(fn):
    
    <a class="headerLink" href="#_RequireJobQueueLock" title="ganeti.server.noded._RequireJobQueueLock">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Decorator for job queue manipulating functions.</p>
</div>
  </div>
</div>
        </div>
      
      </div>
    </div>

    <footer class="navbar navbar-default">

  
  <div class="container">
    <a href="index.html">API Documentation</a> for ganeti/server,
  generated by <a href="https://github.com/twisted/pydoctor/">pydoctor</a>
    22.9.1 at 2024-05-06 13:21:37.
  </div>

  <!-- Search related scripts needs to be loaded at the end of HTML 
    parsing not to introduce overhead and display HTML data asap -->
  <script src="ajax.js" type="text/javascript"></script>
  <script src="searchlib.js" type="text/javascript"></script>
  <script src="search.js" type="text/javascript"></script>

</footer>
  
    <script src="pydoctor.js" type="text/javascript"></script>

  </body>
</html>