
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>gnt-filter &#8212; Ganeti 3.0.2 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="gnt-group" href="man-gnt-group.html" />
    <link rel="prev" title="gnt-debug" href="man-gnt-debug.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="man-gnt-group.html" title="gnt-group"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="man-gnt-debug.html" title="gnt-debug"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Ganeti 3.0.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="manpages.html" accesskey="U">Man pages</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">gnt-filter</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="gnt-filter">
<h1>gnt-filter<a class="headerlink" href="#gnt-filter" title="Permalink to this headline">¶</a></h1>
<div class="section" id="name">
<h2>Name<a class="headerlink" href="#name" title="Permalink to this headline">¶</a></h2>
<p>gnt-filter - Ganeti job filter rule administration</p>
</div>
<div class="section" id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<p><strong>gnt-filter</strong> {command} [options…] [arguments…]</p>
</div>
<div class="section" id="description">
<h2>DESCRIPTION<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>The <strong>gnt-filter</strong> command is used for managing job filter rules in the
Ganeti system. Filter rules are used by the Ganeti job scheduler to
determine which jobs should be accepted, rejected, paused or
rate-limited.</p>
<p>Filter rules consist of the following:</p>
<ul>
<li><p>A <code class="docutils literal notranslate"><span class="pre">UUID</span></code>, used to refer to existing filters.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">watermark</span></code>. This is the highest job id ever used, as valid in
the moment when the filter was added or replaced.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">priority</span></code>. This is a non-negative integer. Filters are processed
in order of increasing priority. While there
is a well-defined order in which rules of the same priority are
evaluated (increasing watermark, then the UUID, are taken as tie
breakers), it is not recommended to have rules of the same priority
that overlap and have different actions associated.</p></li>
<li><p>A list of <code class="docutils literal notranslate"><span class="pre">predicates</span></code> to be matched against the job.</p>
<p>A predicate is a list, with the first element being the name of the
predicate and the rest being parameters suitable for that predicate.
Most predicates take a single parameter, which is a boolean expression
formulated in the of the Ganeti query language.
The currently supported predicate names are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">jobid</span></code>. Only parameter is a boolean expression.
For this expression, there is only one field available, <code class="docutils literal notranslate"><span class="pre">id</span></code>,
which represents the id the job to be filtered.
In all value positions, the string <code class="docutils literal notranslate"><span class="pre">watermark</span></code> is replaced by
the value of the watermark of the filter rule.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">opcode</span></code>. Only parameter is a boolean expression.
For this expression, <code class="docutils literal notranslate"><span class="pre">OP_ID</span></code> and all other fields present in the
opcode are available. This predicate will hold true, if the
expression is true for at least one opcode in the job.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reason</span></code>. Only parameter is a boolean expression.
For this expression, the three fields <code class="docutils literal notranslate"><span class="pre">source</span></code>, <code class="docutils literal notranslate"><span class="pre">reason</span></code>,
<code class="docutils literal notranslate"><span class="pre">timestamp</span></code> of reason trail entries are available.
This predicate is true, if one of the entries of one of the opcodes
in this job satisfies the expression.</p></li>
</ul>
</li>
<li><p>An <code class="docutils literal notranslate"><span class="pre">action</span></code>. One of:</p>
<ul class="simple">
<li><p>ACCEPT. The job will be accepted; no further filter rules
are applied.</p></li>
<li><p>PAUSE. The job will be accepted to the queue and remain there;
however, it is not executed.
Has no effect if the job is already running.</p></li>
<li><p>REJECT. The job is rejected. If it is already in the queue,
it will be cancelled.</p></li>
<li><p>CONTINUE. The filtering continues processing with the next
rule. Such a rule will never have any direct or indirect effect,
but it can serve as documentation for a “normally present, but
currently disabled” rule.</p></li>
<li><p>RATE_LIMIT <code class="docutils literal notranslate"><span class="pre">n</span></code>, where <code class="docutils literal notranslate"><span class="pre">n</span></code> is a positive integer. The job will
be held in the queue while <code class="docutils literal notranslate"><span class="pre">n</span></code> or more jobs where this rule
applies are running. Jobs already running when this rule is added
are not changed. Logically, this rule is applied job by job
sequentially, so that the number of jobs where this rule applies
is limited to <code class="docutils literal notranslate"><span class="pre">n</span></code> once the jobs running at rule addition have
finished.</p></li>
</ul>
</li>
<li><p>A reason trail, in the same format as reason trails for job opcodes
(see the <code class="docutils literal notranslate"><span class="pre">--reason</span></code> option in <strong>ganeti</strong>(7)).
This allows to find out which maintenance (or other reason) caused
the addition of this filter rule.</p></li>
</ul>
</div>
<div class="section" id="commands">
<h2>COMMANDS<a class="headerlink" href="#commands" title="Permalink to this headline">¶</a></h2>
<div class="section" id="add">
<h3>ADD<a class="headerlink" href="#add" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><strong>add</strong></div>
<div class="line">[--priority=*priority*]</div>
<div class="line">[--predicates=*predicates*]</div>
<div class="line">[--action=*action*]</div>
</div>
<p>Creates a new filter rule. A UUID is automatically assigned.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--priority</span></code> option sets the priority of the filter.
It is a non-negative integer.
Default: 0 (the highest possible priority).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--predicates</span></code> option sets the predicates of the filter.
It is a list of predicates in the format described in the
<strong>DESCRIPTION</strong> above.
Default: [] (no predicate, filter always matches).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--action</span></code> option sets the action of the filter.
It is one of the strings <code class="docutils literal notranslate"><span class="pre">ACCEPT</span></code>, <code class="docutils literal notranslate"><span class="pre">PAUSE</span></code>, <code class="docutils literal notranslate"><span class="pre">REJECT</span></code>,
<code class="docutils literal notranslate"><span class="pre">CONTINUE</span></code>, or <code class="docutils literal notranslate"><span class="pre">RATE_LIMIT</span> <span class="pre">n</span></code> (see the <strong>DESCRIPTION</strong> above).
Default: <code class="docutils literal notranslate"><span class="pre">CONTINUE</span></code>.</p>
<p>See <strong>ganeti</strong>(7) for a description of <code class="docutils literal notranslate"><span class="pre">--reason</span></code> and other common
options.</p>
</div>
<div class="section" id="replace">
<h3>REPLACE<a class="headerlink" href="#replace" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><strong>replace</strong></div>
<div class="line">[--priority=*priority*]</div>
<div class="line">[--predicates=*predicates*]</div>
<div class="line">[--action=*action*]</div>
<div class="line">[--reason=*reason*]</div>
<div class="line">{<em>filter-uuid</em>}</div>
</div>
<p>Replaces a filter rule, or creates one if it doesn’t already exist.</p>
<p>Accepts all options described above in <code class="docutils literal notranslate"><span class="pre">ADD</span></code>.</p>
<p>When being replaced, the filter will be assigned an updated watermark.</p>
<p>See <strong>ganeti</strong>(7) for a description of <code class="docutils literal notranslate"><span class="pre">--reason</span></code> and other common
options.</p>
</div>
<div class="section" id="delete">
<h3>DELETE<a class="headerlink" href="#delete" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><strong>delete</strong> {<em>filter-uuid</em>}</div>
</div>
<p>Deletes the indicated filter rule.</p>
</div>
<div class="section" id="list">
<h3>LIST<a class="headerlink" href="#list" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><strong>list</strong> [--no-headers] [--separator=*separator*] [-v]</div>
<div class="line">[-o <em>[+]field,…</em>] [filter-uuid…]</div>
</div>
<p>Lists all existing filters in the cluster. If no filter UUIDs are given,
then all filters are included. Otherwise, only the given filters will be
listed.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--no-headers</span></code> option will skip the initial header line. The
<code class="docutils literal notranslate"><span class="pre">--separator</span></code> option takes an argument which denotes what will be used
between the output fields. Both these options are to help scripting.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-v</span></code> option activates verbose mode, which changes the display of
special field states (see <strong>ganeti</strong>(7)).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-o</span></code> option takes a comma-separated list of output fields. If the
value of the option starts with the character <code class="docutils literal notranslate"><span class="pre">+</span></code>, the new fields will
be added to the default list. This allows to quickly see the default
list plus a few other fields, instead of retyping the entire list of
fields.</p>
<p>The available fields and their meaning are:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">action</span></code></dt><dd><p>Action</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">predicates</span></code></dt><dd><p>Predicates</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">priority</span></code></dt><dd><p>Priority</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reason_trail</span></code></dt><dd><p>Reason trail</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uuid</span></code></dt><dd><p>Network UUID</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">watermark</span></code></dt><dd><p>Watermark</p>
</dd>
</dl>
</div>
<div class="section" id="list-fields">
<h3>LIST-FIELDS<a class="headerlink" href="#list-fields" title="Permalink to this headline">¶</a></h3>
<p><strong>list-fields</strong> [field…]</p>
<p>List available fields for filters.</p>
</div>
<div class="section" id="info">
<h3>INFO<a class="headerlink" href="#info" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><strong>info</strong> [filter-uuid…]</div>
</div>
<p>Displays information about a given filter.</p>
</div>
</div>
<div class="section" id="examples">
<h2>EXAMPLES<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>Draining the queue.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gnt</span><span class="o">-</span><span class="nb">filter</span> <span class="n">add</span> <span class="s1">&#39;--predicates=[[&quot;jobid&quot;, [&quot;&gt;&quot;, &quot;id&quot;, &quot;watermark&quot;]]]&#39;</span> <span class="o">--</span><span class="n">action</span><span class="o">=</span><span class="n">REJECT</span>
</pre></div>
</div>
<p>Soft draining could be achieved by replacing <code class="docutils literal notranslate"><span class="pre">REJECT</span></code> by <code class="docutils literal notranslate"><span class="pre">PAUSE</span></code> in
the above example.</p>
<p>Pausing all new jobs not belonging to a specific maintenance.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gnt</span><span class="o">-</span><span class="nb">filter</span> <span class="n">add</span> <span class="o">--</span><span class="n">priority</span><span class="o">=</span><span class="mi">0</span> <span class="s1">&#39;--predicates=[[&quot;reason&quot;, [&quot;=~&quot;, &quot;reason&quot;, &quot;maintenance pink bunny&quot;]]]&#39;</span> <span class="o">--</span><span class="n">action</span><span class="o">=</span><span class="n">ACCEPT</span>
<span class="n">gnt</span><span class="o">-</span><span class="nb">filter</span> <span class="n">add</span> <span class="o">--</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span> <span class="s1">&#39;--predicates=[[&quot;jobid&quot;, [&quot;&gt;&quot;, &quot;id&quot;, &quot;watermark&quot;]]]&#39;</span> <span class="o">--</span><span class="n">action</span><span class="o">=</span><span class="n">PAUSE</span>
</pre></div>
</div>
<p>Cancelling all queued instance creations and disallowing new such jobs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gnt</span><span class="o">-</span><span class="nb">filter</span> <span class="n">add</span> <span class="s1">&#39;--predicates=[[&quot;opcode&quot;, [&quot;=&quot;, &quot;OP_ID&quot;, &quot;OP_INSTANCE_CREATE&quot;]]]&#39;</span> <span class="o">--</span><span class="n">action</span><span class="o">=</span><span class="n">REJECT</span>
</pre></div>
</div>
<p>Limiting the number of simultaneous instance disk replacements to 10 in
order to throttle replication traffic.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gnt</span><span class="o">-</span><span class="nb">filter</span> <span class="n">add</span> <span class="s1">&#39;--predicates=[[&quot;opcode&quot;, [&quot;=&quot;, &quot;OP_ID&quot;, &quot;OP_INSTANCE_REPLACE_DISKS&quot;]]]&#39;</span> <span class="s1">&#39;--action=RATE_LIMIT 10&#39;</span>
</pre></div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">gnt-filter</a><ul>
<li><a class="reference internal" href="#name">Name</a></li>
<li><a class="reference internal" href="#synopsis">Synopsis</a></li>
<li><a class="reference internal" href="#description">DESCRIPTION</a></li>
<li><a class="reference internal" href="#commands">COMMANDS</a><ul>
<li><a class="reference internal" href="#add">ADD</a></li>
<li><a class="reference internal" href="#replace">REPLACE</a></li>
<li><a class="reference internal" href="#delete">DELETE</a></li>
<li><a class="reference internal" href="#list">LIST</a></li>
<li><a class="reference internal" href="#list-fields">LIST-FIELDS</a></li>
<li><a class="reference internal" href="#info">INFO</a></li>
</ul>
</li>
<li><a class="reference internal" href="#examples">EXAMPLES</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="man-gnt-debug.html"
                        title="previous chapter">gnt-debug</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="man-gnt-group.html"
                        title="next chapter">gnt-group</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/man-gnt-filter.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="man-gnt-group.html" title="gnt-group"
             >next</a></li>
        <li class="right" >
          <a href="man-gnt-debug.html" title="gnt-debug"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Ganeti 3.0.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="manpages.html" >Man pages</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">gnt-filter</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015 Google Inc..
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.4.3.
    </div>
  </body>
</html>