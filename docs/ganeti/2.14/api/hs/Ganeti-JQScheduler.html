<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ganeti.JQScheduler</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Ganeti-JQScheduler.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="Ganeti/JQScheduler.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ganeti</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Infered</td></tr></table><p class="caption">Ganeti.JQScheduler</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Implementation of a reader for the job queue.
</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span>  <a href="#t:JQStatus">JQStatus</a>  = <a href="#v:JQStatus">JQStatus</a> {<ul class="subs"><li><a href="#v:jqJobs">jqJobs</a> :: IORef <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a></li><li><a href="#v:jqConfig">jqConfig</a> :: IORef (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a>)</li><li><a href="#v:jqLivelock">jqLivelock</a> :: <a href="Ganeti-Utils-Livelock.html#t:Livelock">Livelock</a></li><li><a href="#v:jqForkLock">jqForkLock</a> :: <a href="Ganeti-Utils-MVarLock.html#t:Lock">Lock</a></li></ul>}</li><li class="src short"><a href="#v:emptyJQStatus">emptyJQStatus</a> :: IORef (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a>) -&gt; IO <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a></li><li class="src short"><a href="#v:onRunningJobs">onRunningJobs</a> :: ([<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>] -&gt; [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>]) -&gt; <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a></li><li class="src short"><a href="#v:onQueuedJobs">onQueuedJobs</a> :: ([<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>] -&gt; [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>]) -&gt; <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a></li><li class="src short"><a href="#v:unreadJob">unreadJob</a> :: <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a></li><li class="src short"><a href="#v:watchInterval">watchInterval</a> :: Int</li><li class="src short"><a href="#v:getConfigValue">getConfigValue</a> ::  (<a href="Ganeti-Objects.html#t:Cluster">Cluster</a> -&gt; a) -&gt; a -&gt; <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; IO a</li><li class="src short"><a href="#v:getMaxRunningJobs">getMaxRunningJobs</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; IO Int</li><li class="src short"><a href="#v:getMaxTrackedJobs">getMaxTrackedJobs</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; IO Int</li><li class="src short"><a href="#v:getRQL">getRQL</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; IO Int</li><li class="src short"><a href="#v:modifyJobs">modifyJobs</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; (<a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a>) -&gt; IO ()</li><li class="src short"><a href="#v:readJobStatus">readJobStatus</a> :: <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a> -&gt; IO (Maybe <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>)</li><li class="src short"><a href="#v:updateJobStatus">updateJobStatus</a> :: <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a> -&gt; [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>] -&gt; [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>]</li><li class="src short"><a href="#v:updateJob">updateJob</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a> -&gt; IO ()</li><li class="src short"><a href="#v:moveJob">moveJob</a> :: Lens' <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>] -&gt; Lens' <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>] -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> -&gt; (<a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a>, Maybe <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>)</li><li class="src short"><a href="#v:moveJobAtomic">moveJobAtomic</a> :: Lens' <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>] -&gt; Lens' <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>] -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; IO (Maybe <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>)</li><li class="src short"><a href="#v:manipulateRunningJob">manipulateRunningJob</a> ::  <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; IO a -&gt; IO (Maybe a)</li><li class="src short"><a href="#v:sortoutFinishedJobs">sortoutFinishedJobs</a> :: <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> -&gt; (<a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a>, [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>])</li><li class="src short"><a href="#v:cleanupFinishedJobs">cleanupFinishedJobs</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; IO ()</li><li class="src short"><a href="#v:jobWatcher">jobWatcher</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a> -&gt; Event -&gt; IO ()</li><li class="src short"><a href="#v:attachWatcher">attachWatcher</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a> -&gt; IO ()</li><li class="src short"><a href="#v:jobEligible">jobEligible</a> :: <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a> -&gt; Bool</li><li class="src short"><a href="#v:selectJobsToRun">selectJobsToRun</a> :: Int -&gt; Set <a href="Ganeti-Objects.html#t:FilterRule">FilterRule</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> -&gt; (<a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a>, [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>])</li><li class="src short"><a href="#v:logFailedJobs">logFailedJobs</a> :: <a href="Ganeti-Logging.html#t:MonadLog">MonadLog</a> m =&gt; [(<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>, <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a>)] -&gt; m (Set <a href="Ganeti-Types.html#t:JobId">JobId</a>)</li><li class="src short"><a href="#v:failJobs">failJobs</a> :: <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; [(<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>, <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a>)] -&gt; IO ()</li><li class="src short"><a href="#v:cancelRejectedJobs">cancelRejectedJobs</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; Set <a href="Ganeti-Objects.html#t:FilterRule">FilterRule</a> -&gt; IO ()</li><li class="src short"><a href="#v:scheduleSomeJobs">scheduleSomeJobs</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; IO ()</li><li class="src short"><a href="#v:showQueue">showQueue</a> :: <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> -&gt; String</li><li class="src short"><a href="#v:checkForDeath">checkForDeath</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a> -&gt; IO Bool</li><li class="src short"><a href="#v:cleanupIfDead">cleanupIfDead</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; IO Bool</li><li class="src short"><a href="#v:onTimeWatcher">onTimeWatcher</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; IO ()</li><li class="src short"><a href="#v:readJobFromDisk">readJobFromDisk</a> :: <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>)</li><li class="src short"><a href="#v:readJobsFromDisk">readJobsFromDisk</a> :: IO [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>]</li><li class="src short"><a href="#v:initJQScheduler">initJQScheduler</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; IO ()</li><li class="src short"><a href="#v:enqueueNewJobs">enqueueNewJobs</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; [<a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a>] -&gt; IO ()</li><li class="src short"><a href="#v:rmJob">rmJob</a> :: <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> -&gt; (<a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a>, <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (Maybe <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a>))</li><li class="src short"><a href="#v:dequeueJob">dequeueJob</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> Bool)</li><li class="src short"><a href="#v:setJobPriority">setJobPriority</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; Int -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> (Maybe <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a>))</li><li class="src short"><a href="#v:configChangeNeedsRescheduling">configChangeNeedsRescheduling</a> :: <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; Bool</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:JQStatus" class="def">JQStatus</a>  <a href="Ganeti/JQScheduler.html#JQStatus" class="link">Source</a></p><div class="doc"><p>Representation of the job queue
</p><p>We keep two lists of jobs (together with information about the last
fstat result observed): the jobs that are enqueued, but not yet handed
over for execution, and the jobs already handed over for execution. They
are kept together in a single IORef, so that we can atomically update
both, in particular when scheduling jobs to be handed over for execution.
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:JQStatus" class="def">JQStatus</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:jqJobs" class="def">jqJobs</a> :: IORef <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:jqConfig" class="def">jqConfig</a> :: IORef (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a>)</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:jqLivelock" class="def">jqLivelock</a> :: <a href="Ganeti-Utils-Livelock.html#t:Livelock">Livelock</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:jqForkLock" class="def">jqForkLock</a> :: <a href="Ganeti-Utils-MVarLock.html#t:Lock">Lock</a></dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div></div><div class="top"><p class="src"><a name="v:emptyJQStatus" class="def">emptyJQStatus</a> :: IORef (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a>) -&gt; IO <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a><a href="Ganeti/JQScheduler.html#emptyJQStatus" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:onRunningJobs" class="def">onRunningJobs</a> :: ([<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>] -&gt; [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>]) -&gt; <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a><a href="Ganeti/JQScheduler.html#onRunningJobs" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:onQueuedJobs" class="def">onQueuedJobs</a> :: ([<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>] -&gt; [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>]) -&gt; <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a><a href="Ganeti/JQScheduler.html#onQueuedJobs" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:unreadJob" class="def">unreadJob</a> :: <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a><a href="Ganeti/JQScheduler.html#unreadJob" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:watchInterval" class="def">watchInterval</a> :: Int<a href="Ganeti/JQScheduler.html#watchInterval" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:getConfigValue" class="def">getConfigValue</a> ::  (<a href="Ganeti-Objects.html#t:Cluster">Cluster</a> -&gt; a) -&gt; a -&gt; <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; IO a<a href="Ganeti/JQScheduler.html#getConfigValue" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:getMaxRunningJobs" class="def">getMaxRunningJobs</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; IO Int<a href="Ganeti/JQScheduler.html#getMaxRunningJobs" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:getMaxTrackedJobs" class="def">getMaxTrackedJobs</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; IO Int<a href="Ganeti/JQScheduler.html#getMaxTrackedJobs" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:getRQL" class="def">getRQL</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; IO Int<a href="Ganeti/JQScheduler.html#getRQL" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:modifyJobs" class="def">modifyJobs</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; (<a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a>) -&gt; IO ()<a href="Ganeti/JQScheduler.html#modifyJobs" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:readJobStatus" class="def">readJobStatus</a> :: <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a> -&gt; IO (Maybe <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>)<a href="Ganeti/JQScheduler.html#readJobStatus" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:updateJobStatus" class="def">updateJobStatus</a> :: <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a> -&gt; [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>] -&gt; [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>]<a href="Ganeti/JQScheduler.html#updateJobStatus" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:updateJob" class="def">updateJob</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a> -&gt; IO ()<a href="Ganeti/JQScheduler.html#updateJob" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:moveJob" class="def">moveJob</a> :: Lens' <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>] -&gt; Lens' <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>] -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> -&gt; (<a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a>, Maybe <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>)<a href="Ganeti/JQScheduler.html#moveJob" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:moveJobAtomic" class="def">moveJobAtomic</a> :: Lens' <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>] -&gt; Lens' <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>] -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; IO (Maybe <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>)<a href="Ganeti/JQScheduler.html#moveJobAtomic" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:manipulateRunningJob" class="def">manipulateRunningJob</a> ::  <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; IO a -&gt; IO (Maybe a)<a href="Ganeti/JQScheduler.html#manipulateRunningJob" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:sortoutFinishedJobs" class="def">sortoutFinishedJobs</a> :: <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> -&gt; (<a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a>, [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>])<a href="Ganeti/JQScheduler.html#sortoutFinishedJobs" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:cleanupFinishedJobs" class="def">cleanupFinishedJobs</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; IO ()<a href="Ganeti/JQScheduler.html#cleanupFinishedJobs" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:jobWatcher" class="def">jobWatcher</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a> -&gt; Event -&gt; IO ()<a href="Ganeti/JQScheduler.html#jobWatcher" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:attachWatcher" class="def">attachWatcher</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a> -&gt; IO ()<a href="Ganeti/JQScheduler.html#attachWatcher" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:jobEligible" class="def">jobEligible</a> :: <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a> -&gt; Bool<a href="Ganeti/JQScheduler.html#jobEligible" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:selectJobsToRun" class="def">selectJobsToRun</a><a href="Ganeti/JQScheduler.html#selectJobsToRun" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: Int</td><td class="doc"><p>How many jobs are allowed to run at the
 same time.
</p></td></tr><tr><td class="src">-&gt; Set <a href="Ganeti-Objects.html#t:FilterRule">FilterRule</a></td><td class="doc"><p>Filter rules to respect for scheduling
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; (<a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a>, [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>])</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Decide on which jobs to schedule next for execution. This is the
 pure function doing the scheduling.
</p></div></div><div class="top"><p class="src"><a name="v:logFailedJobs" class="def">logFailedJobs</a> :: <a href="Ganeti-Logging.html#t:MonadLog">MonadLog</a> m =&gt; [(<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>, <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a>)] -&gt; m (Set <a href="Ganeti-Types.html#t:JobId">JobId</a>)<a href="Ganeti/JQScheduler.html#logFailedJobs" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:failJobs" class="def">failJobs</a> :: <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; [(<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>, <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a>)] -&gt; IO ()<a href="Ganeti/JQScheduler.html#failJobs" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:cancelRejectedJobs" class="def">cancelRejectedJobs</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; Set <a href="Ganeti-Objects.html#t:FilterRule">FilterRule</a> -&gt; IO ()<a href="Ganeti/JQScheduler.html#cancelRejectedJobs" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:scheduleSomeJobs" class="def">scheduleSomeJobs</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; IO ()<a href="Ganeti/JQScheduler.html#scheduleSomeJobs" class="link">Source</a></p><div class="doc"><p>Schedule jobs to be run. This is the IO wrapper around the
 pure <code><a href="Ganeti-JQScheduler.html#v:selectJobsToRun">selectJobsToRun</a></code>.
</p></div></div><div class="top"><p class="src"><a name="v:showQueue" class="def">showQueue</a> :: <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> -&gt; String<a href="Ganeti/JQScheduler.html#showQueue" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:checkForDeath" class="def">checkForDeath</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a> -&gt; IO Bool<a href="Ganeti/JQScheduler.html#checkForDeath" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:cleanupIfDead" class="def">cleanupIfDead</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; IO Bool<a href="Ganeti/JQScheduler.html#cleanupIfDead" class="link">Source</a></p><div class="doc"><p>Trigger job detection for the job with the given job id.
 Return True, if the job is dead.
</p></div></div><div class="top"><p class="src"><a name="v:onTimeWatcher" class="def">onTimeWatcher</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; IO ()<a href="Ganeti/JQScheduler.html#onTimeWatcher" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:readJobFromDisk" class="def">readJobFromDisk</a> :: <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>)<a href="Ganeti/JQScheduler.html#readJobFromDisk" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:readJobsFromDisk" class="def">readJobsFromDisk</a> :: IO [<a href="Ganeti-JQScheduler-Types.html#t:JobWithStat">JobWithStat</a>]<a href="Ganeti/JQScheduler.html#readJobsFromDisk" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:initJQScheduler" class="def">initJQScheduler</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; IO ()<a href="Ganeti/JQScheduler.html#initJQScheduler" class="link">Source</a></p><div class="doc"><p>Set up the job scheduler. This will also start the monitoring
 of changes to the running jobs.
</p></div></div><div class="top"><p class="src"><a name="v:enqueueNewJobs" class="def">enqueueNewJobs</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; [<a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a>] -&gt; IO ()<a href="Ganeti/JQScheduler.html#enqueueNewJobs" class="link">Source</a></p><div class="doc"><p>Enqueue new jobs. This will guarantee that the jobs will be executed
 eventually.
</p></div></div><div class="top"><p class="src"><a name="v:rmJob" class="def">rmJob</a> :: <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; <a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a> -&gt; (<a href="Ganeti-JQScheduler-Types.html#t:Queue">Queue</a>, <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (Maybe <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a>))<a href="Ganeti/JQScheduler.html#rmJob" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:dequeueJob" class="def">dequeueJob</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> Bool)<a href="Ganeti/JQScheduler.html#dequeueJob" class="link">Source</a></p><div class="doc"><p>Try to remove a queued job from the job queue. Return True, if
 the job could be removed from the queue before being handed over
 to execution, False if the job already started, and a Bad result
 if the job is unknown.
</p></div></div><div class="top"><p class="src"><a name="v:setJobPriority" class="def">setJobPriority</a> :: <a href="Ganeti-JQScheduler.html#t:JQStatus">JQStatus</a> -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; Int -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> (Maybe <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a>))<a href="Ganeti/JQScheduler.html#setJobPriority" class="link">Source</a></p><div class="doc"><p>Change the priority of a queued job (once the job is handed over
 to execution, the job itself needs to be informed). To avoid the
 job being started unmodified, it is temporarily unqueued during the
 change. Return the modified job, if the job's priority was sucessfully
 modified, Nothing, if the job already started, and a Bad value, if the job
 is unkown.
</p></div></div><div class="top"><p class="src"><a name="v:configChangeNeedsRescheduling" class="def">configChangeNeedsRescheduling</a> :: <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; Bool<a href="Ganeti/JQScheduler.html#configChangeNeedsRescheduling" class="link">Source</a></p><div class="doc"><p>Given old and new configs, determines if the changes between them should
 trigger the scheduler to run.
</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.10.0</p></div></body></html>