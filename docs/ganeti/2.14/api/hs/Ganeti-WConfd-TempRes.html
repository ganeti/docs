<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ganeti.WConfd.TempRes</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Ganeti-WConfd-TempRes.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="Ganeti/WConfd/TempRes.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ganeti</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Ganeti.WConfd.TempRes</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">The main reservation state
</a><ul><li><a href="#g:2">Aliases to make types more meaningful:
</a></li></ul></li><li><a href="#g:3">The state data structure
</a><ul><li><a href="#g:4">Utility functions
</a></li></ul></li><li><a href="#g:5">DRBD functions
</a></li><li><a href="#g:6">Other temporary resources
</a><ul><li><a href="#g:7">Functions common to all reservations
</a></li><li><a href="#g:8">IDs
</a></li><li><a href="#g:9">MAC addresses
</a></li><li><a href="#g:10">DRBD secrets
</a></li><li><a href="#g:11">LVs
</a></li><li><a href="#g:12">IPv4 addresses
</a></li></ul></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Pure functions for manipulating reservations of temporary objects
</p><p>NOTE: Reservations aren't released specifically, they're just all
released at the end of a job. This could be improved in the future.
</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">type</span> <a href="#t:NodeUUID">NodeUUID</a> = String</li><li class="src short"><span class="keyword">type</span> <a href="#t:InstanceUUID">InstanceUUID</a> = String</li><li class="src short"><span class="keyword">type</span> <a href="#t:DiskUUID">DiskUUID</a> = String</li><li class="src short"><span class="keyword">type</span> <a href="#t:NetworkUUID">NetworkUUID</a> = String</li><li class="src short"><span class="keyword">type</span> <a href="#t:DRBDMinor">DRBDMinor</a> = Int</li><li class="src short"><span class="keyword">type</span> <a href="#t:DRBDMap">DRBDMap</a> = Map <a href="Ganeti-WConfd-TempRes.html#t:NodeUUID">NodeUUID</a> (Map <a href="Ganeti-WConfd-TempRes.html#t:DRBDMinor">DRBDMinor</a> <a href="Ganeti-WConfd-TempRes.html#t:DiskUUID">DiskUUID</a>)</li><li class="src short"><span class="keyword">type</span> <a href="#t:DRBDMap-39-">DRBDMap'</a> = Map <a href="Ganeti-WConfd-TempRes.html#t:NodeUUID">NodeUUID</a> (Map <a href="Ganeti-WConfd-TempRes.html#t:DRBDMinor">DRBDMinor</a> [<a href="Ganeti-WConfd-TempRes.html#t:DiskUUID">DiskUUID</a>])</li><li class="src short"><span class="keyword">data</span>  <a href="#t:IPv4ResAction">IPv4ResAction</a> <ul class="subs"><li>= <a href="#v:IPv4Reserve">IPv4Reserve</a>  </li><li>| <a href="#v:IPv4Release">IPv4Release</a>  </li></ul></li><li class="src short"><span class="keyword">data</span>  <a href="#t:IPv4Reservation">IPv4Reservation</a>  = <a href="#v:IPv4Res">IPv4Res</a> {<ul class="subs"><li><a href="#v:ipv4ResAction">ipv4ResAction</a> :: <a href="Ganeti-WConfd-TempRes.html#t:IPv4ResAction">IPv4ResAction</a></li><li><a href="#v:ipv4ResNetwork">ipv4ResNetwork</a> :: <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a></li><li><a href="#v:ipv4ResAddr">ipv4ResAddr</a> :: <a href="Ganeti-Objects.html#t:Ip4Address">Ip4Address</a></li></ul>}</li><li class="src short"><span class="keyword">newtype</span>  <a href="#t:TempRes">TempRes</a> j a = <a href="#v:TempRes">TempRes</a> {<ul class="subs"><li><a href="#v:getTempRes">getTempRes</a> :: <a href="Ganeti-Utils-MultiMap.html#t:MultiMap">MultiMap</a> j a</li></ul>}</li><li class="src short"><a href="#v:mkTempRes">mkTempRes</a> ::  <a href="Ganeti-Utils-MultiMap.html#t:MultiMap">MultiMap</a> j a -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a</li><li class="src short"><span class="keyword">data</span>  <a href="#t:TempResState">TempResState</a>  = <a href="#v:TempResState">TempResState</a> {<ul class="subs"><li><a href="#v:trsDRBD">trsDRBD</a> :: <a href="Ganeti-WConfd-TempRes.html#t:DRBDMap">DRBDMap</a></li><li><a href="#v:trsMACs">trsMACs</a> :: <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> <a href="Ganeti-Config.html#t:MAC">MAC</a></li><li><a href="#v:trsDRBDSecrets">trsDRBDSecrets</a> :: <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> <a href="Ganeti-Objects-Disk.html#t:DRBDSecret">DRBDSecret</a></li><li><a href="#v:trsLVs">trsLVs</a> :: <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> <a href="Ganeti-Objects-Disk.html#t:LogicalVolume">LogicalVolume</a></li><li><a href="#v:trsIPv4s">trsIPv4s</a> :: <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> <a href="Ganeti-WConfd-TempRes.html#t:IPv4Reservation">IPv4Reservation</a></li></ul>}</li><li class="src short"><a href="#v:loadTempResState">loadTempResState</a> :: JSValue -&gt; Result <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a></li><li class="src short"><a href="#v:saveTempResState">saveTempResState</a> :: <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> -&gt; JSValue</li><li class="src short"><a href="#v:emptyTempResState">emptyTempResState</a> :: <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a></li><li class="src short"><a href="#v:trsMACsL">trsMACsL</a> :: Lens' <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> (<a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> <a href="Ganeti-Config.html#t:MAC">MAC</a>)</li><li class="src short"><a href="#v:trsLVsL">trsLVsL</a> :: Lens' <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> (<a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> <a href="Ganeti-Objects-Disk.html#t:LogicalVolume">LogicalVolume</a>)</li><li class="src short"><a href="#v:trsIPv4sL">trsIPv4sL</a> :: Lens' <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> (<a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> <a href="Ganeti-WConfd-TempRes.html#t:IPv4Reservation">IPv4Reservation</a>)</li><li class="src short"><a href="#v:trsDRBDSecretsL">trsDRBDSecretsL</a> :: Lens' <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> (<a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> <a href="Ganeti-Objects-Disk.html#t:DRBDSecret">DRBDSecret</a>)</li><li class="src short"><a href="#v:trsDRBDL">trsDRBDL</a> :: Lens' <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> <a href="Ganeti-WConfd-TempRes.html#t:DRBDMap">DRBDMap</a></li><li class="src short"><a href="#v:resError">resError</a> :: MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m =&gt; String -&gt; m a</li><li class="src short"><a href="#v:toResError">toResError</a> :: MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m =&gt; m a -&gt; m a</li><li class="src short"><a href="#v:filterNested">filterNested</a> :: (Ord a, Ord b) =&gt; (c -&gt; Bool) -&gt; Map a (Map b c) -&gt; Map a (Map b c)</li><li class="src short"><a href="#v:maybeLens">maybeLens</a> :: (Monoid a, Monoid b, Eq b) =&gt; Lens s t (Maybe a) (Maybe b) -&gt; Lens s t a b</li><li class="src short"><a href="#v:computeDRBDMap-39-">computeDRBDMap'</a> :: MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m =&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> -&gt; m <a href="Ganeti-WConfd-TempRes.html#t:DRBDMap-39-">DRBDMap'</a></li><li class="src short"><a href="#v:computeDRBDMap">computeDRBDMap</a> :: MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m =&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> -&gt; m <a href="Ganeti-WConfd-TempRes.html#t:DRBDMap">DRBDMap</a></li><li class="src short"><a href="#v:allocateDRBDMinor">allocateDRBDMinor</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, MonadState <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> m) =&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:DiskUUID">DiskUUID</a> -&gt; [<a href="Ganeti-WConfd-TempRes.html#t:NodeUUID">NodeUUID</a>] -&gt; m [<a href="Ganeti-WConfd-TempRes.html#t:DRBDMinor">DRBDMinor</a>]</li><li class="src short"><a href="#v:releaseDRBDMinors">releaseDRBDMinors</a> :: MonadState <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> m =&gt; <a href="Ganeti-WConfd-TempRes.html#t:DiskUUID">DiskUUID</a> -&gt; m ()</li><li class="src short"><a href="#v:isReserved">isReserved</a> :: (Ord a, Ord j) =&gt; a -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a -&gt; Bool</li><li class="src short"><a href="#v:reserve">reserve</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, Show a, Ord a, Ord j) =&gt; j -&gt; a -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a -&gt; m (<a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a)</li><li class="src short"><a href="#v:dropReservationsFor">dropReservationsFor</a> :: (Ord a, Ord j) =&gt; j -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a</li><li class="src short"><a href="#v:reservedFor">reservedFor</a> :: (Ord a, Ord j) =&gt; j -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a -&gt; Set a</li><li class="src short"><a href="#v:reserved">reserved</a> :: (Ord a, Ord j) =&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a -&gt; Set a</li><li class="src short"><a href="#v:withReserved">withReserved</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, Show a, Ord a, Ord j) =&gt; j -&gt; (Set a -&gt; m a) -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a -&gt; m (a, <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a)</li><li class="src short"><a href="#v:generate">generate</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, Show a, Ord a, Ord j) =&gt; j -&gt; Set a -&gt; m (Maybe a) -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a -&gt; m (a, <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a)</li><li class="src short"><a href="#v:generateRand">generateRand</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, Show a, Ord a, Ord j, RandomGen g) =&gt; g -&gt; j -&gt; Set a -&gt; (g -&gt; (Maybe a, g)) -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a -&gt; m (a, <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a)</li><li class="src short"><a href="#v:stateM">stateM</a> :: MonadState s m =&gt; (s -&gt; m (a, s)) -&gt; m a</li><li class="src short"><a href="#v:modifyM">modifyM</a> :: MonadState s m =&gt; (s -&gt; m s) -&gt; m ()</li><li class="src short"><a href="#v:dropAllReservations">dropAllReservations</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; State <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> ()</li><li class="src short"><a href="#v:lookupNetwork">lookupNetwork</a> :: MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m =&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; m <a href="Ganeti-Objects.html#t:Network">Network</a></li><li class="src short"><a href="#v:generateMAC">generateMAC</a> :: (RandomGen g, MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, Functor m) =&gt; g -&gt; <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; Maybe <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; StateT <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> m <a href="Ganeti-Config.html#t:MAC">MAC</a></li><li class="src short"><a href="#v:reserveMAC">reserveMAC</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, MonadState <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> m, Functor m) =&gt; <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-Config.html#t:MAC">MAC</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; m ()</li><li class="src short"><a href="#v:generateDRBDSecret">generateDRBDSecret</a> :: (RandomGen g, MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, Functor m) =&gt; g -&gt; <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; StateT <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> m <a href="Ganeti-Objects-Disk.html#t:DRBDSecret">DRBDSecret</a></li><li class="src short"><a href="#v:reserveLV">reserveLV</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, MonadState <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> m, Functor m) =&gt; <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-Objects-Disk.html#t:LogicalVolume">LogicalVolume</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; m ()</li><li class="src short"><a href="#v:usedIPv4Addrs">usedIPv4Addrs</a> :: <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; Set <a href="Ganeti-WConfd-TempRes.html#t:IPv4Reservation">IPv4Reservation</a> -&gt; Set <a href="Ganeti-Objects.html#t:Ip4Address">Ip4Address</a></li><li class="src short"><a href="#v:reserveIp">reserveIp</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, MonadState <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> m, Functor m) =&gt; <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; <a href="Ganeti-Objects.html#t:Ip4Address">Ip4Address</a> -&gt; Bool -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; m ()</li><li class="src short"><a href="#v:releaseIp">releaseIp</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, MonadState <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> m, Functor m) =&gt; <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; <a href="Ganeti-Objects.html#t:Ip4Address">Ip4Address</a> -&gt; m ()</li><li class="src short"><a href="#v:generateIp">generateIp</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, MonadState <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> m, Functor m) =&gt; <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; m <a href="Ganeti-Objects.html#t:Ip4Address">Ip4Address</a></li><li class="src short"><a href="#v:commitIp">commitIp</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, Functor m) =&gt; <a href="Ganeti-WConfd-TempRes.html#t:IPv4Reservation">IPv4Reservation</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; m <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a></li><li class="src short"><a href="#v:commitReleaseIp">commitReleaseIp</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, Functor m) =&gt; <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; <a href="Ganeti-Objects.html#t:Ip4Address">Ip4Address</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; m <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a></li><li class="src short"><a href="#v:commitReservedIps">commitReservedIps</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, Functor m, <a href="Ganeti-Logging.html#t:MonadLog">MonadLog</a> m) =&gt; <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; m <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a></li><li class="src short"><a href="#v:listReservedIps">listReservedIps</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> -&gt; Set <a href="Ganeti-WConfd-TempRes.html#t:IPv4Reservation">IPv4Reservation</a></li></ul></div><div id="interface"><h1 id="g:1">The main reservation state
</h1><h2 id="g:2">Aliases to make types more meaningful:
</h2><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:NodeUUID" class="def">NodeUUID</a> = String<a href="Ganeti/WConfd/TempRes.html#NodeUUID" class="link">Source</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:InstanceUUID" class="def">InstanceUUID</a> = String<a href="Ganeti/WConfd/TempRes.html#InstanceUUID" class="link">Source</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:DiskUUID" class="def">DiskUUID</a> = String<a href="Ganeti/WConfd/TempRes.html#DiskUUID" class="link">Source</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:NetworkUUID" class="def">NetworkUUID</a> = String<a href="Ganeti/WConfd/TempRes.html#NetworkUUID" class="link">Source</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:DRBDMinor" class="def">DRBDMinor</a> = Int<a href="Ganeti/WConfd/TempRes.html#DRBDMinor" class="link">Source</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:DRBDMap" class="def">DRBDMap</a> = Map <a href="Ganeti-WConfd-TempRes.html#t:NodeUUID">NodeUUID</a> (Map <a href="Ganeti-WConfd-TempRes.html#t:DRBDMinor">DRBDMinor</a> <a href="Ganeti-WConfd-TempRes.html#t:DiskUUID">DiskUUID</a>)<a href="Ganeti/WConfd/TempRes.html#DRBDMap" class="link">Source</a></p><div class="doc"><p>A map of the usage of DRBD minors
</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:DRBDMap-39-" class="def">DRBDMap'</a> = Map <a href="Ganeti-WConfd-TempRes.html#t:NodeUUID">NodeUUID</a> (Map <a href="Ganeti-WConfd-TempRes.html#t:DRBDMinor">DRBDMinor</a> [<a href="Ganeti-WConfd-TempRes.html#t:DiskUUID">DiskUUID</a>])<a href="Ganeti/WConfd/TempRes.html#DRBDMap%27" class="link">Source</a></p></div><h1 id="g:3">The state data structure
</h1><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:IPv4ResAction" class="def">IPv4ResAction</a>  <a href="Ganeti/WConfd/TempRes.html#IPv4ResAction" class="link">Source</a></p><div class="doc"><p>Types of IPv4 reservation actions.
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:IPv4Reserve" class="def">IPv4Reserve</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:IPv4Release" class="def">IPv4Release</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:IPv4ResAction" class="caption collapser" onclick="toggleSection('i:IPv4ResAction')">Instances</p><div id="section.i:IPv4ResAction" class="show"><table><tr><td class="src">Bounded <a href="Ganeti-WConfd-TempRes.html#t:IPv4ResAction">IPv4ResAction</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Enum <a href="Ganeti-WConfd-TempRes.html#t:IPv4ResAction">IPv4ResAction</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Eq <a href="Ganeti-WConfd-TempRes.html#t:IPv4ResAction">IPv4ResAction</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Ord <a href="Ganeti-WConfd-TempRes.html#t:IPv4ResAction">IPv4ResAction</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Show <a href="Ganeti-WConfd-TempRes.html#t:IPv4ResAction">IPv4ResAction</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Arbitrary <a href="Ganeti-WConfd-TempRes.html#t:IPv4ResAction">IPv4ResAction</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">JSON <a href="Ganeti-WConfd-TempRes.html#t:IPv4ResAction">IPv4ResAction</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:IPv4Reservation" class="def">IPv4Reservation</a>  <a href="Ganeti/WConfd/TempRes.html#IPv4Reservation" class="link">Source</a></p><div class="doc"><p>The values stored in the IPv4 reservation table.
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:IPv4Res" class="def">IPv4Res</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:ipv4ResAction" class="def">ipv4ResAction</a> :: <a href="Ganeti-WConfd-TempRes.html#t:IPv4ResAction">IPv4ResAction</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:ipv4ResNetwork" class="def">ipv4ResNetwork</a> :: <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:ipv4ResAddr" class="def">ipv4ResAddr</a> :: <a href="Ganeti-Objects.html#t:Ip4Address">Ip4Address</a></dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:IPv4Reservation" class="caption collapser" onclick="toggleSection('i:IPv4Reservation')">Instances</p><div id="section.i:IPv4Reservation" class="show"><table><tr><td class="src">Eq <a href="Ganeti-WConfd-TempRes.html#t:IPv4Reservation">IPv4Reservation</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Ord <a href="Ganeti-WConfd-TempRes.html#t:IPv4Reservation">IPv4Reservation</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Show <a href="Ganeti-WConfd-TempRes.html#t:IPv4Reservation">IPv4Reservation</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Arbitrary <a href="Ganeti-WConfd-TempRes.html#t:IPv4Reservation">IPv4Reservation</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">JSON <a href="Ganeti-WConfd-TempRes.html#t:IPv4Reservation">IPv4Reservation</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">newtype</span>  <a name="t:TempRes" class="def">TempRes</a> j a <a href="Ganeti/WConfd/TempRes.html#TempRes" class="link">Source</a></p><div class="doc"><p>A polymorphic data structure for managing temporary resources assigned
 to jobs.
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:TempRes" class="def">TempRes</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:getTempRes" class="def">getTempRes</a> :: <a href="Ganeti-Utils-MultiMap.html#t:MultiMap">MultiMap</a> j a</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:TempRes" class="caption collapser" onclick="toggleSection('i:TempRes')">Instances</p><div id="section.i:TempRes" class="show"><table><tr><td class="src">(Eq j, Eq a) =&gt; Eq (<a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(Ord j, Ord a) =&gt; Ord (<a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(Show j, Show a) =&gt; Show (<a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(Ord j, Ord a) =&gt; Monoid (<a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(Arbitrary k, Ord k, Arbitrary v, Ord v) =&gt; Arbitrary (<a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> k v)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(JSON j, Ord j, JSON a, Ord a) =&gt; JSON (<a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a)</td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:mkTempRes" class="def">mkTempRes</a> ::  <a href="Ganeti-Utils-MultiMap.html#t:MultiMap">MultiMap</a> j a -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a<a href="Ganeti/WConfd/TempRes.html#mkTempRes" class="link">Source</a></p><div class="doc"><p>Create a temporary reservations from a given multi-map.
</p></div></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:TempResState" class="def">TempResState</a>  <a href="Ganeti/WConfd/TempRes.html#TempResState" class="link">Source</a></p><div class="doc"><p>The state of the temporary reservations
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:TempResState" class="def">TempResState</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:trsDRBD" class="def">trsDRBD</a> :: <a href="Ganeti-WConfd-TempRes.html#t:DRBDMap">DRBDMap</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:trsMACs" class="def">trsMACs</a> :: <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> <a href="Ganeti-Config.html#t:MAC">MAC</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:trsDRBDSecrets" class="def">trsDRBDSecrets</a> :: <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> <a href="Ganeti-Objects-Disk.html#t:DRBDSecret">DRBDSecret</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:trsLVs" class="def">trsLVs</a> :: <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> <a href="Ganeti-Objects-Disk.html#t:LogicalVolume">LogicalVolume</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:trsIPv4s" class="def">trsIPv4s</a> :: <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> <a href="Ganeti-WConfd-TempRes.html#t:IPv4Reservation">IPv4Reservation</a></dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:TempResState" class="caption collapser" onclick="toggleSection('i:TempResState')">Instances</p><div id="section.i:TempResState" class="show"><table><tr><td class="src">Eq <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Show <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Arbitrary <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">JSON <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Ganeti-JSON.html#t:ArrayObject">ArrayObject</a> <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Ganeti-JSON.html#t:DictObject">DictObject</a> <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:loadTempResState" class="def">loadTempResState</a> :: JSValue -&gt; Result <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a><a href="Ganeti/WConfd/TempRes.html#loadTempResState" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:saveTempResState" class="def">saveTempResState</a> :: <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> -&gt; JSValue<a href="Ganeti/WConfd/TempRes.html#saveTempResState" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:emptyTempResState" class="def">emptyTempResState</a> :: <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a><a href="Ganeti/WConfd/TempRes.html#emptyTempResState" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:trsMACsL" class="def">trsMACsL</a> :: Lens' <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> (<a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> <a href="Ganeti-Config.html#t:MAC">MAC</a>)<a href="Ganeti/WConfd/TempRes.html#trsMACsL" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:trsLVsL" class="def">trsLVsL</a> :: Lens' <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> (<a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> <a href="Ganeti-Objects-Disk.html#t:LogicalVolume">LogicalVolume</a>)<a href="Ganeti/WConfd/TempRes.html#trsLVsL" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:trsIPv4sL" class="def">trsIPv4sL</a> :: Lens' <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> (<a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> <a href="Ganeti-WConfd-TempRes.html#t:IPv4Reservation">IPv4Reservation</a>)<a href="Ganeti/WConfd/TempRes.html#trsIPv4sL" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:trsDRBDSecretsL" class="def">trsDRBDSecretsL</a> :: Lens' <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> (<a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> <a href="Ganeti-Objects-Disk.html#t:DRBDSecret">DRBDSecret</a>)<a href="Ganeti/WConfd/TempRes.html#trsDRBDSecretsL" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:trsDRBDL" class="def">trsDRBDL</a> :: Lens' <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> <a href="Ganeti-WConfd-TempRes.html#t:DRBDMap">DRBDMap</a><a href="Ganeti/WConfd/TempRes.html#trsDRBDL" class="link">Source</a></p></div><h2 id="g:4">Utility functions
</h2><div class="top"><p class="src"><a name="v:resError" class="def">resError</a> :: MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m =&gt; String -&gt; m a<a href="Ganeti/WConfd/TempRes.html#resError" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:toResError" class="def">toResError</a> :: MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m =&gt; m a -&gt; m a<a href="Ganeti/WConfd/TempRes.html#toResError" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:filterNested" class="def">filterNested</a> :: (Ord a, Ord b) =&gt; (c -&gt; Bool) -&gt; Map a (Map b c) -&gt; Map a (Map b c)<a href="Ganeti/WConfd/TempRes.html#filterNested" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:maybeLens" class="def">maybeLens</a> :: (Monoid a, Monoid b, Eq b) =&gt; Lens s t (Maybe a) (Maybe b) -&gt; Lens s t a b<a href="Ganeti/WConfd/TempRes.html#maybeLens" class="link">Source</a></p></div><h1 id="g:5">DRBD functions
</h1><div class="top"><p class="src"><a name="v:computeDRBDMap-39-" class="def">computeDRBDMap'</a> :: MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m =&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> -&gt; m <a href="Ganeti-WConfd-TempRes.html#t:DRBDMap-39-">DRBDMap'</a><a href="Ganeti/WConfd/TempRes.html#computeDRBDMap%27" class="link">Source</a></p><div class="doc"><p>Compute the map of used DRBD minor/nodes, including possible
 duplicates.
 An error is returned if the configuration isn't consistent
 (for example if a referenced disk is missing etc.).
</p></div></div><div class="top"><p class="src"><a name="v:computeDRBDMap" class="def">computeDRBDMap</a> :: MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m =&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> -&gt; m <a href="Ganeti-WConfd-TempRes.html#t:DRBDMap">DRBDMap</a><a href="Ganeti/WConfd/TempRes.html#computeDRBDMap" class="link">Source</a></p><div class="doc"><p>Compute the map of used DRBD minor/nodes.
 Report any duplicate entries as an error.
</p><p>Unlike <code><a href="Ganeti-WConfd-TempRes.html#v:computeDRBDMap-39-">computeDRBDMap'</a></code>, includes entries for all nodes, even if empty.
</p></div></div><div class="top"><p class="src"><a name="v:allocateDRBDMinor" class="def">allocateDRBDMinor</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, MonadState <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> m) =&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:DiskUUID">DiskUUID</a> -&gt; [<a href="Ganeti-WConfd-TempRes.html#t:NodeUUID">NodeUUID</a>] -&gt; m [<a href="Ganeti-WConfd-TempRes.html#t:DRBDMinor">DRBDMinor</a>]<a href="Ganeti/WConfd/TempRes.html#allocateDRBDMinor" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:releaseDRBDMinors" class="def">releaseDRBDMinors</a> :: MonadState <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> m =&gt; <a href="Ganeti-WConfd-TempRes.html#t:DiskUUID">DiskUUID</a> -&gt; m ()<a href="Ganeti/WConfd/TempRes.html#releaseDRBDMinors" class="link">Source</a></p></div><h1 id="g:6">Other temporary resources
</h1><div class="top"><p class="src"><a name="v:isReserved" class="def">isReserved</a> :: (Ord a, Ord j) =&gt; a -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a -&gt; Bool<a href="Ganeti/WConfd/TempRes.html#isReserved" class="link">Source</a></p><div class="doc"><p>Tests if a given value is reserved for a given job.
</p></div></div><div class="top"><p class="src"><a name="v:reserve" class="def">reserve</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, Show a, Ord a, Ord j) =&gt; j -&gt; a -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a -&gt; m (<a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a)<a href="Ganeti/WConfd/TempRes.html#reserve" class="link">Source</a></p><div class="doc"><p>Tries to reserve a given value for a given job.
</p></div></div><div class="top"><p class="src"><a name="v:dropReservationsFor" class="def">dropReservationsFor</a> :: (Ord a, Ord j) =&gt; j -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a<a href="Ganeti/WConfd/TempRes.html#dropReservationsFor" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:reservedFor" class="def">reservedFor</a> :: (Ord a, Ord j) =&gt; j -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a -&gt; Set a<a href="Ganeti/WConfd/TempRes.html#reservedFor" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:reserved" class="def">reserved</a> :: (Ord a, Ord j) =&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a -&gt; Set a<a href="Ganeti/WConfd/TempRes.html#reserved" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:withReserved" class="def">withReserved</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, Show a, Ord a, Ord j) =&gt; j -&gt; (Set a -&gt; m a) -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a -&gt; m (a, <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a)<a href="Ganeti/WConfd/TempRes.html#withReserved" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:generate" class="def">generate</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, Show a, Ord a, Ord j) =&gt; j -&gt; Set a -&gt; m (Maybe a) -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a -&gt; m (a, <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a)<a href="Ganeti/WConfd/TempRes.html#generate" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:generateRand" class="def">generateRand</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, Show a, Ord a, Ord j, RandomGen g) =&gt; g -&gt; j -&gt; Set a -&gt; (g -&gt; (Maybe a, g)) -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a -&gt; m (a, <a href="Ganeti-WConfd-TempRes.html#t:TempRes">TempRes</a> j a)<a href="Ganeti/WConfd/TempRes.html#generateRand" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:stateM" class="def">stateM</a> :: MonadState s m =&gt; (s -&gt; m (a, s)) -&gt; m a<a href="Ganeti/WConfd/TempRes.html#stateM" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:modifyM" class="def">modifyM</a> :: MonadState s m =&gt; (s -&gt; m s) -&gt; m ()<a href="Ganeti/WConfd/TempRes.html#modifyM" class="link">Source</a></p></div><h2 id="g:7">Functions common to all reservations
</h2><div class="top"><p class="src"><a name="v:dropAllReservations" class="def">dropAllReservations</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; State <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> ()<a href="Ganeti/WConfd/TempRes.html#dropAllReservations" class="link">Source</a></p><div class="doc"><p>Removes all resources reserved by a given job.
</p><p>If a new reservation resource type is added, it must be added here as well.
</p></div></div><div class="top"><p class="src"><a name="v:lookupNetwork" class="def">lookupNetwork</a> :: MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m =&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; m <a href="Ganeti-Objects.html#t:Network">Network</a><a href="Ganeti/WConfd/TempRes.html#lookupNetwork" class="link">Source</a></p></div><h2 id="g:8">IDs
</h2><h2 id="g:9">MAC addresses
</h2><div class="top"><p class="src"><a name="v:generateMAC" class="def">generateMAC</a> :: (RandomGen g, MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, Functor m) =&gt; g -&gt; <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; Maybe <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; StateT <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> m <a href="Ganeti-Config.html#t:MAC">MAC</a><a href="Ganeti/WConfd/TempRes.html#generateMAC" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:reserveMAC" class="def">reserveMAC</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, MonadState <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> m, Functor m) =&gt; <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-Config.html#t:MAC">MAC</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; m ()<a href="Ganeti/WConfd/TempRes.html#reserveMAC" class="link">Source</a></p></div><h2 id="g:10">DRBD secrets
</h2><div class="top"><p class="src"><a name="v:generateDRBDSecret" class="def">generateDRBDSecret</a> :: (RandomGen g, MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, Functor m) =&gt; g -&gt; <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; StateT <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> m <a href="Ganeti-Objects-Disk.html#t:DRBDSecret">DRBDSecret</a><a href="Ganeti/WConfd/TempRes.html#generateDRBDSecret" class="link">Source</a></p></div><h2 id="g:11">LVs
</h2><div class="top"><p class="src"><a name="v:reserveLV" class="def">reserveLV</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, MonadState <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> m, Functor m) =&gt; <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-Objects-Disk.html#t:LogicalVolume">LogicalVolume</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; m ()<a href="Ganeti/WConfd/TempRes.html#reserveLV" class="link">Source</a></p></div><h2 id="g:12">IPv4 addresses
</h2><div class="top"><p class="src"><a name="v:usedIPv4Addrs" class="def">usedIPv4Addrs</a> :: <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; Set <a href="Ganeti-WConfd-TempRes.html#t:IPv4Reservation">IPv4Reservation</a> -&gt; Set <a href="Ganeti-Objects.html#t:Ip4Address">Ip4Address</a><a href="Ganeti/WConfd/TempRes.html#usedIPv4Addrs" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:reserveIp" class="def">reserveIp</a><a href="Ganeti/WConfd/TempRes.html#reserveIp" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, MonadState <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> m, Functor m)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Ganeti-Objects.html#t:Ip4Address">Ip4Address</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; Bool</td><td class="doc"><p>whether to check externally reserved IPs
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; m ()</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Reserve a given IPv4 address for use by an instance.
</p></div></div><div class="top"><p class="src"><a name="v:releaseIp" class="def">releaseIp</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, MonadState <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> m, Functor m) =&gt; <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; <a href="Ganeti-Objects.html#t:Ip4Address">Ip4Address</a> -&gt; m ()<a href="Ganeti/WConfd/TempRes.html#releaseIp" class="link">Source</a></p><div class="doc"><p>Give a specific IP address back to an IP pool.
 The IP address is returned to the IP pool designated by network id
 and marked as reserved.
</p></div></div><div class="top"><p class="src"><a name="v:generateIp" class="def">generateIp</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, MonadState <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> m, Functor m) =&gt; <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; m <a href="Ganeti-Objects.html#t:Ip4Address">Ip4Address</a><a href="Ganeti/WConfd/TempRes.html#generateIp" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:commitIp" class="def">commitIp</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, Functor m) =&gt; <a href="Ganeti-WConfd-TempRes.html#t:IPv4Reservation">IPv4Reservation</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; m <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a><a href="Ganeti/WConfd/TempRes.html#commitIp" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:commitReleaseIp" class="def">commitReleaseIp</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, Functor m) =&gt; <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; <a href="Ganeti-Objects.html#t:Ip4Address">Ip4Address</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; m <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a><a href="Ganeti/WConfd/TempRes.html#commitReleaseIp" class="link">Source</a></p><div class="doc"><p>Immediately release an IP address, without using the reservations pool.
</p></div></div><div class="top"><p class="src"><a name="v:commitReservedIps" class="def">commitReservedIps</a> :: (MonadError <a href="Ganeti-Errors.html#t:GanetiException">GanetiException</a> m, Functor m, <a href="Ganeti-Logging.html#t:MonadLog">MonadLog</a> m) =&gt; <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; m <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a><a href="Ganeti/WConfd/TempRes.html#commitReservedIps" class="link">Source</a></p><div class="doc"><p>Commit all reserved/released IP address to an IP pool.
 The IP addresses are taken from the network's IP pool and marked as
 reserved/free for instances.
</p><p>Note that the reservations are kept, they are supposed to be cleaned
 when a job finishes.
</p></div></div><div class="top"><p class="src"><a name="v:listReservedIps" class="def">listReservedIps</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:TempResState">TempResState</a> -&gt; Set <a href="Ganeti-WConfd-TempRes.html#t:IPv4Reservation">IPv4Reservation</a><a href="Ganeti/WConfd/TempRes.html#listReservedIps" class="link">Source</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.10.0</p></div></body></html>