<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>ganeti.cmdlib.TLReplaceDisks</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
</head>

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://code.google.com/p/ganeti/">Ganeti</a></th>
          </tr></table></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        <a href="ganeti-module.html">Package&nbsp;ganeti</a> ::
        <a href="ganeti.cmdlib-module.html">Module&nbsp;cmdlib</a> ::
        Class&nbsp;TLReplaceDisks
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
        <tr><td align="right"><span class="options">[<a href="javascript:void(0);" class="privatelink"
    onclick="toggle_private();">hide&nbsp;private</a>]</span></td></tr>
        <tr><td align="right"><span class="options"
            >[<a href="frames.html" target="_top">frames</a
            >]&nbsp;|&nbsp;<a href="ganeti.cmdlib.TLReplaceDisks-class.html"
            target="_top">no&nbsp;frames</a>]</span></td></tr>
      </table>
    </td>
  </tr>
</table>
<!-- ==================== CLASS DESCRIPTION ==================== -->
<h1 class="epydoc">Class TLReplaceDisks</h1><p class="nomargin-top"><span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks">source&nbsp;code</a></span></p>
<center>
<center>  <map id="uml_class_diagram_for_ganeti_c_73" name="uml_class_diagram_for_ganeti_c_73">
<area shape="rect" href="ganeti.cmdlib.TLReplaceDisks-class.html#__init__" title="Initializes this class." alt="" coords="17,97,655,116"/>
<area shape="rect" href="ganeti.cmdlib.TLReplaceDisks-class.html#CheckArguments" title="Helper function for users of this class." alt="" coords="17,116,655,135"/>
<area shape="rect" href="ganeti.cmdlib.TLReplaceDisks-class.html#CheckPrereq" title="Check prerequisites." alt="" coords="17,135,655,153"/>
<area shape="rect" href="ganeti.cmdlib.TLReplaceDisks-class.html#Exec" title="Execute disk replacement." alt="" coords="17,153,655,172"/>
<area shape="rect" href="ganeti.cmdlib.TLReplaceDisks-class.html" title="Replaces disks for an instance." alt="" coords="16,72,656,173"/>
<area shape="rect" href="ganeti.cmdlib.Tasklet-class.html" title="Tasklet base class." alt="" coords="313,11,359,43"/>
</map>
  <img src="uml_class_diagram_for_ganeti_c_73.gif" alt='' usemap="#uml_class_diagram_for_ganeti_c_73" ismap="ismap" class="graph-without-title" />
</center>
</center>
<hr />
<p>Replaces disks for an instance.</p>
  <p>Note: Locking is not within the scope of this class.</p>

<!-- ==================== INSTANCE METHODS ==================== -->
<a name="section-InstanceMethods"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Instance Methods</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-InstanceMethods"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.TLReplaceDisks-class.html#__init__" class="summary-sig-name">__init__</a>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">lu</span>,
        <span class="summary-sig-arg">instance_name</span>,
        <span class="summary-sig-arg">mode</span>,
        <span class="summary-sig-arg">iallocator_name</span>,
        <span class="summary-sig-arg">remote_node</span>,
        <span class="summary-sig-arg">disks</span>,
        <span class="summary-sig-arg">delay_iallocator</span>,
        <span class="summary-sig-arg">early_release</span>)</span><br />
      Initializes this class.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks.__init__">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="_FindFaultyDisks"></a><span class="summary-sig-name">_FindFaultyDisks</span>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">node_name</span>)</span></td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks._FindFaultyDisks">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.TLReplaceDisks-class.html#CheckPrereq" class="summary-sig-name">CheckPrereq</a>(<span class="summary-sig-arg">self</span>)</span><br />
      Check prerequisites.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks.CheckPrereq">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.TLReplaceDisks-class.html#_CheckPrereq2" class="summary-sig-name" onclick="show_private();">_CheckPrereq2</a>(<span class="summary-sig-arg">self</span>)</span><br />
      Check prerequisites, second part.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks._CheckPrereq2">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.TLReplaceDisks-class.html#Exec" class="summary-sig-name">Exec</a>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">feedback_fn</span>)</span><br />
      Execute disk replacement.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks.Exec">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="_CheckVolumeGroup"></a><span class="summary-sig-name">_CheckVolumeGroup</span>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">nodes</span>)</span></td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks._CheckVolumeGroup">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="_CheckDisksExistence"></a><span class="summary-sig-name">_CheckDisksExistence</span>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">nodes</span>)</span></td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks._CheckDisksExistence">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="_CheckDisksConsistency"></a><span class="summary-sig-name">_CheckDisksConsistency</span>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">node_name</span>,
        <span class="summary-sig-arg">on_primary</span>,
        <span class="summary-sig-arg">ldisk</span>)</span></td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks._CheckDisksConsistency">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="_CreateNewStorage"></a><span class="summary-sig-name">_CreateNewStorage</span>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">node_name</span>)</span></td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks._CreateNewStorage">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="_CheckDevices"></a><span class="summary-sig-name">_CheckDevices</span>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">node_name</span>,
        <span class="summary-sig-arg">iv_names</span>)</span></td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks._CheckDevices">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="_RemoveOldStorage"></a><span class="summary-sig-name">_RemoveOldStorage</span>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">node_name</span>,
        <span class="summary-sig-arg">iv_names</span>)</span></td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks._RemoveOldStorage">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="_ReleaseNodeLock"></a><span class="summary-sig-name">_ReleaseNodeLock</span>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">node_name</span>)</span><br />
      Releases the lock for a given node.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks._ReleaseNodeLock">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.TLReplaceDisks-class.html#_ExecDrbd8DiskOnly" class="summary-sig-name" onclick="show_private();">_ExecDrbd8DiskOnly</a>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">feedback_fn</span>)</span><br />
      Replace a disk on the primary or secondary for DRBD 8.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks._ExecDrbd8DiskOnly">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.TLReplaceDisks-class.html#_ExecDrbd8Secondary" class="summary-sig-name" onclick="show_private();">_ExecDrbd8Secondary</a>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">feedback_fn</span>)</span><br />
      Replace the secondary node for DRBD 8.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks._ExecDrbd8Secondary">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
</table>
<!-- ==================== STATIC METHODS ==================== -->
<a name="section-StaticMethods"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Static Methods</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-StaticMethods"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="CheckArguments"></a><span class="summary-sig-name">CheckArguments</span>(<span class="summary-sig-arg">mode</span>,
        <span class="summary-sig-arg">remote_node</span>,
        <span class="summary-sig-arg">iallocator</span>)</span><br />
      Helper function for users of this class.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks.CheckArguments">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="_RunAllocator"></a><span class="summary-sig-name">_RunAllocator</span>(<span class="summary-sig-arg">lu</span>,
        <span class="summary-sig-arg">iallocator_name</span>,
        <span class="summary-sig-arg">instance_name</span>,
        <span class="summary-sig-arg">relocate_from</span>)</span><br />
      Compute a new secondary node using an IAllocator.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks._RunAllocator">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
</table>
<!-- ==================== METHOD DETAILS ==================== -->
<a name="section-MethodDetails"></a>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Method Details</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-MethodDetails"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
</table>
<a name="__init__"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">__init__</span>(<span class="sig-arg">self</span>,
        <span class="sig-arg">lu</span>,
        <span class="sig-arg">instance_name</span>,
        <span class="sig-arg">mode</span>,
        <span class="sig-arg">iallocator_name</span>,
        <span class="sig-arg">remote_node</span>,
        <span class="sig-arg">disks</span>,
        <span class="sig-arg">delay_iallocator</span>,
        <span class="sig-arg">early_release</span>)</span>
    <br /><em class="fname">(Constructor)</em>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks.__init__">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Initializes this class.</p>
  <dl class="fields">
    <dt>Overrides:
        <a href="ganeti.cmdlib.Tasklet-class.html#__init__">Tasklet.__init__</a>
    </dt>
  </dl>
</td></tr></table>
</div>
<a name="CheckPrereq"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">CheckPrereq</span>(<span class="sig-arg">self</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks.CheckPrereq">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Check prerequisites.</p>
  <p>This checks that the instance is in the cluster.</p>
  <dl class="fields">
    <dt>Overrides:
        <a href="ganeti.cmdlib.Tasklet-class.html#CheckPrereq">Tasklet.CheckPrereq</a>
    </dt>
  </dl>
</td></tr></table>
</div>
<a name="_CheckPrereq2"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_CheckPrereq2</span>(<span class="sig-arg">self</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks._CheckPrereq2">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Check prerequisites, second part.</p>
  <p>This function should always be part of CheckPrereq. It was separated 
  and is now called from Exec because during node evacuation iallocator was
  only called with an unmodified cluster model, not taking planned changes 
  into account.</p>
  <dl class="fields">
  </dl>
</td></tr></table>
</div>
<a name="Exec"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">Exec</span>(<span class="sig-arg">self</span>,
        <span class="sig-arg">feedback_fn</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks.Exec">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Execute disk replacement.</p>
  <p>This dispatches the disk replacement to the appropriate handler.</p>
  <dl class="fields">
    <dt>Overrides:
        <a href="ganeti.cmdlib.Tasklet-class.html#Exec">Tasklet.Exec</a>
    </dt>
  </dl>
</td></tr></table>
</div>
<a name="_ExecDrbd8DiskOnly"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_ExecDrbd8DiskOnly</span>(<span class="sig-arg">self</span>,
        <span class="sig-arg">feedback_fn</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks._ExecDrbd8DiskOnly">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Replace a disk on the primary or secondary for DRBD 8.</p>
  <p>The algorithm for replace is quite complicated:</p>
  <ol start="1">
    <li>
      for each disk to be replaced:
      <ol start="1">
        <li>
          create new LVs on the target node with unique names
        </li>
      </ol>
      <ol start="1">
        <li>
          detach old LVs from the drbd device
        </li>
      </ol>
      <ol start="1">
        <li>
          rename old LVs to name_replaced.&lt;time_t&gt;
        </li>
      </ol>
      <ol start="1">
        <li>
          rename new LVs to old LVs
        </li>
      </ol>
      <ol start="1">
        <li>
          attach the new LVs (with the old names now) to the drbd device
        </li>
      </ol>
    </li>
  </ol>
  <ol start="1">
    <li>
      wait for sync across all devices
    </li>
  </ol>
  <ol start="1">
    <li>
      for each modified disk:
      <ol start="1">
        <li>
          remove old LVs (which have the name name_replaces.&lt;time_t&gt;)
        </li>
      </ol>
    </li>
  </ol>
  <p>Failures are not very well handled.</p>
  <dl class="fields">
  </dl>
</td></tr></table>
</div>
<a name="_ExecDrbd8Secondary"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_ExecDrbd8Secondary</span>(<span class="sig-arg">self</span>,
        <span class="sig-arg">feedback_fn</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib-pysrc.html#TLReplaceDisks._ExecDrbd8Secondary">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Replace the secondary node for DRBD 8.</p>
  <p>The algorithm for replace is quite complicated:</p>
  <ul>
    <li>
      for all disks of the instance:
      <ul>
        <li>
          create new LVs on the new node with same names
        </li>
        <li>
          shutdown the drbd device on the old secondary
        </li>
        <li>
          disconnect the drbd network on the primary
        </li>
        <li>
          create the drbd device on the new secondary
        </li>
        <li>
          network attach the drbd on the primary, using an artifice: the 
          drbd code for Attach() will connect to the network if it finds a 
          device which is connected to the good local disks but not network
          enabled
        </li>
      </ul>
    </li>
    <li>
      wait for sync across all devices
    </li>
    <li>
      remove all disks from the old secondary
    </li>
  </ul>
  <p>Failures are not very well handled.</p>
  <dl class="fields">
  </dl>
</td></tr></table>
</div>
<br />
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://code.google.com/p/ganeti/">Ganeti</a></th>
          </tr></table></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">
    Generated by Epydoc 3.0.1 on Thu Dec  9 16:11:52 2010
    </td>
    <td align="right" class="footer">
      <a target="mainFrame" href="http://epydoc.sourceforge.net"
        >http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie();
  // -->
</script>
</body>
</html>
