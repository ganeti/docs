<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>ganeti.cmdlib.instance_utils</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
</head>

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://code.google.com/p/ganeti/">Ganeti</a></th>
          </tr></table></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        <a href="ganeti-module.html">Package&nbsp;ganeti</a> ::
        <a href="ganeti.cmdlib-module.html">Package&nbsp;cmdlib</a> ::
        Module&nbsp;instance_utils
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
        <tr><td align="right"><span class="options">[<a href="javascript:void(0);" class="privatelink"
    onclick="toggle_private();">hide&nbsp;private</a>]</span></td></tr>
        <tr><td align="right"><span class="options"
            >[<a href="frames.html" target="_top">frames</a
            >]&nbsp;|&nbsp;<a href="ganeti.cmdlib.instance_utils-module.html"
            target="_top">no&nbsp;frames</a>]</span></td></tr>
      </table>
    </td>
  </tr>
</table>
<!-- ==================== MODULE DESCRIPTION ==================== -->
<h1 class="epydoc">Module instance_utils</h1><p class="nomargin-top"><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html">source&nbsp;code</a></span></p>
<p>Utility function mainly, but not only used by instance LU's.</p>

<!-- ==================== FUNCTIONS ==================== -->
<a name="section-Functions"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Functions</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-Functions"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">dict</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#BuildInstanceHookEnv" class="summary-sig-name">BuildInstanceHookEnv</a>(<span class="summary-sig-arg">name</span>,
        <span class="summary-sig-arg">primary_node_name</span>,
        <span class="summary-sig-arg">secondary_node_names</span>,
        <span class="summary-sig-arg">os_type</span>,
        <span class="summary-sig-arg">status</span>,
        <span class="summary-sig-arg">minmem</span>,
        <span class="summary-sig-arg">maxmem</span>,
        <span class="summary-sig-arg">vcpus</span>,
        <span class="summary-sig-arg">nics</span>,
        <span class="summary-sig-arg">disk_template</span>,
        <span class="summary-sig-arg">disks</span>,
        <span class="summary-sig-arg">bep</span>,
        <span class="summary-sig-arg">hvp</span>,
        <span class="summary-sig-arg">hypervisor_name</span>,
        <span class="summary-sig-arg">tags</span>)</span><br />
      Builds instance related env variables for hooks</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#BuildInstanceHookEnv">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">dict</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#BuildInstanceHookEnvByObject" class="summary-sig-name">BuildInstanceHookEnvByObject</a>(<span class="summary-sig-arg">lu</span>,
        <span class="summary-sig-arg">instance</span>,
        <span class="summary-sig-arg">secondary_nodes</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">disks</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">override</span>=<span class="summary-sig-default">None</span>)</span><br />
      Builds instance related env variables for hooks from an object.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#BuildInstanceHookEnvByObject">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="GetClusterDomainSecret"></a><span class="summary-sig-name">GetClusterDomainSecret</span>()</span><br />
      Reads the cluster domain secret.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#GetClusterDomainSecret">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#CheckNodeNotDrained" class="summary-sig-name">CheckNodeNotDrained</a>(<span class="summary-sig-arg">lu</span>,
        <span class="summary-sig-arg">node_uuid</span>)</span><br />
      Ensure that a given node is not drained.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CheckNodeNotDrained">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#CheckNodeVmCapable" class="summary-sig-name">CheckNodeVmCapable</a>(<span class="summary-sig-arg">lu</span>,
        <span class="summary-sig-arg">node_uuid</span>)</span><br />
      Ensure that a given node is vm capable.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CheckNodeVmCapable">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="RemoveInstance"></a><span class="summary-sig-name">RemoveInstance</span>(<span class="summary-sig-arg">lu</span>,
        <span class="summary-sig-arg">feedback_fn</span>,
        <span class="summary-sig-arg">instance</span>,
        <span class="summary-sig-arg">ignore_failures</span>)</span><br />
      Utility function to remove an instance.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#RemoveInstance">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">list of file paths</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#_StoragePathsRemoved" class="summary-sig-name" onclick="show_private();">_StoragePathsRemoved</a>(<span class="summary-sig-arg">removed</span>,
        <span class="summary-sig-arg">disks</span>)</span><br />
      Returns an iterable of all storage paths to be removed.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#_StoragePathsRemoved">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">boolean</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#RemoveDisks" class="summary-sig-name">RemoveDisks</a>(<span class="summary-sig-arg">lu</span>,
        <span class="summary-sig-arg">instance</span>,
        <span class="summary-sig-arg">disks</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">target_node_uuid</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">ignore_failures</span>=<span class="summary-sig-default">False</span>)</span><br />
      Remove all or a subset of disks for an instance.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#RemoveDisks">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#NICToTuple" class="summary-sig-name">NICToTuple</a>(<span class="summary-sig-arg">lu</span>,
        <span class="summary-sig-arg">nic</span>)</span><br />
      Build a tupple of nic information.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#NICToTuple">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#NICListToTuple" class="summary-sig-name">NICListToTuple</a>(<span class="summary-sig-arg">lu</span>,
        <span class="summary-sig-arg">nics</span>)</span><br />
      Build a list of nic information tuples.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#NICListToTuple">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#CopyLockList" class="summary-sig-name">CopyLockList</a>(<span class="summary-sig-arg">names</span>)</span><br />
      Makes a copy of a list of lock names.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CopyLockList">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#ReleaseLocks" class="summary-sig-name">ReleaseLocks</a>(<span class="summary-sig-arg">lu</span>,
        <span class="summary-sig-arg">level</span>,
        <span class="summary-sig-arg">names</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">keep</span>=<span class="summary-sig-default">None</span>)</span><br />
      Releases locks owned by an LU.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#ReleaseLocks">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#_ComputeIPolicyNodeViolation" class="summary-sig-name" onclick="show_private();">_ComputeIPolicyNodeViolation</a>(<span class="summary-sig-arg">ipolicy</span>,
        <span class="summary-sig-arg">instance</span>,
        <span class="summary-sig-arg">current_group</span>,
        <span class="summary-sig-arg">target_group</span>,
        <span class="summary-sig-arg">cfg</span>,
        <span class="summary-sig-arg">_compute_fn</span>=<span class="summary-sig-default">ComputeIPolicyInstanceViolation</span>)</span><br />
      Compute if instance meets the specs of the new target group.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#_ComputeIPolicyNodeViolation">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#CheckTargetNodeIPolicy" class="summary-sig-name">CheckTargetNodeIPolicy</a>(<span class="summary-sig-arg">lu</span>,
        <span class="summary-sig-arg">ipolicy</span>,
        <span class="summary-sig-arg">instance</span>,
        <span class="summary-sig-arg">node</span>,
        <span class="summary-sig-arg">cfg</span>,
        <span class="summary-sig-arg">ignore</span>=<span class="summary-sig-default">False</span>,
        <span class="summary-sig-arg">_compute_fn</span>=<span class="summary-sig-default">_ComputeIPolicyNodeViolation</span>)</span><br />
      Checks that the target node is correct in terms of instance policy.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CheckTargetNodeIPolicy">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="GetInstanceInfoText"></a><span class="summary-sig-name">GetInstanceInfoText</span>(<span class="summary-sig-arg">instance</span>)</span><br />
      Compute that text that should be added to the disk's metadata.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#GetInstanceInfoText">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">integer</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#CheckNodeFreeMemory" class="summary-sig-name">CheckNodeFreeMemory</a>(<span class="summary-sig-arg">lu</span>,
        <span class="summary-sig-arg">node_uuid</span>,
        <span class="summary-sig-arg">reason</span>,
        <span class="summary-sig-arg">requested</span>,
        <span class="summary-sig-arg">hvname</span>,
        <span class="summary-sig-arg">hvparams</span>)</span><br />
      Checks if a node has enough free memory.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CheckNodeFreeMemory">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="CheckInstanceBridgesExist"></a><span class="summary-sig-name">CheckInstanceBridgesExist</span>(<span class="summary-sig-arg">lu</span>,
        <span class="summary-sig-arg">instance</span>,
        <span class="summary-sig-arg">node_uuid</span>=<span class="summary-sig-default">None</span>)</span><br />
      Check that the brigdes needed by an instance exist.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CheckInstanceBridgesExist">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="CheckNicsBridgesExist"></a><span class="summary-sig-name">CheckNicsBridgesExist</span>(<span class="summary-sig-arg">lu</span>,
        <span class="summary-sig-arg">nics</span>,
        <span class="summary-sig-arg">node_uuid</span>)</span><br />
      Check that the brigdes needed by a list of nics exist.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CheckNicsBridgesExist">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">NoneType</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#UpdateMetadata" class="summary-sig-name">UpdateMetadata</a>(<span class="summary-sig-arg">feedback_fn</span>,
        <span class="summary-sig-arg">rpc</span>,
        <span class="summary-sig-arg">instance</span>,
        <span class="summary-sig-arg">osparams_public</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">osparams_private</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">osparams_secret</span>=<span class="summary-sig-default">None</span>)</span><br />
      Updates instance metadata on the metadata daemon on the instance's 
      primary node.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#UpdateMetadata">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">NoneType</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#CheckCompressionTool" class="summary-sig-name">CheckCompressionTool</a>(<span class="summary-sig-arg">lu</span>,
        <span class="summary-sig-arg">compression_tool</span>)</span><br />
      Checks if the provided compression tool is allowed to be used.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CheckCompressionTool">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#BuildDiskLogicalIDEnv" class="summary-sig-name">BuildDiskLogicalIDEnv</a>(<span class="summary-sig-arg">idx</span>,
        <span class="summary-sig-arg">disk</span>)</span><br />
      Helper method to create hooks env related to disk's logical_id</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#BuildDiskLogicalIDEnv">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#BuildDiskEnv" class="summary-sig-name">BuildDiskEnv</a>(<span class="summary-sig-arg">idx</span>,
        <span class="summary-sig-arg">disk</span>)</span><br />
      Helper method to create disk's hooks env</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#BuildDiskEnv">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#CheckInstanceExistence" class="summary-sig-name">CheckInstanceExistence</a>(<span class="summary-sig-arg">lu</span>,
        <span class="summary-sig-arg">instance_name</span>)</span><br />
      Raises an error if an instance with the given name exists already.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CheckInstanceExistence">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#CheckForConflictingIp" class="summary-sig-name">CheckForConflictingIp</a>(<span class="summary-sig-arg">lu</span>,
        <span class="summary-sig-arg">ip</span>,
        <span class="summary-sig-arg">node_uuid</span>)</span><br />
      In case of conflicting IP address raise error.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CheckForConflictingIp">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#ComputeIPolicyInstanceSpecViolation" class="summary-sig-name">ComputeIPolicyInstanceSpecViolation</a>(<span class="summary-sig-arg">ipolicy</span>,
        <span class="summary-sig-arg">instance_spec</span>,
        <span class="summary-sig-arg">disk_types</span>,
        <span class="summary-sig-arg">_compute_fn</span>=<span class="summary-sig-default">ComputeIPolicySpecViolation</span>)</span><br />
      Compute if instance specs meets the specs of ipolicy.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#ComputeIPolicyInstanceSpecViolation">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">string</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#ComputeInstanceCommunicationNIC" class="summary-sig-name">ComputeInstanceCommunicationNIC</a>(<span class="summary-sig-arg">instance_name</span>)</span><br />
      Compute the name of the instance NIC used by instance communication.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#ComputeInstanceCommunicationNIC">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">list</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#PrepareContainerMods" class="summary-sig-name">PrepareContainerMods</a>(<span class="summary-sig-arg">mods</span>,
        <span class="summary-sig-arg">private_fn</span>)</span><br />
      Prepares a list of container modifications by adding a private data 
      field.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#PrepareContainerMods">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#ApplyContainerMods" class="summary-sig-name">ApplyContainerMods</a>(<span class="summary-sig-arg">kind</span>,
        <span class="summary-sig-arg">container</span>,
        <span class="summary-sig-arg">chgdesc</span>,
        <span class="summary-sig-arg">mods</span>,
        <span class="summary-sig-arg">create_fn</span>,
        <span class="summary-sig-arg">attach_fn</span>,
        <span class="summary-sig-arg">modify_fn</span>,
        <span class="summary-sig-arg">remove_fn</span>,
        <span class="summary-sig-arg">detach_fn</span>,
        <span class="summary-sig-arg">post_add_fn</span>=<span class="summary-sig-default">None</span>)</span><br />
      Applies descriptions in <code>mods</code> to <code>container</code>.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#ApplyContainerMods">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#GetItemFromContainer" class="summary-sig-name">GetItemFromContainer</a>(<span class="summary-sig-arg">identifier</span>,
        <span class="summary-sig-arg">kind</span>,
        <span class="summary-sig-arg">container</span>)</span><br />
      Return the item refered by the identifier.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#GetItemFromContainer">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#GetIndexFromIdentifier" class="summary-sig-name">GetIndexFromIdentifier</a>(<span class="summary-sig-arg">identifier</span>,
        <span class="summary-sig-arg">kind</span>,
        <span class="summary-sig-arg">container</span>)</span><br />
      Check if the identifier represents a valid container index and return
      it.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#GetIndexFromIdentifier">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#InsertItemToIndex" class="summary-sig-name">InsertItemToIndex</a>(<span class="summary-sig-arg">identifier</span>,
        <span class="summary-sig-arg">item</span>,
        <span class="summary-sig-arg">container</span>)</span><br />
      Insert an item to the provided index of a container.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#InsertItemToIndex">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#CheckNodesPhysicalCPUs" class="summary-sig-name">CheckNodesPhysicalCPUs</a>(<span class="summary-sig-arg">lu</span>,
        <span class="summary-sig-arg">node_uuids</span>,
        <span class="summary-sig-arg">requested</span>,
        <span class="summary-sig-arg">hypervisor_specs</span>)</span><br />
      Checks if nodes have enough physical CPUs</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CheckNodesPhysicalCPUs">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#CheckHostnameSane" class="summary-sig-name">CheckHostnameSane</a>(<span class="summary-sig-arg">lu</span>,
        <span class="summary-sig-arg">name</span>)</span><br />
      Ensures that a given hostname resolves to a 'sane' name.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CheckHostnameSane">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="CheckOpportunisticLocking"></a><span class="summary-sig-name">CheckOpportunisticLocking</span>(<span class="summary-sig-arg">op</span>)</span><br />
      Generate error if opportunistic locking is not possible.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CheckOpportunisticLocking">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#CreateInstanceAllocRequest" class="summary-sig-name">CreateInstanceAllocRequest</a>(<span class="summary-sig-arg">op</span>,
        <span class="summary-sig-arg">disks</span>,
        <span class="summary-sig-arg">nics</span>,
        <span class="summary-sig-arg">beparams</span>,
        <span class="summary-sig-arg">node_name_whitelist</span>)</span><br />
      Wrapper around IAReqInstanceAlloc.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CreateInstanceAllocRequest">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#ComputeFullBeParams" class="summary-sig-name">ComputeFullBeParams</a>(<span class="summary-sig-arg">op</span>,
        <span class="summary-sig-arg">cluster</span>)</span><br />
      Computes the full beparams.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#ComputeFullBeParams">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.cmdlib.instance_utils-module.html#ComputeNics" class="summary-sig-name">ComputeNics</a>(<span class="summary-sig-arg">op</span>,
        <span class="summary-sig-arg">cluster</span>,
        <span class="summary-sig-arg">default_ip</span>,
        <span class="summary-sig-arg">cfg</span>,
        <span class="summary-sig-arg">ec_id</span>)</span><br />
      Computes the nics.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#ComputeNics">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
</table>
<!-- ==================== VARIABLES ==================== -->
<a name="section-Variables"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Variables</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-Variables"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a href="ganeti.cmdlib.instance_utils-module.html#_TApplyContModsCbChanges" class="summary-name" onclick="show_private();">_TApplyContModsCbChanges</a> = <code title="ht.TMaybeListOf(ht.TAnd(ht.TIsLength(2), ht.TItems([ht.TNonEmptyString\
, ht.TAny,])))">ht.TMaybeListOf(ht.TAnd(ht.TIsLengt<code class="variable-ellipsis">...</code></code><br />
      Type description for changes as returned by <a 
      href="ganeti.cmdlib.instance_utils-module.html#ApplyContainerMods" 
      class="link">ApplyContainerMods</a>'s callbacks
    </td>
  </tr>
</table>
<p class="indent-wrapped-lines"><b>Imports:</b>
  <span title="logging">logging</span>,
  <span title="os">os</span>,
  <a href="ganeti.constants-module.html" title="ganeti.constants">constants</a>,
  <a href="ganeti.errors-module.html" title="ganeti.errors">errors</a>,
  <a href="ganeti.ht-module.html" title="ganeti.ht">ht</a>,
  <a href="ganeti.locking-module.html" title="ganeti.locking">locking</a>,
  <a href="ganeti.masterd.iallocator-module.html" title="ganeti.masterd.iallocator">iallocator</a>,
  <a href="ganeti.network-module.html" title="ganeti.network">network</a>,
  <a href="ganeti.netutils-module.html" title="ganeti.netutils">netutils</a>,
  <a href="ganeti.objects-module.html" title="ganeti.objects">objects</a>,
  <a href="ganeti.pathutils-module.html" title="ganeti.pathutils">pathutils</a>,
  <a href="ganeti.utils-module.html" title="ganeti.utils">utils</a>,
  <a href="ganeti.cmdlib.common-module.html#AnnotateDiskParams" title="ganeti.cmdlib.common.AnnotateDiskParams">AnnotateDiskParams</a>,
  <a href="ganeti.cmdlib.common-module.html#ComputeIPolicyInstanceViolation" title="ganeti.cmdlib.common.ComputeIPolicyInstanceViolation">ComputeIPolicyInstanceViolation</a>,
  <a href="ganeti.cmdlib.common-module.html#CheckDiskTemplateEnabled" title="ganeti.cmdlib.common.CheckDiskTemplateEnabled">CheckDiskTemplateEnabled</a>,
  <a href="ganeti.cmdlib.common-module.html#ComputeIPolicySpecViolation" title="ganeti.cmdlib.common.ComputeIPolicySpecViolation">ComputeIPolicySpecViolation</a>
</p><br />
<!-- ==================== FUNCTION DETAILS ==================== -->
<a name="section-FunctionDetails"></a>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Function Details</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-FunctionDetails"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
</table>
<a name="BuildInstanceHookEnv"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">BuildInstanceHookEnv</span>(<span class="sig-arg">name</span>,
        <span class="sig-arg">primary_node_name</span>,
        <span class="sig-arg">secondary_node_names</span>,
        <span class="sig-arg">os_type</span>,
        <span class="sig-arg">status</span>,
        <span class="sig-arg">minmem</span>,
        <span class="sig-arg">maxmem</span>,
        <span class="sig-arg">vcpus</span>,
        <span class="sig-arg">nics</span>,
        <span class="sig-arg">disk_template</span>,
        <span class="sig-arg">disks</span>,
        <span class="sig-arg">bep</span>,
        <span class="sig-arg">hvp</span>,
        <span class="sig-arg">hypervisor_name</span>,
        <span class="sig-arg">tags</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#BuildInstanceHookEnv">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Builds instance related env variables for hooks</p>
  <p>This builds the hook environment from individual variables.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>name</code></strong> (string) - the name of the instance</li>
        <li><strong class="pname"><code>primary_node_name</code></strong> (string) - the name of the instance's primary node</li>
        <li><strong class="pname"><code>secondary_node_names</code></strong> (list) - list of secondary nodes as strings</li>
        <li><strong class="pname"><code>os_type</code></strong> (string) - the name of the instance's OS</li>
        <li><strong class="pname"><code>status</code></strong> (string) - the desired status of the instance</li>
        <li><strong class="pname"><code>minmem</code></strong> (string) - the minimum memory size of the instance</li>
        <li><strong class="pname"><code>maxmem</code></strong> (string) - the maximum memory size of the instance</li>
        <li><strong class="pname"><code>vcpus</code></strong> (string) - the count of VCPUs the instance has</li>
        <li><strong class="pname"><code>nics</code></strong> (list) - list of tuples (name, uuid, ip, mac, mode, link, vlan, net, 
          netinfo) representing the NICs the instance has</li>
        <li><strong class="pname"><code>disk_template</code></strong> (string) - the disk template of the instance</li>
        <li><strong class="pname"><code>disks</code></strong> (list) - list of disks (either objects.Disk or dict)</li>
        <li><strong class="pname"><code>bep</code></strong> (dict) - the backend parameters for the instance</li>
        <li><strong class="pname"><code>hvp</code></strong> (dict) - the hypervisor parameters for the instance</li>
        <li><strong class="pname"><code>hypervisor_name</code></strong> (string) - the hypervisor for the instance</li>
        <li><strong class="pname"><code>tags</code></strong> (list) - list of instance tags as strings</li>
    </ul></dd>
    <dt>Returns: dict</dt>
        <dd>the hook environment for this instance</dd>
  </dl>
</td></tr></table>
</div>
<a name="BuildInstanceHookEnvByObject"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">BuildInstanceHookEnvByObject</span>(<span class="sig-arg">lu</span>,
        <span class="sig-arg">instance</span>,
        <span class="sig-arg">secondary_nodes</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">disks</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">override</span>=<span class="sig-default">None</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#BuildInstanceHookEnvByObject">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Builds instance related env variables for hooks from an object.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>lu</code></strong> (<a href="ganeti.cmdlib.base.LogicalUnit-class.html" 
          class="link">LogicalUnit</a>) - the logical unit on whose behalf we execute</li>
        <li><strong class="pname"><code>instance</code></strong> (<a href="ganeti.objects.Instance-class.html" 
          class="link">objects.Instance</a>) - the instance for which we should build the environment</li>
        <li><strong class="pname"><code>override</code></strong> (dict) - dictionary with key/values that will override our values</li>
    </ul></dd>
    <dt>Returns: dict</dt>
        <dd>the hook environment dictionary</dd>
  </dl>
</td></tr></table>
</div>
<a name="CheckNodeNotDrained"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">CheckNodeNotDrained</span>(<span class="sig-arg">lu</span>,
        <span class="sig-arg">node_uuid</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CheckNodeNotDrained">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Ensure that a given node is not drained.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>lu</code></strong> - the LU on behalf of which we make the check</li>
        <li><strong class="pname"><code>node_uuid</code></strong> - the node to check</li>
    </ul></dd>
    <dt>Raises:</dt>
    <dd><ul class="nomargin-top">
        <li><code><strong class='fraise'><a href="ganeti.errors.OpPrereqError-class.html">errors.OpPrereqError</a></strong></code> - if the node is drained</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="CheckNodeVmCapable"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">CheckNodeVmCapable</span>(<span class="sig-arg">lu</span>,
        <span class="sig-arg">node_uuid</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CheckNodeVmCapable">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Ensure that a given node is vm capable.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>lu</code></strong> - the LU on behalf of which we make the check</li>
        <li><strong class="pname"><code>node_uuid</code></strong> - the node to check</li>
    </ul></dd>
    <dt>Raises:</dt>
    <dd><ul class="nomargin-top">
        <li><code><strong class='fraise'><a href="ganeti.errors.OpPrereqError-class.html">errors.OpPrereqError</a></strong></code> - if the node is not vm capable</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="_StoragePathsRemoved"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_StoragePathsRemoved</span>(<span class="sig-arg">removed</span>,
        <span class="sig-arg">disks</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#_StoragePathsRemoved">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Returns an iterable of all storage paths to be removed.</p>
  <p>A storage path is removed if no disks are contained in it anymore.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>removed</code></strong> (list of <a href="ganeti.objects.Disk-class.html" 
          class="link">objects.Disk</a>) - The disks that are being removed</li>
        <li><strong class="pname"><code>disks</code></strong> (list of <a href="ganeti.objects.Disk-class.html" 
          class="link">objects.Disk</a>) - All disks attached to the instance</li>
    </ul></dd>
    <dt>Returns: list of file paths</dt>
        <dd>the storage directories that need to be removed</dd>
  </dl>
</td></tr></table>
</div>
<a name="RemoveDisks"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">RemoveDisks</span>(<span class="sig-arg">lu</span>,
        <span class="sig-arg">instance</span>,
        <span class="sig-arg">disks</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">target_node_uuid</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">ignore_failures</span>=<span class="sig-default">False</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#RemoveDisks">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Remove all or a subset of disks for an instance.</p>
  <p>This abstracts away some work from `AddInstance()` and 
  `RemoveInstance()`. Note that in case some of the devices couldn't be 
  removed, the removal will continue with the other ones.</p>
  <p>This function is also used by the disk template conversion mechanism 
  to remove the old block devices of the instance. Since the instance has 
  changed its template at the time we remove the original disks, we must 
  specify the template of the disks we are about to remove as an 
  argument.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>lu</code></strong> (<a href="ganeti.cmdlib.base.LogicalUnit-class.html" 
          class="link">LogicalUnit</a>) - the logical unit on whose behalf we execute</li>
        <li><strong class="pname"><code>instance</code></strong> (<a href="ganeti.objects.Instance-class.html" 
          class="link">objects.Instance</a>) - the instance whose disks we should remove</li>
        <li><strong class="pname"><code>disks</code></strong> (list of <a href="ganeti.objects.Disk-class.html" 
          class="link">objects.Disk</a>) - the disks to remove; if not specified, all the disks of the 
          instance are removed</li>
        <li><strong class="pname"><code>target_node_uuid</code></strong> (string) - used to override the node on which to remove the disks</li>
    </ul></dd>
    <dt>Returns: boolean</dt>
        <dd>the success of the removal</dd>
  </dl>
</td></tr></table>
</div>
<a name="NICToTuple"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">NICToTuple</span>(<span class="sig-arg">lu</span>,
        <span class="sig-arg">nic</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#NICToTuple">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Build a tupple of nic information.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>lu</code></strong> (<a href="ganeti.cmdlib.base.LogicalUnit-class.html" 
          class="link">LogicalUnit</a>) - the logical unit on whose behalf we execute</li>
        <li><strong class="pname"><code>nic</code></strong> (<a href="ganeti.objects.NIC-class.html" 
          class="link">objects.NIC</a>) - nic to convert to hooks tuple</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="NICListToTuple"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">NICListToTuple</span>(<span class="sig-arg">lu</span>,
        <span class="sig-arg">nics</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#NICListToTuple">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Build a list of nic information tuples.</p>
  <p>This list is suitable to be passed to _BuildInstanceHookEnv or as a 
  return value in LUInstanceQueryData.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>lu</code></strong> (<a href="ganeti.cmdlib.base.LogicalUnit-class.html" 
          class="link">LogicalUnit</a>) - the logical unit on whose behalf we execute</li>
        <li><strong class="pname"><code>nics</code></strong> (list of <a href="ganeti.objects.NIC-class.html" 
          class="link">objects.NIC</a>) - list of nics to convert to hooks tuples</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="CopyLockList"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">CopyLockList</span>(<span class="sig-arg">names</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CopyLockList">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Makes a copy of a list of lock names.</p>
  <p>Handles <a href="ganeti.locking-module.html#ALL_SET" 
  class="link">locking.ALL_SET</a> correctly.</p>
  <dl class="fields">
  </dl>
</td></tr></table>
</div>
<a name="ReleaseLocks"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">ReleaseLocks</span>(<span class="sig-arg">lu</span>,
        <span class="sig-arg">level</span>,
        <span class="sig-arg">names</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">keep</span>=<span class="sig-default">None</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#ReleaseLocks">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Releases locks owned by an LU.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>level</code></strong> - Lock level</li>
        <li><strong class="pname"><code>names</code></strong> (list or None) - Names of locks to release</li>
        <li><strong class="pname"><code>keep</code></strong> (list or None) - Names of locks to retain</li>
        <li><strong class="pname"><code>lu</code></strong> (<a href="ganeti.cmdlib.base.LogicalUnit-class.html" 
          class="link">LogicalUnit</a>)</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="_ComputeIPolicyNodeViolation"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_ComputeIPolicyNodeViolation</span>(<span class="sig-arg">ipolicy</span>,
        <span class="sig-arg">instance</span>,
        <span class="sig-arg">current_group</span>,
        <span class="sig-arg">target_group</span>,
        <span class="sig-arg">cfg</span>,
        <span class="sig-arg">_compute_fn</span>=<span class="sig-default">ComputeIPolicyInstanceViolation</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#_ComputeIPolicyNodeViolation">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Compute if instance meets the specs of the new target group.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>ipolicy</code></strong> - The ipolicy to verify</li>
        <li><strong class="pname"><code>instance</code></strong> - The instance object to verify</li>
        <li><strong class="pname"><code>current_group</code></strong> - The current group of the instance</li>
        <li><strong class="pname"><code>target_group</code></strong> - The new group of the instance</li>
        <li><strong class="pname"><code>cfg</code></strong> (<a href="ganeti.config.ConfigWriter-class.html" 
          class="link">config.ConfigWriter</a>) - Cluster configuration</li>
        <li><strong class="pname"><code>_compute_fn</code></strong> - The function to verify ipolicy (unittest only)</li>
    </ul></dd>
  </dl>
<div class="fields">      <p><strong>See Also:</strong>
        <a 
        href="ganeti.cmdlib.common-module.html#ComputeIPolicySpecViolation"
        class="link">ganeti.cmdlib.common.ComputeIPolicySpecViolation</a>
      </p>
</div></td></tr></table>
</div>
<a name="CheckTargetNodeIPolicy"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">CheckTargetNodeIPolicy</span>(<span class="sig-arg">lu</span>,
        <span class="sig-arg">ipolicy</span>,
        <span class="sig-arg">instance</span>,
        <span class="sig-arg">node</span>,
        <span class="sig-arg">cfg</span>,
        <span class="sig-arg">ignore</span>=<span class="sig-default">False</span>,
        <span class="sig-arg">_compute_fn</span>=<span class="sig-default">_ComputeIPolicyNodeViolation</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CheckTargetNodeIPolicy">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Checks that the target node is correct in terms of instance 
  policy.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>ipolicy</code></strong> - The ipolicy to verify</li>
        <li><strong class="pname"><code>instance</code></strong> - The instance object to verify</li>
        <li><strong class="pname"><code>node</code></strong> - The new node to relocate</li>
        <li><strong class="pname"><code>cfg</code></strong> (<a href="ganeti.config.ConfigWriter-class.html" 
          class="link">config.ConfigWriter</a>) - Cluster configuration</li>
        <li><strong class="pname"><code>ignore</code></strong> - Ignore violations of the ipolicy</li>
        <li><strong class="pname"><code>_compute_fn</code></strong> - The function to verify ipolicy (unittest only)</li>
    </ul></dd>
  </dl>
<div class="fields">      <p><strong>See Also:</strong>
        <a 
        href="ganeti.cmdlib.common-module.html#ComputeIPolicySpecViolation"
        class="link">ganeti.cmdlib.common.ComputeIPolicySpecViolation</a>
      </p>
</div></td></tr></table>
</div>
<a name="CheckNodeFreeMemory"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">CheckNodeFreeMemory</span>(<span class="sig-arg">lu</span>,
        <span class="sig-arg">node_uuid</span>,
        <span class="sig-arg">reason</span>,
        <span class="sig-arg">requested</span>,
        <span class="sig-arg">hvname</span>,
        <span class="sig-arg">hvparams</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CheckNodeFreeMemory">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Checks if a node has enough free memory.</p>
  <p>This function checks if a given node has the needed amount of free 
  memory. In case the node has less memory or we cannot get the information
  from the node, this function raises an OpPrereqError exception.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>lu</code></strong> (<code>LogicalUnit</code>) - a logical unit from which we get configuration data</li>
        <li><strong class="pname"><code>node_uuid</code></strong> (<code>str</code>) - the node to check</li>
        <li><strong class="pname"><code>reason</code></strong> (<code>str</code>) - string to use in the error message</li>
        <li><strong class="pname"><code>requested</code></strong> (<code>int</code>) - the amount of memory in MiB to check for</li>
        <li><strong class="pname"><code>hvname</code></strong> (string) - the hypervisor's name</li>
        <li><strong class="pname"><code>hvparams</code></strong> (dict of strings) - the hypervisor's parameters</li>
    </ul></dd>
    <dt>Returns: integer</dt>
        <dd>node current free memory</dd>
    <dt>Raises:</dt>
    <dd><ul class="nomargin-top">
        <li><code><strong class='fraise'><a href="ganeti.errors.OpPrereqError-class.html">errors.OpPrereqError</a></strong></code> - if the node doesn't have enough memory, or we cannot check the node</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="UpdateMetadata"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">UpdateMetadata</span>(<span class="sig-arg">feedback_fn</span>,
        <span class="sig-arg">rpc</span>,
        <span class="sig-arg">instance</span>,
        <span class="sig-arg">osparams_public</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">osparams_private</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">osparams_secret</span>=<span class="sig-default">None</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#UpdateMetadata">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Updates instance metadata on the metadata daemon on the instance's 
  primary node.</p>
  <p>If the daemon isn't available (not compiled), do nothing.</p>
  <p>In case the RPC fails, this function simply issues a warning and 
  proceeds normally.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>feedback_fn</code></strong> (callable) - function used send feedback back to the caller</li>
        <li><strong class="pname"><code>rpc</code></strong> (<a href="ganeti.rpc.node.RpcRunner-class.html" 
          class="link">rpc.node.RpcRunner</a>) - RPC runner</li>
        <li><strong class="pname"><code>instance</code></strong> (<a href="ganeti.objects.Instance-class.html" 
          class="link">objects.Instance</a>) - instance for which the metadata should be updated</li>
        <li><strong class="pname"><code>osparams_public</code></strong> (NoneType or dict) - public OS parameters used to override those defined in <a 
          href="ganeti.cmdlib.instance-module.html" 
          class="link">instance</a></li>
        <li><strong class="pname"><code>osparams_private</code></strong> (NoneType or dict) - private OS parameters used to override those defined in <a 
          href="ganeti.cmdlib.instance-module.html" 
          class="link">instance</a></li>
        <li><strong class="pname"><code>osparams_secret</code></strong> (NoneType or dict) - secret OS parameters used to override those defined in <a 
          href="ganeti.cmdlib.instance-module.html" 
          class="link">instance</a></li>
    </ul></dd>
    <dt>Returns: NoneType</dt>
        <dd>None</dd>
  </dl>
</td></tr></table>
</div>
<a name="CheckCompressionTool"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">CheckCompressionTool</span>(<span class="sig-arg">lu</span>,
        <span class="sig-arg">compression_tool</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CheckCompressionTool">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Checks if the provided compression tool is allowed to be used.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>compression_tool</code></strong> (string) - Compression tool to use for importing or exporting the instance</li>
    </ul></dd>
    <dt>Returns: NoneType</dt>
        <dd>None</dd>
    <dt>Raises:</dt>
    <dd><ul class="nomargin-top">
        <li><code><strong class='fraise'><a href="ganeti.errors.OpPrereqError-class.html">errors.OpPrereqError</a></strong></code> - If the tool is not enabled by Ganeti or whitelisted</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="BuildDiskLogicalIDEnv"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">BuildDiskLogicalIDEnv</span>(<span class="sig-arg">idx</span>,
        <span class="sig-arg">disk</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#BuildDiskLogicalIDEnv">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Helper method to create hooks env related to disk's logical_id</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>idx</code></strong> (integer) - The index of the disk</li>
        <li><strong class="pname"><code>disk</code></strong> (<a href="ganeti.objects.Disk-class.html" 
          class="link">objects.Disk</a>) - The disk object</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="BuildDiskEnv"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">BuildDiskEnv</span>(<span class="sig-arg">idx</span>,
        <span class="sig-arg">disk</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#BuildDiskEnv">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Helper method to create disk's hooks env</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>idx</code></strong> (integer) - The index of the disk</li>
        <li><strong class="pname"><code>disk</code></strong> (<a href="ganeti.objects.Disk-class.html" 
          class="link">objects.Disk</a> or dict) - The disk object or a simple dict in case of LUInstanceCreate</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="CheckInstanceExistence"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">CheckInstanceExistence</span>(<span class="sig-arg">lu</span>,
        <span class="sig-arg">instance_name</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CheckInstanceExistence">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Raises an error if an instance with the given name exists already.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>instance_name</code></strong> (string) - The name of the instance.
          <p>To be used in the locking phase.</p></li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="CheckForConflictingIp"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">CheckForConflictingIp</span>(<span class="sig-arg">lu</span>,
        <span class="sig-arg">ip</span>,
        <span class="sig-arg">node_uuid</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CheckForConflictingIp">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>In case of conflicting IP address raise error.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>ip</code></strong> (string) - IP address</li>
        <li><strong class="pname"><code>node_uuid</code></strong> (string) - node UUID</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="ComputeIPolicyInstanceSpecViolation"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">ComputeIPolicyInstanceSpecViolation</span>(<span class="sig-arg">ipolicy</span>,
        <span class="sig-arg">instance_spec</span>,
        <span class="sig-arg">disk_types</span>,
        <span class="sig-arg">_compute_fn</span>=<span class="sig-default">ComputeIPolicySpecViolation</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#ComputeIPolicyInstanceSpecViolation">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Compute if instance specs meets the specs of ipolicy.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>ipolicy</code></strong> (dict) - The ipolicy to verify against</li>
        <li><strong class="pname"><code>instance_spec</code></strong> - dict</li>
        <li><strong class="pname"><code>instance_spec</code></strong> - The instance spec to verify</li>
        <li><strong class="pname"><code>disk_types</code></strong> (list of strings) - the disk templates of the instance</li>
        <li><strong class="pname"><code>_compute_fn</code></strong> - The function to verify ipolicy (unittest only)</li>
    </ul></dd>
  </dl>
<div class="fields">      <p><strong>See Also:</strong>
        <a 
        href="ganeti.cmdlib.common-module.html#ComputeIPolicySpecViolation"
        class="link">ComputeIPolicySpecViolation</a>
      </p>
</div></td></tr></table>
</div>
<a name="ComputeInstanceCommunicationNIC"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">ComputeInstanceCommunicationNIC</span>(<span class="sig-arg">instance_name</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#ComputeInstanceCommunicationNIC">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Compute the name of the instance NIC used by instance 
  communication.</p>
  <p>With instance communication, a new NIC is added to the instance. This 
  NIC has a special name that identities it as being part of instance 
  communication, and not just a normal NIC.  This function generates the 
  name of the NIC based on a prefix and the instance name</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>instance_name</code></strong> (string) - name of the instance the NIC belongs to</li>
    </ul></dd>
    <dt>Returns: string</dt>
        <dd>name of the NIC</dd>
  </dl>
</td></tr></table>
</div>
<a name="PrepareContainerMods"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">PrepareContainerMods</span>(<span class="sig-arg">mods</span>,
        <span class="sig-arg">private_fn</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#PrepareContainerMods">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Prepares a list of container modifications by adding a private data 
  field.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>mods</code></strong> (list of tuples; (operation, index, parameters)) - List of modifications</li>
        <li><strong class="pname"><code>private_fn</code></strong> (callable or None) - Callable for constructing a private data field for a modification</li>
    </ul></dd>
    <dt>Returns: list</dt>
  </dl>
</td></tr></table>
</div>
<a name="ApplyContainerMods"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">ApplyContainerMods</span>(<span class="sig-arg">kind</span>,
        <span class="sig-arg">container</span>,
        <span class="sig-arg">chgdesc</span>,
        <span class="sig-arg">mods</span>,
        <span class="sig-arg">create_fn</span>,
        <span class="sig-arg">attach_fn</span>,
        <span class="sig-arg">modify_fn</span>,
        <span class="sig-arg">remove_fn</span>,
        <span class="sig-arg">detach_fn</span>,
        <span class="sig-arg">post_add_fn</span>=<span class="sig-default">None</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#ApplyContainerMods">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Applies descriptions in <code>mods</code> to 
  <code>container</code>.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>kind</code></strong> (string) - One-word item description</li>
        <li><strong class="pname"><code>container</code></strong> (list) - Container to modify</li>
        <li><strong class="pname"><code>chgdesc</code></strong> (None or list) - List of applied changes</li>
        <li><strong class="pname"><code>mods</code></strong> (list) - Modifications as returned by <a 
          href="ganeti.cmdlib.instance_utils-module.html#PrepareContainerMods"
          class="link">PrepareContainerMods</a></li>
        <li><strong class="pname"><code>create_fn</code></strong> (callable) - Callback for creating a new item (constants.DDM_ADD); receives 
          absolute item index, parameters and private data object as added 
          by <a 
          href="ganeti.cmdlib.instance_utils-module.html#PrepareContainerMods"
          class="link">PrepareContainerMods</a>, returns tuple containing 
          new item and changes as list</li>
        <li><strong class="pname"><code>attach_fn</code></strong> (callable) - Callback for attaching an existing item to a container 
          (constants.DDM_ATTACH); receives absolute item index and item 
          UUID or name, returns tuple containing new item and changes as 
          list</li>
        <li><strong class="pname"><code>modify_fn</code></strong> (callable) - Callback for modifying an existing item (constants.DDM_MODIFY); 
          receives absolute item index, item, parameters and private data 
          object as added by <a 
          href="ganeti.cmdlib.instance_utils-module.html#PrepareContainerMods"
          class="link">PrepareContainerMods</a>, returns changes as list</li>
        <li><strong class="pname"><code>remove_fn</code></strong> (callable) - Callback on removing item; receives absolute item index, item and
          private data object as added by <a 
          href="ganeti.cmdlib.instance_utils-module.html#PrepareContainerMods"
          class="link">PrepareContainerMods</a></li>
        <li><strong class="pname"><code>detach_fn</code></strong> (callable) - Callback on detaching item; receives absolute item index, item 
          and private data object as added by <a 
          href="ganeti.cmdlib.instance_utils-module.html#PrepareContainerMods"
          class="link">PrepareContainerMods</a></li>
        <li><strong class="pname"><code>post_add_fn</code></strong> (callable) - Callable for post-processing a newly created item after it has 
          been put into the container. It receives the index of the new 
          item and the new item as parameters.</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="GetItemFromContainer"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">GetItemFromContainer</span>(<span class="sig-arg">identifier</span>,
        <span class="sig-arg">kind</span>,
        <span class="sig-arg">container</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#GetItemFromContainer">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Return the item refered by the identifier.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>identifier</code></strong> (string) - Item index or name or UUID</li>
        <li><strong class="pname"><code>kind</code></strong> (string) - One-word item description</li>
        <li><strong class="pname"><code>container</code></strong> (list) - Container to get the item from</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="GetIndexFromIdentifier"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">GetIndexFromIdentifier</span>(<span class="sig-arg">identifier</span>,
        <span class="sig-arg">kind</span>,
        <span class="sig-arg">container</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#GetIndexFromIdentifier">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Check if the identifier represents a valid container index and return 
  it.</p>
  <p>Used in &quot;add&quot; and &quot;attach&quot; actions.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>identifier</code></strong> (string) - Item index or name or UUID</li>
        <li><strong class="pname"><code>kind</code></strong> (string) - Type of item, e.g. &quot;disk&quot;, &quot;nic&quot;</li>
        <li><strong class="pname"><code>container</code></strong> (list) - Container to calculate the index from</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="InsertItemToIndex"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">InsertItemToIndex</span>(<span class="sig-arg">identifier</span>,
        <span class="sig-arg">item</span>,
        <span class="sig-arg">container</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#InsertItemToIndex">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Insert an item to the provided index of a container.</p>
  <p>Used in &quot;add&quot; and &quot;attach&quot; actions.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>identifier</code></strong> (string) - Item index</li>
        <li><strong class="pname"><code>item</code></strong> (object) - The item to be inserted</li>
        <li><strong class="pname"><code>container</code></strong> (list) - Container to insert the item to</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="CheckNodesPhysicalCPUs"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">CheckNodesPhysicalCPUs</span>(<span class="sig-arg">lu</span>,
        <span class="sig-arg">node_uuids</span>,
        <span class="sig-arg">requested</span>,
        <span class="sig-arg">hypervisor_specs</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CheckNodesPhysicalCPUs">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Checks if nodes have enough physical CPUs</p>
  <p>This function checks if all given nodes have the needed number of 
  physical CPUs. In case any node has less CPUs or we cannot get the 
  information from the node, this function raises an OpPrereqError 
  exception.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>lu</code></strong> (<code>LogicalUnit</code>) - a logical unit from which we get configuration data</li>
        <li><strong class="pname"><code>node_uuids</code></strong> (<code>list</code>) - the list of node UUIDs to check</li>
        <li><strong class="pname"><code>requested</code></strong> (<code>int</code>) - the minimum acceptable number of physical CPUs</li>
        <li><strong class="pname"><code>hypervisor_specs</code></strong> (list of pairs (string, dict of strings)) - list of hypervisor specifications in pairs (hypervisor_name, 
          hvparams)</li>
    </ul></dd>
    <dt>Raises:</dt>
    <dd><ul class="nomargin-top">
        <li><code><strong class='fraise'><a href="ganeti.errors.OpPrereqError-class.html">errors.OpPrereqError</a></strong></code> - if the node doesn't have enough CPUs, or we cannot check the node</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="CheckHostnameSane"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">CheckHostnameSane</span>(<span class="sig-arg">lu</span>,
        <span class="sig-arg">name</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CheckHostnameSane">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Ensures that a given hostname resolves to a 'sane' name.</p>
  <p>The given name is required to be a prefix of the resolved hostname, to
  prevent accidental mismatches.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>lu</code></strong> - the logical unit on behalf of which we're checking</li>
        <li><strong class="pname"><code>name</code></strong> - the name we should resolve and check</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>the resolved hostname object</dd>
  </dl>
</td></tr></table>
</div>
<a name="CreateInstanceAllocRequest"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">CreateInstanceAllocRequest</span>(<span class="sig-arg">op</span>,
        <span class="sig-arg">disks</span>,
        <span class="sig-arg">nics</span>,
        <span class="sig-arg">beparams</span>,
        <span class="sig-arg">node_name_whitelist</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#CreateInstanceAllocRequest">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Wrapper around IAReqInstanceAlloc.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>op</code></strong> - The instance opcode</li>
        <li><strong class="pname"><code>disks</code></strong> - The computed disks</li>
        <li><strong class="pname"><code>nics</code></strong> - The computed nics</li>
        <li><strong class="pname"><code>beparams</code></strong> - The full filled beparams</li>
        <li><strong class="pname"><code>node_name_whitelist</code></strong> - List of nodes which should appear as online to the allocator 
          (unless the node is already marked offline)</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>A filled <a 
          href="ganeti.masterd.iallocator.IAReqInstanceAlloc-class.html" 
          class="link">iallocator.IAReqInstanceAlloc</a></dd>
  </dl>
</td></tr></table>
</div>
<a name="ComputeFullBeParams"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">ComputeFullBeParams</span>(<span class="sig-arg">op</span>,
        <span class="sig-arg">cluster</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#ComputeFullBeParams">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Computes the full beparams.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>op</code></strong> - The instance opcode</li>
        <li><strong class="pname"><code>cluster</code></strong> - The cluster config object</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>The fully filled beparams</dd>
  </dl>
</td></tr></table>
</div>
<a name="ComputeNics"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">ComputeNics</span>(<span class="sig-arg">op</span>,
        <span class="sig-arg">cluster</span>,
        <span class="sig-arg">default_ip</span>,
        <span class="sig-arg">cfg</span>,
        <span class="sig-arg">ec_id</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.cmdlib.instance_utils-pysrc.html#ComputeNics">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Computes the nics.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>op</code></strong> - The instance opcode</li>
        <li><strong class="pname"><code>cluster</code></strong> - Cluster configuration object</li>
        <li><strong class="pname"><code>default_ip</code></strong> - The default ip to assign</li>
        <li><strong class="pname"><code>cfg</code></strong> - An instance of the configuration object</li>
        <li><strong class="pname"><code>ec_id</code></strong> - Execution context ID</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>The build up nics</dd>
  </dl>
</td></tr></table>
</div>
<br />
<!-- ==================== VARIABLES DETAILS ==================== -->
<a name="section-VariablesDetails"></a>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Variables Details</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-VariablesDetails"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
</table>
<a name="_TApplyContModsCbChanges"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <h3 class="epydoc">_TApplyContModsCbChanges</h3>
  <p>Type description for changes as returned by <a 
  href="ganeti.cmdlib.instance_utils-module.html#ApplyContainerMods" 
  class="link">ApplyContainerMods</a>'s callbacks</p>
  <dl class="fields">
  </dl>
  <dl class="fields">
    <dt>Value:</dt>
      <dd><table><tr><td><pre class="variable">
ht.TMaybeListOf(ht.TAnd(ht.TIsLength(2), ht.TItems([ht.TNonEmptyString<span class="variable-linewrap"><img src="crarr.png" alt="\" /></span>
, ht.TAny,])))
</pre></td></tr></table>
</dd>
  </dl>
</td></tr></table>
</div>
<br />
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://code.google.com/p/ganeti/">Ganeti</a></th>
          </tr></table></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">
    Generated by Epydoc 3.0.1 on Mon Aug 22 11:13:08 2016
    </td>
    <td align="right" class="footer">
      <a target="mainFrame" href="http://epydoc.sourceforge.net"
        >http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie();
  // -->
</script>
</body>
</html>
