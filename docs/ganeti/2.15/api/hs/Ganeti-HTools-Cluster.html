<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ganeti.HTools.Cluster</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Ganeti-HTools-Cluster.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="Ganeti/HTools/Cluster.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ganeti</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Infered</td></tr></table><p class="caption">Ganeti.HTools.Cluster</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Types
</a></li><li><a href="#g:2">Utility functions
</a></li><li><a href="#g:3">Balancing functions
</a></li><li><a href="#g:4">Allocation functions
</a></li><li><a href="#g:5">Formatting functions
</a></li><li><a href="#g:6">Node group functions
</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Implementation of cluster-wide logic.
</p><p>This module holds all pure cluster-logic; I/O related functionality
goes into the <em>Main</em> module for the individual binaries.
</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span>  <a href="#t:AllocDetails">AllocDetails</a>  = <a href="#v:AllocDetails">AllocDetails</a> Int (Maybe String)</li><li class="src short"><span class="keyword">data</span>  <a href="#t:GenericAllocSolution">GenericAllocSolution</a> a = <a href="#v:AllocSolution">AllocSolution</a> {<ul class="subs"><li><a href="#v:asFailures">asFailures</a> :: [<a href="Ganeti-HTools-Types.html#t:FailMode">FailMode</a>]</li><li><a href="#v:asAllocs">asAllocs</a> :: Int</li><li><a href="#v:asSolution">asSolution</a> :: Maybe (<a href="Ganeti-HTools-Node.html#t:GenericAllocElement">GenericAllocElement</a> a)</li><li><a href="#v:asLog">asLog</a> :: [String]</li></ul>}</li><li class="src short"><span class="keyword">type</span> <a href="#t:AllocSolution">AllocSolution</a> = <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> <a href="Ganeti-HTools-Types.html#t:Score">Score</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:AllocResult">AllocResult</a> = (<a href="Ganeti-HTools-Types.html#t:FailStats">FailStats</a>, <a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>, [<a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a>], [<a href="Ganeti-HTools-Cluster.html#t:CStats">CStats</a>])</li><li class="src short"><span class="keyword">type</span> <a href="#t:GenericAllocSolutionList">GenericAllocSolutionList</a> a = [(<a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a>, <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a)]</li><li class="src short"><span class="keyword">type</span> <a href="#t:AllocSolutionList">AllocSolutionList</a> = <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolutionList">GenericAllocSolutionList</a> <a href="Ganeti-HTools-Types.html#t:Score">Score</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:AllocNodes">AllocNodes</a> = Either [<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>] [(<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>, [<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>])]</li><li class="src short"><a href="#v:emptyAllocSolution">emptyAllocSolution</a> ::  <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a</li><li class="src short"><span class="keyword">data</span>  <a href="#t:Table">Table</a>  = <a href="#v:Table">Table</a> <a href="Ganeti-HTools-Node.html#t:List">List</a> <a href="Ganeti-HTools-Instance.html#t:List">List</a> <a href="Ganeti-HTools-Types.html#t:Score">Score</a> [<a href="Ganeti-HTools-Types.html#t:Placement">Placement</a>]</li><li class="src short"><span class="keyword">data</span>  <a href="#t:CStats">CStats</a>  = <a href="#v:CStats">CStats</a> {<ul class="subs"><li><a href="#v:csFmem">csFmem</a> :: Integer</li><li><a href="#v:csFdsk">csFdsk</a> :: Integer</li><li><a href="#v:csFspn">csFspn</a> :: Integer</li><li><a href="#v:csAmem">csAmem</a> :: Integer</li><li><a href="#v:csAdsk">csAdsk</a> :: Integer</li><li><a href="#v:csAcpu">csAcpu</a> :: Integer</li><li><a href="#v:csMmem">csMmem</a> :: Integer</li><li><a href="#v:csMdsk">csMdsk</a> :: Integer</li><li><a href="#v:csMcpu">csMcpu</a> :: Integer</li><li><a href="#v:csImem">csImem</a> :: Integer</li><li><a href="#v:csIdsk">csIdsk</a> :: Integer</li><li><a href="#v:csIspn">csIspn</a> :: Integer</li><li><a href="#v:csIcpu">csIcpu</a> :: Integer</li><li><a href="#v:csTmem">csTmem</a> :: Double</li><li><a href="#v:csTdsk">csTdsk</a> :: Double</li><li><a href="#v:csTspn">csTspn</a> :: Double</li><li><a href="#v:csTcpu">csTcpu</a> :: Double</li><li><a href="#v:csVcpu">csVcpu</a> :: Integer</li><li><a href="#v:csNcpu">csNcpu</a> :: Double</li><li><a href="#v:csXmem">csXmem</a> :: Integer</li><li><a href="#v:csNmem">csNmem</a> :: Integer</li><li><a href="#v:csScore">csScore</a> :: <a href="Ganeti-HTools-Types.html#t:Score">Score</a></li><li><a href="#v:csNinst">csNinst</a> :: Int</li></ul>}</li><li class="src short"><span class="keyword">type</span> <a href="#t:AllocMethod">AllocMethod</a> = <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; Maybe Int -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocNodes">AllocNodes</a> -&gt; [<a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a>] -&gt; [<a href="Ganeti-HTools-Cluster.html#t:CStats">CStats</a>] -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Cluster.html#t:AllocResult">AllocResult</a></li><li class="src short"><a href="#v:verifyN1">verifyN1</a> :: [<a href="Ganeti-HTools-Node.html#t:Node">Node</a>] -&gt; [<a href="Ganeti-HTools-Node.html#t:Node">Node</a>]</li><li class="src short"><a href="#v:computeBadItems">computeBadItems</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; ([<a href="Ganeti-HTools-Node.html#t:Node">Node</a>], [<a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a>])</li><li class="src short"><a href="#v:emptyCStats">emptyCStats</a> :: <a href="Ganeti-HTools-Cluster.html#t:CStats">CStats</a></li><li class="src short"><a href="#v:updateCStats">updateCStats</a> :: <a href="Ganeti-HTools-Cluster.html#t:CStats">CStats</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:CStats">CStats</a></li><li class="src short"><a href="#v:totalResources">totalResources</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:CStats">CStats</a></li><li class="src short"><a href="#v:computeAllocationDelta">computeAllocationDelta</a> :: <a href="Ganeti-HTools-Cluster.html#t:CStats">CStats</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:CStats">CStats</a> -&gt; <a href="Ganeti-HTools-Types.html#t:AllocStats">AllocStats</a></li><li class="src short"><a href="#v:getOnline">getOnline</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; [<a href="Ganeti-HTools-Node.html#t:Node">Node</a>]</li><li class="src short"><a href="#v:compareTables">compareTables</a> :: <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a></li><li class="src short"><a href="#v:allocateOnSingle">allocateOnSingle</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a> -&gt; <a href="Ganeti-HTools-Types.html#t:OpResult">OpResult</a> <a href="Ganeti-HTools-Node.html#t:AllocElement">AllocElement</a></li><li class="src short"><a href="#v:allocateOnPair">allocateOnPair</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; [<a href="Ganeti-Utils-Statistics.html#t:Statistics">Statistics</a>] -&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a> -&gt; <a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a> -&gt; <a href="Ganeti-HTools-Types.html#t:OpResult">OpResult</a> <a href="Ganeti-HTools-Node.html#t:AllocElement">AllocElement</a></li><li class="src short"><a href="#v:checkSingleStep">checkSingleStep</a> :: Bool -&gt; <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a> -&gt; <a href="Ganeti-HTools-Types.html#t:IMove">IMove</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a></li><li class="src short"><a href="#v:possibleMoves">possibleMoves</a> :: <a href="Ganeti-HTools-Types.html#t:MirrorType">MirrorType</a> -&gt; Bool -&gt; Bool -&gt; Bool -&gt; (Bool, Bool) -&gt; <a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a> -&gt; [<a href="Ganeti-HTools-Types.html#t:IMove">IMove</a>]</li><li class="src short"><a href="#v:checkInstanceMove">checkInstanceMove</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; [<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>] -&gt; <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a></li><li class="src short"><a href="#v:checkMove">checkMove</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; [<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>] -&gt; <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a> -&gt; [<a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a>] -&gt; <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a></li><li class="src short"><a href="#v:doNextBalance">doNextBalance</a> :: <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a> -&gt; Int -&gt; <a href="Ganeti-HTools-Types.html#t:Score">Score</a> -&gt; Bool</li><li class="src short"><a href="#v:tryBalance">tryBalance</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a> -&gt; Maybe <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a></li><li class="src short"><a href="#v:collapseFailures">collapseFailures</a> :: [<a href="Ganeti-HTools-Types.html#t:FailMode">FailMode</a>] -&gt; <a href="Ganeti-HTools-Types.html#t:FailStats">FailStats</a></li><li class="src short"><a href="#v:bestAllocElement">bestAllocElement</a> :: Ord a =&gt; Maybe (<a href="Ganeti-HTools-Node.html#t:GenericAllocElement">GenericAllocElement</a> a) -&gt; Maybe (<a href="Ganeti-HTools-Node.html#t:GenericAllocElement">GenericAllocElement</a> a) -&gt; Maybe (<a href="Ganeti-HTools-Node.html#t:GenericAllocElement">GenericAllocElement</a> a)</li><li class="src short"><a href="#v:concatAllocs">concatAllocs</a> :: Ord a =&gt; <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a -&gt; <a href="Ganeti-HTools-Types.html#t:OpResult">OpResult</a> (<a href="Ganeti-HTools-Node.html#t:GenericAllocElement">GenericAllocElement</a> a) -&gt; <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a</li><li class="src short"><a href="#v:sumAllocs">sumAllocs</a> :: Ord a =&gt; <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a -&gt; <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a -&gt; <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a</li><li class="src short"><a href="#v:genericDescribeSolution">genericDescribeSolution</a> ::  (a -&gt; String) -&gt; <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a -&gt; String</li><li class="src short"><a href="#v:genericAnnotateSolution">genericAnnotateSolution</a> ::  (a -&gt; String) -&gt; <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a -&gt; <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a</li><li class="src short"><a href="#v:annotateSolution">annotateSolution</a> :: <a href="Ganeti-HTools-Cluster.html#t:AllocSolution">AllocSolution</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocSolution">AllocSolution</a></li><li class="src short"><a href="#v:genAllocNodes">genAllocNodes</a> :: <a href="Ganeti-HTools-Group.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; Int -&gt; Bool -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Cluster.html#t:AllocNodes">AllocNodes</a></li><li class="src short"><a href="#v:tryAlloc">tryAlloc</a> :: Monad m =&gt; <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocNodes">AllocNodes</a> -&gt; m <a href="Ganeti-HTools-Cluster.html#t:AllocSolution">AllocSolution</a></li><li class="src short"><a href="#v:solutionDescription">solutionDescription</a> ::  (<a href="Ganeti-HTools-Group.html#t:Group">Group</a>, <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (<a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a)) -&gt; [String]</li><li class="src short"><a href="#v:filterMGResults">filterMGResults</a> ::  [(<a href="Ganeti-HTools-Group.html#t:Group">Group</a>, <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (<a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a))] -&gt; [(<a href="Ganeti-HTools-Group.html#t:Group">Group</a>, <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a)]</li><li class="src short"><a href="#v:sortMGResults">sortMGResults</a> :: Ord a =&gt; [(<a href="Ganeti-HTools-Group.html#t:Group">Group</a>, <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a)] -&gt; [(<a href="Ganeti-HTools-Group.html#t:Group">Group</a>, <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a)]</li><li class="src short"><a href="#v:hasRequiredNetworks">hasRequiredNetworks</a> :: <a href="Ganeti-HTools-Group.html#t:Group">Group</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Bool</li><li class="src short"><a href="#v:filterValidGroups">filterValidGroups</a> :: [(<a href="Ganeti-HTools-Group.html#t:Group">Group</a>, (<a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>))] -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; ([(<a href="Ganeti-HTools-Group.html#t:Group">Group</a>, (<a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>))], [String])</li><li class="src short"><a href="#v:findAllocation">findAllocation</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Group.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Types.html#t:Gdx">Gdx</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Int -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (<a href="Ganeti-HTools-Cluster.html#t:AllocSolution">AllocSolution</a>, [String])</li><li class="src short"><a href="#v:findBestAllocGroup">findBestAllocGroup</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Group.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; Maybe [<a href="Ganeti-HTools-Types.html#t:Gdx">Gdx</a>] -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Int -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (<a href="Ganeti-HTools-Group.html#t:Group">Group</a>, <a href="Ganeti-HTools-Cluster.html#t:AllocSolution">AllocSolution</a>, [String])</li><li class="src short"><a href="#v:tryMGAlloc">tryMGAlloc</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Group.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Int -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Cluster.html#t:AllocSolution">AllocSolution</a></li><li class="src short"><a href="#v:tryGroupAlloc">tryGroupAlloc</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Group.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; String -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Int -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Cluster.html#t:AllocSolution">AllocSolution</a></li><li class="src short"><a href="#v:updateIl">updateIl</a> ::  <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; Maybe (<a href="Ganeti-HTools-Node.html#t:GenericAllocElement">GenericAllocElement</a> a) -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a></li><li class="src short"><a href="#v:extractNl">extractNl</a> ::  <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; Maybe (<a href="Ganeti-HTools-Node.html#t:GenericAllocElement">GenericAllocElement</a> a) -&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a></li><li class="src short"><a href="#v:allocList">allocList</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Group.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; [(<a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a>, <a href="Ganeti-HTools-Cluster.html#t:AllocDetails">AllocDetails</a>)] -&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocSolutionList">AllocSolutionList</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (<a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>, <a href="Ganeti-HTools-Cluster.html#t:AllocSolutionList">AllocSolutionList</a>)</li><li class="src short"><a href="#v:tryChangeGroup">tryChangeGroup</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Group.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; [<a href="Ganeti-HTools-Types.html#t:Gdx">Gdx</a>] -&gt; [<a href="Ganeti-HTools-Types.html#t:Idx">Idx</a>] -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (<a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>, <a href="Ganeti-HTools-Cluster-Evacuate.html#t:EvacSolution">EvacSolution</a>)</li><li class="src short"><a href="#v:iterateAlloc">iterateAlloc</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocMethod">AllocMethod</a></li><li class="src short"><a href="#v:sufficesShrinking">sufficesShrinking</a> :: (<a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocSolution">AllocSolution</a>) -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Types.html#t:FailMode">FailMode</a> -&gt; Maybe <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a></li><li class="src short"><a href="#v:tieredAlloc">tieredAlloc</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocMethod">AllocMethod</a></li><li class="src short"><a href="#v:computeMoves">computeMoves</a> :: <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; String -&gt; <a href="Ganeti-HTools-Types.html#t:IMove">IMove</a> -&gt; String -&gt; String -&gt; (String, [String])</li><li class="src short"><a href="#v:printSolutionLine">printSolutionLine</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; Int -&gt; Int -&gt; <a href="Ganeti-HTools-Types.html#t:Placement">Placement</a> -&gt; Int -&gt; (String, [String])</li><li class="src short"><a href="#v:involvedNodes">involvedNodes</a> :: <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Types.html#t:Placement">Placement</a> -&gt; [<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>]</li><li class="src short"><a href="#v:getMoves">getMoves</a> :: (<a href="Ganeti-HTools-Cluster.html#t:Table">Table</a>, <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a>) -&gt; [<a href="Ganeti-HTools-Types.html#t:MoveJob">MoveJob</a>]</li><li class="src short"><a href="#v:mergeJobs">mergeJobs</a> :: ([<a href="Ganeti-HTools-Types.html#t:JobSet">JobSet</a>], [<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>]) -&gt; <a href="Ganeti-HTools-Types.html#t:MoveJob">MoveJob</a> -&gt; ([<a href="Ganeti-HTools-Types.html#t:JobSet">JobSet</a>], [<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>])</li><li class="src short"><a href="#v:splitJobs">splitJobs</a> :: [<a href="Ganeti-HTools-Types.html#t:MoveJob">MoveJob</a>] -&gt; [<a href="Ganeti-HTools-Types.html#t:JobSet">JobSet</a>]</li><li class="src short"><a href="#v:formatJob">formatJob</a> :: Int -&gt; Int -&gt; (Int, <a href="Ganeti-HTools-Types.html#t:MoveJob">MoveJob</a>) -&gt; [String]</li><li class="src short"><a href="#v:formatCmds">formatCmds</a> :: [<a href="Ganeti-HTools-Types.html#t:JobSet">JobSet</a>] -&gt; String</li><li class="src short"><a href="#v:printNodes">printNodes</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; [String] -&gt; String</li><li class="src short"><a href="#v:printInsts">printInsts</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; String</li><li class="src short"><a href="#v:instanceGroup">instanceGroup</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Types.html#t:Gdx">Gdx</a></li><li class="src short"><a href="#v:findSplitInstances">findSplitInstances</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; [<a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a>]</li></ul></div><div id="interface"><h1 id="g:1">Types
</h1><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:AllocDetails" class="def">AllocDetails</a>  <a href="Ganeti/HTools/Cluster.html#AllocDetails" class="link">Source</a></p><div class="doc"><p>Allocation details for an instance, specifying
 required number of nodes, and
 an optional group (name) to allocate to
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:AllocDetails" class="def">AllocDetails</a> Int (Maybe String)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:AllocDetails" class="caption collapser" onclick="toggleSection('i:AllocDetails')">Instances</p><div id="section.i:AllocDetails" class="show"><table><tr><td class="src">Show <a href="Ganeti-HTools-Cluster.html#t:AllocDetails">AllocDetails</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:GenericAllocSolution" class="def">GenericAllocSolution</a> a <a href="Ganeti/HTools/Cluster.html#GenericAllocSolution" class="link">Source</a></p><div class="doc"><p>Allocation/relocation solution.
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:AllocSolution" class="def">AllocSolution</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:asFailures" class="def">asFailures</a> :: [<a href="Ganeti-HTools-Types.html#t:FailMode">FailMode</a>]</dt><dd class="doc"><p>Failure counts
</p></dd><dt class="src"><a name="v:asAllocs" class="def">asAllocs</a> :: Int</dt><dd class="doc"><p>Good allocation count
</p></dd><dt class="src"><a name="v:asSolution" class="def">asSolution</a> :: Maybe (<a href="Ganeti-HTools-Node.html#t:GenericAllocElement">GenericAllocElement</a> a)</dt><dd class="doc"><p>The actual allocation
 result
</p></dd><dt class="src"><a name="v:asLog" class="def">asLog</a> :: [String]</dt><dd class="doc"><p>Informational messages
</p></dd></dl><div class="clear"></div></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:AllocSolution" class="def">AllocSolution</a> = <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> <a href="Ganeti-HTools-Types.html#t:Score">Score</a><a href="Ganeti/HTools/Cluster.html#AllocSolution" class="link">Source</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:AllocResult" class="def">AllocResult</a> = (<a href="Ganeti-HTools-Types.html#t:FailStats">FailStats</a>, <a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>, [<a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a>], [<a href="Ganeti-HTools-Cluster.html#t:CStats">CStats</a>])<a href="Ganeti/HTools/Cluster.html#AllocResult" class="link">Source</a></p><div class="doc"><p>Allocation results, as used in <code><a href="Ganeti-HTools-Cluster.html#v:iterateAlloc">iterateAlloc</a></code> and <code><a href="Ganeti-HTools-Cluster.html#v:tieredAlloc">tieredAlloc</a></code>.
</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:GenericAllocSolutionList" class="def">GenericAllocSolutionList</a> a = [(<a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a>, <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a)]<a href="Ganeti/HTools/Cluster.html#GenericAllocSolutionList" class="link">Source</a></p><div class="doc"><p>Type alias for easier handling.
</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:AllocSolutionList" class="def">AllocSolutionList</a> = <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolutionList">GenericAllocSolutionList</a> <a href="Ganeti-HTools-Types.html#t:Score">Score</a><a href="Ganeti/HTools/Cluster.html#AllocSolutionList" class="link">Source</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:AllocNodes" class="def">AllocNodes</a> = Either [<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>] [(<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>, [<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>])]<a href="Ganeti/HTools/Cluster.html#AllocNodes" class="link">Source</a></p><div class="doc"><p>A type denoting the valid allocation mode/pairs.
</p><p>For a one-node allocation, this will be a <code>Left [<code><a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a></code>]</code>, whereas
 for a two-node allocation, this will be a <code>Right [(<code><a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a></code>,
 [<code><a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a></code>])]</code>. In the latter case, the list is basically an
 association list, grouped by primary node and holding the potential
 secondary nodes in the sub-list.
</p></div></div><div class="top"><p class="src"><a name="v:emptyAllocSolution" class="def">emptyAllocSolution</a> ::  <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a<a href="Ganeti/HTools/Cluster.html#emptyAllocSolution" class="link">Source</a></p><div class="doc"><p>The empty solution we start with when computing allocations.
</p></div></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:Table" class="def">Table</a>  <a href="Ganeti/HTools/Cluster.html#Table" class="link">Source</a></p><div class="doc"><p>The complete state for the balancing solution.
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Table" class="def">Table</a> <a href="Ganeti-HTools-Node.html#t:List">List</a> <a href="Ganeti-HTools-Instance.html#t:List">List</a> <a href="Ganeti-HTools-Types.html#t:Score">Score</a> [<a href="Ganeti-HTools-Types.html#t:Placement">Placement</a>]</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:Table" class="caption collapser" onclick="toggleSection('i:Table')">Instances</p><div id="section.i:Table" class="show"><table><tr><td class="src">Show <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:CStats" class="def">CStats</a>  <a href="Ganeti/HTools/Cluster.html#CStats" class="link">Source</a></p><div class="doc"><p>Cluster statistics data type.
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:CStats" class="def">CStats</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:csFmem" class="def">csFmem</a> :: Integer</dt><dd class="doc"><p>Cluster free mem
</p></dd><dt class="src"><a name="v:csFdsk" class="def">csFdsk</a> :: Integer</dt><dd class="doc"><p>Cluster free disk
</p></dd><dt class="src"><a name="v:csFspn" class="def">csFspn</a> :: Integer</dt><dd class="doc"><p>Cluster free spindles
</p></dd><dt class="src"><a name="v:csAmem" class="def">csAmem</a> :: Integer</dt><dd class="doc"><p>Cluster allocatable mem
</p></dd><dt class="src"><a name="v:csAdsk" class="def">csAdsk</a> :: Integer</dt><dd class="doc"><p>Cluster allocatable disk
</p></dd><dt class="src"><a name="v:csAcpu" class="def">csAcpu</a> :: Integer</dt><dd class="doc"><p>Cluster allocatable cpus
</p></dd><dt class="src"><a name="v:csMmem" class="def">csMmem</a> :: Integer</dt><dd class="doc"><p>Max node allocatable mem
</p></dd><dt class="src"><a name="v:csMdsk" class="def">csMdsk</a> :: Integer</dt><dd class="doc"><p>Max node allocatable disk
</p></dd><dt class="src"><a name="v:csMcpu" class="def">csMcpu</a> :: Integer</dt><dd class="doc"><p>Max node allocatable cpu
</p></dd><dt class="src"><a name="v:csImem" class="def">csImem</a> :: Integer</dt><dd class="doc"><p>Instance used mem
</p></dd><dt class="src"><a name="v:csIdsk" class="def">csIdsk</a> :: Integer</dt><dd class="doc"><p>Instance used disk
</p></dd><dt class="src"><a name="v:csIspn" class="def">csIspn</a> :: Integer</dt><dd class="doc"><p>Instance used spindles
</p></dd><dt class="src"><a name="v:csIcpu" class="def">csIcpu</a> :: Integer</dt><dd class="doc"><p>Instance used cpu
</p></dd><dt class="src"><a name="v:csTmem" class="def">csTmem</a> :: Double</dt><dd class="doc"><p>Cluster total mem
</p></dd><dt class="src"><a name="v:csTdsk" class="def">csTdsk</a> :: Double</dt><dd class="doc"><p>Cluster total disk
</p></dd><dt class="src"><a name="v:csTspn" class="def">csTspn</a> :: Double</dt><dd class="doc"><p>Cluster total spindles
</p></dd><dt class="src"><a name="v:csTcpu" class="def">csTcpu</a> :: Double</dt><dd class="doc"><p>Cluster total cpus
</p></dd><dt class="src"><a name="v:csVcpu" class="def">csVcpu</a> :: Integer</dt><dd class="doc"><p>Cluster total virtual cpus
</p></dd><dt class="src"><a name="v:csNcpu" class="def">csNcpu</a> :: Double</dt><dd class="doc"><p>Equivalent to <code><a href="Ganeti-HTools-Cluster.html#v:csIcpu">csIcpu</a></code> but in terms of
 physical CPUs, i.e. normalised used phys CPUs
</p></dd><dt class="src"><a name="v:csXmem" class="def">csXmem</a> :: Integer</dt><dd class="doc"><p>Unnacounted for mem
</p></dd><dt class="src"><a name="v:csNmem" class="def">csNmem</a> :: Integer</dt><dd class="doc"><p>Node own memory
</p></dd><dt class="src"><a name="v:csScore" class="def">csScore</a> :: <a href="Ganeti-HTools-Types.html#t:Score">Score</a></dt><dd class="doc"><p>The cluster score
</p></dd><dt class="src"><a name="v:csNinst" class="def">csNinst</a> :: Int</dt><dd class="doc"><p>The total number of instances
</p></dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:CStats" class="caption collapser" onclick="toggleSection('i:CStats')">Instances</p><div id="section.i:CStats" class="show"><table><tr><td class="src">Show <a href="Ganeti-HTools-Cluster.html#t:CStats">CStats</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:AllocMethod" class="def">AllocMethod</a><a href="Ganeti/HTools/Cluster.html#AllocMethod" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">&nbsp;= <a href="Ganeti-HTools-Node.html#t:List">List</a></td><td class="doc"><p>Node list
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a></td><td class="doc"><p>Instance list
</p></td></tr><tr><td class="src">-&gt; Maybe Int</td><td class="doc"><p>Optional allocation limit
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a></td><td class="doc"><p>Instance spec for allocation
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocNodes">AllocNodes</a></td><td class="doc"><p>Which nodes we should allocate on
</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a>]</td><td class="doc"><p>Allocated instances
</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-HTools-Cluster.html#t:CStats">CStats</a>]</td><td class="doc"><p>Running cluster stats
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Cluster.html#t:AllocResult">AllocResult</a></td><td class="doc"><p>Allocation result
</p></td></tr></table></div><div class="doc"><p>A simple type for allocation functions.
</p></div></div><h1 id="g:2">Utility functions
</h1><div class="top"><p class="src"><a name="v:verifyN1" class="def">verifyN1</a> :: [<a href="Ganeti-HTools-Node.html#t:Node">Node</a>] -&gt; [<a href="Ganeti-HTools-Node.html#t:Node">Node</a>]<a href="Ganeti/HTools/Cluster.html#verifyN1" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:computeBadItems" class="def">computeBadItems</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; ([<a href="Ganeti-HTools-Node.html#t:Node">Node</a>], [<a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a>])<a href="Ganeti/HTools/Cluster.html#computeBadItems" class="link">Source</a></p><div class="doc"><p>Computes the pair of bad nodes and instances.
</p><p>The bad node list is computed via a simple <code><a href="Ganeti-HTools-Cluster.html#v:verifyN1">verifyN1</a></code> check, and the
bad instance list is the list of primary and secondary instances of
those nodes.
</p></div></div><div class="top"><p class="src"><a name="v:emptyCStats" class="def">emptyCStats</a> :: <a href="Ganeti-HTools-Cluster.html#t:CStats">CStats</a><a href="Ganeti/HTools/Cluster.html#emptyCStats" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:updateCStats" class="def">updateCStats</a> :: <a href="Ganeti-HTools-Cluster.html#t:CStats">CStats</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:CStats">CStats</a><a href="Ganeti/HTools/Cluster.html#updateCStats" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:totalResources" class="def">totalResources</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:CStats">CStats</a><a href="Ganeti/HTools/Cluster.html#totalResources" class="link">Source</a></p><div class="doc"><p>Compute the total free disk and memory in the cluster.
</p></div></div><div class="top"><p class="src"><a name="v:computeAllocationDelta" class="def">computeAllocationDelta</a> :: <a href="Ganeti-HTools-Cluster.html#t:CStats">CStats</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:CStats">CStats</a> -&gt; <a href="Ganeti-HTools-Types.html#t:AllocStats">AllocStats</a><a href="Ganeti/HTools/Cluster.html#computeAllocationDelta" class="link">Source</a></p><div class="doc"><p>Compute the delta between two cluster state.
</p><p>This is used when doing allocations, to understand better the
 available cluster resources. The return value is a triple of the
 current used values, the delta that was still allocated, and what
 was left unallocated.
</p></div></div><div class="top"><p class="src"><a name="v:getOnline" class="def">getOnline</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; [<a href="Ganeti-HTools-Node.html#t:Node">Node</a>]<a href="Ganeti/HTools/Cluster.html#getOnline" class="link">Source</a></p></div><h1 id="g:3">Balancing functions
</h1><div class="top"><p class="src"><a name="v:compareTables" class="def">compareTables</a> :: <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a><a href="Ganeti/HTools/Cluster.html#compareTables" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:allocateOnSingle" class="def">allocateOnSingle</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a> -&gt; <a href="Ganeti-HTools-Types.html#t:OpResult">OpResult</a> <a href="Ganeti-HTools-Node.html#t:AllocElement">AllocElement</a><a href="Ganeti/HTools/Cluster.html#allocateOnSingle" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:allocateOnPair" class="def">allocateOnPair</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; [<a href="Ganeti-Utils-Statistics.html#t:Statistics">Statistics</a>] -&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a> -&gt; <a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a> -&gt; <a href="Ganeti-HTools-Types.html#t:OpResult">OpResult</a> <a href="Ganeti-HTools-Node.html#t:AllocElement">AllocElement</a><a href="Ganeti/HTools/Cluster.html#allocateOnPair" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:checkSingleStep" class="def">checkSingleStep</a> :: Bool -&gt; <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a> -&gt; <a href="Ganeti-HTools-Types.html#t:IMove">IMove</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a><a href="Ganeti/HTools/Cluster.html#checkSingleStep" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:possibleMoves" class="def">possibleMoves</a> :: <a href="Ganeti-HTools-Types.html#t:MirrorType">MirrorType</a> -&gt; Bool -&gt; Bool -&gt; Bool -&gt; (Bool, Bool) -&gt; <a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a> -&gt; [<a href="Ganeti-HTools-Types.html#t:IMove">IMove</a>]<a href="Ganeti/HTools/Cluster.html#possibleMoves" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:checkInstanceMove" class="def">checkInstanceMove</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; [<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>] -&gt; <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a><a href="Ganeti/HTools/Cluster.html#checkInstanceMove" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:checkMove" class="def">checkMove</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; [<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>] -&gt; <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a> -&gt; [<a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a>] -&gt; <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a><a href="Ganeti/HTools/Cluster.html#checkMove" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:doNextBalance" class="def">doNextBalance</a><a href="Ganeti/HTools/Cluster.html#doNextBalance" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a></td><td class="doc"><p>The starting table
</p></td></tr><tr><td class="src">-&gt; Int</td><td class="doc"><p>Remaining length
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Types.html#t:Score">Score</a></td><td class="doc"><p>Score at which to stop
</p></td></tr><tr><td class="src">-&gt; Bool</td><td class="doc"><p>The resulting table and commands
</p></td></tr></table></div><div class="doc"><p>Check if we are allowed to go deeper in the balancing.
</p></div></div><div class="top"><p class="src"><a name="v:tryBalance" class="def">tryBalance</a><a href="Ganeti/HTools/Cluster.html#tryBalance" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a></td><td class="doc"><p>Algorithmic options for balancing
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a></td><td class="doc"><p>The starting table
</p></td></tr><tr><td class="src">-&gt; Maybe <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a></td><td class="doc"><p>The resulting table and commands
</p></td></tr></table></div><div class="doc"><p>Run a balance move.
</p></div></div><h1 id="g:4">Allocation functions
</h1><div class="top"><p class="src"><a name="v:collapseFailures" class="def">collapseFailures</a> :: [<a href="Ganeti-HTools-Types.html#t:FailMode">FailMode</a>] -&gt; <a href="Ganeti-HTools-Types.html#t:FailStats">FailStats</a><a href="Ganeti/HTools/Cluster.html#collapseFailures" class="link">Source</a></p><div class="doc"><p>Build failure stats out of a list of failures.
</p></div></div><div class="top"><p class="src"><a name="v:bestAllocElement" class="def">bestAllocElement</a> :: Ord a =&gt; Maybe (<a href="Ganeti-HTools-Node.html#t:GenericAllocElement">GenericAllocElement</a> a) -&gt; Maybe (<a href="Ganeti-HTools-Node.html#t:GenericAllocElement">GenericAllocElement</a> a) -&gt; Maybe (<a href="Ganeti-HTools-Node.html#t:GenericAllocElement">GenericAllocElement</a> a)<a href="Ganeti/HTools/Cluster.html#bestAllocElement" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:concatAllocs" class="def">concatAllocs</a> :: Ord a =&gt; <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a -&gt; <a href="Ganeti-HTools-Types.html#t:OpResult">OpResult</a> (<a href="Ganeti-HTools-Node.html#t:GenericAllocElement">GenericAllocElement</a> a) -&gt; <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a<a href="Ganeti/HTools/Cluster.html#concatAllocs" class="link">Source</a></p><div class="doc"><p>Update current Allocation solution and failure stats with new
 elements.
</p></div></div><div class="top"><p class="src"><a name="v:sumAllocs" class="def">sumAllocs</a> :: Ord a =&gt; <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a -&gt; <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a -&gt; <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a<a href="Ganeti/HTools/Cluster.html#sumAllocs" class="link">Source</a></p><div class="doc"><p>Sums two <code><a href="Ganeti-HTools-Cluster.html#t:AllocSolution">AllocSolution</a></code> structures.
</p></div></div><div class="top"><p class="src"><a name="v:genericDescribeSolution" class="def">genericDescribeSolution</a> ::  (a -&gt; String) -&gt; <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a -&gt; String<a href="Ganeti/HTools/Cluster.html#genericDescribeSolution" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:genericAnnotateSolution" class="def">genericAnnotateSolution</a> ::  (a -&gt; String) -&gt; <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a -&gt; <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a<a href="Ganeti/HTools/Cluster.html#genericAnnotateSolution" class="link">Source</a></p><div class="doc"><p>Annotates a solution with the appropriate string.
</p></div></div><div class="top"><p class="src"><a name="v:annotateSolution" class="def">annotateSolution</a> :: <a href="Ganeti-HTools-Cluster.html#t:AllocSolution">AllocSolution</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocSolution">AllocSolution</a><a href="Ganeti/HTools/Cluster.html#annotateSolution" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:genAllocNodes" class="def">genAllocNodes</a><a href="Ganeti/HTools/Cluster.html#genAllocNodes" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-Group.html#t:List">List</a></td><td class="doc"><p>Group list
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a></td><td class="doc"><p>The node map
</p></td></tr><tr><td class="src">-&gt; Int</td><td class="doc"><p>The number of nodes required
</p></td></tr><tr><td class="src">-&gt; Bool</td><td class="doc"><p>Whether to drop or not
 unallocable nodes
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Cluster.html#t:AllocNodes">AllocNodes</a></td><td class="doc"><p>The (monadic) result
</p></td></tr></table></div><div class="doc"><p>Generate the valid node allocation singles or pairs for a new instance.
</p></div></div><div class="top"><p class="src"><a name="v:tryAlloc" class="def">tryAlloc</a><a href="Ganeti/HTools/Cluster.html#tryAlloc" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: Monad m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a></td><td class="doc"><p>The node list
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a></td><td class="doc"><p>The instance list
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a></td><td class="doc"><p>The instance to allocate
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocNodes">AllocNodes</a></td><td class="doc"><p>The allocation targets
</p></td></tr><tr><td class="src">-&gt; m <a href="Ganeti-HTools-Cluster.html#t:AllocSolution">AllocSolution</a></td><td class="doc"><p>Possible solution list
</p></td></tr></table></div><div class="doc"><p>Try to allocate an instance on the cluster.
</p></div></div><div class="top"><p class="src"><a name="v:solutionDescription" class="def">solutionDescription</a> ::  (<a href="Ganeti-HTools-Group.html#t:Group">Group</a>, <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (<a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a)) -&gt; [String]<a href="Ganeti/HTools/Cluster.html#solutionDescription" class="link">Source</a></p><div class="doc"><p>Given a group/result, describe it as a nice (list of) messages.
</p></div></div><div class="top"><p class="src"><a name="v:filterMGResults" class="def">filterMGResults</a> ::  [(<a href="Ganeti-HTools-Group.html#t:Group">Group</a>, <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (<a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a))] -&gt; [(<a href="Ganeti-HTools-Group.html#t:Group">Group</a>, <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a)]<a href="Ganeti/HTools/Cluster.html#filterMGResults" class="link">Source</a></p><div class="doc"><p>From a list of possibly bad and possibly empty solutions, filter
 only the groups with a valid result. Note that the result will be
 reversed compared to the original list.
</p></div></div><div class="top"><p class="src"><a name="v:sortMGResults" class="def">sortMGResults</a> :: Ord a =&gt; [(<a href="Ganeti-HTools-Group.html#t:Group">Group</a>, <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a)] -&gt; [(<a href="Ganeti-HTools-Group.html#t:Group">Group</a>, <a href="Ganeti-HTools-Cluster.html#t:GenericAllocSolution">GenericAllocSolution</a> a)]<a href="Ganeti/HTools/Cluster.html#sortMGResults" class="link">Source</a></p><div class="doc"><p>Sort multigroup results based on policy and score.
</p></div></div><div class="top"><p class="src"><a name="v:hasRequiredNetworks" class="def">hasRequiredNetworks</a> :: <a href="Ganeti-HTools-Group.html#t:Group">Group</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Bool<a href="Ganeti/HTools/Cluster.html#hasRequiredNetworks" class="link">Source</a></p><div class="doc"><p>Determines if a group is connected to the networks required by the
 | instance.
</p></div></div><div class="top"><p class="src"><a name="v:filterValidGroups" class="def">filterValidGroups</a> :: [(<a href="Ganeti-HTools-Group.html#t:Group">Group</a>, (<a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>))] -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; ([(<a href="Ganeti-HTools-Group.html#t:Group">Group</a>, (<a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>))], [String])<a href="Ganeti/HTools/Cluster.html#filterValidGroups" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:findAllocation" class="def">findAllocation</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Group.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Types.html#t:Gdx">Gdx</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Int -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (<a href="Ganeti-HTools-Cluster.html#t:AllocSolution">AllocSolution</a>, [String])<a href="Ganeti/HTools/Cluster.html#findAllocation" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:findBestAllocGroup" class="def">findBestAllocGroup</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Group.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; Maybe [<a href="Ganeti-HTools-Types.html#t:Gdx">Gdx</a>] -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Int -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (<a href="Ganeti-HTools-Group.html#t:Group">Group</a>, <a href="Ganeti-HTools-Cluster.html#t:AllocSolution">AllocSolution</a>, [String])<a href="Ganeti/HTools/Cluster.html#findBestAllocGroup" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:tryMGAlloc" class="def">tryMGAlloc</a><a href="Ganeti/HTools/Cluster.html#tryMGAlloc" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Group.html#t:List">List</a></td><td class="doc"><p>The group list
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a></td><td class="doc"><p>The node list
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a></td><td class="doc"><p>The instance list
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a></td><td class="doc"><p>The instance to allocate
</p></td></tr><tr><td class="src">-&gt; Int</td><td class="doc"><p>Required number of nodes
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Cluster.html#t:AllocSolution">AllocSolution</a></td><td class="doc"><p>Possible solution list
</p></td></tr></table></div><div class="doc"><p>Try to allocate an instance on a multi-group cluster.
</p></div></div><div class="top"><p class="src"><a name="v:tryGroupAlloc" class="def">tryGroupAlloc</a><a href="Ganeti/HTools/Cluster.html#tryGroupAlloc" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Group.html#t:List">List</a></td><td class="doc"><p>The group list
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a></td><td class="doc"><p>The node list
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a></td><td class="doc"><p>The instance list
</p></td></tr><tr><td class="src">-&gt; String</td><td class="doc"><p>The allocation group (name)
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a></td><td class="doc"><p>The instance to allocate
</p></td></tr><tr><td class="src">-&gt; Int</td><td class="doc"><p>Required number of nodes
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Cluster.html#t:AllocSolution">AllocSolution</a></td><td class="doc"><p>Solution
</p></td></tr></table></div><div class="doc"><p>Try to allocate an instance to a group.
</p></div></div><div class="top"><p class="src"><a name="v:updateIl" class="def">updateIl</a><a href="Ganeti/HTools/Cluster.html#updateIl" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-Instance.html#t:List">List</a></td><td class="doc"><p>The original instance list
</p></td></tr><tr><td class="src">-&gt; Maybe (<a href="Ganeti-HTools-Node.html#t:GenericAllocElement">GenericAllocElement</a> a)</td><td class="doc"><p>The result of
 the allocation attempt
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a></td><td class="doc"><p>The updated instance list
</p></td></tr></table></div><div class="doc"><p>Calculate the new instance list after allocation solution.
</p></div></div><div class="top"><p class="src"><a name="v:extractNl" class="def">extractNl</a><a href="Ganeti/HTools/Cluster.html#extractNl" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-Node.html#t:List">List</a></td><td class="doc"><p>The original node list
</p></td></tr><tr><td class="src">-&gt; Maybe (<a href="Ganeti-HTools-Node.html#t:GenericAllocElement">GenericAllocElement</a> a)</td><td class="doc"><p>The result of the
 allocation attempt
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a></td><td class="doc"><p>The new node list
</p></td></tr></table></div><div class="doc"><p>Extract the the new node list from the allocation solution.
</p></div></div><div class="top"><p class="src"><a name="v:allocList" class="def">allocList</a><a href="Ganeti/HTools/Cluster.html#allocList" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Group.html#t:List">List</a></td><td class="doc"><p>The group list
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a></td><td class="doc"><p>The node list
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a></td><td class="doc"><p>The instance list
</p></td></tr><tr><td class="src">-&gt; [(<a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a>, <a href="Ganeti-HTools-Cluster.html#t:AllocDetails">AllocDetails</a>)]</td><td class="doc"><p>The instance to
   allocate
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocSolutionList">AllocSolutionList</a></td><td class="doc"><p>Possible solution
   list
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (<a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>, <a href="Ganeti-HTools-Cluster.html#t:AllocSolutionList">AllocSolutionList</a>)</td><td class="doc"><p>The final solution
   list
</p></td></tr></table></div><div class="doc"><p>Try to allocate a list of instances on a multi-group cluster.
</p></div></div><div class="top"><p class="src"><a name="v:tryChangeGroup" class="def">tryChangeGroup</a><a href="Ganeti/HTools/Cluster.html#tryChangeGroup" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Group.html#t:List">List</a></td><td class="doc"><p>The cluster groups
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a></td><td class="doc"><p>The node list (cluster-wide)
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a></td><td class="doc"><p>Instance list (cluster-wide)
</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-HTools-Types.html#t:Gdx">Gdx</a>]</td><td class="doc"><p>Target groups; if empty, any
 groups not being evacuated
</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-HTools-Types.html#t:Idx">Idx</a>]</td><td class="doc"><p>List of instance (indices) to be evacuated
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (<a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>, <a href="Ganeti-HTools-Cluster-Evacuate.html#t:EvacSolution">EvacSolution</a>)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Change-group IAllocator mode main function.
</p><p>This is very similar to <code>tryNodeEvac</code>, the only difference is that
 we don't choose as target group the current instance group, but
 instead:
</p><ol><li> at the start of the function, we compute which are the target
   groups; either no groups were passed in, in which case we choose
   all groups out of which we don't evacuate instance, or there were
   some groups passed, in which case we use those
</li><li> for each instance, we use <code><a href="Ganeti-HTools-Cluster.html#v:findBestAllocGroup">findBestAllocGroup</a></code> to choose the
   best group to hold the instance, and then we do what
   <code>tryNodeEvac</code> does, except for this group instead of the current
   instance group.
</li></ol><p>Note that the correct behaviour of this function relies on the
 function <code><a href="Ganeti-HTools-Cluster-Evacuate.html#v:nodeEvacInstance">nodeEvacInstance</a></code> to be able to do correctly both
 intra-group and inter-group moves when passed the <code><a href="Ganeti-Types.html#v:ChangeAll">ChangeAll</a></code> mode.
</p></div></div><div class="top"><p class="src"><a name="v:iterateAlloc" class="def">iterateAlloc</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocMethod">AllocMethod</a><a href="Ganeti/HTools/Cluster.html#iterateAlloc" class="link">Source</a></p><div class="doc"><p>Standard-sized allocation method.
</p><p>This places instances of the same size on the cluster until we're
 out of space. The result will be a list of identically-sized
 instances.
</p></div></div><div class="top"><p class="src"><a name="v:sufficesShrinking" class="def">sufficesShrinking</a> :: (<a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocSolution">AllocSolution</a>) -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Types.html#t:FailMode">FailMode</a> -&gt; Maybe <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a><a href="Ganeti/HTools/Cluster.html#sufficesShrinking" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:tieredAlloc" class="def">tieredAlloc</a> :: <a href="Ganeti-HTools-AlgorithmParams.html#t:AlgorithmOptions">AlgorithmOptions</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocMethod">AllocMethod</a><a href="Ganeti/HTools/Cluster.html#tieredAlloc" class="link">Source</a></p><div class="doc"><p>Tiered allocation method.
</p><p>This places instances on the cluster, and decreases the spec until
 we can allocate again. The result will be a list of decreasing
 instance specs.
</p></div></div><h1 id="g:5">Formatting functions
</h1><div class="top"><p class="src"><a name="v:computeMoves" class="def">computeMoves</a> :: <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; String -&gt; <a href="Ganeti-HTools-Types.html#t:IMove">IMove</a> -&gt; String -&gt; String -&gt; (String, [String])<a href="Ganeti/HTools/Cluster.html#computeMoves" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:printSolutionLine" class="def">printSolutionLine</a><a href="Ganeti/HTools/Cluster.html#printSolutionLine" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-Node.html#t:List">List</a></td><td class="doc"><p>The node list
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a></td><td class="doc"><p>The instance list
</p></td></tr><tr><td class="src">-&gt; Int</td><td class="doc"><p>Maximum node name length
</p></td></tr><tr><td class="src">-&gt; Int</td><td class="doc"><p>Maximum instance name length
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Types.html#t:Placement">Placement</a></td><td class="doc"><p>The current placement
</p></td></tr><tr><td class="src">-&gt; Int</td><td class="doc"><p>The index of the placement in
 the solution
</p></td></tr><tr><td class="src">-&gt; (String, [String])</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Converts a placement to string format.
</p></div></div><div class="top"><p class="src"><a name="v:involvedNodes" class="def">involvedNodes</a><a href="Ganeti/HTools/Cluster.html#involvedNodes" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-Instance.html#t:List">List</a></td><td class="doc"><p>Instance list, used for retrieving
 the instance from its index; note
 that this <em>must</em> be the original
 instance list, so that we can
 retrieve the old nodes
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Types.html#t:Placement">Placement</a></td><td class="doc"><p>The placement we're investigating,
 containing the new nodes and
 instance index
</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>]</td><td class="doc"><p>Resulting list of node indices
</p></td></tr></table></div><div class="doc"><p>Return the instance and involved nodes in an instance move.
</p><p>Note that the output list length can vary, and is not required nor
 guaranteed to be of any specific length.
</p></div></div><div class="top"><p class="src"><a name="v:getMoves" class="def">getMoves</a> :: (<a href="Ganeti-HTools-Cluster.html#t:Table">Table</a>, <a href="Ganeti-HTools-Cluster.html#t:Table">Table</a>) -&gt; [<a href="Ganeti-HTools-Types.html#t:MoveJob">MoveJob</a>]<a href="Ganeti/HTools/Cluster.html#getMoves" class="link">Source</a></p><div class="doc"><p>From two adjacent cluster tables get the list of moves that transitions
 from to the other
</p></div></div><div class="top"><p class="src"><a name="v:mergeJobs" class="def">mergeJobs</a> :: ([<a href="Ganeti-HTools-Types.html#t:JobSet">JobSet</a>], [<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>]) -&gt; <a href="Ganeti-HTools-Types.html#t:MoveJob">MoveJob</a> -&gt; ([<a href="Ganeti-HTools-Types.html#t:JobSet">JobSet</a>], [<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>])<a href="Ganeti/HTools/Cluster.html#mergeJobs" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:splitJobs" class="def">splitJobs</a> :: [<a href="Ganeti-HTools-Types.html#t:MoveJob">MoveJob</a>] -&gt; [<a href="Ganeti-HTools-Types.html#t:JobSet">JobSet</a>]<a href="Ganeti/HTools/Cluster.html#splitJobs" class="link">Source</a></p><div class="doc"><p>Break a list of moves into independent groups. Note that this
 will reverse the order of jobs.
</p></div></div><div class="top"><p class="src"><a name="v:formatJob" class="def">formatJob</a> :: Int -&gt; Int -&gt; (Int, <a href="Ganeti-HTools-Types.html#t:MoveJob">MoveJob</a>) -&gt; [String]<a href="Ganeti/HTools/Cluster.html#formatJob" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:formatCmds" class="def">formatCmds</a> :: [<a href="Ganeti-HTools-Types.html#t:JobSet">JobSet</a>] -&gt; String<a href="Ganeti/HTools/Cluster.html#formatCmds" class="link">Source</a></p><div class="doc"><p>Given a list of commands, prefix them with <code>gnt-instance</code> and
 also beautify the display a little.
</p></div></div><div class="top"><p class="src"><a name="v:printNodes" class="def">printNodes</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; [String] -&gt; String<a href="Ganeti/HTools/Cluster.html#printNodes" class="link">Source</a></p><div class="doc"><p>Print the node list.
</p></div></div><div class="top"><p class="src"><a name="v:printInsts" class="def">printInsts</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; String<a href="Ganeti/HTools/Cluster.html#printInsts" class="link">Source</a></p><div class="doc"><p>Print the instance list.
</p></div></div><h1 id="g:6">Node group functions
</h1><div class="top"><p class="src"><a name="v:instanceGroup" class="def">instanceGroup</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Types.html#t:Gdx">Gdx</a><a href="Ganeti/HTools/Cluster.html#instanceGroup" class="link">Source</a></p><div class="doc"><p>Computes the group of an instance.
</p></div></div><div class="top"><p class="src"><a name="v:findSplitInstances" class="def">findSplitInstances</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; [<a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a>]<a href="Ganeti/HTools/Cluster.html#findSplitInstances" class="link">Source</a></p><div class="doc"><p>Compute the list of badly allocated instances (split across node
 groups).
</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.10.0</p></div></body></html>