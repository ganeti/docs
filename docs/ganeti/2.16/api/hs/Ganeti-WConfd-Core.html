<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ganeti.WConfd.Core</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Ganeti-WConfd-Core.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="Ganeti/WConfd/Core.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ganeti</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Ganeti.WConfd.Core</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Functions available to the RPC module
</a><ul><li><a href="#g:2">Configuration related functions
</a><ul><li><a href="#g:3">Locks on the configuration (only transitional, will be removed later)
</a></li></ul></li><li><a href="#g:4">Temporary reservations related functions
</a><ul><li><a href="#g:5">DRBD
</a></li><li><a href="#g:6">MACs
</a></li><li><a href="#g:7">DRBDSecrets
</a></li><li><a href="#g:8">LVs
</a></li><li><a href="#g:9">IPv4s
</a></li></ul></li><li><a href="#g:10">Locking related functions
</a></li></ul></li><li><a href="#g:11">Prepareation for cluster destruction
</a></li><li><a href="#g:12">The list of all functions exported to RPC.
</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>The Ganeti WConfd core functions.
</p><p>This module defines all the functions that WConfD exports for
RPC calls. They are in a separate module so that in a later
stage, TemplateHaskell can generate, e.g., the python interface
for those.
</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:echo">echo</a> :: String -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> String</li><li class="src short"><a href="#v:checkConfigLock">checkConfigLock</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:readConfig">readConfig</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a></li><li class="src short"><a href="#v:writeConfig">writeConfig</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:verifyConfig">verifyConfig</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:lockConfig">lockConfig</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; Bool -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> (<a href="Ganeti-JSON.html#t:MaybeForJSON">MaybeForJSON</a> <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a>)</li><li class="src short"><a href="#v:unlockConfig">unlockConfig</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:writeConfigAndUnlock">writeConfigAndUnlock</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> Bool</li><li class="src short"><a href="#v:flushConfig">flushConfig</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:flushConfigGroup">flushConfigGroup</a> :: String -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:dropAllReservations">dropAllReservations</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:computeDRBDMap">computeDRBDMap</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> <a href="Ganeti-WConfd-TempRes.html#t:DRBDMap">DRBDMap</a></li><li class="src short"><a href="#v:allocateDRBDMinor">allocateDRBDMinor</a> :: <a href="Ganeti-WConfd-TempRes.html#t:DiskUUID">DiskUUID</a> -&gt; [<a href="Ganeti-WConfd-TempRes.html#t:NodeUUID">NodeUUID</a>] -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> [<a href="Ganeti-WConfd-TempRes.html#t:DRBDMinor">DRBDMinor</a>]</li><li class="src short"><a href="#v:releaseDRBDMinors">releaseDRBDMinors</a> :: <a href="Ganeti-WConfd-TempRes.html#t:DiskUUID">DiskUUID</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:generateMAC">generateMAC</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-JSON.html#t:MaybeForJSON">MaybeForJSON</a> <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> <a href="Ganeti-Config.html#t:MAC">MAC</a></li><li class="src short"><a href="#v:reserveMAC">reserveMAC</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-Config.html#t:MAC">MAC</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:generateDRBDSecret">generateDRBDSecret</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> <a href="Ganeti-Objects-Disk.html#t:DRBDSecret">DRBDSecret</a></li><li class="src short"><a href="#v:reserveLV">reserveLV</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-Objects-Disk.html#t:LogicalVolume">LogicalVolume</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:reserveIp">reserveIp</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; <a href="Ganeti-Objects.html#t:Ip4Address">Ip4Address</a> -&gt; Bool -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:releaseIp">releaseIp</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; <a href="Ganeti-Objects.html#t:Ip4Address">Ip4Address</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:generateIp">generateIp</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> <a href="Ganeti-Objects.html#t:Ip4Address">Ip4Address</a></li><li class="src short"><a href="#v:commitTemporaryIps">commitTemporaryIps</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:commitReleaseTemporaryIp">commitReleaseTemporaryIp</a> :: <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; <a href="Ganeti-Objects.html#t:Ip4Address">Ip4Address</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:listReservedIps">listReservedIps</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> [<a href="Ganeti-WConfd-TempRes.html#t:IPv4Reservation">IPv4Reservation</a>]</li><li class="src short"><a href="#v:listLocks">listLocks</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> [(<a href="Ganeti-Locking-Locks.html#t:GanetiLocks">GanetiLocks</a>, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)]</li><li class="src short"><a href="#v:listAllLocks">listAllLocks</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> [<a href="Ganeti-Locking-Locks.html#t:GanetiLocks">GanetiLocks</a>]</li><li class="src short"><a href="#v:listAllLocksOwners">listAllLocksOwners</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> [(<a href="Ganeti-Locking-Locks.html#t:GanetiLocks">GanetiLocks</a>, [(<a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a>, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)])]</li><li class="src short"><a href="#v:listLocksWaitingStatus">listLocksWaitingStatus</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ([(<a href="Ganeti-Locking-Locks.html#t:GanetiLocks">GanetiLocks</a>, [(<a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a>, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)])], [(Integer, <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a>, [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> <a href="Ganeti-Locking-Locks.html#t:GanetiLocks">GanetiLocks</a>])])</li><li class="src short"><a href="#v:tryUpdateLocks">tryUpdateLocks</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-Language.html#t:GanetiLockRequest">GanetiLockRequest</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> [<a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a>]</li><li class="src short"><a href="#v:updateLocksWaiting">updateLocksWaiting</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; Integer -&gt; <a href="Ganeti-WConfd-Language.html#t:GanetiLockRequest">GanetiLockRequest</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> [<a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a>]</li><li class="src short"><a href="#v:hasPendingRequest">hasPendingRequest</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> Bool</li><li class="src short"><a href="#v:freeLocks">freeLocks</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:freeLocksLevel">freeLocksLevel</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-Locking-Locks.html#t:LockLevel">LockLevel</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:downGradeLocksLevel">downGradeLocksLevel</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-Locking-Locks.html#t:LockLevel">LockLevel</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:intersectLocks">intersectLocks</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; [<a href="Ganeti-Locking-Locks.html#t:GanetiLocks">GanetiLocks</a>] -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:opportunisticLockUnion">opportunisticLockUnion</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; [(<a href="Ganeti-Locking-Locks.html#t:GanetiLocks">GanetiLocks</a>, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)] -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> [<a href="Ganeti-Locking-Locks.html#t:GanetiLocks">GanetiLocks</a>]</li><li class="src short"><a href="#v:guardedOpportunisticLockUnion">guardedOpportunisticLockUnion</a> :: Int -&gt; <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; [(<a href="Ganeti-Locking-Locks.html#t:GanetiLocks">GanetiLocks</a>, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)] -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> [<a href="Ganeti-Locking-Locks.html#t:GanetiLocks">GanetiLocks</a>]</li><li class="src short"><a href="#v:prepareClusterDestruction">prepareClusterDestruction</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()</li><li class="src short"><a href="#v:exportedFunctions">exportedFunctions</a> :: [Name]</li></ul></div><div id="interface"><h1 id="g:1">Functions available to the RPC module
</h1><div class="top"><p class="src"><a name="v:echo" class="def">echo</a> :: String -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> String<a href="Ganeti/WConfd/Core.html#echo" class="link">Source</a></p></div><h2 id="g:2">Configuration related functions
</h2><div class="top"><p class="src"><a name="v:checkConfigLock" class="def">checkConfigLock</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()<a href="Ganeti/WConfd/Core.html#checkConfigLock" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:readConfig" class="def">readConfig</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a><a href="Ganeti/WConfd/Core.html#readConfig" class="link">Source</a></p><div class="doc"><p>Read the configuration.
</p></div></div><div class="top"><p class="src"><a name="v:writeConfig" class="def">writeConfig</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()<a href="Ganeti/WConfd/Core.html#writeConfig" class="link">Source</a></p><div class="doc"><p>Write the configuration, checking that an exclusive lock is held.
 If not, the call fails.
</p></div></div><div class="top"><p class="src"><a name="v:verifyConfig" class="def">verifyConfig</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()<a href="Ganeti/WConfd/Core.html#verifyConfig" class="link">Source</a></p><div class="doc"><p>Explicitly run verification of the configuration.
 The caller doesn't need to hold the configuration lock.
</p></div></div><h3 id="g:3">Locks on the configuration (only transitional, will be removed later)
</h3><div class="top"><p class="src"><a name="v:lockConfig" class="def">lockConfig</a><a href="Ganeti/WConfd/Core.html#lockConfig" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; Bool</td><td class="doc"><p>set to <code>True</code> if the lock should be shared
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> (<a href="Ganeti-JSON.html#t:MaybeForJSON">MaybeForJSON</a> <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a>)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Tries to acquire <code><a href="Ganeti-Locking-Locks.html#v:ConfigLock">ConfigLock</a></code> for the client.
 If the second parameter is set to <code>True</code>, the lock is acquired in
 shared mode.
</p><p>If the lock was successfully acquired, returns the current configuration
 state.
</p></div></div><div class="top"><p class="src"><a name="v:unlockConfig" class="def">unlockConfig</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()<a href="Ganeti/WConfd/Core.html#unlockConfig" class="link">Source</a></p><div class="doc"><p>Release the config lock, if the client currently holds it.
</p></div></div><div class="top"><p class="src"><a name="v:writeConfigAndUnlock" class="def">writeConfigAndUnlock</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> Bool<a href="Ganeti/WConfd/Core.html#writeConfigAndUnlock" class="link">Source</a></p><div class="doc"><p>Write the configuration, if the config lock is held exclusively,
 and release the config lock. It the caller does not have the config
 lock, return False.
</p></div></div><div class="top"><p class="src"><a name="v:flushConfig" class="def">flushConfig</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()<a href="Ganeti/WConfd/Core.html#flushConfig" class="link">Source</a></p><div class="doc"><p>Force the distribution of configuration without actually modifying it.
 It is not necessary to hold a lock for this operation.
</p></div></div><div class="top"><p class="src"><a name="v:flushConfigGroup" class="def">flushConfigGroup</a> :: String -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()<a href="Ganeti/WConfd/Core.html#flushConfigGroup" class="link">Source</a></p><div class="doc"><p>Force the distribution of configuration to a given group without actually
 modifying it. It is not necessary to hold a lock for this operation.
</p></div></div><h2 id="g:4">Temporary reservations related functions
</h2><div class="top"><p class="src"><a name="v:dropAllReservations" class="def">dropAllReservations</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()<a href="Ganeti/WConfd/Core.html#dropAllReservations" class="link">Source</a></p></div><h3 id="g:5">DRBD
</h3><div class="top"><p class="src"><a name="v:computeDRBDMap" class="def">computeDRBDMap</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> <a href="Ganeti-WConfd-TempRes.html#t:DRBDMap">DRBDMap</a><a href="Ganeti/WConfd/Core.html#computeDRBDMap" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:allocateDRBDMinor" class="def">allocateDRBDMinor</a> :: <a href="Ganeti-WConfd-TempRes.html#t:DiskUUID">DiskUUID</a> -&gt; [<a href="Ganeti-WConfd-TempRes.html#t:NodeUUID">NodeUUID</a>] -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> [<a href="Ganeti-WConfd-TempRes.html#t:DRBDMinor">DRBDMinor</a>]<a href="Ganeti/WConfd/Core.html#allocateDRBDMinor" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:releaseDRBDMinors" class="def">releaseDRBDMinors</a> :: <a href="Ganeti-WConfd-TempRes.html#t:DiskUUID">DiskUUID</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()<a href="Ganeti/WConfd/Core.html#releaseDRBDMinors" class="link">Source</a></p></div><h3 id="g:6">MACs
</h3><div class="top"><p class="src"><a name="v:generateMAC" class="def">generateMAC</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-JSON.html#t:MaybeForJSON">MaybeForJSON</a> <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> <a href="Ganeti-Config.html#t:MAC">MAC</a><a href="Ganeti/WConfd/Core.html#generateMAC" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:reserveMAC" class="def">reserveMAC</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-Config.html#t:MAC">MAC</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()<a href="Ganeti/WConfd/Core.html#reserveMAC" class="link">Source</a></p></div><h3 id="g:7">DRBDSecrets
</h3><div class="top"><p class="src"><a name="v:generateDRBDSecret" class="def">generateDRBDSecret</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> <a href="Ganeti-Objects-Disk.html#t:DRBDSecret">DRBDSecret</a><a href="Ganeti/WConfd/Core.html#generateDRBDSecret" class="link">Source</a></p></div><h3 id="g:8">LVs
</h3><div class="top"><p class="src"><a name="v:reserveLV" class="def">reserveLV</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-Objects-Disk.html#t:LogicalVolume">LogicalVolume</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()<a href="Ganeti/WConfd/Core.html#reserveLV" class="link">Source</a></p></div><h3 id="g:9">IPv4s
</h3><div class="top"><p class="src"><a name="v:reserveIp" class="def">reserveIp</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; <a href="Ganeti-Objects.html#t:Ip4Address">Ip4Address</a> -&gt; Bool -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()<a href="Ganeti/WConfd/Core.html#reserveIp" class="link">Source</a></p><div class="doc"><p>Reserve a given IPv4 address for use by an instance.
</p></div></div><div class="top"><p class="src"><a name="v:releaseIp" class="def">releaseIp</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; <a href="Ganeti-Objects.html#t:Ip4Address">Ip4Address</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()<a href="Ganeti/WConfd/Core.html#releaseIp" class="link">Source</a></p><div class="doc"><p>Give a specific IP address back to an IP pool.
 The IP address is returned to the IP pool designated by network id
 and marked as reserved.
</p></div></div><div class="top"><p class="src"><a name="v:generateIp" class="def">generateIp</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> <a href="Ganeti-Objects.html#t:Ip4Address">Ip4Address</a><a href="Ganeti/WConfd/Core.html#generateIp" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:commitTemporaryIps" class="def">commitTemporaryIps</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()<a href="Ganeti/WConfd/Core.html#commitTemporaryIps" class="link">Source</a></p><div class="doc"><p>Commit all reserved/released IP address to an IP pool.
 The IP addresses are taken from the network's IP pool and marked as
 reserved/free for instances.
</p><p>Note that the reservations are kept, they are supposed to be cleaned
 when a job finishes.
</p></div></div><div class="top"><p class="src"><a name="v:commitReleaseTemporaryIp" class="def">commitReleaseTemporaryIp</a> :: <a href="Ganeti-WConfd-TempRes.html#t:NetworkUUID">NetworkUUID</a> -&gt; <a href="Ganeti-Objects.html#t:Ip4Address">Ip4Address</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()<a href="Ganeti/WConfd/Core.html#commitReleaseTemporaryIp" class="link">Source</a></p><div class="doc"><p>Immediately release an IP address, without using the reservations pool.
</p></div></div><div class="top"><p class="src"><a name="v:listReservedIps" class="def">listReservedIps</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> [<a href="Ganeti-WConfd-TempRes.html#t:IPv4Reservation">IPv4Reservation</a>]<a href="Ganeti/WConfd/Core.html#listReservedIps" class="link">Source</a></p><div class="doc"><p>List all IP reservations for the current client.
</p><p>This function won't be needed once the corresponding calls are moved to
 WConfd.
</p></div></div><h2 id="g:10">Locking related functions
</h2><div class="top"><p class="src"><a name="v:listLocks" class="def">listLocks</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> [(<a href="Ganeti-Locking-Locks.html#t:GanetiLocks">GanetiLocks</a>, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)]<a href="Ganeti/WConfd/Core.html#listLocks" class="link">Source</a></p><div class="doc"><p>List the locks of a given owner (i.e., a job-id lockfile pair).
</p></div></div><div class="top"><p class="src"><a name="v:listAllLocks" class="def">listAllLocks</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> [<a href="Ganeti-Locking-Locks.html#t:GanetiLocks">GanetiLocks</a>]<a href="Ganeti/WConfd/Core.html#listAllLocks" class="link">Source</a></p><div class="doc"><p>List all active locks.
</p></div></div><div class="top"><p class="src"><a name="v:listAllLocksOwners" class="def">listAllLocksOwners</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> [(<a href="Ganeti-Locking-Locks.html#t:GanetiLocks">GanetiLocks</a>, [(<a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a>, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)])]<a href="Ganeti/WConfd/Core.html#listAllLocksOwners" class="link">Source</a></p><div class="doc"><p>List all active locks with their owners.
</p></div></div><div class="top"><p class="src"><a name="v:listLocksWaitingStatus" class="def">listLocksWaitingStatus</a> :: <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ([(<a href="Ganeti-Locking-Locks.html#t:GanetiLocks">GanetiLocks</a>, [(<a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a>, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)])], [(Integer, <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a>, [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> <a href="Ganeti-Locking-Locks.html#t:GanetiLocks">GanetiLocks</a>])])<a href="Ganeti/WConfd/Core.html#listLocksWaitingStatus" class="link">Source</a></p><div class="doc"><p>Get full information of the lock waiting status, i.e., provide
 the information about all locks owners and all pending requests.
</p></div></div><div class="top"><p class="src"><a name="v:tryUpdateLocks" class="def">tryUpdateLocks</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-Language.html#t:GanetiLockRequest">GanetiLockRequest</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> [<a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a>]<a href="Ganeti/WConfd/Core.html#tryUpdateLocks" class="link">Source</a></p><div class="doc"><p>Try to update the locks of a given owner (i.e., a job-id lockfile pair).
 This function always returns immediately. If the lock update was possible,
 the empty list is returned; otherwise, the lock status is left completly
 unchanged, and the return value is the list of jobs which need to release
 some locks before this request can succeed.
</p></div></div><div class="top"><p class="src"><a name="v:updateLocksWaiting" class="def">updateLocksWaiting</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; Integer -&gt; <a href="Ganeti-WConfd-Language.html#t:GanetiLockRequest">GanetiLockRequest</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> [<a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a>]<a href="Ganeti/WConfd/Core.html#updateLocksWaiting" class="link">Source</a></p><div class="doc"><p>Try to update the locks of a given owner and make that a pending
 request if not immediately possible.
</p></div></div><div class="top"><p class="src"><a name="v:hasPendingRequest" class="def">hasPendingRequest</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> Bool<a href="Ganeti/WConfd/Core.html#hasPendingRequest" class="link">Source</a></p><div class="doc"><p>Tell whether a given owner has pending requests.
</p></div></div><div class="top"><p class="src"><a name="v:freeLocks" class="def">freeLocks</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()<a href="Ganeti/WConfd/Core.html#freeLocks" class="link">Source</a></p><div class="doc"><p>Free all locks of a given owner (i.e., a job-id lockfile pair).
</p></div></div><div class="top"><p class="src"><a name="v:freeLocksLevel" class="def">freeLocksLevel</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-Locking-Locks.html#t:LockLevel">LockLevel</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()<a href="Ganeti/WConfd/Core.html#freeLocksLevel" class="link">Source</a></p><div class="doc"><p>Free all locks of a given owner (i.e., a job-id lockfile pair)
 of a given level in the Ganeti sense (e.g., <a href="cluster.html">cluster</a>, <a href="node.html">node</a>).
</p></div></div><div class="top"><p class="src"><a name="v:downGradeLocksLevel" class="def">downGradeLocksLevel</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-Locking-Locks.html#t:LockLevel">LockLevel</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()<a href="Ganeti/WConfd/Core.html#downGradeLocksLevel" class="link">Source</a></p><div class="doc"><p>Downgrade all locks of the given level to shared.
</p></div></div><div class="top"><p class="src"><a name="v:intersectLocks" class="def">intersectLocks</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; [<a href="Ganeti-Locking-Locks.html#t:GanetiLocks">GanetiLocks</a>] -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()<a href="Ganeti/WConfd/Core.html#intersectLocks" class="link">Source</a></p><div class="doc"><p>Intersect the possesed locks of an owner with a given set.
</p></div></div><div class="top"><p class="src"><a name="v:opportunisticLockUnion" class="def">opportunisticLockUnion</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; [(<a href="Ganeti-Locking-Locks.html#t:GanetiLocks">GanetiLocks</a>, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)] -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> [<a href="Ganeti-Locking-Locks.html#t:GanetiLocks">GanetiLocks</a>]<a href="Ganeti/WConfd/Core.html#opportunisticLockUnion" class="link">Source</a></p><div class="doc"><p>Opportunistically allocate locks for a given owner.
</p></div></div><div class="top"><p class="src"><a name="v:guardedOpportunisticLockUnion" class="def">guardedOpportunisticLockUnion</a> :: Int -&gt; <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; [(<a href="Ganeti-Locking-Locks.html#t:GanetiLocks">GanetiLocks</a>, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)] -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> [<a href="Ganeti-Locking-Locks.html#t:GanetiLocks">GanetiLocks</a>]<a href="Ganeti/WConfd/Core.html#guardedOpportunisticLockUnion" class="link">Source</a></p><div class="doc"><p>Opprtunistially allocate locks for a given owner, requesting a
 certain minimum of success.
</p></div></div><h1 id="g:11">Prepareation for cluster destruction
</h1><div class="top"><p class="src"><a name="v:prepareClusterDestruction" class="def">prepareClusterDestruction</a> :: <a href="Ganeti-Locking-Locks.html#t:ClientId">ClientId</a> -&gt; <a href="Ganeti-WConfd-Monad.html#t:WConfdMonad">WConfdMonad</a> ()<a href="Ganeti/WConfd/Core.html#prepareClusterDestruction" class="link">Source</a></p><div class="doc"><p>Prepare daemon for cluster destruction. This consists of
 verifying that the requester owns the BGL exclusively, transfering the BGL
 to WConfD itself, and modifying the configuration so that no
 node is the master any more. Note that, since we own the BGL exclusively,
 we can safely modify the configuration, as no other process can request
 changes.
</p></div></div><h1 id="g:12">The list of all functions exported to RPC.
</h1><div class="top"><p class="src"><a name="v:exportedFunctions" class="def">exportedFunctions</a> :: [Name]<a href="Ganeti/WConfd/Core.html#exportedFunctions" class="link">Source</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.10.0</p></div></body></html>