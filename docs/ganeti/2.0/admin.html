<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
<title>Ganeti administrator's guide</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 5951 2009-05-18 18:03:10Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left{
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: left }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="ganeti-administrator-s-guide">
<h1 class="title">Ganeti administrator's guide</h1>

<p>Documents Ganeti version 2.0</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a><ul>
<li><a class="reference internal" href="#ganeti-terminology" id="id2">Ganeti terminology</a></li>
<li><a class="reference internal" href="#prerequisites" id="id3">Prerequisites</a></li>
</ul>
</li>
<li><a class="reference internal" href="#managing-instances" id="id4">Managing Instances</a><ul>
<li><a class="reference internal" href="#adding-removing-an-instance" id="id5">Adding/Removing an instance</a></li>
<li><a class="reference internal" href="#starting-stopping-an-instance" id="id6">Starting/Stopping an instance</a></li>
<li><a class="reference internal" href="#exporting-importing-an-instance" id="id7">Exporting/Importing an instance</a></li>
</ul>
</li>
<li><a class="reference internal" href="#high-availability-features" id="id8">High availability features</a><ul>
<li><a class="reference internal" href="#failing-over-an-instance" id="id9">Failing over an instance</a></li>
<li><a class="reference internal" href="#live-migrating-an-instance" id="id10">Live migrating an instance</a></li>
<li><a class="reference internal" href="#replacing-an-instance-disks" id="id11">Replacing an instance disks</a></li>
<li><a class="reference internal" href="#failing-over-the-master-node" id="id12">Failing over the master node</a></li>
<li><a class="reference internal" href="#adding-removing-nodes" id="id13">Adding/Removing nodes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#debugging-features" id="id14">Debugging Features</a><ul>
<li><a class="reference internal" href="#accessing-an-instance-s-disks" id="id15">Accessing an instance's disks</a></li>
<li><a class="reference internal" href="#instance-os-definitions-debugging" id="id16">Instance OS definitions Debugging</a></li>
<li><a class="reference internal" href="#cluster-wide-debugging" id="id17">Cluster-wide debugging</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h1><a class="toc-backref" href="#id1">Introduction</a></h1>
<p>Ganeti is a virtualization cluster management software. You are
expected to be a system administrator familiar with your Linux
distribution and the Xen or KVM virtualization environments before
using it.</p>
<p>The various components of Ganeti all have man pages and interactive
help. This manual though will help you getting familiar with the
system by explaining the most common operations, grouped by related
use.</p>
<p>After a terminology glossary and a section on the prerequisites needed
to use this manual, the rest of this document is divided in three main
sections, which group different features of Ganeti:</p>
<ul class="simple">
<li>Instance Management</li>
<li>High Availability Features</li>
<li>Debugging Features</li>
</ul>
<div class="section" id="ganeti-terminology">
<h2><a class="toc-backref" href="#id2">Ganeti terminology</a></h2>
<p>This section provides a small introduction to Ganeti terminology,
which might be useful to read the rest of the document.</p>
<dl class="docutils">
<dt>Cluster</dt>
<dd>A set of machines (nodes) that cooperate to offer a coherent
highly available virtualization service.</dd>
<dt>Node</dt>
<dd>A physical machine which is member of a cluster.
Nodes are the basic cluster infrastructure, and are
not fault tolerant.</dd>
<dt>Master node</dt>
<dd>The node which controls the Cluster, from which all
Ganeti commands must be given.</dd>
<dt>Instance</dt>
<dd>A virtual machine which runs on a cluster. It can be a
fault tolerant highly available entity.</dd>
<dt>Pool</dt>
<dd>A pool is a set of clusters sharing the same network.</dd>
<dt>Meta-Cluster</dt>
<dd>Anything that concerns more than one cluster.</dd>
</dl>
</div>
<div class="section" id="prerequisites">
<h2><a class="toc-backref" href="#id3">Prerequisites</a></h2>
<p>You need to have your Ganeti cluster installed and configured before
you try any of the commands in this document. Please follow the
<em>Ganeti installation tutorial</em> for instructions on how to do that.</p>
</div>
</div>
<div class="section" id="managing-instances">
<h1><a class="toc-backref" href="#id4">Managing Instances</a></h1>
<div class="section" id="adding-removing-an-instance">
<h2><a class="toc-backref" href="#id5">Adding/Removing an instance</a></h2>
<p>Adding a new virtual instance to your Ganeti cluster is really easy.
The command is:</p>
<pre class="literal-block">
gnt-instance add \
  -n TARGET_NODE:SECONDARY_NODE -o OS_TYPE -t DISK_TEMPLATE \
  INSTANCE_NAME
</pre>
<p>The instance name must be resolvable (e.g. exist in DNS) and usually
to an address in the same subnet as the cluster itself. Options you
can give to this command include:</p>
<ul class="simple">
<li>The disk size (<tt class="docutils literal"><span class="pre">-s</span></tt>) for a single-disk instance, or multiple
<tt class="docutils literal"><span class="pre">--disk</span> N:size=SIZE</tt> options for multi-instance disks</li>
<li>The memory size (<tt class="docutils literal"><span class="pre">-B</span> memory</tt>)</li>
<li>The number of virtual CPUs (<tt class="docutils literal"><span class="pre">-B</span> vcpus</tt>)</li>
<li>Arguments for the NICs of the instance; by default, a single-NIC
instance is created. The IP and/or bridge of the NIC can be changed
via <tt class="docutils literal"><span class="pre">--nic</span> 0:ip=IP,bridge=BRIDGE</tt></li>
</ul>
<p>There are four types of disk template you can choose from:</p>
<dl class="docutils">
<dt>diskless</dt>
<dd>The instance has no disks. Only used for special purpouse operating
systems or for testing.</dd>
<dt>file</dt>
<dd>The instance will use plain files as backend for its disks. No
redundancy is provided, and this is somewhat more difficult to
configure for high performance.</dd>
<dt>plain</dt>
<dd>The instance will use LVM devices as backend for its disks. No
redundancy is provided.</dd>
<dt>drbd</dt>
<dd><div class="note first">
<p class="first admonition-title">Note</p>
<p class="last">This is only valid for multi-node clusters using DRBD 8.0.x</p>
</div>
<p class="last">A mirror is set between the local node and a remote one, which must
be specified with the second value of the --node option. Use this
option to obtain a highly available instance that can be failed over
to a remote node should the primary one fail.</p>
</dd>
</dl>
<p>For example if you want to create an highly available instance use the
drbd disk templates:</p>
<pre class="literal-block">
gnt-instance add -n TARGET_NODE:SECONDARY_NODE -o OS_TYPE -t drbd \
  INSTANCE_NAME
</pre>
<p>To know which operating systems your cluster supports you can use
the command:</p>
<pre class="literal-block">
gnt-os list
</pre>
<p>Removing an instance is even easier than creating one. This operation
is irrereversible and destroys all the contents of your instance. Use
with care:</p>
<pre class="literal-block">
gnt-instance remove INSTANCE_NAME
</pre>
</div>
<div class="section" id="starting-stopping-an-instance">
<h2><a class="toc-backref" href="#id6">Starting/Stopping an instance</a></h2>
<p>Instances are automatically started at instance creation time. To
manually start one which is currently stopped you can run:</p>
<pre class="literal-block">
gnt-instance startup INSTANCE_NAME
</pre>
<p>While the command to stop one is:</p>
<pre class="literal-block">
gnt-instance shutdown INSTANCE_NAME
</pre>
<p>The command to see all the instances configured and their status is:</p>
<pre class="literal-block">
gnt-instance list
</pre>
<p>Do not use the Xen commands to stop instances. If you run for example
xm shutdown or xm destroy on an instance Ganeti will automatically
restart it (via the <tt class="docutils literal"><span class="pre">ganeti-watcher</span></tt>).</p>
</div>
<div class="section" id="exporting-importing-an-instance">
<h2><a class="toc-backref" href="#id7">Exporting/Importing an instance</a></h2>
<p>You can create a snapshot of an instance disk and Ganeti
configuration, which then you can backup, or import into another
cluster. The way to export an instance is:</p>
<pre class="literal-block">
gnt-backup export -n TARGET_NODE INSTANCE_NAME
</pre>
<p>The target node can be any node in the cluster with enough space under
<tt class="docutils literal">/srv/ganeti</tt> to hold the instance image. Use the <em>--noshutdown</em>
option to snapshot an instance without rebooting it. Any previous
snapshot of the same instance existing cluster-wide under
<tt class="docutils literal">/srv/ganeti</tt> will be removed by this operation: if you want to keep
them move them out of the Ganeti exports directory.</p>
<p>Importing an instance is similar to creating a new one. The command is:</p>
<pre class="literal-block">
gnt-backup import -n TARGET_NODE -t DISK_TEMPLATE \
  --src-node=NODE --src-dir=DIR INSTANCE_NAME
</pre>
<p>Most of the options available for the command <em>gnt-instance add</em> are
supported here too.</p>
</div>
</div>
<div class="section" id="high-availability-features">
<h1><a class="toc-backref" href="#id8">High availability features</a></h1>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">This section only applies to multi-node clusters</p>
</div>
<div class="section" id="failing-over-an-instance">
<h2><a class="toc-backref" href="#id9">Failing over an instance</a></h2>
<p>If an instance is built in highly available mode you can at any time
fail it over to its secondary node, even if the primary has somehow
failed and it's not up anymore. Doing it is really easy, on the master
node you can just run:</p>
<pre class="literal-block">
gnt-instance failover INSTANCE_NAME
</pre>
<p>That's it. After the command completes the secondary node is now the
primary, and vice versa.</p>
</div>
<div class="section" id="live-migrating-an-instance">
<h2><a class="toc-backref" href="#id10">Live migrating an instance</a></h2>
<p>If an instance is built in highly available mode, it currently runs
and both its nodes are running fine, you can at migrate it over to its
secondary node, without dowtime. On the master node you need to run:</p>
<pre class="literal-block">
gnt-instance migrate INSTANCE_NAME
</pre>
</div>
<div class="section" id="replacing-an-instance-disks">
<h2><a class="toc-backref" href="#id11">Replacing an instance disks</a></h2>
<p>So what if instead the secondary node for an instance has failed, or
you plan to remove a node from your cluster, and you failed over all
its instances, but it's still secondary for some? The solution here is
to replace the instance disks, changing the secondary node:</p>
<pre class="literal-block">
gnt-instance replace-disks -n NODE INSTANCE_NAME
</pre>
<p>This process is a bit long, but involves no instance downtime, and at
the end of it the instance has changed its secondary node, to which it
can if necessary be failed over.</p>
</div>
<div class="section" id="failing-over-the-master-node">
<h2><a class="toc-backref" href="#id12">Failing over the master node</a></h2>
<p>This is all good as long as the Ganeti Master Node is up. Should it go
down, or should you wish to decommission it, just run on any other
node the command:</p>
<pre class="literal-block">
gnt-cluster masterfailover
</pre>
<p>and the node you ran it on is now the new master.</p>
</div>
<div class="section" id="adding-removing-nodes">
<h2><a class="toc-backref" href="#id13">Adding/Removing nodes</a></h2>
<p>And of course, now that you know how to move instances around, it's
easy to free up a node, and then you can remove it from the cluster:</p>
<pre class="literal-block">
gnt-node remove NODE_NAME
</pre>
<p>and maybe add a new one:</p>
<pre class="literal-block">
gnt-node add --secondary-ip=ADDRESS NODE_NAME
</pre>
</div>
</div>
<div class="section" id="debugging-features">
<h1><a class="toc-backref" href="#id14">Debugging Features</a></h1>
<p>At some point you might need to do some debugging operations on your
cluster or on your instances. This section will help you with the most
used debugging functionalities.</p>
<div class="section" id="accessing-an-instance-s-disks">
<h2><a class="toc-backref" href="#id15">Accessing an instance's disks</a></h2>
<p>From an instance's primary node you have access to its disks. Never
ever mount the underlying logical volume manually on a fault tolerant
instance, or you risk breaking replication. The correct way to access
them is to run the command:</p>
<pre class="literal-block">
gnt-instance activate-disks INSTANCE_NAME
</pre>
<p>And then access the device that gets created.  After you've finished
you can deactivate them with the deactivate-disks command, which works
in the same way.</p>
<p>Accessing an instance's console</p>
<p>The command to access a running instance's console is:</p>
<pre class="literal-block">
gnt-instance console INSTANCE_NAME
</pre>
<p>Use the console normally and then type <tt class="docutils literal">^]</tt> when
done, to exit.</p>
</div>
<div class="section" id="instance-os-definitions-debugging">
<h2><a class="toc-backref" href="#id16">Instance OS definitions Debugging</a></h2>
<p>Should you have any problems with operating systems support the
command to ran to see a complete status for all your nodes is:</p>
<pre class="literal-block">
gnt-os diagnose
</pre>
</div>
<div class="section" id="cluster-wide-debugging">
<h2><a class="toc-backref" href="#id17">Cluster-wide debugging</a></h2>
<p>The <em>gnt-cluster</em> command offers several options to run tests or
execute cluster-wide operations. For example:</p>
<pre class="literal-block">
gnt-cluster command
gnt-cluster copyfile
gnt-cluster verify
gnt-cluster verify-disks
gnt-cluster getmaster
gnt-cluster version
</pre>
<p>See the man page <em>gnt-cluster</em> to know more about their usage.</p>
</div>
</div>
</div>
</body>
</html>
