<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ganeti.JQueue</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Ganeti-JQueue.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="Ganeti/JQueue.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ganeti</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Infered</td></tr></table><p class="caption">Ganeti.JQueue</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Data types
</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Implementation of the job queue.
</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:noTimestamp">noTimestamp</a> :: <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a></li><li class="src short"><a href="#v:fromClockTime">fromClockTime</a> :: ClockTime -&gt; <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a></li><li class="src short"><a href="#v:currentTimestamp">currentTimestamp</a> :: IO <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a></li><li class="src short"><a href="#v:advanceTimestamp">advanceTimestamp</a> :: Int -&gt; <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a></li><li class="src short"><a href="#v:toMetaOpCode">toMetaOpCode</a> :: <a href="Ganeti-JQueue-Objects.html#t:InputOpCode">InputOpCode</a> -&gt; [<a href="Ganeti-OpCodes.html#t:MetaOpCode">MetaOpCode</a>]</li><li class="src short"><a href="#v:invalidOp">invalidOp</a> :: String</li><li class="src short"><a href="#v:extractOpSummary">extractOpSummary</a> :: <a href="Ganeti-JQueue-Objects.html#t:InputOpCode">InputOpCode</a> -&gt; String</li><li class="src short"><a href="#v:queuedOpCodeFromMetaOpCode">queuedOpCodeFromMetaOpCode</a> :: <a href="Ganeti-OpCodes.html#t:MetaOpCode">MetaOpCode</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedOpCode">QueuedOpCode</a></li><li class="src short"><a href="#v:queuedJobFromOpCodes">queuedJobFromOpCodes</a> :: Monad m =&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; [<a href="Ganeti-OpCodes.html#t:MetaOpCode">MetaOpCode</a>] -&gt; m <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a></li><li class="src short"><a href="#v:setReceivedTimestamp">setReceivedTimestamp</a> :: <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a></li><li class="src short"><a href="#v:reasonTrailTimestamp">reasonTrailTimestamp</a> :: <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; Integer</li><li class="src short"><a href="#v:extendInputOpCodeReasonTrail">extendInputOpCodeReasonTrail</a> :: <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; Int -&gt; <a href="Ganeti-JQueue-Objects.html#t:InputOpCode">InputOpCode</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:InputOpCode">InputOpCode</a></li><li class="src short"><a href="#v:extendOpCodeReasonTrail">extendOpCodeReasonTrail</a> :: <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; Int -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedOpCode">QueuedOpCode</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedOpCode">QueuedOpCode</a></li><li class="src short"><a href="#v:extendJobReasonTrail">extendJobReasonTrail</a> :: <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a></li><li class="src short"><a href="#v:getJobDependencies">getJobDependencies</a> :: <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; [<a href="Ganeti-Types.html#t:JobId">JobId</a>]</li><li class="src short"><a href="#v:changeOpCodePriority">changeOpCodePriority</a> :: Int -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedOpCode">QueuedOpCode</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedOpCode">QueuedOpCode</a></li><li class="src short"><a href="#v:cancelOpCode">cancelOpCode</a> :: <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedOpCode">QueuedOpCode</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedOpCode">QueuedOpCode</a></li><li class="src short"><a href="#v:changeJobPriority">changeJobPriority</a> :: Int -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a></li><li class="src short"><a href="#v:cancelQueuedJob">cancelQueuedJob</a> :: <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a></li><li class="src short"><a href="#v:failOpCode">failOpCode</a> :: <a href="Ganeti-Types.html#t:ReasonElem">ReasonElem</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedOpCode">QueuedOpCode</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedOpCode">QueuedOpCode</a></li><li class="src short"><a href="#v:failQueuedJob">failQueuedJob</a> :: <a href="Ganeti-Types.html#t:ReasonElem">ReasonElem</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a></li><li class="src short"><a href="#v:jobFilePrefix">jobFilePrefix</a> :: String</li><li class="src short"><a href="#v:jobFileName">jobFileName</a> :: <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; FilePath</li><li class="src short"><a href="#v:parseJobFileId">parseJobFileId</a> :: Monad m =&gt; FilePath -&gt; m <a href="Ganeti-Types.html#t:JobId">JobId</a></li><li class="src short"><a href="#v:liveJobFile">liveJobFile</a> :: FilePath -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; FilePath</li><li class="src short"><a href="#v:archivedJobFile">archivedJobFile</a> :: FilePath -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; FilePath</li><li class="src short"><a href="#v:opStatusToJob">opStatusToJob</a> :: <a href="Ganeti-Types.html#t:OpStatus">OpStatus</a> -&gt; <a href="Ganeti-Types.html#t:JobStatus">JobStatus</a></li><li class="src short"><a href="#v:calcJobStatus">calcJobStatus</a> :: <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; <a href="Ganeti-Types.html#t:JobStatus">JobStatus</a></li><li class="src short"><a href="#v:jobStarted">jobStarted</a> :: <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; Bool</li><li class="src short"><a href="#v:jobFinalized">jobFinalized</a> :: <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; Bool</li><li class="src short"><a href="#v:jobArchivable">jobArchivable</a> :: <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; Bool</li><li class="src short"><a href="#v:opStatusFinalized">opStatusFinalized</a> :: <a href="Ganeti-Types.html#t:OpStatus">OpStatus</a> -&gt; Bool</li><li class="src short"><a href="#v:calcJobPriority">calcJobPriority</a> :: <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; Int</li><li class="src short"><a href="#v:ignoreIOError">ignoreIOError</a> ::  a -&gt; Bool -&gt; String -&gt; IOError -&gt; IO a</li><li class="src short"><a href="#v:allArchiveDirs">allArchiveDirs</a> :: FilePath -&gt; IO [FilePath]</li><li class="src short"><a href="#v:determineJobDirectories">determineJobDirectories</a> :: FilePath -&gt; Bool -&gt; IO [FilePath]</li><li class="src short"><a href="#v:getJobIDs">getJobIDs</a> :: [FilePath] -&gt; IO (<a href="Ganeti-BasicTypes.html#t:GenericResult">GenericResult</a> IOError [<a href="Ganeti-Types.html#t:JobId">JobId</a>])</li><li class="src short"><a href="#v:sortJobIDs">sortJobIDs</a> :: [<a href="Ganeti-Types.html#t:JobId">JobId</a>] -&gt; [<a href="Ganeti-Types.html#t:JobId">JobId</a>]</li><li class="src short"><a href="#v:getDirJobIDs">getDirJobIDs</a> :: FilePath -&gt; <a href="Ganeti-BasicTypes.html#t:ResultT">ResultT</a> IOError IO [<a href="Ganeti-Types.html#t:JobId">JobId</a>]</li><li class="src short"><a href="#v:readJobDataFromDisk">readJobDataFromDisk</a> :: FilePath -&gt; Bool -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; IO (Maybe (String, Bool))</li><li class="src short"><a href="#v:noSuchJob">noSuchJob</a> :: <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (<a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a>, Bool)</li><li class="src short"><a href="#v:loadJobFromDisk">loadJobFromDisk</a> :: FilePath -&gt; Bool -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> (<a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a>, Bool))</li><li class="src short"><a href="#v:writeJobToDisk">writeJobToDisk</a> :: FilePath -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> ())</li><li class="src short"><a href="#v:replicateJob">replicateJob</a> :: FilePath -&gt; [<a href="Ganeti-Objects.html#t:Node">Node</a>] -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; IO [(<a href="Ganeti-Objects.html#t:Node">Node</a>, <a href="Ganeti-Rpc.html#t:ERpcError">ERpcError</a> ())]</li><li class="src short"><a href="#v:replicateManyJobs">replicateManyJobs</a> :: FilePath -&gt; [<a href="Ganeti-Objects.html#t:Node">Node</a>] -&gt; [<a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a>] -&gt; IO ()</li><li class="src short"><a href="#v:writeAndReplicateJob">writeAndReplicateJob</a> :: <a href="Ganeti-BasicTypes.html#t:FromString">FromString</a> e =&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; FilePath -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; <a href="Ganeti-BasicTypes.html#t:ResultT">ResultT</a> e IO [(<a href="Ganeti-Objects.html#t:Node">Node</a>, <a href="Ganeti-Rpc.html#t:ERpcError">ERpcError</a> ())]</li><li class="src short"><a href="#v:readSerialFromDisk">readSerialFromDisk</a> :: IO (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-Types.html#t:JobId">JobId</a>)</li><li class="src short"><a href="#v:allocateJobIds">allocateJobIds</a> :: [<a href="Ganeti-Objects.html#t:Node">Node</a>] -&gt; <a href="Ganeti-Utils-MVarLock.html#t:Lock">Lock</a> -&gt; Int -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> [<a href="Ganeti-Types.html#t:JobId">JobId</a>])</li><li class="src short"><a href="#v:allocateJobId">allocateJobId</a> :: [<a href="Ganeti-Objects.html#t:Node">Node</a>] -&gt; <a href="Ganeti-Utils-MVarLock.html#t:Lock">Lock</a> -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-Types.html#t:JobId">JobId</a>)</li><li class="src short"><a href="#v:isQueueOpen">isQueueOpen</a> :: IO Bool</li><li class="src short"><a href="#v:startJobs">startJobs</a> :: <a href="Ganeti-Utils-Livelock.html#t:Livelock">Livelock</a> -&gt; <a href="Ganeti-Utils-MVarLock.html#t:Lock">Lock</a> -&gt; [<a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a>] -&gt; IO [<a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a>]</li><li class="src short"><a href="#v:isQueuedJobDead">isQueuedJobDead</a> :: MonadIO m =&gt; <a href="Ganeti-Utils-Livelock.html#t:Livelock">Livelock</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; m Bool</li><li class="src short"><a href="#v:waitForJob">waitForJob</a> :: <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; Int -&gt; <a href="Ganeti-Errors.html#t:ResultG">ResultG</a> (Bool, String)</li><li class="src short"><a href="#v:cancelJob">cancelJob</a> :: Bool -&gt; <a href="Ganeti-Utils-Livelock.html#t:Livelock">Livelock</a> -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; IO (<a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> (Bool, String))</li><li class="src short"><a href="#v:tellJobPriority">tellJobPriority</a> :: <a href="Ganeti-Utils-Livelock.html#t:Livelock">Livelock</a> -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; Int -&gt; IO (<a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> (Bool, String))</li><li class="src short"><a href="#v:notifyJob">notifyJob</a> :: ProcessID -&gt; IO (<a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> ())</li><li class="src short"><a href="#v:queueDirPermissions">queueDirPermissions</a> :: <a href="Ganeti-Utils.html#t:FilePermissions">FilePermissions</a></li><li class="src short"><a href="#v:archiveSomeJobsUntil">archiveSomeJobsUntil</a> :: ([<a href="Ganeti-Types.html#t:JobId">JobId</a>] -&gt; IO ()) -&gt; FilePath -&gt; ClockTime -&gt; <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; Int -&gt; [<a href="Ganeti-Types.html#t:JobId">JobId</a>] -&gt; [<a href="Ganeti-Types.html#t:JobId">JobId</a>] -&gt; IO (Int, Int)</li><li class="src short"><a href="#v:archiveJobs">archiveJobs</a> :: <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; Int -&gt; Int -&gt; [<a href="Ganeti-Types.html#t:JobId">JobId</a>] -&gt; IO (Int, Int)</li></ul></div><div id="interface"><h1 id="g:1">Data types
</h1><div class="top"><p class="src"><a name="v:noTimestamp" class="def">noTimestamp</a> :: <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a><a href="Ganeti/JQueue.html#noTimestamp" class="link">Source</a></p><div class="doc"><p>Missing timestamp type.
</p></div></div><div class="top"><p class="src"><a name="v:fromClockTime" class="def">fromClockTime</a> :: ClockTime -&gt; <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a><a href="Ganeti/JQueue.html#fromClockTime" class="link">Source</a></p><div class="doc"><p>Obtain a Timestamp from a given clock time
</p></div></div><div class="top"><p class="src"><a name="v:currentTimestamp" class="def">currentTimestamp</a> :: IO <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a><a href="Ganeti/JQueue.html#currentTimestamp" class="link">Source</a></p><div class="doc"><p>Get the current time in the job-queue timestamp format.
</p></div></div><div class="top"><p class="src"><a name="v:advanceTimestamp" class="def">advanceTimestamp</a> :: Int -&gt; <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a><a href="Ganeti/JQueue.html#advanceTimestamp" class="link">Source</a></p><div class="doc"><p>From a given timestamp, obtain the timestamp of the
 time that is the given number of seconds later.
</p></div></div><div class="top"><p class="src"><a name="v:toMetaOpCode" class="def">toMetaOpCode</a> :: <a href="Ganeti-JQueue-Objects.html#t:InputOpCode">InputOpCode</a> -&gt; [<a href="Ganeti-OpCodes.html#t:MetaOpCode">MetaOpCode</a>]<a href="Ganeti/JQueue.html#toMetaOpCode" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:invalidOp" class="def">invalidOp</a> :: String<a href="Ganeti/JQueue.html#invalidOp" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:extractOpSummary" class="def">extractOpSummary</a> :: <a href="Ganeti-JQueue-Objects.html#t:InputOpCode">InputOpCode</a> -&gt; String<a href="Ganeti/JQueue.html#extractOpSummary" class="link">Source</a></p><div class="doc"><p>Tries to extract the opcode summary from an <code><a href="Ganeti-JQueue-Objects.html#t:InputOpCode">InputOpCode</a></code>. This
 duplicates some functionality from the <code><a href="Ganeti-OpCodes.html#v:opSummary">opSummary</a></code> function in
 <a href="Ganeti-OpCodes.html">Ganeti.OpCodes</a>.
</p></div></div><div class="top"><p class="src"><a name="v:queuedOpCodeFromMetaOpCode" class="def">queuedOpCodeFromMetaOpCode</a> :: <a href="Ganeti-OpCodes.html#t:MetaOpCode">MetaOpCode</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedOpCode">QueuedOpCode</a><a href="Ganeti/JQueue.html#queuedOpCodeFromMetaOpCode" class="link">Source</a></p><div class="doc"><p>Convenience function to obtain a QueuedOpCode from a MetaOpCode
</p></div></div><div class="top"><p class="src"><a name="v:queuedJobFromOpCodes" class="def">queuedJobFromOpCodes</a> :: Monad m =&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; [<a href="Ganeti-OpCodes.html#t:MetaOpCode">MetaOpCode</a>] -&gt; m <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a><a href="Ganeti/JQueue.html#queuedJobFromOpCodes" class="link">Source</a></p><div class="doc"><p>From a job-id and a list of op-codes create a job. This is
 the pure part of job creation, as allocating a new job id
 lives in IO.
</p></div></div><div class="top"><p class="src"><a name="v:setReceivedTimestamp" class="def">setReceivedTimestamp</a> :: <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a><a href="Ganeti/JQueue.html#setReceivedTimestamp" class="link">Source</a></p><div class="doc"><p>Attach a received timestamp to a Queued Job.
</p></div></div><div class="top"><p class="src"><a name="v:reasonTrailTimestamp" class="def">reasonTrailTimestamp</a> :: <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; Integer<a href="Ganeti/JQueue.html#reasonTrailTimestamp" class="link">Source</a></p><div class="doc"><p>Build a timestamp in the format expected by the reason trail (nanoseconds)
 starting from a JQueue Timestamp.
</p></div></div><div class="top"><p class="src"><a name="v:extendInputOpCodeReasonTrail" class="def">extendInputOpCodeReasonTrail</a> :: <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; Int -&gt; <a href="Ganeti-JQueue-Objects.html#t:InputOpCode">InputOpCode</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:InputOpCode">InputOpCode</a><a href="Ganeti/JQueue.html#extendInputOpCodeReasonTrail" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:extendOpCodeReasonTrail" class="def">extendOpCodeReasonTrail</a> :: <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; Int -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedOpCode">QueuedOpCode</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedOpCode">QueuedOpCode</a><a href="Ganeti/JQueue.html#extendOpCodeReasonTrail" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:extendJobReasonTrail" class="def">extendJobReasonTrail</a> :: <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a><a href="Ganeti/JQueue.html#extendJobReasonTrail" class="link">Source</a></p><div class="doc"><p>Append an element to the reason trail of all the OpCodes of a queued job.
</p></div></div><div class="top"><p class="src"><a name="v:getJobDependencies" class="def">getJobDependencies</a> :: <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; [<a href="Ganeti-Types.html#t:JobId">JobId</a>]<a href="Ganeti/JQueue.html#getJobDependencies" class="link">Source</a></p><div class="doc"><p>From a queued job obtain the list of jobs it depends on.
</p></div></div><div class="top"><p class="src"><a name="v:changeOpCodePriority" class="def">changeOpCodePriority</a> :: Int -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedOpCode">QueuedOpCode</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedOpCode">QueuedOpCode</a><a href="Ganeti/JQueue.html#changeOpCodePriority" class="link">Source</a></p><div class="doc"><p>Change the priority of a QueuedOpCode, if it is not already
 finalized.
</p></div></div><div class="top"><p class="src"><a name="v:cancelOpCode" class="def">cancelOpCode</a> :: <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedOpCode">QueuedOpCode</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedOpCode">QueuedOpCode</a><a href="Ganeti/JQueue.html#cancelOpCode" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:changeJobPriority" class="def">changeJobPriority</a> :: Int -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a><a href="Ganeti/JQueue.html#changeJobPriority" class="link">Source</a></p><div class="doc"><p>Change the priority of a job, i.e., change the priority of the
 non-finalized opcodes.
</p></div></div><div class="top"><p class="src"><a name="v:cancelQueuedJob" class="def">cancelQueuedJob</a> :: <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a><a href="Ganeti/JQueue.html#cancelQueuedJob" class="link">Source</a></p><div class="doc"><p>Transform a QueuedJob that has not been started into its canceled form.
</p></div></div><div class="top"><p class="src"><a name="v:failOpCode" class="def">failOpCode</a> :: <a href="Ganeti-Types.html#t:ReasonElem">ReasonElem</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedOpCode">QueuedOpCode</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedOpCode">QueuedOpCode</a><a href="Ganeti/JQueue.html#failOpCode" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:failQueuedJob" class="def">failQueuedJob</a> :: <a href="Ganeti-Types.html#t:ReasonElem">ReasonElem</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a><a href="Ganeti/JQueue.html#failQueuedJob" class="link">Source</a></p><div class="doc"><p>Transform a QueuedJob that has not been started into its failed form.
</p></div></div><div class="top"><p class="src"><a name="v:jobFilePrefix" class="def">jobFilePrefix</a> :: String<a href="Ganeti/JQueue.html#jobFilePrefix" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:jobFileName" class="def">jobFileName</a> :: <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; FilePath<a href="Ganeti/JQueue.html#jobFileName" class="link">Source</a></p><div class="doc"><p>Computes the filename for a given job ID.
</p></div></div><div class="top"><p class="src"><a name="v:parseJobFileId" class="def">parseJobFileId</a> :: Monad m =&gt; FilePath -&gt; m <a href="Ganeti-Types.html#t:JobId">JobId</a><a href="Ganeti/JQueue.html#parseJobFileId" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:liveJobFile" class="def">liveJobFile</a> :: FilePath -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; FilePath<a href="Ganeti/JQueue.html#liveJobFile" class="link">Source</a></p><div class="doc"><p>Computes the full path to a live job.
</p></div></div><div class="top"><p class="src"><a name="v:archivedJobFile" class="def">archivedJobFile</a> :: FilePath -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; FilePath<a href="Ganeti/JQueue.html#archivedJobFile" class="link">Source</a></p><div class="doc"><p>Computes the full path to an archives job. BROKEN.
</p></div></div><div class="top"><p class="src"><a name="v:opStatusToJob" class="def">opStatusToJob</a> :: <a href="Ganeti-Types.html#t:OpStatus">OpStatus</a> -&gt; <a href="Ganeti-Types.html#t:JobStatus">JobStatus</a><a href="Ganeti/JQueue.html#opStatusToJob" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:calcJobStatus" class="def">calcJobStatus</a> :: <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; <a href="Ganeti-Types.html#t:JobStatus">JobStatus</a><a href="Ganeti/JQueue.html#calcJobStatus" class="link">Source</a></p><div class="doc"><p>Computes a queued job's status.
</p></div></div><div class="top"><p class="src"><a name="v:jobStarted" class="def">jobStarted</a> :: <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; Bool<a href="Ganeti/JQueue.html#jobStarted" class="link">Source</a></p><div class="doc"><p>Determine if a job has started
</p></div></div><div class="top"><p class="src"><a name="v:jobFinalized" class="def">jobFinalized</a> :: <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; Bool<a href="Ganeti/JQueue.html#jobFinalized" class="link">Source</a></p><div class="doc"><p>Determine if a job is finalised.
</p></div></div><div class="top"><p class="src"><a name="v:jobArchivable" class="def">jobArchivable</a> :: <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; Bool<a href="Ganeti/JQueue.html#jobArchivable" class="link">Source</a></p><div class="doc"><p>Determine if a job is finalized and its timestamp is before
 a given time.
</p></div></div><div class="top"><p class="src"><a name="v:opStatusFinalized" class="def">opStatusFinalized</a> :: <a href="Ganeti-Types.html#t:OpStatus">OpStatus</a> -&gt; Bool<a href="Ganeti/JQueue.html#opStatusFinalized" class="link">Source</a></p><div class="doc"><p>Determine whether an opcode status is finalized.
</p></div></div><div class="top"><p class="src"><a name="v:calcJobPriority" class="def">calcJobPriority</a> :: <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; Int<a href="Ganeti/JQueue.html#calcJobPriority" class="link">Source</a></p><div class="doc"><p>Compute a job's priority.
</p></div></div><div class="top"><p class="src"><a name="v:ignoreIOError" class="def">ignoreIOError</a> ::  a -&gt; Bool -&gt; String -&gt; IOError -&gt; IO a<a href="Ganeti/JQueue.html#ignoreIOError" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:allArchiveDirs" class="def">allArchiveDirs</a> :: FilePath -&gt; IO [FilePath]<a href="Ganeti/JQueue.html#allArchiveDirs" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:determineJobDirectories" class="def">determineJobDirectories</a> :: FilePath -&gt; Bool -&gt; IO [FilePath]<a href="Ganeti/JQueue.html#determineJobDirectories" class="link">Source</a></p><div class="doc"><p>Build list of directories containing job files. Note: compared to
 the Python version, this doesn't ignore a potential lost+found
 file.
</p></div></div><div class="top"><p class="src"><a name="v:getJobIDs" class="def">getJobIDs</a> :: [FilePath] -&gt; IO (<a href="Ganeti-BasicTypes.html#t:GenericResult">GenericResult</a> IOError [<a href="Ganeti-Types.html#t:JobId">JobId</a>])<a href="Ganeti/JQueue.html#getJobIDs" class="link">Source</a></p><div class="doc"><p>Computes the list of all jobs in the given directories.
</p></div></div><div class="top"><p class="src"><a name="v:sortJobIDs" class="def">sortJobIDs</a> :: [<a href="Ganeti-Types.html#t:JobId">JobId</a>] -&gt; [<a href="Ganeti-Types.html#t:JobId">JobId</a>]<a href="Ganeti/JQueue.html#sortJobIDs" class="link">Source</a></p><div class="doc"><p>Sorts the a list of job IDs.
</p></div></div><div class="top"><p class="src"><a name="v:getDirJobIDs" class="def">getDirJobIDs</a> :: FilePath -&gt; <a href="Ganeti-BasicTypes.html#t:ResultT">ResultT</a> IOError IO [<a href="Ganeti-Types.html#t:JobId">JobId</a>]<a href="Ganeti/JQueue.html#getDirJobIDs" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:readJobDataFromDisk" class="def">readJobDataFromDisk</a> :: FilePath -&gt; Bool -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; IO (Maybe (String, Bool))<a href="Ganeti/JQueue.html#readJobDataFromDisk" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:noSuchJob" class="def">noSuchJob</a> :: <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (<a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a>, Bool)<a href="Ganeti/JQueue.html#noSuchJob" class="link">Source</a></p><div class="doc"><p>Failed to load job error.
</p></div></div><div class="top"><p class="src"><a name="v:loadJobFromDisk" class="def">loadJobFromDisk</a> :: FilePath -&gt; Bool -&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> (<a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a>, Bool))<a href="Ganeti/JQueue.html#loadJobFromDisk" class="link">Source</a></p><div class="doc"><p>Loads a job from disk.
</p></div></div><div class="top"><p class="src"><a name="v:writeJobToDisk" class="def">writeJobToDisk</a> :: FilePath -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> ())<a href="Ganeti/JQueue.html#writeJobToDisk" class="link">Source</a></p><div class="doc"><p>Write a job to disk.
</p></div></div><div class="top"><p class="src"><a name="v:replicateJob" class="def">replicateJob</a> :: FilePath -&gt; [<a href="Ganeti-Objects.html#t:Node">Node</a>] -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; IO [(<a href="Ganeti-Objects.html#t:Node">Node</a>, <a href="Ganeti-Rpc.html#t:ERpcError">ERpcError</a> ())]<a href="Ganeti/JQueue.html#replicateJob" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:replicateManyJobs" class="def">replicateManyJobs</a> :: FilePath -&gt; [<a href="Ganeti-Objects.html#t:Node">Node</a>] -&gt; [<a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a>] -&gt; IO ()<a href="Ganeti/JQueue.html#replicateManyJobs" class="link">Source</a></p><div class="doc"><p>Replicate many jobs to all master candidates.
</p></div></div><div class="top"><p class="src"><a name="v:writeAndReplicateJob" class="def">writeAndReplicateJob</a> :: <a href="Ganeti-BasicTypes.html#t:FromString">FromString</a> e =&gt; <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a> -&gt; FilePath -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; <a href="Ganeti-BasicTypes.html#t:ResultT">ResultT</a> e IO [(<a href="Ganeti-Objects.html#t:Node">Node</a>, <a href="Ganeti-Rpc.html#t:ERpcError">ERpcError</a> ())]<a href="Ganeti/JQueue.html#writeAndReplicateJob" class="link">Source</a></p><div class="doc"><p>Writes a job to a file and replicates it to master candidates.
</p></div></div><div class="top"><p class="src"><a name="v:readSerialFromDisk" class="def">readSerialFromDisk</a> :: IO (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-Types.html#t:JobId">JobId</a>)<a href="Ganeti/JQueue.html#readSerialFromDisk" class="link">Source</a></p><div class="doc"><p>Read the job serial number from disk.
</p></div></div><div class="top"><p class="src"><a name="v:allocateJobIds" class="def">allocateJobIds</a> :: [<a href="Ganeti-Objects.html#t:Node">Node</a>] -&gt; <a href="Ganeti-Utils-MVarLock.html#t:Lock">Lock</a> -&gt; Int -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> [<a href="Ganeti-Types.html#t:JobId">JobId</a>])<a href="Ganeti/JQueue.html#allocateJobIds" class="link">Source</a></p><div class="doc"><p>Allocate new job ids.
 To avoid races while accessing the serial file, the threads synchronize
 over a lock, as usual provided by a Lock.
</p></div></div><div class="top"><p class="src"><a name="v:allocateJobId" class="def">allocateJobId</a> :: [<a href="Ganeti-Objects.html#t:Node">Node</a>] -&gt; <a href="Ganeti-Utils-MVarLock.html#t:Lock">Lock</a> -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-Types.html#t:JobId">JobId</a>)<a href="Ganeti/JQueue.html#allocateJobId" class="link">Source</a></p><div class="doc"><p>Allocate one new job id.
</p></div></div><div class="top"><p class="src"><a name="v:isQueueOpen" class="def">isQueueOpen</a> :: IO Bool<a href="Ganeti/JQueue.html#isQueueOpen" class="link">Source</a></p><div class="doc"><p>Decide if job queue is open
</p></div></div><div class="top"><p class="src"><a name="v:startJobs" class="def">startJobs</a><a href="Ganeti/JQueue.html#startJobs" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-Utils-Livelock.html#t:Livelock">Livelock</a></td><td class="doc"><p>Luxi's livelock path
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Utils-MVarLock.html#t:Lock">Lock</a></td><td class="doc"><p>lock for forking new processes
</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a>]</td><td class="doc"><p>the list of jobs to start
</p></td></tr><tr><td class="src">-&gt; IO [<a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a>]</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Start enqueued jobs by executing the Python code.
</p></div></div><div class="top"><p class="src"><a name="v:isQueuedJobDead" class="def">isQueuedJobDead</a> :: MonadIO m =&gt; <a href="Ganeti-Utils-Livelock.html#t:Livelock">Livelock</a> -&gt; <a href="Ganeti-JQueue-Objects.html#t:QueuedJob">QueuedJob</a> -&gt; m Bool<a href="Ganeti/JQueue.html#isQueuedJobDead" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:waitForJob" class="def">waitForJob</a> :: <a href="Ganeti-Types.html#t:JobId">JobId</a> -&gt; Int -&gt; <a href="Ganeti-Errors.html#t:ResultG">ResultG</a> (Bool, String)<a href="Ganeti/JQueue.html#waitForJob" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:cancelJob" class="def">cancelJob</a><a href="Ganeti/JQueue.html#cancelJob" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: Bool</td><td class="doc"><p>if True, use sigKILL instead of sigTERM
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Utils-Livelock.html#t:Livelock">Livelock</a></td><td class="doc"><p>Luxi's livelock path
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a></td><td class="doc"><p>the job to cancel
</p></td></tr><tr><td class="src">-&gt; IO (<a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> (Bool, String))</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Try to cancel a job that has already been handed over to execution,
 by terminating the process.
</p></div></div><div class="top"><p class="src"><a name="v:tellJobPriority" class="def">tellJobPriority</a><a href="Ganeti/JQueue.html#tellJobPriority" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-Utils-Livelock.html#t:Livelock">Livelock</a></td><td class="doc"><p>Luxi's livelock path
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-Types.html#t:JobId">JobId</a></td><td class="doc"><p>the job to inform
</p></td></tr><tr><td class="src">-&gt; Int</td><td class="doc"><p>the new priority
</p></td></tr><tr><td class="src">-&gt; IO (<a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> (Bool, String))</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Inform a job that it is requested to change its priority. This is done
 by writing the new priority to a file and sending SIGUSR1.
</p></div></div><div class="top"><p class="src"><a name="v:notifyJob" class="def">notifyJob</a> :: ProcessID -&gt; IO (<a href="Ganeti-Errors.html#t:ErrorResult">ErrorResult</a> ())<a href="Ganeti/JQueue.html#notifyJob" class="link">Source</a></p><div class="doc"><p>Notify a job that something relevant happened, e.g., a lock became
 available. We do this by sending sigHUP to the process.
</p></div></div><div class="top"><p class="src"><a name="v:queueDirPermissions" class="def">queueDirPermissions</a> :: <a href="Ganeti-Utils.html#t:FilePermissions">FilePermissions</a><a href="Ganeti/JQueue.html#queueDirPermissions" class="link">Source</a></p><div class="doc"><p>Permissions for the archive directories.
</p></div></div><div class="top"><p class="src"><a name="v:archiveSomeJobsUntil" class="def">archiveSomeJobsUntil</a> :: ([<a href="Ganeti-Types.html#t:JobId">JobId</a>] -&gt; IO ()) -&gt; FilePath -&gt; ClockTime -&gt; <a href="Ganeti-JQueue-Objects.html#t:Timestamp">Timestamp</a> -&gt; Int -&gt; [<a href="Ganeti-Types.html#t:JobId">JobId</a>] -&gt; [<a href="Ganeti-Types.html#t:JobId">JobId</a>] -&gt; IO (Int, Int)<a href="Ganeti/JQueue.html#archiveSomeJobsUntil" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:archiveJobs" class="def">archiveJobs</a><a href="Ganeti/JQueue.html#archiveJobs" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-Objects.html#t:ConfigData">ConfigData</a></td><td class="doc"><p>cluster configuration
</p></td></tr><tr><td class="src">-&gt; Int</td><td class="doc"><p>time the job has to be in the past in order
 to be archived
</p></td></tr><tr><td class="src">-&gt; Int</td><td class="doc"><p>timeout
</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-Types.html#t:JobId">JobId</a>]</td><td class="doc"><p>jobs to consider
</p></td></tr><tr><td class="src">-&gt; IO (Int, Int)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Archive jobs older than the given time, but do not exceed the timeout for
 carrying out this task.
</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.10.0</p></div></body></html>