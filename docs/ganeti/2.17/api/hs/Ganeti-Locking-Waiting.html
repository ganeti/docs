<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ganeti.Locking.Waiting</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Ganeti-Locking-Waiting.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="Ganeti/Locking/Waiting.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ganeti</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Infered</td></tr></table><p class="caption">Ganeti.Locking.Waiting</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Implementation of a priority waiting structure for locks.
</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span>  <a href="#t:LockWaiting">LockWaiting</a> a b c = <a href="#v:LockWaiting">LockWaiting</a> {<ul class="subs"><li><a href="#v:lwAllocation">lwAllocation</a> :: <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b</li><li><a href="#v:lwPending">lwPending</a> :: Map b (Set (c, b, [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a]))</li><li><a href="#v:lwPendingOwners">lwPendingOwners</a> :: Map b (b, (c, b, [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a]))</li></ul>}</li><li class="src short"><a href="#v:emptyWaiting">emptyWaiting</a> :: (Ord a, Ord b, Ord c) =&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c</li><li class="src short"><a href="#v:getPendingOwners">getPendingOwners</a> ::  <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; Set b</li><li class="src short"><a href="#v:hasPendingRequest">hasPendingRequest</a> :: Ord b =&gt; b -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; Bool</li><li class="src short"><a href="#v:getAllocation">getAllocation</a> ::  <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b</li><li class="src short"><a href="#v:getPendingRequests">getPendingRequests</a> :: (Ord a, Ord b, Ord c) =&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; Set (c, b, [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a])</li><li class="src short"><span class="keyword">type</span> <a href="#t:ExtWaiting">ExtWaiting</a> a b c = (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b, Set (c, b, [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a]))</li><li class="src short"><a href="#v:extRepr">extRepr</a> :: (Ord a, Ord b, Ord c) =&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; <a href="Ganeti-Locking-Waiting.html#t:ExtWaiting">ExtWaiting</a> a b c</li><li class="src short"><a href="#v:tryFulfillRequest">tryFulfillRequest</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, Set b) -&gt; (c, b, [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a]) -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, Set b)</li><li class="src short"><a href="#v:revisitRequests">revisitRequests</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; Set b -&gt; Set b -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (Set b, <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c)</li><li class="src short"><a href="#v:updateLocks-39-">updateLocks'</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; b -&gt; [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a] -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> (Set b), Set b))</li><li class="src short"><a href="#v:updateLocksWaiting-39-">updateLocksWaiting'</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; c -&gt; b -&gt; [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a] -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> (Set b), Set b))</li><li class="src short"><a href="#v:requestFulfilled">requestFulfilled</a> :: (Ord a, Ord b) =&gt; b -&gt; [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a] -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; Bool</li><li class="src short"><a href="#v:updateLocks">updateLocks</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; b -&gt; [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a] -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> (Set b), Set b))</li><li class="src short"><a href="#v:updateLocksWaiting">updateLocksWaiting</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; c -&gt; b -&gt; [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a] -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> (Set b), Set b))</li><li class="src short"><a href="#v:removePendingRequest">removePendingRequest</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; b -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c</li><li class="src short"><a href="#v:safeUpdateLocksWaiting">safeUpdateLocksWaiting</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; c -&gt; b -&gt; [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a] -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> (Set b), Set b))</li><li class="src short"><a href="#v:releaseResources">releaseResources</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; b -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, Set b)</li><li class="src short"><a href="#v:fromExtRepr">fromExtRepr</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; <a href="Ganeti-Locking-Waiting.html#t:ExtWaiting">ExtWaiting</a> a b c -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c</li><li class="src short"><a href="#v:manipulateLocksPredicate">manipulateLocksPredicate</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; (a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a) -&gt; (a -&gt; Bool) -&gt; b -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, Set b)</li><li class="src short"><a href="#v:freeLocksPredicate">freeLocksPredicate</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; (a -&gt; Bool) -&gt; b -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, Set b)</li><li class="src short"><a href="#v:downGradeLocksPredicate">downGradeLocksPredicate</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; (a -&gt; Bool) -&gt; b -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, Set b)</li><li class="src short"><a href="#v:intersectLocks">intersectLocks</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; [a] -&gt; b -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, Set b)</li><li class="src short"><a href="#v:opportunisticLockUnion">opportunisticLockUnion</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; b -&gt; [(a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)] -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, ([a], Set b))</li><li class="src short"><a href="#v:guardedOpportunisticLockUnion">guardedOpportunisticLockUnion</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; Int -&gt; b -&gt; [(a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)] -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, ([a], Set b))</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:LockWaiting" class="def">LockWaiting</a> a b c <a href="Ganeti/Locking/Waiting.html#LockWaiting" class="link">Source</a></p><div class="doc"><p>Representation of the waiting structure
</p><p>For any request we cannot fullfill immediately, we have a set of lock
owners it is blocked on. We can pick one of the owners, the smallest say;
then we know that this request cannot possibly be fulfilled until this
owner does something. So we can index the pending requests by such a chosen
owner and only revisit them once the owner acts. For the requests to revisit
we need to do so in order of increasing priority; this order can be maintained
by the Set data structure, where we make use of the fact that tuples are ordered
lexicographically.
</p><p>Additionally, we keep track of which owners have pending requests, to disallow
them any other lock tasks till their request is fulfilled. To allow canceling
of pending requests, we also keep track on which owner their request is pending
on and what the request was.
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:LockWaiting" class="def">LockWaiting</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:lwAllocation" class="def">lwAllocation</a> :: <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:lwPending" class="def">lwPending</a> :: Map b (Set (c, b, [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a]))</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:lwPendingOwners" class="def">lwPendingOwners</a> :: Map b (b, (c, b, [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a]))</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:LockWaiting" class="caption collapser" onclick="toggleSection('i:LockWaiting')">Instances</p><div id="section.i:LockWaiting" class="show"><table><tr><td class="src">(Show a, Show b, Show c) =&gt; Show (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, JSON a, Ord b, JSON b, Show b, Ord c, JSON c) =&gt; JSON (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(Arbitrary a, <a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Arbitrary b, Ord b, Arbitrary c, Ord c) =&gt; Arbitrary (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c)</td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:emptyWaiting" class="def">emptyWaiting</a> :: (Ord a, Ord b, Ord c) =&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c<a href="Ganeti/Locking/Waiting.html#emptyWaiting" class="link">Source</a></p><div class="doc"><p>A state without locks and pending requests.
</p></div></div><div class="top"><p class="src"><a name="v:getPendingOwners" class="def">getPendingOwners</a> ::  <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; Set b<a href="Ganeti/Locking/Waiting.html#getPendingOwners" class="link">Source</a></p><div class="doc"><p>Get the set of owners with pending lock requests.
</p></div></div><div class="top"><p class="src"><a name="v:hasPendingRequest" class="def">hasPendingRequest</a> :: Ord b =&gt; b -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; Bool<a href="Ganeti/Locking/Waiting.html#hasPendingRequest" class="link">Source</a></p><div class="doc"><p>Predicate on whether an owner has a pending lock request.
</p></div></div><div class="top"><p class="src"><a name="v:getAllocation" class="def">getAllocation</a> ::  <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b<a href="Ganeti/Locking/Waiting.html#getAllocation" class="link">Source</a></p><div class="doc"><p>Get the allocation state from the waiting state
</p></div></div><div class="top"><p class="src"><a name="v:getPendingRequests" class="def">getPendingRequests</a> :: (Ord a, Ord b, Ord c) =&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; Set (c, b, [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a])<a href="Ganeti/Locking/Waiting.html#getPendingRequests" class="link">Source</a></p><div class="doc"><p>Get the list of all pending requests.
</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:ExtWaiting" class="def">ExtWaiting</a> a b c = (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b, Set (c, b, [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a]))<a href="Ganeti/Locking/Waiting.html#ExtWaiting" class="link">Source</a></p><div class="doc"><p>Type of the extensional representation of a LockWaiting.
</p></div></div><div class="top"><p class="src"><a name="v:extRepr" class="def">extRepr</a> :: (Ord a, Ord b, Ord c) =&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; <a href="Ganeti-Locking-Waiting.html#t:ExtWaiting">ExtWaiting</a> a b c<a href="Ganeti/Locking/Waiting.html#extRepr" class="link">Source</a></p><div class="doc"><p>Get a representation, comparable by (==), that captures the extensional
 behaviour. In other words, <code>(==) <code>on</code> extRepr</code> is a bisumlation.
</p></div></div><div class="top"><p class="src"><a name="v:tryFulfillRequest" class="def">tryFulfillRequest</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, Set b) -&gt; (c, b, [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a]) -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, Set b)<a href="Ganeti/Locking/Waiting.html#tryFulfillRequest" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:revisitRequests" class="def">revisitRequests</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; Set b -&gt; Set b -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (Set b, <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c)<a href="Ganeti/Locking/Waiting.html#revisitRequests" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:updateLocks-39-" class="def">updateLocks'</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; b -&gt; [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a] -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> (Set b), Set b))<a href="Ganeti/Locking/Waiting.html#updateLocks%27" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:updateLocksWaiting-39-" class="def">updateLocksWaiting'</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; c -&gt; b -&gt; [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a] -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> (Set b), Set b))<a href="Ganeti/Locking/Waiting.html#updateLocksWaiting%27" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:requestFulfilled" class="def">requestFulfilled</a> :: (Ord a, Ord b) =&gt; b -&gt; [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a] -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; Bool<a href="Ganeti/Locking/Waiting.html#requestFulfilled" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:updateLocks" class="def">updateLocks</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; b -&gt; [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a] -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> (Set b), Set b))<a href="Ganeti/Locking/Waiting.html#updateLocks" class="link">Source</a></p><div class="doc"><p>Update the locks on an onwer according to the given request, if possible.
 Additionally (if the request succeeds) fulfill any pending requests that
 became possible through this request. Return the new state of the waiting
 structure, the result of the operation, and a list of owners to be notified.
 The result is, as for lock allocation, the set of owners the request is
 blocked on. Again, the type is chosen to be suitable for use in
 atomicModifyIORef.
 For convenience, fulfilled requests are always accepted.
</p></div></div><div class="top"><p class="src"><a name="v:updateLocksWaiting" class="def">updateLocksWaiting</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; c -&gt; b -&gt; [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a] -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> (Set b), Set b))<a href="Ganeti/Locking/Waiting.html#updateLocksWaiting" class="link">Source</a></p><div class="doc"><p>Update locks as soon as possible. If the request cannot be fulfilled
 immediately add the request to the waiting queue. The first argument is
 the priority at which the owner is waiting, the remaining are as for
 updateLocks, and so is the output.
 For convenience, fulfilled requests are always accepted.
</p></div></div><div class="top"><p class="src"><a name="v:removePendingRequest" class="def">removePendingRequest</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; b -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c<a href="Ganeti/Locking/Waiting.html#removePendingRequest" class="link">Source</a></p><div class="doc"><p>Compute the state of a waiting after an owner gives up
 on his pending request.
</p></div></div><div class="top"><p class="src"><a name="v:safeUpdateLocksWaiting" class="def">safeUpdateLocksWaiting</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; c -&gt; b -&gt; [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a] -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> (Set b), Set b))<a href="Ganeti/Locking/Waiting.html#safeUpdateLocksWaiting" class="link">Source</a></p><div class="doc"><p>A repeatable version of <code><a href="Ganeti-Locking-Waiting.html#v:updateLocksWaiting">updateLocksWaiting</a></code>. If the owner has a pending
 request and the pending request is equal to the current one, do nothing;
 otherwise call updateLocksWaiting.
</p></div></div><div class="top"><p class="src"><a name="v:releaseResources" class="def">releaseResources</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; b -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, Set b)<a href="Ganeti/Locking/Waiting.html#releaseResources" class="link">Source</a></p><div class="doc"><p>Convenience function to release all pending requests and locks
 of a given owner. Return the new configuration and the owners to
 notify.
</p></div></div><div class="top"><p class="src"><a name="v:fromExtRepr" class="def">fromExtRepr</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; <a href="Ganeti-Locking-Waiting.html#t:ExtWaiting">ExtWaiting</a> a b c -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c<a href="Ganeti/Locking/Waiting.html#fromExtRepr" class="link">Source</a></p><div class="doc"><p>Obtain a LockWaiting from its extensional representation.
</p></div></div><div class="top"><p class="src"><a name="v:manipulateLocksPredicate" class="def">manipulateLocksPredicate</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; (a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a) -&gt; (a -&gt; Bool) -&gt; b -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, Set b)<a href="Ganeti/Locking/Waiting.html#manipulateLocksPredicate" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:freeLocksPredicate" class="def">freeLocksPredicate</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; (a -&gt; Bool) -&gt; b -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, Set b)<a href="Ganeti/Locking/Waiting.html#freeLocksPredicate" class="link">Source</a></p><div class="doc"><p>Free all Locks of a given owner satisfying a given predicate. As this
 operation is supposed to unconditionally suceed, all pending requests
 are dropped as well.
</p></div></div><div class="top"><p class="src"><a name="v:downGradeLocksPredicate" class="def">downGradeLocksPredicate</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; (a -&gt; Bool) -&gt; b -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, Set b)<a href="Ganeti/Locking/Waiting.html#downGradeLocksPredicate" class="link">Source</a></p><div class="doc"><p>Downgrade all locks of  a given owner that satisfy a given predicate. As
 this operation is supposed to unconditionally suceed, all pending requests
 are dropped as well.
</p></div></div><div class="top"><p class="src"><a name="v:intersectLocks" class="def">intersectLocks</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; [a] -&gt; b -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, Set b)<a href="Ganeti/Locking/Waiting.html#intersectLocks" class="link">Source</a></p><div class="doc"><p>Intersect locks to a given set.
</p></div></div><div class="top"><p class="src"><a name="v:opportunisticLockUnion" class="def">opportunisticLockUnion</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; b -&gt; [(a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)] -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, ([a], Set b))<a href="Ganeti/Locking/Waiting.html#opportunisticLockUnion" class="link">Source</a></p><div class="doc"><p>Opprotunistically allocate locks for a given owner; return the set
 of newly actually acquired locks (i.e., locks already held before are
 not mentioned).
</p></div></div><div class="top"><p class="src"><a name="v:guardedOpportunisticLockUnion" class="def">guardedOpportunisticLockUnion</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Ord c) =&gt; Int -&gt; b -&gt; [(a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)] -&gt; <a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c -&gt; (<a href="Ganeti-Locking-Waiting.html#t:LockWaiting">LockWaiting</a> a b c, ([a], Set b))<a href="Ganeti/Locking/Waiting.html#guardedOpportunisticLockUnion" class="link">Source</a></p><div class="doc"><p>A guarded version of opportunisticLockUnion; if the number of fulfilled
 requests is not at least the given amount, then do not change anything.
</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.10.0</p></div></body></html>