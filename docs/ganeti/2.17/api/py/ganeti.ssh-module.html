<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>ganeti.ssh</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
</head>

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://code.google.com/p/ganeti/">Ganeti</a></th>
          </tr></table></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        <a href="ganeti-module.html">Package&nbsp;ganeti</a> ::
        Module&nbsp;ssh
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
        <tr><td align="right"><span class="options">[<a href="javascript:void(0);" class="privatelink"
    onclick="toggle_private();">hide&nbsp;private</a>]</span></td></tr>
        <tr><td align="right"><span class="options"
            >[<a href="frames.html" target="_top">frames</a
            >]&nbsp;|&nbsp;<a href="ganeti.ssh-module.html"
            target="_top">no&nbsp;frames</a>]</span></td></tr>
      </table>
    </td>
  </tr>
</table>
<!-- ==================== MODULE DESCRIPTION ==================== -->
<h1 class="epydoc">Module ssh</h1><p class="nomargin-top"><span class="codelink"><a href="ganeti.ssh-pysrc.html">source&nbsp;code</a></span></p>
<p>Module encapsulating ssh functionality.</p>

<!-- ==================== CLASSES ==================== -->
<a name="section-Classes"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Classes</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-Classes"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a href="ganeti.ssh.SshRunner-class.html" class="summary-name">SshRunner</a><br />
      Wrapper for SSH commands.
    </td>
  </tr>
</table>
<!-- ==================== FUNCTIONS ==================== -->
<a name="section-Functions"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Functions</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-Functions"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">tuple; (string, string, string)</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#GetUserFiles" class="summary-sig-name">GetUserFiles</a>(<span class="summary-sig-arg">user</span>,
        <span class="summary-sig-arg">mkdir</span>=<span class="summary-sig-default">False</span>,
        <span class="summary-sig-arg">dircheck</span>=<span class="summary-sig-default">True</span>,
        <span class="summary-sig-arg">kind</span>=<span class="summary-sig-default">constants.SSHK_DSA</span>,
        <span class="summary-sig-arg">_homedir_fn</span>=<span class="summary-sig-default">None</span>)</span><br />
      Return the paths of a user's SSH files.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#GetUserFiles">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">tuple; (string, dict with string as key, tuple of (string, string) as
      value)</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#GetAllUserFiles" class="summary-sig-name">GetAllUserFiles</a>(<span class="summary-sig-arg">user</span>,
        <span class="summary-sig-arg">mkdir</span>=<span class="summary-sig-default">False</span>,
        <span class="summary-sig-arg">dircheck</span>=<span class="summary-sig-default">True</span>,
        <span class="summary-sig-arg">_homedir_fn</span>=<span class="summary-sig-default">None</span>)</span><br />
      Wrapper over <a href="ganeti.ssh-module.html#GetUserFiles" 
      class="link">GetUserFiles</a> to retrieve files for all SSH key 
      types.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#GetAllUserFiles">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">tuple</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#_SplitSshKey" class="summary-sig-name" onclick="show_private();">_SplitSshKey</a>(<span class="summary-sig-arg">key</span>)</span><br />
      Splits a line for SSH's <code>authorized_keys</code> file.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#_SplitSshKey">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#AddAuthorizedKeys" class="summary-sig-name">AddAuthorizedKeys</a>(<span class="summary-sig-arg">file_obj</span>,
        <span class="summary-sig-arg">keys</span>)</span><br />
      Adds a list of SSH public key to an authorized_keys file.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#AddAuthorizedKeys">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#HasAuthorizedKey" class="summary-sig-name">HasAuthorizedKey</a>(<span class="summary-sig-arg">file_obj</span>,
        <span class="summary-sig-arg">key</span>)</span><br />
      Check if a particular key is in the 'authorized_keys' file.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#HasAuthorizedKey">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#CheckForMultipleKeys" class="summary-sig-name">CheckForMultipleKeys</a>(<span class="summary-sig-arg">file_obj</span>,
        <span class="summary-sig-arg">node_names</span>)</span><br />
      Check if there is at most one key per host in 'authorized_keys' file.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#CheckForMultipleKeys">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#AddAuthorizedKey" class="summary-sig-name">AddAuthorizedKey</a>(<span class="summary-sig-arg">file_obj</span>,
        <span class="summary-sig-arg">key</span>)</span><br />
      Adds an SSH public key to an authorized_keys file.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#AddAuthorizedKey">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#RemoveAuthorizedKeys" class="summary-sig-name">RemoveAuthorizedKeys</a>(<span class="summary-sig-arg">file_name</span>,
        <span class="summary-sig-arg">keys</span>)</span><br />
      Removes public SSH keys from an authorized_keys file.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#RemoveAuthorizedKeys">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#RemoveAuthorizedKey" class="summary-sig-name">RemoveAuthorizedKey</a>(<span class="summary-sig-arg">file_name</span>,
        <span class="summary-sig-arg">key</span>)</span><br />
      Removes an SSH public key from an authorized_keys file.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#RemoveAuthorizedKey">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">(boolean, string)</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#_AddPublicKeyProcessLine" class="summary-sig-name" onclick="show_private();">_AddPublicKeyProcessLine</a>(<span class="summary-sig-arg">new_uuid</span>,
        <span class="summary-sig-arg">new_key</span>,
        <span class="summary-sig-arg">line_uuid</span>,
        <span class="summary-sig-arg">line_key</span>,
        <span class="summary-sig-arg">found</span>)</span><br />
      Processes one line of the public key file when adding a key.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#_AddPublicKeyProcessLine">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">string</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#_AddPublicKeyElse" class="summary-sig-name" onclick="show_private();">_AddPublicKeyElse</a>(<span class="summary-sig-arg">new_uuid</span>,
        <span class="summary-sig-arg">new_key</span>)</span><br />
      Adds a new SSH key to the key file if it did not exist already.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#_AddPublicKeyElse">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">(boolean, string)</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#_RemovePublicKeyProcessLine" class="summary-sig-name" onclick="show_private();">_RemovePublicKeyProcessLine</a>(<span class="summary-sig-arg">target_uuid</span>,
        <span class="summary-sig-arg">_target_key</span>,
        <span class="summary-sig-arg">line_uuid</span>,
        <span class="summary-sig-arg">line_key</span>,
        <span class="summary-sig-arg">found</span>)</span><br />
      Processes a line in the public key file when aiming for removing a 
      key.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#_RemovePublicKeyProcessLine">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">string</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#_RemovePublicKeyElse" class="summary-sig-name" onclick="show_private();">_RemovePublicKeyElse</a>(<span class="summary-sig-arg">target_uuid</span>,
        <span class="summary-sig-arg">_target_key</span>)</span><br />
      Logs when we tried to remove a key that does not exist.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#_RemovePublicKeyElse">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">(boolean, string)</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#_ReplaceNameByUuidProcessLine" class="summary-sig-name" onclick="show_private();">_ReplaceNameByUuidProcessLine</a>(<span class="summary-sig-arg">node_name</span>,
        <span class="summary-sig-arg">_key</span>,
        <span class="summary-sig-arg">line_identifier</span>,
        <span class="summary-sig-arg">line_key</span>,
        <span class="summary-sig-arg">found</span>,
        <span class="summary-sig-arg">node_uuid</span>=<span class="summary-sig-default">None</span>)</span><br />
      Replaces a node's name with its UUID on a matching line in the key 
      file.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#_ReplaceNameByUuidProcessLine">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">string</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#_ReplaceNameByUuidElse" class="summary-sig-name" onclick="show_private();">_ReplaceNameByUuidElse</a>(<span class="summary-sig-arg">node_uuid</span>,
        <span class="summary-sig-arg">node_name</span>,
        <span class="summary-sig-arg">_key</span>)</span><br />
      Logs a debug message when we try to replace a key that is not there.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#_ReplaceNameByUuidElse">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">tuple (string, string)</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#_ParseKeyLine" class="summary-sig-name" onclick="show_private();">_ParseKeyLine</a>(<span class="summary-sig-arg">line</span>,
        <span class="summary-sig-arg">error_fn</span>)</span><br />
      Parses a line of the public key file.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#_ParseKeyLine">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#_ManipulatePubKeyFile" class="summary-sig-name" onclick="show_private();">_ManipulatePubKeyFile</a>(<span class="summary-sig-arg">target_identifier</span>,
        <span class="summary-sig-arg">target_key</span>,
        <span class="summary-sig-arg">key_file</span>=<span class="summary-sig-default">pathutils.SSH_PUB_KEYS</span>,
        <span class="summary-sig-arg">error_fn</span>=<span class="summary-sig-default">errors.ProgrammerError</span>,
        <span class="summary-sig-arg">process_line_fn</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">process_else_fn</span>=<span class="summary-sig-default">None</span>)</span><br />
      Manipulates the list of public SSH keys of the cluster.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#_ManipulatePubKeyFile">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#AddPublicKey" class="summary-sig-name">AddPublicKey</a>(<span class="summary-sig-arg">new_uuid</span>,
        <span class="summary-sig-arg">new_key</span>,
        <span class="summary-sig-arg">key_file</span>=<span class="summary-sig-default">pathutils.SSH_PUB_KEYS</span>,
        <span class="summary-sig-arg">error_fn</span>=<span class="summary-sig-default">errors.ProgrammerError</span>)</span><br />
      Adds a new key to the list of public keys.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#AddPublicKey">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#RemovePublicKey" class="summary-sig-name">RemovePublicKey</a>(<span class="summary-sig-arg">target_uuid</span>,
        <span class="summary-sig-arg">key_file</span>=<span class="summary-sig-default">pathutils.SSH_PUB_KEYS</span>,
        <span class="summary-sig-arg">error_fn</span>=<span class="summary-sig-default">errors.ProgrammerError</span>)</span><br />
      Removes a key from the list of public keys.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#RemovePublicKey">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#ReplaceNameByUuid" class="summary-sig-name">ReplaceNameByUuid</a>(<span class="summary-sig-arg">node_uuid</span>,
        <span class="summary-sig-arg">node_name</span>,
        <span class="summary-sig-arg">key_file</span>=<span class="summary-sig-default">pathutils.SSH_PUB_KEYS</span>,
        <span class="summary-sig-arg">error_fn</span>=<span class="summary-sig-default">errors.ProgrammerError</span>)</span><br />
      Replaces a host name with the node's corresponding UUID.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#ReplaceNameByUuid">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="ClearPubKeyFile"></a><span class="summary-sig-name">ClearPubKeyFile</span>(<span class="summary-sig-arg">key_file</span>=<span class="summary-sig-default">pathutils.SSH_PUB_KEYS</span>,
        <span class="summary-sig-arg">mode</span>=<span class="summary-sig-default">0600</span>)</span><br />
      Resets the content of the public key file.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#ClearPubKeyFile">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#OverridePubKeyFile" class="summary-sig-name">OverridePubKeyFile</a>(<span class="summary-sig-arg">key_map</span>,
        <span class="summary-sig-arg">key_file</span>=<span class="summary-sig-default">pathutils.SSH_PUB_KEYS</span>)</span><br />
      Overrides the public key file with a list of given keys.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#OverridePubKeyFile">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">dict mapping strings to list of strings</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#QueryPubKeyFile" class="summary-sig-name">QueryPubKeyFile</a>(<span class="summary-sig-arg">target_uuids</span>,
        <span class="summary-sig-arg">key_file</span>=<span class="summary-sig-default">pathutils.SSH_PUB_KEYS</span>,
        <span class="summary-sig-arg">error_fn</span>=<span class="summary-sig-default">errors.ProgrammerError</span>)</span><br />
      Retrieves a map of keys for the requested node UUIDs.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#QueryPubKeyFile">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#InitSSHSetup" class="summary-sig-name">InitSSHSetup</a>(<span class="summary-sig-arg">key_type</span>,
        <span class="summary-sig-arg">key_bits</span>,
        <span class="summary-sig-arg">error_fn</span>=<span class="summary-sig-default">errors.OpPrereqError</span>,
        <span class="summary-sig-arg">_homedir_fn</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">_suffix</span>=<span class="summary-sig-default">&quot;&quot;</span>)</span><br />
      Setup the SSH configuration for the node.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#InitSSHSetup">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#InitPubKeyFile" class="summary-sig-name">InitPubKeyFile</a>(<span class="summary-sig-arg">master_uuid</span>,
        <span class="summary-sig-arg">key_type</span>,
        <span class="summary-sig-arg">key_file</span>=<span class="summary-sig-default">pathutils.SSH_PUB_KEYS</span>)</span><br />
      Creates the public key file and adds the master node's SSH key.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#InitPubKeyFile">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="WriteKnownHostsFile"></a><span class="summary-sig-name">WriteKnownHostsFile</span>(<span class="summary-sig-arg">cfg</span>,
        <span class="summary-sig-arg">file_name</span>)</span><br />
      Writes the cluster-wide equally known_hosts file.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#WriteKnownHostsFile">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">list of strings</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#_EnsureCorrectGanetiVersion" class="summary-sig-name" onclick="show_private();">_EnsureCorrectGanetiVersion</a>(<span class="summary-sig-arg">cmd</span>)</span><br />
      Ensured the correct Ganeti version before running a command via SSH.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#_EnsureCorrectGanetiVersion">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#RunSshCmdWithStdin" class="summary-sig-name">RunSshCmdWithStdin</a>(<span class="summary-sig-arg">cluster_name</span>,
        <span class="summary-sig-arg">node</span>,
        <span class="summary-sig-arg">basecmd</span>,
        <span class="summary-sig-arg">port</span>,
        <span class="summary-sig-arg">data</span>,
        <span class="summary-sig-arg">debug</span>=<span class="summary-sig-default">False</span>,
        <span class="summary-sig-arg">verbose</span>=<span class="summary-sig-default">False</span>,
        <span class="summary-sig-arg">use_cluster_key</span>=<span class="summary-sig-default">False</span>,
        <span class="summary-sig-arg">ask_key</span>=<span class="summary-sig-default">False</span>,
        <span class="summary-sig-arg">strict_host_check</span>=<span class="summary-sig-default">False</span>,
        <span class="summary-sig-arg">ensure_version</span>=<span class="summary-sig-default">False</span>)</span><br />
      Runs a command on a remote machine via SSH and provides input in 
      stdin.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#RunSshCmdWithStdin">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#ReadRemoteSshPubKey" class="summary-sig-name">ReadRemoteSshPubKey</a>(<span class="summary-sig-arg">pub_key_file</span>,
        <span class="summary-sig-arg">node</span>,
        <span class="summary-sig-arg">cluster_name</span>,
        <span class="summary-sig-arg">port</span>,
        <span class="summary-sig-arg">ask_key</span>,
        <span class="summary-sig-arg">strict_host_check</span>)</span><br />
      Fetches a public SSH key from a node via SSH.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#ReadRemoteSshPubKey">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">tuple of (string, string)</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#GetSshKeyFilenames" class="summary-sig-name">GetSshKeyFilenames</a>(<span class="summary-sig-arg">key_type</span>,
        <span class="summary-sig-arg">suffix</span>=<span class="summary-sig-default">&quot;&quot;</span>)</span><br />
      Get filenames of the SSH key pair of the given type.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#GetSshKeyFilenames">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">string</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#GetSshPubKeyFilename" class="summary-sig-name">GetSshPubKeyFilename</a>(<span class="summary-sig-arg">key_type</span>,
        <span class="summary-sig-arg">suffix</span>=<span class="summary-sig-default">&quot;&quot;</span>)</span><br />
      Get filename of the public SSH key of the given type.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#GetSshPubKeyFilename">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#_ComputeKeyFilePathWithSuffix" class="summary-sig-name" onclick="show_private();">_ComputeKeyFilePathWithSuffix</a>(<span class="summary-sig-arg">key_filepath</span>,
        <span class="summary-sig-arg">suffix</span>)</span><br />
      Converts the given key filename to a key filename with a suffix.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#_ComputeKeyFilePathWithSuffix">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#ReplaceSshKeys" class="summary-sig-name">ReplaceSshKeys</a>(<span class="summary-sig-arg">src_key_type</span>,
        <span class="summary-sig-arg">dest_key_type</span>,
        <span class="summary-sig-arg">src_key_suffix</span>=<span class="summary-sig-default">&quot;&quot;</span>,
        <span class="summary-sig-arg">dest_key_suffix</span>=<span class="summary-sig-default">&quot;&quot;</span>)</span><br />
      Replaces an SSH key pair by another SSH key pair.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#ReplaceSshKeys">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">list of string</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#ReadLocalSshPubKeys" class="summary-sig-name">ReadLocalSshPubKeys</a>(<span class="summary-sig-arg">key_types</span>,
        <span class="summary-sig-arg">suffix</span>=<span class="summary-sig-default">&quot;&quot;</span>)</span><br />
      Reads the local root user SSH key.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#ReadLocalSshPubKeys">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">positive int</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.ssh-module.html#DetermineKeyBits" class="summary-sig-name">DetermineKeyBits</a>(<span class="summary-sig-arg">key_type</span>,
        <span class="summary-sig-arg">key_bits</span>,
        <span class="summary-sig-arg">old_key_type</span>,
        <span class="summary-sig-arg">old_key_bits</span>)</span><br />
      Checks the key bits to be used for a given key type, or provides 
      defaults.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.ssh-pysrc.html#DetermineKeyBits">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
</table>
<!-- ==================== VARIABLES ==================== -->
<a name="section-Variables"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Variables</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-Variables"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a href="ganeti.ssh-module.html#KeyBitInfo" class="summary-name">KeyBitInfo</a> = <code title="namedtuple('KeyBitInfo', ['default', 'validation_fn'])">namedtuple('KeyBitInfo', ['default', 'validation_<code class="variable-ellipsis">...</code></code>
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a href="ganeti.ssh-module.html#SSH_KEY_VALID_BITS" class="summary-name">SSH_KEY_VALID_BITS</a> = <code title="{constants.SSHK_DSA: KeyBitInfo(1024, lambda b: b== 1024), constants.S\
SHK_RSA: KeyBitInfo(2048, lambda b: b &gt;= 768), constants.SSHK_ECDSA: K\
eyBitInfo(384, lambda b: b in [256, 384, 521]),}">{constants.SSHK_DSA: KeyBitInfo(1024, lam<code class="variable-ellipsis">...</code></code>
    </td>
  </tr>
</table>
<p class="indent-wrapped-lines"><b>Imports:</b>
  <span title="logging">logging</span>,
  <span title="os">os</span>,
  <span title="shutil">shutil</span>,
  <span title="tempfile">tempfile</span>,
  <span title="collections.namedtuple">namedtuple</span>,
  <span title="functools.partial">partial</span>,
  <a href="ganeti.utils-module.html" title="ganeti.utils">utils</a>,
  <a href="ganeti.errors-module.html" title="ganeti.errors">errors</a>,
  <a href="ganeti.constants-module.html" title="ganeti.constants">constants</a>,
  <a href="ganeti.netutils-module.html" title="ganeti.netutils">netutils</a>,
  <a href="ganeti.pathutils-module.html" title="ganeti.pathutils">pathutils</a>,
  <a href="ganeti.vcluster-module.html" title="ganeti.vcluster">vcluster</a>,
  <a href="ganeti.compat-module.html" title="ganeti.compat">compat</a>,
  <a href="ganeti.serializer-module.html" title="ganeti.serializer">serializer</a>,
  <a href="ganeti.ssconf-module.html" title="ganeti.ssconf">ssconf</a>
</p><br />
<!-- ==================== FUNCTION DETAILS ==================== -->
<a name="section-FunctionDetails"></a>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Function Details</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-FunctionDetails"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
</table>
<a name="GetUserFiles"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">GetUserFiles</span>(<span class="sig-arg">user</span>,
        <span class="sig-arg">mkdir</span>=<span class="sig-default">False</span>,
        <span class="sig-arg">dircheck</span>=<span class="sig-default">True</span>,
        <span class="sig-arg">kind</span>=<span class="sig-default">constants.SSHK_DSA</span>,
        <span class="sig-arg">_homedir_fn</span>=<span class="sig-default">None</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#GetUserFiles">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Return the paths of a user's SSH files.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>user</code></strong> (string) - Username</li>
        <li><strong class="pname"><code>mkdir</code></strong> (bool) - Whether to create &quot;.ssh&quot; directory if it doesn't exist</li>
        <li><strong class="pname"><code>dircheck</code></strong> (bool) - Whether to check if &quot;.ssh&quot; directory exists</li>
        <li><strong class="pname"><code>kind</code></strong> (string) - One of constants.SSHK_ALL</li>
    </ul></dd>
    <dt>Returns: tuple; (string, string, string)</dt>
        <dd>Tuple containing three file system paths; the private SSH key 
          file, the public SSH key file and the user's 
          <code>authorized_keys</code> file</dd>
    <dt>Raises:</dt>
    <dd><ul class="nomargin-top">
        <li><code><strong class='fraise'><a href="ganeti.errors.OpExecError-class.html">errors.OpExecError</a></strong></code> - When home directory of the user can not be determined</li>
        <li><code><strong class='fraise'><a href="ganeti.errors.OpExecError-class.html">errors.OpExecError</a></strong></code> - Regardless of the <code>mkdir</code> parameters, this exception is 
        raised if <code>~$user/.ssh</code> is not a directory and 
        <code>dircheck</code> is set to <code>True</code></li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="GetAllUserFiles"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">GetAllUserFiles</span>(<span class="sig-arg">user</span>,
        <span class="sig-arg">mkdir</span>=<span class="sig-default">False</span>,
        <span class="sig-arg">dircheck</span>=<span class="sig-default">True</span>,
        <span class="sig-arg">_homedir_fn</span>=<span class="sig-default">None</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#GetAllUserFiles">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Wrapper over <a href="ganeti.ssh-module.html#GetUserFiles" 
  class="link">GetUserFiles</a> to retrieve files for all SSH key 
  types.</p>
  <p>See <a href="ganeti.ssh-module.html#GetUserFiles" 
  class="link">GetUserFiles</a> for details.</p>
  <dl class="fields">
    <dt>Returns: tuple; (string, dict with string as key, tuple of (string, string) as
      value)</dt>
  </dl>
</td></tr></table>
</div>
<a name="_SplitSshKey"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_SplitSshKey</span>(<span class="sig-arg">key</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#_SplitSshKey">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Splits a line for SSH's <code>authorized_keys</code> file.</p>
  <p>If the line has no options (e.g. no 
  <code>command=&quot;...&quot;</code>), only the significant parts, the 
  key type and its hash, are used. Otherwise the whole line is used (split 
  at whitespace).</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>key</code></strong> (string) - Key line</li>
    </ul></dd>
    <dt>Returns: tuple</dt>
  </dl>
</td></tr></table>
</div>
<a name="AddAuthorizedKeys"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">AddAuthorizedKeys</span>(<span class="sig-arg">file_obj</span>,
        <span class="sig-arg">keys</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#AddAuthorizedKeys">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Adds a list of SSH public key to an authorized_keys file.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>file_obj</code></strong> (str or file handle) - path to authorized_keys file</li>
        <li><strong class="pname"><code>keys</code></strong> (list of str) - list of strings containing keys</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="HasAuthorizedKey"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">HasAuthorizedKey</span>(<span class="sig-arg">file_obj</span>,
        <span class="sig-arg">key</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#HasAuthorizedKey">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Check if a particular key is in the 'authorized_keys' file.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>file_obj</code></strong> (str or file handle) - path to authorized_keys file</li>
        <li><strong class="pname"><code>key</code></strong> (str) - string containing key</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="CheckForMultipleKeys"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">CheckForMultipleKeys</span>(<span class="sig-arg">file_obj</span>,
        <span class="sig-arg">node_names</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#CheckForMultipleKeys">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Check if there is at most one key per host in 'authorized_keys' 
  file.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>file_obj</code></strong> (str or file handle) - path to authorized_keys file</li>
        <li><strong class="pname"><code>node_names</code></strong> (list of str) - list of names of nodes of the cluster</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>a dictionary with hostnames which occur more than once</dd>
  </dl>
</td></tr></table>
</div>
<a name="AddAuthorizedKey"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">AddAuthorizedKey</span>(<span class="sig-arg">file_obj</span>,
        <span class="sig-arg">key</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#AddAuthorizedKey">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Adds an SSH public key to an authorized_keys file.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>file_obj</code></strong> (str or file handle) - path to authorized_keys file</li>
        <li><strong class="pname"><code>key</code></strong> (str) - string containing key</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="RemoveAuthorizedKeys"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">RemoveAuthorizedKeys</span>(<span class="sig-arg">file_name</span>,
        <span class="sig-arg">keys</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#RemoveAuthorizedKeys">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Removes public SSH keys from an authorized_keys file.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>file_name</code></strong> (str) - path to authorized_keys file</li>
        <li><strong class="pname"><code>keys</code></strong> (list of str) - list of strings containing keys</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="RemoveAuthorizedKey"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">RemoveAuthorizedKey</span>(<span class="sig-arg">file_name</span>,
        <span class="sig-arg">key</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#RemoveAuthorizedKey">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Removes an SSH public key from an authorized_keys file.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>file_name</code></strong> (str) - path to authorized_keys file</li>
        <li><strong class="pname"><code>key</code></strong> (str) - string containing key</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="_AddPublicKeyProcessLine"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_AddPublicKeyProcessLine</span>(<span class="sig-arg">new_uuid</span>,
        <span class="sig-arg">new_key</span>,
        <span class="sig-arg">line_uuid</span>,
        <span class="sig-arg">line_key</span>,
        <span class="sig-arg">found</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#_AddPublicKeyProcessLine">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Processes one line of the public key file when adding a key.</p>
  <p>This is a sub function that can be called within the 
  <code>_ManipulatePublicKeyFile</code> function. It processes one line of 
  the public key file, checks if this line contains the key to add already 
  and if so, notes the occurrence in the return value.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>new_uuid</code></strong> (string) - the node UUID of the node whose key is added</li>
        <li><strong class="pname"><code>new_key</code></strong> (string) - the SSH key to be added</li>
        <li><strong class="pname"><code>line_key</code></strong> - the SSH key of the node whose line in the public key file is 
          processed in this function call</li>
        <li><strong class="pname"><code>found</code></strong> (boolean) - whether or not the (UUID, key) pair of the node whose key is 
          being added was found in the public key file already.</li>
        <li><strong class="pname"><code>line_uuid</code></strong> (the UUID of the node whose line in the public key file is 
          processed in this function call)</li>
    </ul></dd>
    <dt>Returns: (boolean, string)</dt>
        <dd>a possibly updated value of <code>found</code> and the processed 
          line</dd>
  </dl>
</td></tr></table>
</div>
<a name="_AddPublicKeyElse"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_AddPublicKeyElse</span>(<span class="sig-arg">new_uuid</span>,
        <span class="sig-arg">new_key</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#_AddPublicKeyElse">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Adds a new SSH key to the key file if it did not exist already.</p>
  <p>This is an auxiliary function for 
  <code>_ManipulatePublicKeyFile</code> which is carried out when a new key
  is added to the public key file and after processing the whole file, we 
  found out that the key does not exist in the file yet but needs to be 
  appended at the end.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>new_uuid</code></strong> (string) - the UUID of the node whose key is added</li>
        <li><strong class="pname"><code>new_key</code></strong> (string) - the SSH key to be added</li>
    </ul></dd>
    <dt>Returns: string</dt>
        <dd>a new line to be added to the file</dd>
  </dl>
</td></tr></table>
</div>
<a name="_RemovePublicKeyProcessLine"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_RemovePublicKeyProcessLine</span>(<span class="sig-arg">target_uuid</span>,
        <span class="sig-arg">_target_key</span>,
        <span class="sig-arg">line_uuid</span>,
        <span class="sig-arg">line_key</span>,
        <span class="sig-arg">found</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#_RemovePublicKeyProcessLine">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Processes a line in the public key file when aiming for removing a 
  key.</p>
  <p>This is an auxiliary function for 
  <code>_ManipulatePublicKeyFile</code> when we are removing a key from the
  public key file. This particular function only checks if the current line
  contains the UUID of the node in question and writes the line to the 
  temporary file otherwise.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>target_uuid</code></strong> (string) - UUID of the node whose key is being removed</li>
        <li><strong class="pname"><code>_target_key</code></strong> (string) - SSH key of the node (not used)</li>
        <li><strong class="pname"><code>line_uuid</code></strong> (string) - UUID of the node whose line is processed in this call</li>
        <li><strong class="pname"><code>line_key</code></strong> (string) - SSH key of the nodes whose line is processed in this call</li>
        <li><strong class="pname"><code>found</code></strong> (boolean) - whether or not the UUID was already found.</li>
    </ul></dd>
    <dt>Returns: (boolean, string)</dt>
        <dd>a tuple, indicating if the target line was found and the 
          processed line; the line is 'None', if the original line is 
          removed</dd>
  </dl>
</td></tr></table>
</div>
<a name="_RemovePublicKeyElse"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_RemovePublicKeyElse</span>(<span class="sig-arg">target_uuid</span>,
        <span class="sig-arg">_target_key</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#_RemovePublicKeyElse">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Logs when we tried to remove a key that does not exist.</p>
  <p>This is an auxiliary function for 
  <code>_ManipulatePublicKeyFile</code> which is run after we have 
  processed the complete public key file and did not find the key to be 
  removed.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>target_uuid</code></strong> (string) - the UUID of the node whose key was supposed to be removed</li>
        <li><strong class="pname"><code>_target_key</code></strong> (string) - the key of the node which was supposed to be removed (not used)</li>
    </ul></dd>
    <dt>Returns: string</dt>
        <dd>in this case, always None</dd>
  </dl>
</td></tr></table>
</div>
<a name="_ReplaceNameByUuidProcessLine"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_ReplaceNameByUuidProcessLine</span>(<span class="sig-arg">node_name</span>,
        <span class="sig-arg">_key</span>,
        <span class="sig-arg">line_identifier</span>,
        <span class="sig-arg">line_key</span>,
        <span class="sig-arg">found</span>,
        <span class="sig-arg">node_uuid</span>=<span class="sig-default">None</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#_ReplaceNameByUuidProcessLine">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Replaces a node's name with its UUID on a matching line in the key 
  file.</p>
  <p>This is an auxiliary function for 
  <code>_ManipulatePublicKeyFile</code> which processes a line of the 
  ganeti public key file. If the line in question matches the node's name, 
  the name will be replaced by the node's UUID.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>node_name</code></strong> (string) - name of the node to be replaced by the UUID</li>
        <li><strong class="pname"><code>_key</code></strong> (string) - SSH key of the node (not used)</li>
        <li><strong class="pname"><code>line_identifier</code></strong> (string) - an identifier of a node in a line of the public key file. This 
          can be either a node name or a node UUID, depending on if it got 
          replaced already or not.</li>
        <li><strong class="pname"><code>line_key</code></strong> (string) - SSH key of the node whose line is processed</li>
        <li><strong class="pname"><code>found</code></strong> (boolean) - whether or not the line matches the node's name</li>
        <li><strong class="pname"><code>node_uuid</code></strong> (string) - the node's UUID which will replace the node name</li>
    </ul></dd>
    <dt>Returns: (boolean, string)</dt>
        <dd>a tuple indicating whether the target line was found and the 
          processed line</dd>
  </dl>
</td></tr></table>
</div>
<a name="_ReplaceNameByUuidElse"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_ReplaceNameByUuidElse</span>(<span class="sig-arg">node_uuid</span>,
        <span class="sig-arg">node_name</span>,
        <span class="sig-arg">_key</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#_ReplaceNameByUuidElse">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Logs a debug message when we try to replace a key that is not 
  there.</p>
  <p>This is an implementation of the auxiliary 
  <code>process_else_fn</code> function for the 
  <code>_ManipulatePubKeyFile</code> function when we use it to replace a 
  line in the public key file that is indexed by the node's name instead of
  the node's UUID.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>node_uuid</code></strong> (string) - the node's UUID</li>
        <li><strong class="pname"><code>node_name</code></strong> (string) - the node's UUID</li>
        <li><strong class="pname"><code>_key</code></strong> (string (not used)) - the node's SSH key (not used)</li>
    </ul></dd>
    <dt>Returns: string</dt>
        <dd>in this case, always None</dd>
  </dl>
</td></tr></table>
</div>
<a name="_ParseKeyLine"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_ParseKeyLine</span>(<span class="sig-arg">line</span>,
        <span class="sig-arg">error_fn</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#_ParseKeyLine">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Parses a line of the public key file.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>line</code></strong> (string) - line of the public key file</li>
        <li><strong class="pname"><code>error_fn</code></strong> (function) - function to process error messages</li>
    </ul></dd>
    <dt>Returns: tuple (string, string)</dt>
        <dd>a tuple containing the UUID of the node and a string containing 
          the SSH key and possible more parameters for the key</dd>
  </dl>
</td></tr></table>
</div>
<a name="_ManipulatePubKeyFile"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_ManipulatePubKeyFile</span>(<span class="sig-arg">target_identifier</span>,
        <span class="sig-arg">target_key</span>,
        <span class="sig-arg">key_file</span>=<span class="sig-default">pathutils.SSH_PUB_KEYS</span>,
        <span class="sig-arg">error_fn</span>=<span class="sig-default">errors.ProgrammerError</span>,
        <span class="sig-arg">process_line_fn</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">process_else_fn</span>=<span class="sig-default">None</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#_ManipulatePubKeyFile">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Manipulates the list of public SSH keys of the cluster.</p>
  <p>This is a general function to manipulate the public key file. It needs
  two auxiliary functions <code>process_line_fn</code> and 
  <code>process_else_fn</code> to work. Generally, the public key file is 
  processed as follows: 1) The function processes each line of the original
  ganeti public key file, applies the <code>process_line_fn</code> function
  on it, which returns a possibly manipulated line and an indicator whether
  the line in question was found. If a line is returned, it is added to a 
  list of lines for later writing to the file. 2) If all lines are 
  processed and the 'found' variable is False, the seconds auxiliary 
  function <code>process_else_fn</code> is called to possibly add more 
  lines to the list of lines. 3) Finally, the list of lines is assembled to
  a string and written atomically to the public key file, thereby 
  overriding it.</p>
  <p>If the public key file does not exist, we create it. This is necessary
  for a smooth transition after an upgrade.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>target_identifier</code></strong> (str) - identifier of the node whose key is added; in most cases this is 
          the node's UUID, but in some it is the node's host name</li>
        <li><strong class="pname"><code>target_key</code></strong> (str) - string containing a public SSH key (a complete line possibly 
          including more parameters than just the key)</li>
        <li><strong class="pname"><code>key_file</code></strong> (str) - filename of the file of public node keys (optional parameter for 
          testing)</li>
        <li><strong class="pname"><code>error_fn</code></strong> (function) - Function that returns an exception, used to customize exception 
          types depending on the calling context</li>
        <li><strong class="pname"><code>process_line_fn</code></strong> (function) - function to process one line of the public key file</li>
        <li><strong class="pname"><code>process_else_fn</code></strong> (function) - function to be called if no line of the key file matches the 
          target uuid</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="AddPublicKey"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">AddPublicKey</span>(<span class="sig-arg">new_uuid</span>,
        <span class="sig-arg">new_key</span>,
        <span class="sig-arg">key_file</span>=<span class="sig-default">pathutils.SSH_PUB_KEYS</span>,
        <span class="sig-arg">error_fn</span>=<span class="sig-default">errors.ProgrammerError</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#AddPublicKey">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Adds a new key to the list of public keys.</p>
  <dl class="fields">
  </dl>
<div class="fields">      <p><strong>See Also:</strong>
        _ManipulatePubKeyFile for parameter descriptions.
      </p>
</div></td></tr></table>
</div>
<a name="RemovePublicKey"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">RemovePublicKey</span>(<span class="sig-arg">target_uuid</span>,
        <span class="sig-arg">key_file</span>=<span class="sig-default">pathutils.SSH_PUB_KEYS</span>,
        <span class="sig-arg">error_fn</span>=<span class="sig-default">errors.ProgrammerError</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#RemovePublicKey">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Removes a key from the list of public keys.</p>
  <dl class="fields">
  </dl>
<div class="fields">      <p><strong>See Also:</strong>
        _ManipulatePubKeyFile for parameter descriptions.
      </p>
</div></td></tr></table>
</div>
<a name="ReplaceNameByUuid"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">ReplaceNameByUuid</span>(<span class="sig-arg">node_uuid</span>,
        <span class="sig-arg">node_name</span>,
        <span class="sig-arg">key_file</span>=<span class="sig-default">pathutils.SSH_PUB_KEYS</span>,
        <span class="sig-arg">error_fn</span>=<span class="sig-default">errors.ProgrammerError</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#ReplaceNameByUuid">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Replaces a host name with the node's corresponding UUID.</p>
  <p>When a node is added to the cluster, we don't know it's UUID yet. So 
  first its SSH key gets added to the public key file and in a second step,
  the node's name gets replaced with the node's UUID as soon as we know the
  UUID.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>node_uuid</code></strong> (string) - the node's UUID to replace the node's name</li>
        <li><strong class="pname"><code>node_name</code></strong> (string) - the node's name to be replaced by the node's UUID</li>
    </ul></dd>
  </dl>
<div class="fields">      <p><strong>See Also:</strong>
        _ManipulatePubKeyFile for the other parameter descriptions.
      </p>
</div></td></tr></table>
</div>
<a name="OverridePubKeyFile"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">OverridePubKeyFile</span>(<span class="sig-arg">key_map</span>,
        <span class="sig-arg">key_file</span>=<span class="sig-default">pathutils.SSH_PUB_KEYS</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#OverridePubKeyFile">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Overrides the public key file with a list of given keys.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>key_map</code></strong> (dict from str to list of str) - dictionary mapping uuids to lists of SSH keys</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="QueryPubKeyFile"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">QueryPubKeyFile</span>(<span class="sig-arg">target_uuids</span>,
        <span class="sig-arg">key_file</span>=<span class="sig-default">pathutils.SSH_PUB_KEYS</span>,
        <span class="sig-arg">error_fn</span>=<span class="sig-default">errors.ProgrammerError</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#QueryPubKeyFile">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Retrieves a map of keys for the requested node UUIDs.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>target_uuids</code></strong> (str or list of str) - UUID of the node to retrieve the key for or a list of UUIDs of 
          nodes to retrieve the keys for</li>
        <li><strong class="pname"><code>key_file</code></strong> (str) - filename of the file of public node keys (optional parameter for 
          testing)</li>
        <li><strong class="pname"><code>error_fn</code></strong> (function) - Function that returns an exception, used to customize exception 
          types depending on the calling context</li>
    </ul></dd>
    <dt>Returns: dict mapping strings to list of strings</dt>
        <dd>dictionary mapping node uuids to their ssh keys</dd>
  </dl>
</td></tr></table>
</div>
<a name="InitSSHSetup"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">InitSSHSetup</span>(<span class="sig-arg">key_type</span>,
        <span class="sig-arg">key_bits</span>,
        <span class="sig-arg">error_fn</span>=<span class="sig-default">errors.OpPrereqError</span>,
        <span class="sig-arg">_homedir_fn</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">_suffix</span>=<span class="sig-default">&quot;&quot;</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#InitSSHSetup">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Setup the SSH configuration for the node.</p>
  <p>This generates a dsa keypair for root, adds the pub key to the 
  permitted hosts and adds the hostkey to its own known hosts.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>key_type</code></strong> - the type of SSH keypair to be generated</li>
        <li><strong class="pname"><code>key_bits</code></strong> - the key length, in bits, to be used</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="InitPubKeyFile"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">InitPubKeyFile</span>(<span class="sig-arg">master_uuid</span>,
        <span class="sig-arg">key_type</span>,
        <span class="sig-arg">key_file</span>=<span class="sig-default">pathutils.SSH_PUB_KEYS</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#InitPubKeyFile">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Creates the public key file and adds the master node's SSH key.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>master_uuid</code></strong> (str) - the master node's UUID</li>
        <li><strong class="pname"><code>key_type</code></strong> (one of constants.SSHK_ALL) - the type of ssh key to be used</li>
        <li><strong class="pname"><code>key_file</code></strong> (str) - name of the file containing the public keys</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="_EnsureCorrectGanetiVersion"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_EnsureCorrectGanetiVersion</span>(<span class="sig-arg">cmd</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#_EnsureCorrectGanetiVersion">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Ensured the correct Ganeti version before running a command via 
  SSH.</p>
  <p>Before a command is run on a node via SSH, it makes sense in some 
  situations to ensure that this node is indeed running the correct version
  of Ganeti like the rest of the cluster.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>cmd</code></strong> (string) - string</li>
    </ul></dd>
    <dt>Returns: list of strings</dt>
        <dd>a list of commands with the newly added ones at the beginning</dd>
  </dl>
</td></tr></table>
</div>
<a name="RunSshCmdWithStdin"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">RunSshCmdWithStdin</span>(<span class="sig-arg">cluster_name</span>,
        <span class="sig-arg">node</span>,
        <span class="sig-arg">basecmd</span>,
        <span class="sig-arg">port</span>,
        <span class="sig-arg">data</span>,
        <span class="sig-arg">debug</span>=<span class="sig-default">False</span>,
        <span class="sig-arg">verbose</span>=<span class="sig-default">False</span>,
        <span class="sig-arg">use_cluster_key</span>=<span class="sig-default">False</span>,
        <span class="sig-arg">ask_key</span>=<span class="sig-default">False</span>,
        <span class="sig-arg">strict_host_check</span>=<span class="sig-default">False</span>,
        <span class="sig-arg">ensure_version</span>=<span class="sig-default">False</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#RunSshCmdWithStdin">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Runs a command on a remote machine via SSH and provides input in 
  stdin.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>cluster_name</code></strong> (string) - Cluster name</li>
        <li><strong class="pname"><code>node</code></strong> (string) - Node name</li>
        <li><strong class="pname"><code>basecmd</code></strong> (string) - Base command (path on the remote machine)</li>
        <li><strong class="pname"><code>port</code></strong> (int) - The SSH port of the remote machine or None for the default</li>
        <li><strong class="pname"><code>data</code></strong> - JSON-serializable input data for script (passed to stdin)</li>
        <li><strong class="pname"><code>debug</code></strong> (bool) - Enable debug output</li>
        <li><strong class="pname"><code>verbose</code></strong> (bool) - Enable verbose output</li>
        <li><strong class="pname"><code>use_cluster_key</code></strong> (bool) - See <a href="ganeti.ssh.SshRunner-class.html#BuildCmd" 
          class="link">ssh.SshRunner.BuildCmd</a></li>
        <li><strong class="pname"><code>ask_key</code></strong> (bool) - See <a href="ganeti.ssh.SshRunner-class.html#BuildCmd" 
          class="link">ssh.SshRunner.BuildCmd</a></li>
        <li><strong class="pname"><code>strict_host_check</code></strong> (bool) - See <a href="ganeti.ssh.SshRunner-class.html#BuildCmd" 
          class="link">ssh.SshRunner.BuildCmd</a></li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="ReadRemoteSshPubKey"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">ReadRemoteSshPubKey</span>(<span class="sig-arg">pub_key_file</span>,
        <span class="sig-arg">node</span>,
        <span class="sig-arg">cluster_name</span>,
        <span class="sig-arg">port</span>,
        <span class="sig-arg">ask_key</span>,
        <span class="sig-arg">strict_host_check</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#ReadRemoteSshPubKey">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Fetches a public SSH key from a node via SSH.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>pub_key_file</code></strong> (string) - a tuple consisting of the file name of the public DSA key</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="GetSshKeyFilenames"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">GetSshKeyFilenames</span>(<span class="sig-arg">key_type</span>,
        <span class="sig-arg">suffix</span>=<span class="sig-default">&quot;&quot;</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#GetSshKeyFilenames">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Get filenames of the SSH key pair of the given type.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>key_type</code></strong> (string) - type of SSH key, must be element of 
          <code>constants.SSHK_ALL</code></li>
        <li><strong class="pname"><code>suffix</code></strong> (string) - optional suffix for the key filenames</li>
    </ul></dd>
    <dt>Returns: tuple of (string, string)</dt>
        <dd>a tuple containing the name of the private key file and the 
          public key file.</dd>
  </dl>
</td></tr></table>
</div>
<a name="GetSshPubKeyFilename"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">GetSshPubKeyFilename</span>(<span class="sig-arg">key_type</span>,
        <span class="sig-arg">suffix</span>=<span class="sig-default">&quot;&quot;</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#GetSshPubKeyFilename">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Get filename of the public SSH key of the given type.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>key_type</code></strong> (string) - type of SSH key, must be element of 
          <code>constants.SSHK_ALL</code></li>
        <li><strong class="pname"><code>suffix</code></strong> (string) - optional suffix for the key filenames</li>
    </ul></dd>
    <dt>Returns: string</dt>
        <dd>file name of the public key file</dd>
  </dl>
</td></tr></table>
</div>
<a name="_ComputeKeyFilePathWithSuffix"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_ComputeKeyFilePathWithSuffix</span>(<span class="sig-arg">key_filepath</span>,
        <span class="sig-arg">suffix</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#_ComputeKeyFilePathWithSuffix">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Converts the given key filename to a key filename with a suffix.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>key_filepath</code></strong> (string) - path of the key file</li>
        <li><strong class="pname"><code>suffix</code></strong> (string) - suffix to be appended to the basename of the file</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="ReplaceSshKeys"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">ReplaceSshKeys</span>(<span class="sig-arg">src_key_type</span>,
        <span class="sig-arg">dest_key_type</span>,
        <span class="sig-arg">src_key_suffix</span>=<span class="sig-default">&quot;&quot;</span>,
        <span class="sig-arg">dest_key_suffix</span>=<span class="sig-default">&quot;&quot;</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#ReplaceSshKeys">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Replaces an SSH key pair by another SSH key pair.</p>
  <p>Note that both parts, the private and the public key, are 
  replaced.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>src_key_type</code></strong> (string) - key type of key pair that is replacing the other key pair</li>
        <li><strong class="pname"><code>dest_key_type</code></strong> (string) - key type of the key pair that is being replaced by the source key
          pair</li>
        <li><strong class="pname"><code>src_key_suffix</code></strong> (string) - optional suffix of the key files of the source key pair</li>
        <li><strong class="pname"><code>dest_key_suffix</code></strong> (string) - optional suffix of the keey files of the destination key pair</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="ReadLocalSshPubKeys"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">ReadLocalSshPubKeys</span>(<span class="sig-arg">key_types</span>,
        <span class="sig-arg">suffix</span>=<span class="sig-default">&quot;&quot;</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#ReadLocalSshPubKeys">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Reads the local root user SSH key.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>key_types</code></strong> (list of string) - types of SSH keys. Must be subset of constants.SSHK_ALL. If 
          'None' or [], all available keys are returned.</li>
        <li><strong class="pname"><code>suffix</code></strong> (string) - optional suffix to be attached to key names when reading them. 
          Used for temporary key files.</li>
    </ul></dd>
    <dt>Returns: list of string</dt>
        <dd>list of public keys</dd>
  </dl>
</td></tr></table>
</div>
<a name="DetermineKeyBits"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">DetermineKeyBits</span>(<span class="sig-arg">key_type</span>,
        <span class="sig-arg">key_bits</span>,
        <span class="sig-arg">old_key_type</span>,
        <span class="sig-arg">old_key_bits</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.ssh-pysrc.html#DetermineKeyBits">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Checks the key bits to be used for a given key type, or provides 
  defaults.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>key_type</code></strong> (one of constants.SSHK_ALL) - The key type to use.</li>
        <li><strong class="pname"><code>key_bits</code></strong> (positive int or None) - The number of bits to use, if supplied by user.</li>
        <li><strong class="pname"><code>old_key_type</code></strong> (one of constants.SSHK_ALL or None) - The previously used key type, if any.</li>
        <li><strong class="pname"><code>old_key_bits</code></strong> (positive int or None) - The previously used number of bits, if any.</li>
    </ul></dd>
    <dt>Returns: positive int</dt>
        <dd>The number of bits to use.</dd>
  </dl>
</td></tr></table>
</div>
<br />
<!-- ==================== VARIABLES DETAILS ==================== -->
<a name="section-VariablesDetails"></a>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Variables Details</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-VariablesDetails"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
</table>
<a name="KeyBitInfo"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <h3 class="epydoc">KeyBitInfo</h3>
  
  <dl class="fields">
  </dl>
  <dl class="fields">
    <dt>Value:</dt>
      <dd><table><tr><td><pre class="variable">
namedtuple('KeyBitInfo', ['default', 'validation_fn'])
</pre></td></tr></table>
</dd>
  </dl>
</td></tr></table>
</div>
<a name="SSH_KEY_VALID_BITS"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <h3 class="epydoc">SSH_KEY_VALID_BITS</h3>
  
  <dl class="fields">
  </dl>
  <dl class="fields">
    <dt>Value:</dt>
      <dd><table><tr><td><pre class="variable">
{constants.SSHK_DSA: KeyBitInfo(1024, lambda b: b== 1024), constants.S<span class="variable-linewrap"><img src="crarr.png" alt="\" /></span>
SHK_RSA: KeyBitInfo(2048, lambda b: b &gt;= 768), constants.SSHK_ECDSA: K<span class="variable-linewrap"><img src="crarr.png" alt="\" /></span>
eyBitInfo(384, lambda b: b in [256, 384, 521]),}
</pre></td></tr></table>
</dd>
  </dl>
</td></tr></table>
</div>
<br />
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://code.google.com/p/ganeti/">Ganeti</a></th>
          </tr></table></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">
    Generated by Epydoc 3.0.1 on Mon Apr  4 13:43:46 2016
    </td>
    <td align="right" class="footer">
      <a target="mainFrame" href="http://epydoc.sourceforge.net"
        >http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie();
  // -->
</script>
</body>
</html>
