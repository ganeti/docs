<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ganeti.HTools.Backend.IAlloc</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Ganeti-HTools-Backend-IAlloc.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="Ganeti/HTools/Backend/IAlloc.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ganeti</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Infered</td></tr></table><p class="caption">Ganeti.HTools.Backend.IAlloc</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Implementation of the iallocator interface.
</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">type</span> <a href="#t:IAllocResult">IAllocResult</a> = (String, JSValue, <a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>)</li><li class="src short"><a href="#v:parseNic">parseNic</a> :: String -&gt; <a href="Ganeti-JSON.html#t:JSRecord">JSRecord</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Nic.html#t:Nic">Nic</a></li><li class="src short"><a href="#v:parseBaseInstance">parseBaseInstance</a> :: String -&gt; <a href="Ganeti-JSON.html#t:JSRecord">JSRecord</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (String, <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a>)</li><li class="src short"><a href="#v:parseInstance">parseInstance</a> :: <a href="Ganeti-HTools-Types.html#t:NameAssoc">NameAssoc</a> -&gt; String -&gt; <a href="Ganeti-JSON.html#t:JSRecord">JSRecord</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (String, <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a>)</li><li class="src short"><a href="#v:parseNode">parseNode</a> :: <a href="Ganeti-HTools-Types.html#t:NameAssoc">NameAssoc</a> -&gt; String -&gt; <a href="Ganeti-JSON.html#t:JSRecord">JSRecord</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (String, <a href="Ganeti-HTools-Node.html#t:Node">Node</a>)</li><li class="src short"><a href="#v:parseGroup">parseGroup</a> :: String -&gt; <a href="Ganeti-JSON.html#t:JSRecord">JSRecord</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (String, <a href="Ganeti-HTools-Group.html#t:Group">Group</a>)</li><li class="src short"><a href="#v:parseData">parseData</a> :: ClockTime -&gt; String -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> ([String], <a href="Ganeti-HTools-Loader.html#t:Request">Request</a>)</li><li class="src short"><a href="#v:formatResponse">formatResponse</a> :: Bool -&gt; String -&gt; JSValue -&gt; String</li><li class="src short"><a href="#v:describeSolution">describeSolution</a> :: <a href="Ganeti-HTools-Cluster.html#t:AllocSolution">AllocSolution</a> -&gt; String</li><li class="src short"><a href="#v:formatAllocate">formatAllocate</a> :: <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocSolution">AllocSolution</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Backend-IAlloc.html#t:IAllocResult">IAllocResult</a></li><li class="src short"><a href="#v:formatMultiAlloc">formatMultiAlloc</a> :: (<a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>, <a href="Ganeti-HTools-Cluster.html#t:AllocSolutionList">AllocSolutionList</a>) -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Backend-IAlloc.html#t:IAllocResult">IAllocResult</a></li><li class="src short"><a href="#v:formatNodeEvac">formatNodeEvac</a> :: <a href="Ganeti-HTools-Group.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; (<a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>, <a href="Ganeti-HTools-Cluster.html#t:EvacSolution">EvacSolution</a>) -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Backend-IAlloc.html#t:IAllocResult">IAllocResult</a></li><li class="src short"><a href="#v:processRelocate">processRelocate</a> :: <a href="Ganeti-HTools-Group.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Types.html#t:Idx">Idx</a> -&gt; Int -&gt; [<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>] -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (<a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>, [<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>])</li><li class="src short"><a href="#v:formatRelocate">formatRelocate</a> :: (<a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>, [<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>]) -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Backend-IAlloc.html#t:IAllocResult">IAllocResult</a></li><li class="src short"><a href="#v:processRequest">processRequest</a> :: <a href="Ganeti-HTools-Loader.html#t:Request">Request</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Backend-IAlloc.html#t:IAllocResult">IAllocResult</a></li><li class="src short"><a href="#v:readRequest">readRequest</a> :: FilePath -&gt; IO <a href="Ganeti-HTools-Loader.html#t:Request">Request</a></li><li class="src short"><a href="#v:runIAllocator">runIAllocator</a> :: <a href="Ganeti-HTools-Loader.html#t:Request">Request</a> -&gt; (Maybe (<a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>), String)</li><li class="src short"><a href="#v:loadData">loadData</a> :: FilePath -&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Loader.html#t:ClusterData">ClusterData</a>)</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:IAllocResult" class="def">IAllocResult</a> = (String, JSValue, <a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>)<a href="Ganeti/HTools/Backend/IAlloc.html#IAllocResult" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:parseNic" class="def">parseNic</a> :: String -&gt; <a href="Ganeti-JSON.html#t:JSRecord">JSRecord</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Nic.html#t:Nic">Nic</a><a href="Ganeti/HTools/Backend/IAlloc.html#parseNic" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:parseBaseInstance" class="def">parseBaseInstance</a> :: String -&gt; <a href="Ganeti-JSON.html#t:JSRecord">JSRecord</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (String, <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a>)<a href="Ganeti/HTools/Backend/IAlloc.html#parseBaseInstance" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:parseInstance" class="def">parseInstance</a> :: <a href="Ganeti-HTools-Types.html#t:NameAssoc">NameAssoc</a> -&gt; String -&gt; <a href="Ganeti-JSON.html#t:JSRecord">JSRecord</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (String, <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a>)<a href="Ganeti/HTools/Backend/IAlloc.html#parseInstance" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:parseNode" class="def">parseNode</a> :: <a href="Ganeti-HTools-Types.html#t:NameAssoc">NameAssoc</a> -&gt; String -&gt; <a href="Ganeti-JSON.html#t:JSRecord">JSRecord</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (String, <a href="Ganeti-HTools-Node.html#t:Node">Node</a>)<a href="Ganeti/HTools/Backend/IAlloc.html#parseNode" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:parseGroup" class="def">parseGroup</a> :: String -&gt; <a href="Ganeti-JSON.html#t:JSRecord">JSRecord</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (String, <a href="Ganeti-HTools-Group.html#t:Group">Group</a>)<a href="Ganeti/HTools/Backend/IAlloc.html#parseGroup" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:parseData" class="def">parseData</a> :: ClockTime -&gt; String -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> ([String], <a href="Ganeti-HTools-Loader.html#t:Request">Request</a>)<a href="Ganeti/HTools/Backend/IAlloc.html#parseData" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:formatResponse" class="def">formatResponse</a> :: Bool -&gt; String -&gt; JSValue -&gt; String<a href="Ganeti/HTools/Backend/IAlloc.html#formatResponse" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:describeSolution" class="def">describeSolution</a> :: <a href="Ganeti-HTools-Cluster.html#t:AllocSolution">AllocSolution</a> -&gt; String<a href="Ganeti/HTools/Backend/IAlloc.html#describeSolution" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:formatAllocate" class="def">formatAllocate</a> :: <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Cluster.html#t:AllocSolution">AllocSolution</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Backend-IAlloc.html#t:IAllocResult">IAllocResult</a><a href="Ganeti/HTools/Backend/IAlloc.html#formatAllocate" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:formatMultiAlloc" class="def">formatMultiAlloc</a> :: (<a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>, <a href="Ganeti-HTools-Cluster.html#t:AllocSolutionList">AllocSolutionList</a>) -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Backend-IAlloc.html#t:IAllocResult">IAllocResult</a><a href="Ganeti/HTools/Backend/IAlloc.html#formatMultiAlloc" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:formatNodeEvac" class="def">formatNodeEvac</a> :: <a href="Ganeti-HTools-Group.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; (<a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>, <a href="Ganeti-HTools-Cluster.html#t:EvacSolution">EvacSolution</a>) -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Backend-IAlloc.html#t:IAllocResult">IAllocResult</a><a href="Ganeti/HTools/Backend/IAlloc.html#formatNodeEvac" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:processRelocate" class="def">processRelocate</a><a href="Ganeti/HTools/Backend/IAlloc.html#processRelocate" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-Group.html#t:List">List</a></td><td class="doc"><p>The group list
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a></td><td class="doc"><p>The node list
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a></td><td class="doc"><p>The instance list
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Types.html#t:Idx">Idx</a></td><td class="doc"><p>The index of the instance to move
</p></td></tr><tr><td class="src">-&gt; Int</td><td class="doc"><p>The number of nodes required
</p></td></tr><tr><td class="src">-&gt; [<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>]</td><td class="doc"><p>Nodes which should not be used
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (<a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>, [<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>])</td><td class="doc"><p>Solution list
</p></td></tr></table></div><div class="doc"><p>Runs relocate for a single instance.
</p><p>This is wrapper over the <code><a href="Ganeti-HTools-Cluster.html#v:tryNodeEvac">tryNodeEvac</a></code> function that is run
 with a single instance (ours), and further it checks that the
 result it got (in the nodes field) is actually consistent, as
 tryNodeEvac is designed to output primarily an opcode list, not a
 node list.
</p></div></div><div class="top"><p class="src"><a name="v:formatRelocate" class="def">formatRelocate</a> :: (<a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>, [<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>]) -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Backend-IAlloc.html#t:IAllocResult">IAllocResult</a><a href="Ganeti/HTools/Backend/IAlloc.html#formatRelocate" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:processRequest" class="def">processRequest</a> :: <a href="Ganeti-HTools-Loader.html#t:Request">Request</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Backend-IAlloc.html#t:IAllocResult">IAllocResult</a><a href="Ganeti/HTools/Backend/IAlloc.html#processRequest" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:readRequest" class="def">readRequest</a> :: FilePath -&gt; IO <a href="Ganeti-HTools-Loader.html#t:Request">Request</a><a href="Ganeti/HTools/Backend/IAlloc.html#readRequest" class="link">Source</a></p><div class="doc"><p>Reads the request from the data file(s).
</p></div></div><div class="top"><p class="src"><a name="v:runIAllocator" class="def">runIAllocator</a> :: <a href="Ganeti-HTools-Loader.html#t:Request">Request</a> -&gt; (Maybe (<a href="Ganeti-HTools-Node.html#t:List">List</a>, <a href="Ganeti-HTools-Instance.html#t:List">List</a>), String)<a href="Ganeti/HTools/Backend/IAlloc.html#runIAllocator" class="link">Source</a></p><div class="doc"><p>Main iallocator pipeline.
</p></div></div><div class="top"><p class="src"><a name="v:loadData" class="def">loadData</a><a href="Ganeti/HTools/Backend/IAlloc.html#loadData" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: FilePath</td><td class="doc"><p>The path to the file
</p></td></tr><tr><td class="src">-&gt; IO (<a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Loader.html#t:ClusterData">ClusterData</a>)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Load the data from an iallocation request file
</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.10.0</p></div></body></html>