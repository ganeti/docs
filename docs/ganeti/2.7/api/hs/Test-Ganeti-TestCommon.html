<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Test.Ganeti.TestCommon</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Test-Ganeti-TestCommon.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="Test/Ganeti/TestCommon.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ganeti</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Infered</td></tr></table><p class="caption">Test.Ganeti.TestCommon</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Constants
</a></li><li><a href="#g:2">Helper functions
</a></li><li><a href="#g:3">Arbitrary instances
</a></li><li><a href="#g:4">Helper functions
</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Unittest helpers for ganeti-htools.
</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:maxMem">maxMem</a> :: Int</li><li class="src short"><a href="#v:maxDsk">maxDsk</a> :: Int</li><li class="src short"><a href="#v:maxCpu">maxCpu</a> :: Int</li><li class="src short"><a href="#v:maxVcpuRatio">maxVcpuRatio</a> :: Double</li><li class="src short"><a href="#v:maxSpindleRatio">maxSpindleRatio</a> :: Double</li><li class="src short"><a href="#v:maxNodes">maxNodes</a> :: Int</li><li class="src short"><a href="#v:maxOpCodes">maxOpCodes</a> :: Int</li><li class="src short"><a href="#v:-61--61--63-">(==?)</a> :: (Show a, Eq a) =&gt; a -&gt; a -&gt; Property</li><li class="src short"><a href="#v:-47--61--63-">(/=?)</a> :: (Show a, Eq a) =&gt; a -&gt; a -&gt; Property</li><li class="src short"><a href="#v:failTest">failTest</a> :: String -&gt; Property</li><li class="src short"><a href="#v:passTest">passTest</a> :: Property</li><li class="src short"><a href="#v:pythonCmd">pythonCmd</a> :: IO String</li><li class="src short"><a href="#v:runPython">runPython</a> :: String -&gt; String -&gt; IO (ExitCode, String, String)</li><li class="src short"><a href="#v:checkPythonResult">checkPythonResult</a> :: (ExitCode, String, String) -&gt; IO String</li><li class="src short"><span class="keyword">newtype</span>  <a href="#t:DNSChar">DNSChar</a>  = <a href="#v:DNSChar">DNSChar</a> {<ul class="subs"><li><a href="#v:dnsGetChar">dnsGetChar</a> :: Char</li></ul>}</li><li class="src short"><a href="#v:genName">genName</a> :: Gen String</li><li class="src short"><a href="#v:genFQDN">genFQDN</a> :: Gen String</li><li class="src short"><a href="#v:genMaybe">genMaybe</a> ::  Gen a -&gt; Gen (Maybe a)</li><li class="src short"><span class="keyword">newtype</span>  <a href="#t:TagChar">TagChar</a>  = <a href="#v:TagChar">TagChar</a> {<ul class="subs"><li><a href="#v:tagGetChar">tagGetChar</a> :: Char</li></ul>}</li><li class="src short"><a href="#v:tagChar">tagChar</a> :: String</li><li class="src short"><a href="#v:genTag">genTag</a> :: Gen [<a href="Test-Ganeti-TestCommon.html#t:TagChar">TagChar</a>]</li><li class="src short"><a href="#v:genTags">genTags</a> :: Gen [String]</li><li class="src short"><a href="#v:genFields">genFields</a> :: Gen [String]</li><li class="src short"><a href="#v:genUniquesList">genUniquesList</a> :: (Eq a, Arbitrary a, Ord a) =&gt; Int -&gt; Gen a -&gt; Gen [a]</li><li class="src short"><span class="keyword">newtype</span>  <a href="#t:SmallRatio">SmallRatio</a>  = <a href="#v:SmallRatio">SmallRatio</a> Double</li><li class="src short"><a href="#v:genSetHelper">genSetHelper</a> :: Ord a =&gt; [a] -&gt; Maybe Int -&gt; Gen (Set a)</li><li class="src short"><a href="#v:genSet">genSet</a> :: (Ord a, Bounded a, Enum a) =&gt; Maybe Int -&gt; Gen (Set a)</li><li class="src short"><a href="#v:genIp4Addr">genIp4Addr</a> :: Gen <a href="Ganeti-Types.html#t:NonEmptyString">NonEmptyString</a></li><li class="src short"><a href="#v:genIp4AddrStr">genIp4AddrStr</a> :: Gen String</li><li class="src short"><a href="#v:genIp4NetWithNetmask">genIp4NetWithNetmask</a> :: Int -&gt; Gen <a href="Ganeti-Types.html#t:NonEmptyString">NonEmptyString</a></li><li class="src short"><a href="#v:genIp4Net">genIp4Net</a> :: Gen <a href="Ganeti-Types.html#t:NonEmptyString">NonEmptyString</a></li><li class="src short"><a href="#v:netmask2NumHosts">netmask2NumHosts</a> :: Int -&gt; Int</li><li class="src short"><a href="#v:genIp6Addr">genIp6Addr</a> :: Gen String</li><li class="src short"><a href="#v:genIp6Net">genIp6Net</a> :: Gen String</li><li class="src short"><a href="#v:testSerialisation">testSerialisation</a> :: (Eq a, Show a, JSON a) =&gt; a -&gt; Property</li><li class="src short"><a href="#v:resultProp">resultProp</a> :: Show a =&gt; <a href="Ganeti-BasicTypes.html#t:GenericResult">GenericResult</a> a b -&gt; PropertyM IO b</li><li class="src short"><a href="#v:getSourceDir">getSourceDir</a> :: IO FilePath</li><li class="src short"><a href="#v:testDataFilename">testDataFilename</a> :: String -&gt; String -&gt; IO FilePath</li><li class="src short"><a href="#v:readTestData">readTestData</a> :: String -&gt; IO String</li><li class="src short"><a href="#v:genSample">genSample</a> ::  Gen a -&gt; IO a</li></ul></div><div id="interface"><h1 id="g:1">Constants
</h1><div class="top"><p class="src"><a name="v:maxMem" class="def">maxMem</a> :: Int<a href="Test/Ganeti/TestCommon.html#maxMem" class="link">Source</a></p><div class="doc"><p>Maximum memory (1TiB, somewhat random value).
</p></div></div><div class="top"><p class="src"><a name="v:maxDsk" class="def">maxDsk</a> :: Int<a href="Test/Ganeti/TestCommon.html#maxDsk" class="link">Source</a></p><div class="doc"><p>Maximum disk (8TiB, somewhat random value).
</p></div></div><div class="top"><p class="src"><a name="v:maxCpu" class="def">maxCpu</a> :: Int<a href="Test/Ganeti/TestCommon.html#maxCpu" class="link">Source</a></p><div class="doc"><p>Max CPUs (1024, somewhat random value).
</p></div></div><div class="top"><p class="src"><a name="v:maxVcpuRatio" class="def">maxVcpuRatio</a> :: Double<a href="Test/Ganeti/TestCommon.html#maxVcpuRatio" class="link">Source</a></p><div class="doc"><p>Max vcpu ratio (random value).
</p></div></div><div class="top"><p class="src"><a name="v:maxSpindleRatio" class="def">maxSpindleRatio</a> :: Double<a href="Test/Ganeti/TestCommon.html#maxSpindleRatio" class="link">Source</a></p><div class="doc"><p>Max spindle ratio (random value).
</p></div></div><div class="top"><p class="src"><a name="v:maxNodes" class="def">maxNodes</a> :: Int<a href="Test/Ganeti/TestCommon.html#maxNodes" class="link">Source</a></p><div class="doc"><p>Max nodes, used just to limit arbitrary instances for smaller
 opcode definitions (e.g. list of nodes in OpTestDelay).
</p></div></div><div class="top"><p class="src"><a name="v:maxOpCodes" class="def">maxOpCodes</a> :: Int<a href="Test/Ganeti/TestCommon.html#maxOpCodes" class="link">Source</a></p><div class="doc"><p>Max opcodes or jobs in a submit job and submit many jobs.
</p></div></div><h1 id="g:2">Helper functions
</h1><div class="top"><p class="src"><a name="v:-61--61--63-" class="def">(==?)</a> :: (Show a, Eq a) =&gt; a -&gt; a -&gt; Property<a href="Test/Ganeti/TestCommon.html#%3D%3D%3F" class="link">Source</a></p><div class="doc"><p>Checks for equality with proper annotation. The first argument is
 the computed value, the second one the expected value.
</p></div></div><div class="top"><p class="src"><a name="v:-47--61--63-" class="def">(/=?)</a> :: (Show a, Eq a) =&gt; a -&gt; a -&gt; Property<a href="Test/Ganeti/TestCommon.html#%2F%3D%3F" class="link">Source</a></p><div class="doc"><p>Checks for inequality with proper annotation. The first argument
 is the computed value, the second one the expected (not equal)
 value.
</p></div></div><div class="top"><p class="src"><a name="v:failTest" class="def">failTest</a> :: String -&gt; Property<a href="Test/Ganeti/TestCommon.html#failTest" class="link">Source</a></p><div class="doc"><p>Show a message and fail the test.
</p></div></div><div class="top"><p class="src"><a name="v:passTest" class="def">passTest</a> :: Property<a href="Test/Ganeti/TestCommon.html#passTest" class="link">Source</a></p><div class="doc"><p>A <code>True</code> property.
</p></div></div><div class="top"><p class="src"><a name="v:pythonCmd" class="def">pythonCmd</a> :: IO String<a href="Test/Ganeti/TestCommon.html#pythonCmd" class="link">Source</a></p><div class="doc"><p>Return the python binary to use. If the PYTHON environment
 variable is defined, use its value, otherwise use just &quot;python&quot;.
</p></div></div><div class="top"><p class="src"><a name="v:runPython" class="def">runPython</a> :: String -&gt; String -&gt; IO (ExitCode, String, String)<a href="Test/Ganeti/TestCommon.html#runPython" class="link">Source</a></p><div class="doc"><p>Run Python with an expression, returning the exit code, standard
 output and error.
</p></div></div><div class="top"><p class="src"><a name="v:checkPythonResult" class="def">checkPythonResult</a> :: (ExitCode, String, String) -&gt; IO String<a href="Test/Ganeti/TestCommon.html#checkPythonResult" class="link">Source</a></p><div class="doc"><p>Check python exit code, and fail via HUnit assertions if
 non-zero. Otherwise, return the standard output.
</p></div></div><h1 id="g:3">Arbitrary instances
</h1><div class="top"><p class="src"><span class="keyword">newtype</span>  <a name="t:DNSChar" class="def">DNSChar</a>  <a href="Test/Ganeti/TestCommon.html#DNSChar" class="link">Source</a></p><div class="doc"><p>Defines a DNS name.
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:DNSChar" class="def">DNSChar</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:dnsGetChar" class="def">dnsGetChar</a> :: Char</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:DNSChar" class="caption collapser" onclick="toggleSection('i:DNSChar')">Instances</p><div id="section.i:DNSChar" class="show"><table><tr><td class="src">Show <a href="Test-Ganeti-TestCommon.html#t:DNSChar">DNSChar</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Arbitrary <a href="Test-Ganeti-TestCommon.html#t:DNSChar">DNSChar</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:genName" class="def">genName</a> :: Gen String<a href="Test/Ganeti/TestCommon.html#genName" class="link">Source</a></p><div class="doc"><p>Generates a single name component.
</p></div></div><div class="top"><p class="src"><a name="v:genFQDN" class="def">genFQDN</a> :: Gen String<a href="Test/Ganeti/TestCommon.html#genFQDN" class="link">Source</a></p><div class="doc"><p>Generates an entire FQDN.
</p></div></div><div class="top"><p class="src"><a name="v:genMaybe" class="def">genMaybe</a> ::  Gen a -&gt; Gen (Maybe a)<a href="Test/Ganeti/TestCommon.html#genMaybe" class="link">Source</a></p><div class="doc"><p>Combinator that generates a <code>Maybe</code> using a sub-combinator.
</p></div></div><div class="top"><p class="src"><span class="keyword">newtype</span>  <a name="t:TagChar" class="def">TagChar</a>  <a href="Test/Ganeti/TestCommon.html#TagChar" class="link">Source</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:TagChar" class="def">TagChar</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:tagGetChar" class="def">tagGetChar</a> :: Char</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:TagChar" class="caption collapser" onclick="toggleSection('i:TagChar')">Instances</p><div id="section.i:TagChar" class="show"><table><tr><td class="src">Arbitrary <a href="Test-Ganeti-TestCommon.html#t:TagChar">TagChar</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:tagChar" class="def">tagChar</a> :: String<a href="Test/Ganeti/TestCommon.html#tagChar" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:genTag" class="def">genTag</a> :: Gen [<a href="Test-Ganeti-TestCommon.html#t:TagChar">TagChar</a>]<a href="Test/Ganeti/TestCommon.html#genTag" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:genTags" class="def">genTags</a> :: Gen [String]<a href="Test/Ganeti/TestCommon.html#genTags" class="link">Source</a></p><div class="doc"><p>Generates a list of tags (correctly upper bounded).
</p></div></div><div class="top"><p class="src"><a name="v:genFields" class="def">genFields</a> :: Gen [String]<a href="Test/Ganeti/TestCommon.html#genFields" class="link">Source</a></p><div class="doc"><p>Generates a fields list. This uses the same character set as a
 DNS name (just for simplicity).
</p></div></div><div class="top"><p class="src"><a name="v:genUniquesList" class="def">genUniquesList</a> :: (Eq a, Arbitrary a, Ord a) =&gt; Int -&gt; Gen a -&gt; Gen [a]<a href="Test/Ganeti/TestCommon.html#genUniquesList" class="link">Source</a></p><div class="doc"><p>Generates a list of a given size with non-duplicate elements.
</p></div></div><div class="top"><p class="src"><span class="keyword">newtype</span>  <a name="t:SmallRatio" class="def">SmallRatio</a>  <a href="Test/Ganeti/TestCommon.html#SmallRatio" class="link">Source</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:SmallRatio" class="def">SmallRatio</a> Double</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:SmallRatio" class="caption collapser" onclick="toggleSection('i:SmallRatio')">Instances</p><div id="section.i:SmallRatio" class="show"><table><tr><td class="src">Show <a href="Test-Ganeti-TestCommon.html#t:SmallRatio">SmallRatio</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Arbitrary <a href="Test-Ganeti-TestCommon.html#t:SmallRatio">SmallRatio</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:genSetHelper" class="def">genSetHelper</a> :: Ord a =&gt; [a] -&gt; Maybe Int -&gt; Gen (Set a)<a href="Test/Ganeti/TestCommon.html#genSetHelper" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:genSet" class="def">genSet</a> :: (Ord a, Bounded a, Enum a) =&gt; Maybe Int -&gt; Gen (Set a)<a href="Test/Ganeti/TestCommon.html#genSet" class="link">Source</a></p><div class="doc"><p>Generates a set of arbitrary elements.
</p></div></div><div class="top"><p class="src"><a name="v:genIp4Addr" class="def">genIp4Addr</a> :: Gen <a href="Ganeti-Types.html#t:NonEmptyString">NonEmptyString</a><a href="Test/Ganeti/TestCommon.html#genIp4Addr" class="link">Source</a></p><div class="doc"><p>Generate an arbitrary IPv4 address in textual form (non empty).
</p></div></div><div class="top"><p class="src"><a name="v:genIp4AddrStr" class="def">genIp4AddrStr</a> :: Gen String<a href="Test/Ganeti/TestCommon.html#genIp4AddrStr" class="link">Source</a></p><div class="doc"><p>Generate an arbitrary IPv4 address in textual form.
</p></div></div><div class="top"><p class="src"><a name="v:genIp4NetWithNetmask" class="def">genIp4NetWithNetmask</a> :: Int -&gt; Gen <a href="Ganeti-Types.html#t:NonEmptyString">NonEmptyString</a><a href="Test/Ganeti/TestCommon.html#genIp4NetWithNetmask" class="link">Source</a></p><div class="doc"><p>Generates an arbitrary IPv4 address with a given netmask in textual form.
</p></div></div><div class="top"><p class="src"><a name="v:genIp4Net" class="def">genIp4Net</a> :: Gen <a href="Ganeti-Types.html#t:NonEmptyString">NonEmptyString</a><a href="Test/Ganeti/TestCommon.html#genIp4Net" class="link">Source</a></p><div class="doc"><p>Generate an arbitrary IPv4 network in textual form.
</p></div></div><div class="top"><p class="src"><a name="v:netmask2NumHosts" class="def">netmask2NumHosts</a> :: Int -&gt; Int<a href="Test/Ganeti/TestCommon.html#netmask2NumHosts" class="link">Source</a></p><div class="doc"><p>Helper function to compute the number of hosts in a network
 given the netmask. (For IPv4 only.)
</p></div></div><div class="top"><p class="src"><a name="v:genIp6Addr" class="def">genIp6Addr</a> :: Gen String<a href="Test/Ganeti/TestCommon.html#genIp6Addr" class="link">Source</a></p><div class="doc"><p>Generates an arbitrary IPv6 network address in textual form.
 The generated address is not simpflified, e. g. an address like
 <a href="2607:f0d0:1002:0051:0000:0000:0000:0004.html">2607:f0d0:1002:0051:0000:0000:0000:0004</a> does not become
 <a href="2607:f0d0:1002:51::4.html">2607:f0d0:1002:51::4</a>
</p></div></div><div class="top"><p class="src"><a name="v:genIp6Net" class="def">genIp6Net</a> :: Gen String<a href="Test/Ganeti/TestCommon.html#genIp6Net" class="link">Source</a></p><div class="doc"><p>Generates an arbitrary IPv6 network in textual form.
</p></div></div><h1 id="g:4">Helper functions
</h1><div class="top"><p class="src"><a name="v:testSerialisation" class="def">testSerialisation</a> :: (Eq a, Show a, JSON a) =&gt; a -&gt; Property<a href="Test/Ganeti/TestCommon.html#testSerialisation" class="link">Source</a></p><div class="doc"><p>Checks for serialisation idempotence.
</p></div></div><div class="top"><p class="src"><a name="v:resultProp" class="def">resultProp</a> :: Show a =&gt; <a href="Ganeti-BasicTypes.html#t:GenericResult">GenericResult</a> a b -&gt; PropertyM IO b<a href="Test/Ganeti/TestCommon.html#resultProp" class="link">Source</a></p><div class="doc"><p>Result to PropertyM IO.
</p></div></div><div class="top"><p class="src"><a name="v:getSourceDir" class="def">getSourceDir</a> :: IO FilePath<a href="Test/Ganeti/TestCommon.html#getSourceDir" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:testDataFilename" class="def">testDataFilename</a> :: String -&gt; String -&gt; IO FilePath<a href="Test/Ganeti/TestCommon.html#testDataFilename" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:readTestData" class="def">readTestData</a> :: String -&gt; IO String<a href="Test/Ganeti/TestCommon.html#readTestData" class="link">Source</a></p><div class="doc"><p>Returns the content of the specified haskell test data file.
</p></div></div><div class="top"><p class="src"><a name="v:genSample" class="def">genSample</a> ::  Gen a -&gt; IO a<a href="Test/Ganeti/TestCommon.html#genSample" class="link">Source</a></p><div class="doc"><p>Generate arbitrary values in the IO monad. This is a simple
 wrapper over <code>sample'</code>.
</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.10.0</p></div></body></html>