<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ganeti.HTools.Repair</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Ganeti-HTools-Repair.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="Ganeti/HTools/Repair.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ganeti</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Infered</td></tr></table><p class="caption">Ganeti.HTools.Repair</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Implementation of the auto-repair logic for Ganeti.
</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span>  <a href="#t:InstanceData">InstanceData</a>  = <a href="#v:InstanceData">InstanceData</a> {<ul class="subs"><li><a href="#v:arInstance">arInstance</a> :: <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a></li><li><a href="#v:arState">arState</a> :: <a href="Ganeti-HTools-Types.html#t:AutoRepairStatus">AutoRepairStatus</a></li><li><a href="#v:tagsToRemove">tagsToRemove</a> :: [String]</li></ul>}</li><li class="src short"><a href="#v:parseInitTag">parseInitTag</a> :: String -&gt; Maybe <a href="Ganeti-HTools-Types.html#t:AutoRepairData">AutoRepairData</a></li><li class="src short"><a href="#v:getArData">getArData</a> :: <a href="Ganeti-HTools-Types.html#t:AutoRepairStatus">AutoRepairStatus</a> -&gt; Maybe <a href="Ganeti-HTools-Types.html#t:AutoRepairData">AutoRepairData</a></li><li class="src short"><a href="#v:arStateName">arStateName</a> :: <a href="Ganeti-HTools-Types.html#t:AutoRepairStatus">AutoRepairStatus</a> -&gt; String</li><li class="src short"><a href="#v:delCurTag">delCurTag</a> :: <a href="Ganeti-HTools-Repair.html#t:InstanceData">InstanceData</a> -&gt; [String]</li><li class="src short"><a href="#v:setInitialState">setInitialState</a> :: <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Repair.html#t:InstanceData">InstanceData</a></li><li class="src short"><a href="#v:arStatusCmp">arStatusCmp</a> :: <a href="Ganeti-HTools-Repair.html#t:InstanceData">InstanceData</a> -&gt; [<a href="Ganeti-HTools-Types.html#t:AutoRepairData">AutoRepairData</a>] -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Repair.html#t:InstanceData">InstanceData</a></li><li class="src short"><a href="#v:updateTag">updateTag</a> :: <a href="Ganeti-HTools-Types.html#t:AutoRepairData">AutoRepairData</a> -&gt; <a href="Ganeti-HTools-Types.html#t:AutoRepairData">AutoRepairData</a></li><li class="src short"><a href="#v:detectBroken">detectBroken</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Maybe (<a href="Ganeti-HTools-Types.html#t:AutoRepairType">AutoRepairType</a>, [<a href="Ganeti-OpCodes.html#t:OpCode">OpCode</a>])</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:InstanceData" class="def">InstanceData</a>  <a href="Ganeti/HTools/Repair.html#InstanceData" class="link">Source</a></p><div class="doc"><p>Description of an instance annotated with repair-related information.
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:InstanceData" class="def">InstanceData</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:arInstance" class="def">arInstance</a> :: <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:arState" class="def">arState</a> :: <a href="Ganeti-HTools-Types.html#t:AutoRepairStatus">AutoRepairStatus</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:tagsToRemove" class="def">tagsToRemove</a> :: [String]</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:InstanceData" class="caption collapser" onclick="toggleSection('i:InstanceData')">Instances</p><div id="section.i:InstanceData" class="show"><table><tr><td class="src">Eq <a href="Ganeti-HTools-Repair.html#t:InstanceData">InstanceData</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Show <a href="Ganeti-HTools-Repair.html#t:InstanceData">InstanceData</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:parseInitTag" class="def">parseInitTag</a> :: String -&gt; Maybe <a href="Ganeti-HTools-Types.html#t:AutoRepairData">AutoRepairData</a><a href="Ganeti/HTools/Repair.html#parseInitTag" class="link">Source</a></p><div class="doc"><p>Parse a tag into an <code><a href="Ganeti-HTools-Types.html#t:AutoRepairData">AutoRepairData</a></code> record.
</p><p><code>Nothing</code> is returned if the tag is not an auto-repair tag, or if it's
 malformed.
</p></div></div><div class="top"><p class="src"><a name="v:getArData" class="def">getArData</a> :: <a href="Ganeti-HTools-Types.html#t:AutoRepairStatus">AutoRepairStatus</a> -&gt; Maybe <a href="Ganeti-HTools-Types.html#t:AutoRepairData">AutoRepairData</a><a href="Ganeti/HTools/Repair.html#getArData" class="link">Source</a></p><div class="doc"><p>Return the <code><a href="Ganeti-HTools-Types.html#t:AutoRepairData">AutoRepairData</a></code> element of an <code><a href="Ganeti-HTools-Types.html#t:AutoRepairStatus">AutoRepairStatus</a></code> type.
</p></div></div><div class="top"><p class="src"><a name="v:arStateName" class="def">arStateName</a> :: <a href="Ganeti-HTools-Types.html#t:AutoRepairStatus">AutoRepairStatus</a> -&gt; String<a href="Ganeti/HTools/Repair.html#arStateName" class="link">Source</a></p><div class="doc"><p>Return a short name for each auto-repair status.
</p><p>This is a more concise representation of the status, because the default
 <a href="Show.html">Show</a> formatting includes all the accompanying auto-repair data.
</p></div></div><div class="top"><p class="src"><a name="v:delCurTag" class="def">delCurTag</a> :: <a href="Ganeti-HTools-Repair.html#t:InstanceData">InstanceData</a> -&gt; [String]<a href="Ganeti/HTools/Repair.html#delCurTag" class="link">Source</a></p><div class="doc"><p>Return a new list of tags to remove that includes <code>arTag</code> if present.
</p></div></div><div class="top"><p class="src"><a name="v:setInitialState" class="def">setInitialState</a> :: <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Repair.html#t:InstanceData">InstanceData</a><a href="Ganeti/HTools/Repair.html#setInitialState" class="link">Source</a></p><div class="doc"><p>Set the initial auto-repair state of an instance from its auto-repair tags.
</p><p>The rules when there are multiple tags is:
</p><ul><li> the earliest failure result always wins
</li><li> two or more pending repairs results in a fatal error
</li><li> a pending result from id X and a success result from id Y result in error
     if Y is newer than X
</li><li> if there are no pending repairs, the newest success result wins,
     otherwise the pending result is used.
</li></ul></div></div><div class="top"><p class="src"><a name="v:arStatusCmp" class="def">arStatusCmp</a> :: <a href="Ganeti-HTools-Repair.html#t:InstanceData">InstanceData</a> -&gt; [<a href="Ganeti-HTools-Types.html#t:AutoRepairData">AutoRepairData</a>] -&gt; <a href="Ganeti-BasicTypes.html#t:Result">Result</a> <a href="Ganeti-HTools-Repair.html#t:InstanceData">InstanceData</a><a href="Ganeti/HTools/Repair.html#arStatusCmp" class="link">Source</a></p><div class="doc"><p>Update the initial status of an instance with new repair task tags.
</p><p>This function gets called once per repair group in an instance's tag, and it
 determines whether to set the status of the instance according to this new
 group, or to keep the existing state. See the documentation for
 <code><a href="Ganeti-HTools-Repair.html#v:setInitialState">setInitialState</a></code> for the rules to be followed when determining this.
</p></div></div><div class="top"><p class="src"><a name="v:updateTag" class="def">updateTag</a> :: <a href="Ganeti-HTools-Types.html#t:AutoRepairData">AutoRepairData</a> -&gt; <a href="Ganeti-HTools-Types.html#t:AutoRepairData">AutoRepairData</a><a href="Ganeti/HTools/Repair.html#updateTag" class="link">Source</a></p><div class="doc"><p>Update the tag of an <code><a href="Ganeti-HTools-Types.html#t:AutoRepairData">AutoRepairData</a></code> record to match all the other fields.
</p></div></div><div class="top"><p class="src"><a name="v:detectBroken" class="def">detectBroken</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Maybe (<a href="Ganeti-HTools-Types.html#t:AutoRepairType">AutoRepairType</a>, [<a href="Ganeti-OpCodes.html#t:OpCode">OpCode</a>])<a href="Ganeti/HTools/Repair.html#detectBroken" class="link">Source</a></p><div class="doc"><p>Detect brokenness with an instance and suggest repair type and jobs to run.
</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.10.0</p></div></body></html>