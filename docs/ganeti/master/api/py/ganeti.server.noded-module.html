<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>ganeti.server.noded</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
</head>

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://code.google.com/p/ganeti/">Ganeti</a></th>
          </tr></table></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        <a href="ganeti-module.html">Package&nbsp;ganeti</a> ::
        <a href="ganeti.server-module.html">Package&nbsp;server</a> ::
        Module&nbsp;noded
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
        <tr><td align="right"><span class="options">[<a href="javascript:void(0);" class="privatelink"
    onclick="toggle_private();">hide&nbsp;private</a>]</span></td></tr>
        <tr><td align="right"><span class="options"
            >[<a href="frames.html" target="_top">frames</a
            >]&nbsp;|&nbsp;<a href="ganeti.server.noded-module.html"
            target="_top">no&nbsp;frames</a>]</span></td></tr>
      </table>
    </td>
  </tr>
</table>
<!-- ==================== MODULE DESCRIPTION ==================== -->
<h1 class="epydoc">Module noded</h1><p class="nomargin-top"><span class="codelink"><a href="ganeti.server.noded-pysrc.html">source&nbsp;code</a></span></p>
<p>Ganeti node daemon</p>

<!-- ==================== CLASSES ==================== -->
<a name="section-Classes"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Classes</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-Classes"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a href="ganeti.server.noded.MlockallRequestExecutor-class.html" class="summary-name">MlockallRequestExecutor</a><br />
      Subclass ensuring request handlers are locked in RAM.
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a href="ganeti.server.noded.NodeRequestHandler-class.html" class="summary-name">NodeRequestHandler</a><br />
      The server implementation.
    </td>
  </tr>
</table>
<!-- ==================== FUNCTIONS ==================== -->
<a name="section-Functions"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Functions</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-Functions"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.server.noded-module.html#_extendReasonTrail" class="summary-sig-name" onclick="show_private();">_extendReasonTrail</a>(<span class="summary-sig-arg">trail</span>,
        <span class="summary-sig-arg">source</span>,
        <span class="summary-sig-arg">reason</span>=<span class="summary-sig-default">&quot;&quot;</span>)</span><br />
      Extend the reason trail with noded information</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.server.noded-pysrc.html#_extendReasonTrail">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.server.noded-module.html#_PrepareQueueLock" class="summary-sig-name" onclick="show_private();">_PrepareQueueLock</a>()</span><br />
      Try to prepare the queue lock.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.server.noded-pysrc.html#_PrepareQueueLock">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="_RequireJobQueueLock"></a><span class="summary-sig-name">_RequireJobQueueLock</span>(<span class="summary-sig-arg">fn</span>)</span><br />
      Decorator for job queue manipulating functions.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.server.noded-pysrc.html#_RequireJobQueueLock">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="_DecodeImportExportIO"></a><span class="summary-sig-name">_DecodeImportExportIO</span>(<span class="summary-sig-arg">ieio</span>,
        <span class="summary-sig-arg">ieioargs</span>)</span><br />
      Decodes import/export I/O information.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.server.noded-pysrc.html#_DecodeImportExportIO">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.server.noded-module.html#_DefaultAlternative" class="summary-sig-name" onclick="show_private();">_DefaultAlternative</a>(<span class="summary-sig-arg">value</span>,
        <span class="summary-sig-arg">default</span>)</span><br />
      Returns value or, if evaluating to False, a default value.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.server.noded-pysrc.html#_DefaultAlternative">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="CheckNoded"></a><span class="summary-sig-name">CheckNoded</span>(<span class="summary-sig-arg">_</span>,
        <span class="summary-sig-arg">args</span>)</span><br />
      Initial checks whether to run or exit with a failure.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.server.noded-pysrc.html#CheckNoded">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.server.noded-module.html#SSLVerifyPeer" class="summary-sig-name">SSLVerifyPeer</a>(<span class="summary-sig-arg">conn</span>,
        <span class="summary-sig-arg">cert</span>,
        <span class="summary-sig-arg">errnum</span>,
        <span class="summary-sig-arg">errdepth</span>,
        <span class="summary-sig-arg">ok</span>)</span><br />
      Callback function to verify a peer against the candidate cert map.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.server.noded-pysrc.html#SSLVerifyPeer">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="PrepNoded"></a><span class="summary-sig-name">PrepNoded</span>(<span class="summary-sig-arg">options</span>,
        <span class="summary-sig-arg">_</span>)</span><br />
      Preparation node daemon function, executed with the PID file held.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.server.noded-pysrc.html#PrepNoded">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="ExecNoded"></a><span class="summary-sig-name">ExecNoded</span>(<span class="summary-sig-arg">options</span>,
        <span class="summary-sig-arg">args</span>,
        <span class="summary-sig-arg">prep_data</span>)</span><br />
      Main node daemon function, executed with the PID file held.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.server.noded-pysrc.html#ExecNoded">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="Main"></a><span class="summary-sig-name">Main</span>()</span><br />
      Main function for the node daemon.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.server.noded-pysrc.html#Main">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
</table>
<!-- ==================== VARIABLES ==================== -->
<a name="section-Variables"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Variables</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-Variables"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a name="queue_lock"></a><span class="summary-name">queue_lock</span> = <code title="None">None</code><br />
      hash(x)
    </td>
  </tr>
</table>
<p class="indent-wrapped-lines"><b>Imports:</b>
  <span title="os">os</span>,
  <span title="sys">sys</span>,
  <span title="logging">logging</span>,
  <span title="signal">signal</span>,
  <span title="codecs">codecs</span>,
  <span title="optparse.OptionParser">OptionParser</span>,
  <a href="ganeti.backend-module.html" title="ganeti.backend">backend</a>,
  <a href="ganeti.constants-module.html" title="ganeti.constants">constants</a>,
  <a href="ganeti.objects-module.html" title="ganeti.objects">objects</a>,
  <a href="ganeti.errors-module.html" title="ganeti.errors">errors</a>,
  <a href="ganeti.jstore-module.html" title="ganeti.jstore">jstore</a>,
  <a href="ganeti.daemon-module.html" title="ganeti.daemon">daemon</a>,
  <a href="ganeti.http-module.html" title="ganeti.http">http</a>,
  <a href="ganeti.utils-module.html" title="ganeti.utils">utils</a>,
  <a href="ganeti.storage.container-module.html" title="ganeti.storage.container">container</a>,
  <a href="ganeti.serializer-module.html" title="ganeti.serializer">serializer</a>,
  <a href="ganeti.netutils-module.html" title="ganeti.netutils">netutils</a>,
  <a href="ganeti.pathutils-module.html" title="ganeti.pathutils">pathutils</a>,
  <a href="ganeti.ssconf-module.html" title="ganeti.ssconf">ssconf</a>,
  <a href="ganeti-module.html" title="ganeti">ganeti</a>
</p><br />
<!-- ==================== FUNCTION DETAILS ==================== -->
<a name="section-FunctionDetails"></a>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Function Details</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-FunctionDetails"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
</table>
<a name="_extendReasonTrail"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_extendReasonTrail</span>(<span class="sig-arg">trail</span>,
        <span class="sig-arg">source</span>,
        <span class="sig-arg">reason</span>=<span class="sig-default">&quot;&quot;</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.server.noded-pysrc.html#_extendReasonTrail">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Extend the reason trail with noded information</p>
  <p>The trail is extended by appending the name of the noded 
  functionality</p>
  <dl class="fields">
  </dl>
</td></tr></table>
</div>
<a name="_PrepareQueueLock"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_PrepareQueueLock</span>()</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.server.noded-pysrc.html#_PrepareQueueLock">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Try to prepare the queue lock.</p>
  <dl class="fields">
    <dt>Returns:</dt>
        <dd>None for success, otherwise an exception object</dd>
  </dl>
</td></tr></table>
</div>
<a name="_DefaultAlternative"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_DefaultAlternative</span>(<span class="sig-arg">value</span>,
        <span class="sig-arg">default</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.server.noded-pysrc.html#_DefaultAlternative">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Returns value or, if evaluating to False, a default value.</p>
  <p>Returns the given value, unless it evaluates to False. In the latter 
  case the default value is returned.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>value</code></strong> - Value to return if it doesn't evaluate to False</li>
        <li><strong class="pname"><code>default</code></strong> - Default value</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>Given value or the default</dd>
  </dl>
</td></tr></table>
</div>
<a name="SSLVerifyPeer"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">SSLVerifyPeer</span>(<span class="sig-arg">conn</span>,
        <span class="sig-arg">cert</span>,
        <span class="sig-arg">errnum</span>,
        <span class="sig-arg">errdepth</span>,
        <span class="sig-arg">ok</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.server.noded-pysrc.html#SSLVerifyPeer">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Callback function to verify a peer against the candidate cert map.</p>
  <p>Note that we have a chicken-and-egg problem during cluster init and 
  upgrade. This method checks whether the incoming connection comes from a 
  master candidate by comparing it to the master certificate map in the 
  cluster configuration. However, during cluster init and cluster upgrade 
  there are various RPC calls done to the master node itself, before the 
  candidate certificate list is established and the cluster configuration 
  is written. In this case, we cannot check against the master candidate 
  map.</p>
  <p>This problem is solved by checking whether the candidate map is empty.
  An initialized 2.11 or higher cluster has at least one entry for the 
  master node in the candidate map. If the map is empty, we know that we 
  are still in the bootstrap/upgrade phase. In this case, we read the 
  server certificate digest and compare it to the incoming request.</p>
  <p>This means that after an upgrade of Ganeti, the system continues to 
  operate like before, using server certificates only. After the client 
  certificates are generated with ``gnt-cluster renew-crypto 
  --new-node-certificates``, RPC communication is switched to using client 
  certificates and the trick of using server certificates does not work 
  anymore.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>conn</code></strong> (<code>OpenSSL.SSL.Connection</code>) - the OpenSSL connection object</li>
        <li><strong class="pname"><code>cert</code></strong> (<code>OpenSSL.X509</code>) - the peer's SSL certificate</li>
        <li><strong class="pname"><code>errdepth</code></strong> (integer) - number of the step in the certificate chain starting at 0 for the
          actual client certificate.</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<br />
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://code.google.com/p/ganeti/">Ganeti</a></th>
          </tr></table></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">
    Generated by Epydoc 3.0.1 on Fri Mar 11 11:23:31 2016
    </td>
    <td align="right" class="footer">
      <a target="mainFrame" href="http://epydoc.sourceforge.net"
        >http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie();
  // -->
</script>
</body>
</html>
