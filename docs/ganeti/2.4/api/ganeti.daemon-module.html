<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>ganeti.daemon</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
</head>

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://code.google.com/p/ganeti/">Ganeti</a></th>
          </tr></table></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        <a href="ganeti-module.html">Package&nbsp;ganeti</a> ::
        Module&nbsp;daemon
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
        <tr><td align="right"><span class="options">[<a href="javascript:void(0);" class="privatelink"
    onclick="toggle_private();">hide&nbsp;private</a>]</span></td></tr>
        <tr><td align="right"><span class="options"
            >[<a href="frames.html" target="_top">frames</a
            >]&nbsp;|&nbsp;<a href="ganeti.daemon-module.html"
            target="_top">no&nbsp;frames</a>]</span></td></tr>
      </table>
    </td>
  </tr>
</table>
<!-- ==================== MODULE DESCRIPTION ==================== -->
<h1 class="epydoc">Module daemon</h1><p class="nomargin-top"><span class="codelink"><a href="ganeti.daemon-pysrc.html">source&nbsp;code</a></span></p>
<p>Module with helper classes and functions for daemons</p>

<!-- ==================== CLASSES ==================== -->
<a name="section-Classes"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Classes</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-Classes"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a href="ganeti.daemon.SchedulerBreakout-class.html" class="summary-name">SchedulerBreakout</a><br />
      Exception used to get out of the scheduler loop
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a href="ganeti.daemon.AsyncoreScheduler-class.html" class="summary-name">AsyncoreScheduler</a><br />
      Event scheduler integrated with asyncore
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a href="ganeti.daemon.GanetiBaseAsyncoreDispatcher-class.html" class="summary-name">GanetiBaseAsyncoreDispatcher</a><br />
      Base Ganeti Asyncore Dispacher
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a href="ganeti.daemon.AsyncStreamServer-class.html" class="summary-name">AsyncStreamServer</a><br />
      A stream server to use with asyncore.
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a href="ganeti.daemon.AsyncTerminatedMessageStream-class.html" class="summary-name">AsyncTerminatedMessageStream</a><br />
      A terminator separated message stream asyncore module.
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a href="ganeti.daemon.AsyncUDPSocket-class.html" class="summary-name">AsyncUDPSocket</a><br />
      An improved asyncore udp socket.
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a href="ganeti.daemon.AsyncAwaker-class.html" class="summary-name">AsyncAwaker</a><br />
      A way to notify the asyncore loop that something is going on.
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a href="ganeti.daemon.Mainloop-class.html" class="summary-name">Mainloop</a><br />
      Generic mainloop for daemons
    </td>
  </tr>
</table>
<!-- ==================== FUNCTIONS ==================== -->
<a name="section-Functions"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Functions</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-Functions"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.daemon-module.html#AsyncoreDelayFunction" class="summary-sig-name">AsyncoreDelayFunction</a>(<span class="summary-sig-arg">timeout</span>)</span><br />
      Asyncore-compatible scheduler delay function.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.daemon-pysrc.html#AsyncoreDelayFunction">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.daemon-module.html#_VerifyDaemonUser" class="summary-sig-name" onclick="show_private();">_VerifyDaemonUser</a>(<span class="summary-sig-arg">daemon_name</span>)</span><br />
      Verifies the process uid matches the configured uid.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.daemon-pysrc.html#_VerifyDaemonUser">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">string</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.daemon-module.html#_BeautifyError" class="summary-sig-name" onclick="show_private();">_BeautifyError</a>(<span class="summary-sig-arg">err</span>)</span><br />
      Try to format an error better.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.daemon-pysrc.html#_BeautifyError">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.daemon-module.html#_HandleSigHup" class="summary-sig-name" onclick="show_private();">_HandleSigHup</a>(<span class="summary-sig-arg">reopen_fn</span>,
        <span class="summary-sig-arg">signum</span>,
        <span class="summary-sig-arg">frame</span>)</span><br />
      Handler for SIGHUP.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.daemon-pysrc.html#_HandleSigHup">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.daemon-module.html#GenericMain" class="summary-sig-name">GenericMain</a>(<span class="summary-sig-arg">daemon_name</span>,
        <span class="summary-sig-arg">optionparser</span>,
        <span class="summary-sig-arg">check_fn</span>,
        <span class="summary-sig-arg">prepare_fn</span>,
        <span class="summary-sig-arg">exec_fn</span>,
        <span class="summary-sig-arg">multithreaded</span>=<span class="summary-sig-default">False</span>,
        <span class="summary-sig-arg">console_logging</span>=<span class="summary-sig-default">False</span>,
        <span class="summary-sig-arg">default_ssl_cert</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">default_ssl_key</span>=<span class="summary-sig-default">None</span>)</span><br />
      Shared main function for daemons.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.daemon-pysrc.html#GenericMain">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
</table>
<p class="indent-wrapped-lines"><b>Imports:</b>
  <span title="asyncore">asyncore</span>,
  <span title="asynchat">asynchat</span>,
  <span title="collections">collections</span>,
  <span title="os">os</span>,
  <span title="signal">signal</span>,
  <span title="logging">logging</span>,
  <span title="sched">sched</span>,
  <span title="time">time</span>,
  <span title="socket">socket</span>,
  <span title="select">select</span>,
  <span title="sys">sys</span>,
  <a href="ganeti.utils-module.html" title="ganeti.utils">utils</a>,
  <a href="ganeti.constants-module.html" title="ganeti.constants">constants</a>,
  <a href="ganeti.errors-module.html" title="ganeti.errors">errors</a>,
  <a href="ganeti.netutils-module.html" title="ganeti.netutils">netutils</a>,
  <a href="ganeti.ssconf-module.html" title="ganeti.ssconf">ssconf</a>,
  <a href="ganeti.runtime-module.html" title="ganeti.runtime">runtime</a>,
  <a href="ganeti.compat-module.html" title="ganeti.compat">compat</a>
</p><br />
<!-- ==================== FUNCTION DETAILS ==================== -->
<a name="section-FunctionDetails"></a>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Function Details</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-FunctionDetails"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
</table>
<a name="AsyncoreDelayFunction"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">AsyncoreDelayFunction</span>(<span class="sig-arg">timeout</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.daemon-pysrc.html#AsyncoreDelayFunction">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Asyncore-compatible scheduler delay function.</p>
  <p>This is a delay function for sched that, rather than actually 
  sleeping, executes asyncore events happening in the meantime.</p>
  <p>After an event has occurred, rather than returning, it raises a 
  SchedulerBreakout exception, which will force the current scheduler.run()
  invocation to terminate, so that we can also check for signals. The main 
  loop will then call the scheduler run again, which will allow it to 
  actually process any due events.</p>
  <p>This is needed because scheduler.run() doesn't support a count=..., as
  asyncore loop, and the scheduler module documents throwing exceptions 
  from inside the delay function as an allowed usage model.</p>
  <dl class="fields">
  </dl>
</td></tr></table>
</div>
<a name="_VerifyDaemonUser"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_VerifyDaemonUser</span>(<span class="sig-arg">daemon_name</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.daemon-pysrc.html#_VerifyDaemonUser">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Verifies the process uid matches the configured uid.</p>
  <p>This method verifies that a daemon is started as the user it is 
  intended to be run</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>daemon_name</code></strong> - The name of daemon to be started</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>A tuple with the first item indicating success or not, the second
          item current uid and third with expected uid</dd>
  </dl>
</td></tr></table>
</div>
<a name="_BeautifyError"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_BeautifyError</span>(<span class="sig-arg">err</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.daemon-pysrc.html#_BeautifyError">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Try to format an error better.</p>
  <p>Since we're dealing with daemon startup errors, in many cases this 
  will be due to socket error and such, so we try to format these cases 
  better.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>err</code></strong> - an exception object</li>
    </ul></dd>
    <dt>Returns: string</dt>
        <dd>the formatted error description</dd>
  </dl>
</td></tr></table>
</div>
<a name="_HandleSigHup"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_HandleSigHup</span>(<span class="sig-arg">reopen_fn</span>,
        <span class="sig-arg">signum</span>,
        <span class="sig-arg">frame</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.daemon-pysrc.html#_HandleSigHup">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Handler for SIGHUP.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>reopen_fn</code></strong> - List of callback functions for reopening log files</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="GenericMain"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">GenericMain</span>(<span class="sig-arg">daemon_name</span>,
        <span class="sig-arg">optionparser</span>,
        <span class="sig-arg">check_fn</span>,
        <span class="sig-arg">prepare_fn</span>,
        <span class="sig-arg">exec_fn</span>,
        <span class="sig-arg">multithreaded</span>=<span class="sig-default">False</span>,
        <span class="sig-arg">console_logging</span>=<span class="sig-default">False</span>,
        <span class="sig-arg">default_ssl_cert</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">default_ssl_key</span>=<span class="sig-default">None</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.daemon-pysrc.html#GenericMain">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Shared main function for daemons.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>daemon_name</code></strong> (string) - daemon name</li>
        <li><strong class="pname"><code>optionparser</code></strong> (optparse.OptionParser) - initialized optionparser with daemon-specific options (common -f 
          -d options will be handled by this module)</li>
        <li><strong class="pname"><code>check_fn</code></strong> (function which accepts (options, args)) - function that checks start conditions and exits if they're not 
          met</li>
        <li><strong class="pname"><code>prepare_fn</code></strong> (function which accepts (options, args)) - function that is run before forking, or None; it's result will be
          passed as the third parameter to exec_fn, or if None was passed 
          in, we will just pass None to exec_fn</li>
        <li><strong class="pname"><code>exec_fn</code></strong> (function which accepts (options, args, prepare_results)) - function that's executed with the daemon's pid file held, and 
          runs the daemon itself.</li>
        <li><strong class="pname"><code>multithreaded</code></strong> (bool) - Whether the daemon uses threads</li>
        <li><strong class="pname"><code>console_logging</code></strong> (boolean) - if True, the daemon will fall back to the system console if 
          logging fails</li>
        <li><strong class="pname"><code>default_ssl_cert</code></strong> (string) - Default SSL certificate path</li>
        <li><strong class="pname"><code>default_ssl_key</code></strong> (string) - Default SSL key path</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<br />
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://code.google.com/p/ganeti/">Ganeti</a></th>
          </tr></table></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">
    Generated by Epydoc 3.0.1 on Thu Oct 27 14:18:49 2011
    </td>
    <td align="right" class="footer">
      <a target="mainFrame" href="http://epydoc.sourceforge.net"
        >http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie();
  // -->
</script>
</body>
</html>
