<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ganeti.Locking.Allocation</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Ganeti-Locking-Allocation.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="Ganeti/Locking/Allocation.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ganeti</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Infered</td></tr></table><p class="caption">Ganeti.Locking.Allocation</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Implementation of lock allocation.
</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span>  <a href="#t:OwnerState">OwnerState</a> <ul class="subs"><li>= <a href="#v:OwnShared">OwnShared</a>  </li><li>| <a href="#v:OwnExclusive">OwnExclusive</a>  </li></ul></li><li class="src short"><span class="keyword">type</span> <a href="#t:IndirectOwners">IndirectOwners</a> a b = Map (a, b) <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a></li><li class="src short"><span class="keyword">data</span>  <a href="#t:AllocationState">AllocationState</a> a b<ul class="subs"><li>= <a href="#v:Exclusive">Exclusive</a> b (<a href="Ganeti-Locking-Allocation.html#t:IndirectOwners">IndirectOwners</a> a b)  </li><li>| <a href="#v:Shared">Shared</a> (Set b) (<a href="Ganeti-Locking-Allocation.html#t:IndirectOwners">IndirectOwners</a> a b)  </li></ul></li><li class="src short"><a href="#v:indirectOwners">indirectOwners</a> :: (Ord a, Ord b) =&gt; Map (a, b) <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a> -&gt; Set b</li><li class="src short"><a href="#v:indirectExclusives">indirectExclusives</a> :: (Ord a, Ord b) =&gt; Map (a, b) <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a> -&gt; Set b</li><li class="src short"><span class="keyword">data</span>  <a href="#t:LockAllocation">LockAllocation</a> a b = <a href="#v:LockAllocation">LockAllocation</a> {<ul class="subs"><li><a href="#v:laLocks">laLocks</a> :: Map a (<a href="Ganeti-Locking-Allocation.html#t:AllocationState">AllocationState</a> a b)</li><li><a href="#v:laOwned">laOwned</a> :: Map b (Map a <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)</li></ul>}</li><li class="src short"><a href="#v:emptyAllocation">emptyAllocation</a> :: (Ord a, Ord b) =&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b</li><li class="src short"><a href="#v:lockOwners">lockOwners</a> :: Ord b =&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; [b]</li><li class="src short"><a href="#v:listLocks">listLocks</a> :: Ord b =&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; Map a <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a></li><li class="src short"><a href="#v:listAllLocks">listAllLocks</a> :: Ord b =&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; [a]</li><li class="src short"><a href="#v:toOwnersList">toOwnersList</a> ::  <a href="Ganeti-Locking-Allocation.html#t:AllocationState">AllocationState</a> a b -&gt; [(b, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)]</li><li class="src short"><a href="#v:listAllLocksOwners">listAllLocksOwners</a> ::  <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; [(a, [(b, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)])]</li><li class="src short"><a href="#v:holdsLock">holdsLock</a> :: (Ord a, Ord b) =&gt; b -&gt; a -&gt; <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a> -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; Bool</li><li class="src short"><span class="keyword">data</span>  <a href="#t:LockRequest">LockRequest</a> a = <a href="#v:LockRequest">LockRequest</a> {<ul class="subs"><li><a href="#v:lockAffected">lockAffected</a> :: a</li><li><a href="#v:lockRequestType">lockRequestType</a> :: Maybe <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a></li></ul>}</li><li class="src short"><a href="#v:requestExclusive">requestExclusive</a> ::  a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a</li><li class="src short"><a href="#v:requestShared">requestShared</a> ::  a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a</li><li class="src short"><a href="#v:requestRelease">requestRelease</a> ::  a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a</li><li class="src short"><a href="#v:updateAllocState">updateAllocState</a> :: (Ord a, Ord b) =&gt; (Maybe (<a href="Ganeti-Locking-Allocation.html#t:AllocationState">AllocationState</a> a b) -&gt; <a href="Ganeti-Locking-Allocation.html#t:AllocationState">AllocationState</a> a b) -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b</li><li class="src short"><a href="#v:updateLock">updateLock</a> :: (Ord a, Ord b) =&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b</li><li class="src short"><a href="#v:updateIndirectSet">updateIndirectSet</a> :: (Ord a, Ord b) =&gt; (<a href="Ganeti-Locking-Allocation.html#t:IndirectOwners">IndirectOwners</a> a b -&gt; <a href="Ganeti-Locking-Allocation.html#t:IndirectOwners">IndirectOwners</a> a b) -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b</li><li class="src short"><a href="#v:updateIndirects">updateIndirects</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b) =&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b</li><li class="src short"><a href="#v:updateLocks">updateLocks</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b) =&gt; b -&gt; [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a] -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b, <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (Set b))</li><li class="src short"><a href="#v:manipulateLocksPredicate">manipulateLocksPredicate</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b) =&gt; (a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a) -&gt; (a -&gt; Bool) -&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b</li><li class="src short"><a href="#v:freeLocksPredicate">freeLocksPredicate</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b) =&gt; (a -&gt; Bool) -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b</li><li class="src short"><a href="#v:freeLocks">freeLocks</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b) =&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b</li><li class="src short"><a href="#v:readLockOwnerstate">readLockOwnerstate</a> :: JSON a =&gt; JSValue -&gt; Result (a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)</li><li class="src short"><a href="#v:readOwnerLock">readOwnerLock</a> :: (JSON a, JSON b) =&gt; JSValue -&gt; Result (b, [(a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)])</li><li class="src short"><a href="#v:toRequest">toRequest</a> ::  (a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>) -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a</li><li class="src short"><a href="#v:allocationFromOwners">allocationFromOwners</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Show b) =&gt; [(b, [(a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)])] -&gt; Result (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b)</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:OwnerState" class="def">OwnerState</a>  <a href="Ganeti/Locking/Allocation.html#OwnerState" class="link">Source</a></p><div class="doc"><p>Data type describing the way a lock can be owned.
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:OwnShared" class="def">OwnShared</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:OwnExclusive" class="def">OwnExclusive</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:OwnerState" class="caption collapser" onclick="toggleSection('i:OwnerState')">Instances</p><div id="section.i:OwnerState" class="show"><table><tr><td class="src">Eq <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Ord <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Show <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">JSON <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a></td><td class="doc"><p>Serializaiton of Lock Allocations
</p><p>To serialize a lock allocation, we only remember which owner holds
which locks at which level (shared or exclusive). From this information,
everything else can be reconstructed, simply using updateLocks.
</p></td></tr><tr><td class="src">Arbitrary <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:IndirectOwners" class="def">IndirectOwners</a> a b = Map (a, b) <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a><a href="Ganeti/Locking/Allocation.html#IndirectOwners" class="link">Source</a></p></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:AllocationState" class="def">AllocationState</a> a b <a href="Ganeti/Locking/Allocation.html#AllocationState" class="link">Source</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Exclusive" class="def">Exclusive</a> b (<a href="Ganeti-Locking-Allocation.html#t:IndirectOwners">IndirectOwners</a> a b)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:Shared" class="def">Shared</a> (Set b) (<a href="Ganeti-Locking-Allocation.html#t:IndirectOwners">IndirectOwners</a> a b)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:AllocationState" class="caption collapser" onclick="toggleSection('i:AllocationState')">Instances</p><div id="section.i:AllocationState" class="show"><table><tr><td class="src">(Eq a, Eq b) =&gt; Eq (<a href="Ganeti-Locking-Allocation.html#t:AllocationState">AllocationState</a> a b)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(Show a, Show b) =&gt; Show (<a href="Ganeti-Locking-Allocation.html#t:AllocationState">AllocationState</a> a b)</td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:indirectOwners" class="def">indirectOwners</a> :: (Ord a, Ord b) =&gt; Map (a, b) <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a> -&gt; Set b<a href="Ganeti/Locking/Allocation.html#indirectOwners" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:indirectExclusives" class="def">indirectExclusives</a> :: (Ord a, Ord b) =&gt; Map (a, b) <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a> -&gt; Set b<a href="Ganeti/Locking/Allocation.html#indirectExclusives" class="link">Source</a></p></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:LockAllocation" class="def">LockAllocation</a> a b <a href="Ganeti/Locking/Allocation.html#LockAllocation" class="link">Source</a></p><div class="doc"><p>Representation of a Lock allocation
</p><p>To keep queries for locks efficient, we keep two
associations, with the invariant that they fit
together: the association from locks to their
allocation state, and the association from an
owner to the set of locks owned. As we do not
export the constructor, the problem of keeping
this invariant reduces to only exporting functions
that keep the invariant.
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:LockAllocation" class="def">LockAllocation</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:laLocks" class="def">laLocks</a> :: Map a (<a href="Ganeti-Locking-Allocation.html#t:AllocationState">AllocationState</a> a b)</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:laOwned" class="def">laOwned</a> :: Map b (Map a <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:LockAllocation" class="caption collapser" onclick="toggleSection('i:LockAllocation')">Instances</p><div id="section.i:LockAllocation" class="show"><table><tr><td class="src">(Eq a, Eq b) =&gt; Eq (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(Show a, Show b) =&gt; Show (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, JSON a, Ord b, JSON b, Show b) =&gt; JSON (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(Arbitrary a, <a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Arbitrary b, Ord b, Show b) =&gt; Arbitrary (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b)</td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:emptyAllocation" class="def">emptyAllocation</a> :: (Ord a, Ord b) =&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b<a href="Ganeti/Locking/Allocation.html#emptyAllocation" class="link">Source</a></p><div class="doc"><p>A state with all locks being free.
</p></div></div><div class="top"><p class="src"><a name="v:lockOwners" class="def">lockOwners</a> :: Ord b =&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; [b]<a href="Ganeti/Locking/Allocation.html#lockOwners" class="link">Source</a></p><div class="doc"><p>Obtain the list of all owners holding at least a single lock.
</p></div></div><div class="top"><p class="src"><a name="v:listLocks" class="def">listLocks</a> :: Ord b =&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; Map a <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a><a href="Ganeti/Locking/Allocation.html#listLocks" class="link">Source</a></p><div class="doc"><p>Obtain the locks held by a given owner. The locks are reported
 as a map from the owned locks to the form of ownership (OwnShared
 or OwnExclusive).
</p></div></div><div class="top"><p class="src"><a name="v:listAllLocks" class="def">listAllLocks</a> :: Ord b =&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; [a]<a href="Ganeti/Locking/Allocation.html#listAllLocks" class="link">Source</a></p><div class="doc"><p>List all locks currently (directly or indirectly) owned by someone.
</p></div></div><div class="top"><p class="src"><a name="v:toOwnersList" class="def">toOwnersList</a> ::  <a href="Ganeti-Locking-Allocation.html#t:AllocationState">AllocationState</a> a b -&gt; [(b, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)]<a href="Ganeti/Locking/Allocation.html#toOwnersList" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:listAllLocksOwners" class="def">listAllLocksOwners</a> ::  <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; [(a, [(b, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)])]<a href="Ganeti/Locking/Allocation.html#listAllLocksOwners" class="link">Source</a></p><div class="doc"><p>List all locks currently (directly of indirectly) in use together
 with the direct owners.
</p></div></div><div class="top"><p class="src"><a name="v:holdsLock" class="def">holdsLock</a> :: (Ord a, Ord b) =&gt; b -&gt; a -&gt; <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a> -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; Bool<a href="Ganeti/Locking/Allocation.html#holdsLock" class="link">Source</a></p><div class="doc"><p>Returns <code>True</code> if the given owner holds the given lock at the given
 ownership level or higher. This means that querying for a shared lock
 returns <code>True</code> of the owner holds the lock in shared or exlusive mode.
</p></div></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:LockRequest" class="def">LockRequest</a> a <a href="Ganeti/Locking/Allocation.html#LockRequest" class="link">Source</a></p><div class="doc"><p>Data Type describing a change request on a single lock.
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:LockRequest" class="def">LockRequest</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:lockAffected" class="def">lockAffected</a> :: a</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:lockRequestType" class="def">lockRequestType</a> :: Maybe <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a></dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:LockRequest" class="caption collapser" onclick="toggleSection('i:LockRequest')">Instances</p><div id="section.i:LockRequest" class="show"><table><tr><td class="src">Eq a =&gt; Eq (<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Ord a =&gt; Ord (<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Show a =&gt; Show (<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">JSON a =&gt; JSON (<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Arbitrary a =&gt; Arbitrary (<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a)</td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:requestExclusive" class="def">requestExclusive</a> ::  a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a<a href="Ganeti/Locking/Allocation.html#requestExclusive" class="link">Source</a></p><div class="doc"><p>Lock request for an exclusive lock.
</p></div></div><div class="top"><p class="src"><a name="v:requestShared" class="def">requestShared</a> ::  a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a<a href="Ganeti/Locking/Allocation.html#requestShared" class="link">Source</a></p><div class="doc"><p>Lock request for a shared lock.
</p></div></div><div class="top"><p class="src"><a name="v:requestRelease" class="def">requestRelease</a> ::  a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a<a href="Ganeti/Locking/Allocation.html#requestRelease" class="link">Source</a></p><div class="doc"><p>Request to release a lock.
</p></div></div><div class="top"><p class="src"><a name="v:updateAllocState" class="def">updateAllocState</a> :: (Ord a, Ord b) =&gt; (Maybe (<a href="Ganeti-Locking-Allocation.html#t:AllocationState">AllocationState</a> a b) -&gt; <a href="Ganeti-Locking-Allocation.html#t:AllocationState">AllocationState</a> a b) -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b<a href="Ganeti/Locking/Allocation.html#updateAllocState" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:updateLock" class="def">updateLock</a> :: (Ord a, Ord b) =&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b<a href="Ganeti/Locking/Allocation.html#updateLock" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:updateIndirectSet" class="def">updateIndirectSet</a> :: (Ord a, Ord b) =&gt; (<a href="Ganeti-Locking-Allocation.html#t:IndirectOwners">IndirectOwners</a> a b -&gt; <a href="Ganeti-Locking-Allocation.html#t:IndirectOwners">IndirectOwners</a> a b) -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b<a href="Ganeti/Locking/Allocation.html#updateIndirectSet" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:updateIndirects" class="def">updateIndirects</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b) =&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b<a href="Ganeti/Locking/Allocation.html#updateIndirects" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:updateLocks" class="def">updateLocks</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b) =&gt; b -&gt; [<a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a] -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b, <a href="Ganeti-BasicTypes.html#t:Result">Result</a> (Set b))<a href="Ganeti/Locking/Allocation.html#updateLocks" class="link">Source</a></p><div class="doc"><p>Update the locks of an owner according to the given request. Return
 the pair of the new state and the result of the operation, which is the
 the set of owners on which the operation was blocked on. so an empty set is
 success, and the state is updated if, and only if, the returned set is emtpy.
 In that way, it can be used in atomicModifyIORef.
</p></div></div><div class="top"><p class="src"><a name="v:manipulateLocksPredicate" class="def">manipulateLocksPredicate</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b) =&gt; (a -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a) -&gt; (a -&gt; Bool) -&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b<a href="Ganeti/Locking/Allocation.html#manipulateLocksPredicate" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:freeLocksPredicate" class="def">freeLocksPredicate</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b) =&gt; (a -&gt; Bool) -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b<a href="Ganeti/Locking/Allocation.html#freeLocksPredicate" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:freeLocks" class="def">freeLocks</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b) =&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b -&gt; b -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b<a href="Ganeti/Locking/Allocation.html#freeLocks" class="link">Source</a></p><div class="doc"><p>Compute the state after an onwer releases all its locks.
</p></div></div><div class="top"><p class="src"><a name="v:readLockOwnerstate" class="def">readLockOwnerstate</a> :: JSON a =&gt; JSValue -&gt; Result (a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)<a href="Ganeti/Locking/Allocation.html#readLockOwnerstate" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:readOwnerLock" class="def">readOwnerLock</a> :: (JSON a, JSON b) =&gt; JSValue -&gt; Result (b, [(a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)])<a href="Ganeti/Locking/Allocation.html#readOwnerLock" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:toRequest" class="def">toRequest</a> ::  (a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>) -&gt; <a href="Ganeti-Locking-Allocation.html#t:LockRequest">LockRequest</a> a<a href="Ganeti/Locking/Allocation.html#toRequest" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:allocationFromOwners" class="def">allocationFromOwners</a> :: (<a href="Ganeti-Locking-Types.html#t:Lock">Lock</a> a, Ord b, Show b) =&gt; [(b, [(a, <a href="Ganeti-Locking-Allocation.html#t:OwnerState">OwnerState</a>)])] -&gt; Result (<a href="Ganeti-Locking-Allocation.html#t:LockAllocation">LockAllocation</a> a b)<a href="Ganeti/Locking/Allocation.html#allocationFromOwners" class="link">Source</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.10.0</p></div></body></html>