<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ganeti.HTools.Node</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Ganeti-HTools-Node.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="Ganeti/HTools/Node.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ganeti</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Infered</td></tr></table><p class="caption">Ganeti.HTools.Node</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Type declarations
</a></li><li><a href="#g:2">Helper functions
</a></li><li><a href="#g:3">Initialization functions
</a></li><li><a href="#g:4">Diagnostic functions
</a></li><li><a href="#g:5">Update functions
</a></li><li><a href="#g:6">Stats functions
</a></li><li><a href="#g:7">Node graph functions
</a></li><li><a href="#g:8">Making of a Graph from a node/instance list
</a></li><li><a href="#g:9">Display functions
</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Module describing a node.
</p><p>All updates are functional (copy-based) and return a new node with
    updated value.
</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">type</span> <a href="#t:TagMap">TagMap</a> = Map String Int</li><li class="src short"><span class="keyword">data</span>  <a href="#t:Node">Node</a>  = <a href="#v:Node">Node</a> {<ul class="subs"><li><a href="#v:name">name</a> :: String</li><li><a href="#v:alias">alias</a> :: String</li><li><a href="#v:tMem">tMem</a> :: Double</li><li><a href="#v:nMem">nMem</a> :: Int</li><li><a href="#v:fMem">fMem</a> :: Int</li><li><a href="#v:fMemForth">fMemForth</a> :: Int</li><li><a href="#v:xMem">xMem</a> :: Int</li><li><a href="#v:tDsk">tDsk</a> :: Double</li><li><a href="#v:fDsk">fDsk</a> :: Int</li><li><a href="#v:fDskForth">fDskForth</a> :: Int</li><li><a href="#v:tCpu">tCpu</a> :: Double</li><li><a href="#v:tCpuSpeed">tCpuSpeed</a> :: Double</li><li><a href="#v:nCpu">nCpu</a> :: Int</li><li><a href="#v:uCpu">uCpu</a> :: Int</li><li><a href="#v:uCpuForth">uCpuForth</a> :: Int</li><li><a href="#v:tSpindles">tSpindles</a> :: Int</li><li><a href="#v:fSpindles">fSpindles</a> :: Int</li><li><a href="#v:fSpindlesForth">fSpindlesForth</a> :: Int</li><li><a href="#v:pList">pList</a> :: [<a href="Ganeti-HTools-Types.html#t:Idx">Idx</a>]</li><li><a href="#v:pListForth">pListForth</a> :: [<a href="Ganeti-HTools-Types.html#t:Idx">Idx</a>]</li><li><a href="#v:sList">sList</a> :: [<a href="Ganeti-HTools-Types.html#t:Idx">Idx</a>]</li><li><a href="#v:sListForth">sListForth</a> :: [<a href="Ganeti-HTools-Types.html#t:Idx">Idx</a>]</li><li><a href="#v:idx">idx</a> :: <a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a></li><li><a href="#v:peers">peers</a> :: <a href="Ganeti-HTools-PeerMap.html#t:PeerMap">PeerMap</a></li><li><a href="#v:failN1">failN1</a> :: Bool</li><li><a href="#v:failN1Forth">failN1Forth</a> :: Bool</li><li><a href="#v:rMem">rMem</a> :: Int</li><li><a href="#v:rMemForth">rMemForth</a> :: Int</li><li><a href="#v:pMem">pMem</a> :: Double</li><li><a href="#v:pMemForth">pMemForth</a> :: Double</li><li><a href="#v:pDsk">pDsk</a> :: Double</li><li><a href="#v:pDskForth">pDskForth</a> :: Double</li><li><a href="#v:pRem">pRem</a> :: Double</li><li><a href="#v:pRemForth">pRemForth</a> :: Double</li><li><a href="#v:pCpu">pCpu</a> :: Double</li><li><a href="#v:pCpuForth">pCpuForth</a> :: Double</li><li><a href="#v:mDsk">mDsk</a> :: Double</li><li><a href="#v:loDsk">loDsk</a> :: Int</li><li><a href="#v:hiCpu">hiCpu</a> :: Int</li><li><a href="#v:hiSpindles">hiSpindles</a> :: Double</li><li><a href="#v:instSpindles">instSpindles</a> :: Double</li><li><a href="#v:instSpindlesForth">instSpindlesForth</a> :: Double</li><li><a href="#v:offline">offline</a> :: Bool</li><li><a href="#v:isMaster">isMaster</a> :: Bool</li><li><a href="#v:nTags">nTags</a> :: [String]</li><li><a href="#v:utilPool">utilPool</a> :: <a href="Ganeti-HTools-Types.html#t:DynUtil">DynUtil</a></li><li><a href="#v:utilLoad">utilLoad</a> :: <a href="Ganeti-HTools-Types.html#t:DynUtil">DynUtil</a></li><li><a href="#v:utilLoadForth">utilLoadForth</a> :: <a href="Ganeti-HTools-Types.html#t:DynUtil">DynUtil</a></li><li><a href="#v:pTags">pTags</a> :: <a href="Ganeti-HTools-Node.html#t:TagMap">TagMap</a></li><li><a href="#v:group">group</a> :: <a href="Ganeti-HTools-Types.html#t:Gdx">Gdx</a></li><li><a href="#v:iPolicy">iPolicy</a> :: <a href="Ganeti-HTools-Types.html#t:IPolicy">IPolicy</a></li><li><a href="#v:exclStorage">exclStorage</a> :: Bool</li><li><a href="#v:migTags">migTags</a> :: Set String</li><li><a href="#v:rmigTags">rmigTags</a> :: Set String</li><li><a href="#v:locationTags">locationTags</a> :: Set String</li><li><a href="#v:locationScore">locationScore</a> :: Int</li><li><a href="#v:instanceMap">instanceMap</a> :: Map (String, String) Int</li></ul>}</li><li class="src short"><a href="#v:pCpuEff">pCpuEff</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Double</li><li class="src short"><a href="#v:pCpuEffForth">pCpuEffForth</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Double</li><li class="src short"><span class="keyword">type</span> <a href="#t:AssocList">AssocList</a> = [(<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>, <a href="Ganeti-HTools-Node.html#t:Node">Node</a>)]</li><li class="src short"><span class="keyword">type</span> <a href="#t:List">List</a> = <a href="Ganeti-HTools-Container.html#t:Container">Container</a> <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:noSecondary">noSecondary</a> :: <a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a></li><li class="src short"><a href="#v:addTag">addTag</a> :: Ord k =&gt; Map k Int -&gt; k -&gt; Map k Int</li><li class="src short"><a href="#v:addTags">addTags</a> :: Ord k =&gt; Map k Int -&gt; [k] -&gt; Map k Int</li><li class="src short"><a href="#v:delTag">delTag</a> :: Ord k =&gt; Map k Int -&gt; k -&gt; Map k Int</li><li class="src short"><a href="#v:delTags">delTags</a> :: Ord k =&gt; Map k Int -&gt; [k] -&gt; Map k Int</li><li class="src short"><a href="#v:rejectAddTags">rejectAddTags</a> :: <a href="Ganeti-HTools-Node.html#t:TagMap">TagMap</a> -&gt; [String] -&gt; Bool</li><li class="src short"><a href="#v:conflictingPrimaries">conflictingPrimaries</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Int</li><li class="src short"><a href="#v:incIf">incIf</a> :: Num a =&gt; Bool -&gt; a -&gt; a -&gt; a</li><li class="src short"><a href="#v:decIf">decIf</a> :: Num a =&gt; Bool -&gt; a -&gt; a -&gt; a</li><li class="src short"><a href="#v:haveExclStorage">haveExclStorage</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; Bool</li><li class="src short"><a href="#v:computePmem">computePmem</a> :: Int -&gt; Double -&gt; Int -&gt; Double</li><li class="src short"><a href="#v:create">create</a> :: String -&gt; Double -&gt; Int -&gt; Int -&gt; Double -&gt; Int -&gt; Double -&gt; Int -&gt; Bool -&gt; Int -&gt; Int -&gt; <a href="Ganeti-HTools-Types.html#t:Gdx">Gdx</a> -&gt; Bool -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:mDskToloDsk">mDskToloDsk</a> :: Double -&gt; Double -&gt; Int</li><li class="src short"><a href="#v:mCpuTohiCpu">mCpuTohiCpu</a> :: Double -&gt; Double -&gt; Int</li><li class="src short"><a href="#v:computeHiSpindles">computeHiSpindles</a> :: Double -&gt; Int -&gt; Double</li><li class="src short"><a href="#v:setIdx">setIdx</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:setAlias">setAlias</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; String -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:setOffline">setOffline</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Bool -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:setMaster">setMaster</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Bool -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:setNodeTags">setNodeTags</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; [String] -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:setMigrationTags">setMigrationTags</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Set String -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:setRecvMigrationTags">setRecvMigrationTags</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Set String -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:setLocationTags">setLocationTags</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Set String -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:setXmem">setXmem</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Int -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:setMdsk">setMdsk</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Double -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:setMcpu">setMcpu</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Double -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:setPolicy">setPolicy</a> :: <a href="Ganeti-HTools-Types.html#t:IPolicy">IPolicy</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:computeMaxRes">computeMaxRes</a> :: <a href="Ganeti-HTools-PeerMap.html#t:PeerMap">PeerMap</a> -&gt; <a href="Ganeti-HTools-PeerMap.html#t:Elem">Elem</a></li><li class="src short"><a href="#v:fMemTreshold">fMemTreshold</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Int</li><li class="src short"><a href="#v:buildPeers">buildPeers</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:calcSpindleUse">calcSpindleUse</a> :: Bool -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Double</li><li class="src short"><a href="#v:calcSpindleUseForth">calcSpindleUseForth</a> :: Bool -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Double</li><li class="src short"><a href="#v:calcNewFreeSpindles">calcNewFreeSpindles</a> :: Bool -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Int</li><li class="src short"><a href="#v:calcNewFreeSpindlesForth">calcNewFreeSpindlesForth</a> :: Bool -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Int</li><li class="src short"><a href="#v:calcFmemOfflineOrForthcoming">calcFmemOfflineOrForthcoming</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Container.html#t:Container">Container</a> <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Int</li><li class="src short"><a href="#v:getInstanceDsrdLocScore">getInstanceDsrdLocScore</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Int</li><li class="src short"><a href="#v:getLocationExclusionPairs">getLocationExclusionPairs</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; [(String, String)]</li><li class="src short"><a href="#v:setPri">setPri</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:setSec">setSec</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:computePDsk">computePDsk</a> :: Int -&gt; Double -&gt; Double</li><li class="src short"><a href="#v:computeNewPDsk">computeNewPDsk</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Int -&gt; Int -&gt; Double</li><li class="src short"><a href="#v:getPolicyHealth">getPolicyHealth</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Types.html#t:OpResult">OpResult</a> ()</li><li class="src short"><a href="#v:setCpuSpeed">setCpuSpeed</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Double -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:removePri">removePri</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:removeSec">removeSec</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:addPri">addPri</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Types.html#t:OpResult">OpResult</a> <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:addPriEx">addPriEx</a> :: Bool -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Types.html#t:OpResult">OpResult</a> <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:addSec">addSec</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a> -&gt; <a href="Ganeti-HTools-Types.html#t:OpResult">OpResult</a> <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:addSecEx">addSecEx</a> :: Bool -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a> -&gt; <a href="Ganeti-HTools-Types.html#t:OpResult">OpResult</a> <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:addSecExEx">addSecExEx</a> :: Bool -&gt; Bool -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a> -&gt; <a href="Ganeti-HTools-Types.html#t:OpResult">OpResult</a> <a href="Ganeti-HTools-Node.html#t:Node">Node</a></li><li class="src short"><a href="#v:checkMigration">checkMigration</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Types.html#t:OpResult">OpResult</a> ()</li><li class="src short"><a href="#v:availDisk">availDisk</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Int</li><li class="src short"><a href="#v:iDsk">iDsk</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Int</li><li class="src short"><a href="#v:availMem">availMem</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Int</li><li class="src short"><a href="#v:availCpu">availCpu</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Int</li><li class="src short"><a href="#v:iMem">iMem</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Int</li><li class="src short"><a href="#v:instanceToEdges">instanceToEdges</a> :: <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; [Edge]</li><li class="src short"><a href="#v:instancesToEdges">instancesToEdges</a> :: <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; [Edge]</li><li class="src short"><a href="#v:nodesToBounds">nodesToBounds</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; Maybe Bounds</li><li class="src short"><a href="#v:nodeToSharedSecondaryEdge">nodeToSharedSecondaryEdge</a> :: <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; [Edge]</li><li class="src short"><a href="#v:filterValid">filterValid</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; [Edge] -&gt; [Edge]</li><li class="src short"><a href="#v:mkNodeGraph">mkNodeGraph</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; Maybe Graph</li><li class="src short"><a href="#v:mkRebootNodeGraph">mkRebootNodeGraph</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; Maybe Graph</li><li class="src short"><a href="#v:showField">showField</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; String -&gt; String</li><li class="src short"><a href="#v:showHeader">showHeader</a> :: String -&gt; (String, Bool)</li><li class="src short"><a href="#v:list">list</a> :: [String] -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; [String]</li><li class="src short"><a href="#v:genOpSetOffline">genOpSetOffline</a> :: Monad m =&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Bool -&gt; m <a href="Ganeti-OpCodes.html#t:OpCode">OpCode</a></li><li class="src short"><a href="#v:genOobCommand">genOobCommand</a> :: Monad m =&gt; [<a href="Ganeti-HTools-Node.html#t:Node">Node</a>] -&gt; <a href="Ganeti-Types.html#t:OobCommand">OobCommand</a> -&gt; m <a href="Ganeti-OpCodes.html#t:OpCode">OpCode</a></li><li class="src short"><a href="#v:genPowerOnOpCodes">genPowerOnOpCodes</a> :: Monad m =&gt; [<a href="Ganeti-HTools-Node.html#t:Node">Node</a>] -&gt; m [<a href="Ganeti-OpCodes.html#t:OpCode">OpCode</a>]</li><li class="src short"><a href="#v:genPowerOffOpCodes">genPowerOffOpCodes</a> :: Monad m =&gt; [<a href="Ganeti-HTools-Node.html#t:Node">Node</a>] -&gt; m [<a href="Ganeti-OpCodes.html#t:OpCode">OpCode</a>]</li><li class="src short"><a href="#v:genAddTagsOpCode">genAddTagsOpCode</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; [String] -&gt; <a href="Ganeti-OpCodes.html#t:OpCode">OpCode</a></li><li class="src short"><a href="#v:defaultFields">defaultFields</a> :: [String]</li><li class="src short"><a href="#v:computeGroups">computeGroups</a> :: [<a href="Ganeti-HTools-Node.html#t:Node">Node</a>] -&gt; [(<a href="Ganeti-HTools-Types.html#t:Gdx">Gdx</a>, [<a href="Ganeti-HTools-Node.html#t:Node">Node</a>])]</li></ul></div><div id="interface"><h1 id="g:1">Type declarations
</h1><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:TagMap" class="def">TagMap</a> = Map String Int<a href="Ganeti/HTools/Node.html#TagMap" class="link">Source</a></p></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:Node" class="def">Node</a>  <a href="Ganeti/HTools/Node.html#Node" class="link">Source</a></p><div class="doc"><p>The node type.
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Node" class="def">Node</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:name" class="def">name</a> :: String</dt><dd class="doc"><p>The node name
</p></dd><dt class="src"><a name="v:alias" class="def">alias</a> :: String</dt><dd class="doc"><p>The shortened name (for display purposes)
</p></dd><dt class="src"><a name="v:tMem" class="def">tMem</a> :: Double</dt><dd class="doc"><p>Total memory (MiB)
</p></dd><dt class="src"><a name="v:nMem" class="def">nMem</a> :: Int</dt><dd class="doc"><p>Node memory (MiB)
</p></dd><dt class="src"><a name="v:fMem" class="def">fMem</a> :: Int</dt><dd class="doc"><p>Free memory (MiB)
</p></dd><dt class="src"><a name="v:fMemForth" class="def">fMemForth</a> :: Int</dt><dd class="doc"><p>Free memory (MiB) including forthcoming
   instances
</p></dd><dt class="src"><a name="v:xMem" class="def">xMem</a> :: Int</dt><dd class="doc"><p>Unaccounted memory (MiB)
</p></dd><dt class="src"><a name="v:tDsk" class="def">tDsk</a> :: Double</dt><dd class="doc"><p>Total disk space (MiB)
</p></dd><dt class="src"><a name="v:fDsk" class="def">fDsk</a> :: Int</dt><dd class="doc"><p>Free disk space (MiB)
</p></dd><dt class="src"><a name="v:fDskForth" class="def">fDskForth</a> :: Int</dt><dd class="doc"><p>Free disk space (MiB) including forthcoming
   instances
</p></dd><dt class="src"><a name="v:tCpu" class="def">tCpu</a> :: Double</dt><dd class="doc"><p>Total CPU count
</p></dd><dt class="src"><a name="v:tCpuSpeed" class="def">tCpuSpeed</a> :: Double</dt><dd class="doc"><p>Relative CPU speed
</p></dd><dt class="src"><a name="v:nCpu" class="def">nCpu</a> :: Int</dt><dd class="doc"><p>VCPUs used by the node OS
</p></dd><dt class="src"><a name="v:uCpu" class="def">uCpu</a> :: Int</dt><dd class="doc"><p>Used VCPU count
</p></dd><dt class="src"><a name="v:uCpuForth" class="def">uCpuForth</a> :: Int</dt><dd class="doc"><p>Used VCPU count including forthcoming instances
</p></dd><dt class="src"><a name="v:tSpindles" class="def">tSpindles</a> :: Int</dt><dd class="doc"><p>Node spindles (spindle_count node parameter,
 or actual spindles, see note below)
</p></dd><dt class="src"><a name="v:fSpindles" class="def">fSpindles</a> :: Int</dt><dd class="doc"><p>Free spindles (see note below)
</p></dd><dt class="src"><a name="v:fSpindlesForth" class="def">fSpindlesForth</a> :: Int</dt><dd class="doc"><p>Free spindles (see note below) including
   forthcoming instances
</p></dd><dt class="src"><a name="v:pList" class="def">pList</a> :: [<a href="Ganeti-HTools-Types.html#t:Idx">Idx</a>]</dt><dd class="doc"><p>List of primary instance indices
</p></dd><dt class="src"><a name="v:pListForth" class="def">pListForth</a> :: [<a href="Ganeti-HTools-Types.html#t:Idx">Idx</a>]</dt><dd class="doc"><p>List of primary instance indices including
   forthcoming instances
</p></dd><dt class="src"><a name="v:sList" class="def">sList</a> :: [<a href="Ganeti-HTools-Types.html#t:Idx">Idx</a>]</dt><dd class="doc"><p>List of secondary instance indices
</p></dd><dt class="src"><a name="v:sListForth" class="def">sListForth</a> :: [<a href="Ganeti-HTools-Types.html#t:Idx">Idx</a>]</dt><dd class="doc"><p>List of secondary instance indices including
   forthcoming instances
</p></dd><dt class="src"><a name="v:idx" class="def">idx</a> :: <a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a></dt><dd class="doc"><p>Internal index for book-keeping
</p></dd><dt class="src"><a name="v:peers" class="def">peers</a> :: <a href="Ganeti-HTools-PeerMap.html#t:PeerMap">PeerMap</a></dt><dd class="doc"><p>Pnode to instance mapping
</p></dd><dt class="src"><a name="v:failN1" class="def">failN1</a> :: Bool</dt><dd class="doc"><p>Whether the node has failed n1
</p></dd><dt class="src"><a name="v:failN1Forth" class="def">failN1Forth</a> :: Bool</dt><dd class="doc"><p>Whether the node has failed n1, including
   forthcoming instances
</p></dd><dt class="src"><a name="v:rMem" class="def">rMem</a> :: Int</dt><dd class="doc"><p>Maximum memory needed for failover by
 primaries of this node
</p></dd><dt class="src"><a name="v:rMemForth" class="def">rMemForth</a> :: Int</dt><dd class="doc"><p>Maximum memory needed for failover by
   primaries of this node, including forthcoming
   instances
</p></dd><dt class="src"><a name="v:pMem" class="def">pMem</a> :: Double</dt><dd class="doc"><p>Percent of free memory
</p></dd><dt class="src"><a name="v:pMemForth" class="def">pMemForth</a> :: Double</dt><dd class="doc"><p>Percent of free memory including forthcoming
   instances
</p></dd><dt class="src"><a name="v:pDsk" class="def">pDsk</a> :: Double</dt><dd class="doc"><p>Percent of free disk
</p></dd><dt class="src"><a name="v:pDskForth" class="def">pDskForth</a> :: Double</dt><dd class="doc"><p>Percent of free disk including forthcoming
   instances
</p></dd><dt class="src"><a name="v:pRem" class="def">pRem</a> :: Double</dt><dd class="doc"><p>Percent of reserved memory
</p></dd><dt class="src"><a name="v:pRemForth" class="def">pRemForth</a> :: Double</dt><dd class="doc"><p>Percent of reserved memory including
   forthcoming instances
</p></dd><dt class="src"><a name="v:pCpu" class="def">pCpu</a> :: Double</dt><dd class="doc"><p>Ratio of virtual to physical CPUs
</p></dd><dt class="src"><a name="v:pCpuForth" class="def">pCpuForth</a> :: Double</dt><dd class="doc"><p>Ratio of virtual to physical CPUs including
   forthcoming instances
</p></dd><dt class="src"><a name="v:mDsk" class="def">mDsk</a> :: Double</dt><dd class="doc"><p>Minimum free disk ratio
</p></dd><dt class="src"><a name="v:loDsk" class="def">loDsk</a> :: Int</dt><dd class="doc"><p>Autocomputed from mDsk low disk
 threshold
</p></dd><dt class="src"><a name="v:hiCpu" class="def">hiCpu</a> :: Int</dt><dd class="doc"><p>Autocomputed from mCpu high cpu
 threshold
</p></dd><dt class="src"><a name="v:hiSpindles" class="def">hiSpindles</a> :: Double</dt><dd class="doc"><p>Limit auto-computed from policy spindle_ratio
 and the node spindle count (see note below)
</p></dd><dt class="src"><a name="v:instSpindles" class="def">instSpindles</a> :: Double</dt><dd class="doc"><p>Spindles used by instances (see note below)
</p></dd><dt class="src"><a name="v:instSpindlesForth" class="def">instSpindlesForth</a> :: Double</dt><dd class="doc"><p>Spindles used by instances (see note
   below) including forthcoming instances
</p></dd><dt class="src"><a name="v:offline" class="def">offline</a> :: Bool</dt><dd class="doc"><p>Whether the node should not be used for
 allocations and skipped from score
 computations
</p></dd><dt class="src"><a name="v:isMaster" class="def">isMaster</a> :: Bool</dt><dd class="doc"><p>Whether the node is the master node
</p></dd><dt class="src"><a name="v:nTags" class="def">nTags</a> :: [String]</dt><dd class="doc"><p>The node tags for this node
</p></dd><dt class="src"><a name="v:utilPool" class="def">utilPool</a> :: <a href="Ganeti-HTools-Types.html#t:DynUtil">DynUtil</a></dt><dd class="doc"><p>Total utilisation capacity
</p></dd><dt class="src"><a name="v:utilLoad" class="def">utilLoad</a> :: <a href="Ganeti-HTools-Types.html#t:DynUtil">DynUtil</a></dt><dd class="doc"><p>Sum of instance utilisation
</p></dd><dt class="src"><a name="v:utilLoadForth" class="def">utilLoadForth</a> :: <a href="Ganeti-HTools-Types.html#t:DynUtil">DynUtil</a></dt><dd class="doc"><p>Sum of instance utilisation, including
   forthcoming instances
</p></dd><dt class="src"><a name="v:pTags" class="def">pTags</a> :: <a href="Ganeti-HTools-Node.html#t:TagMap">TagMap</a></dt><dd class="doc"><p>Primary instance exclusion tags and their
   count, including forthcoming instances
</p></dd><dt class="src"><a name="v:group" class="def">group</a> :: <a href="Ganeti-HTools-Types.html#t:Gdx">Gdx</a></dt><dd class="doc"><p>The node's group (index)
</p></dd><dt class="src"><a name="v:iPolicy" class="def">iPolicy</a> :: <a href="Ganeti-HTools-Types.html#t:IPolicy">IPolicy</a></dt><dd class="doc"><p>The instance policy (of the node's group)
</p></dd><dt class="src"><a name="v:exclStorage" class="def">exclStorage</a> :: Bool</dt><dd class="doc"><p>Effective value of exclusive_storage
</p></dd><dt class="src"><a name="v:migTags" class="def">migTags</a> :: Set String</dt><dd class="doc"><p>migration-relevant tags
</p></dd><dt class="src"><a name="v:rmigTags" class="def">rmigTags</a> :: Set String</dt><dd class="doc"><p>migration tags able to receive
</p></dd><dt class="src"><a name="v:locationTags" class="def">locationTags</a> :: Set String</dt><dd class="doc"><p>common-failure domains the node belongs
 to
</p></dd><dt class="src"><a name="v:locationScore" class="def">locationScore</a> :: Int</dt><dd class="doc"><p>Sum of instance location and desired location
 scores
</p></dd><dt class="src"><a name="v:instanceMap" class="def">instanceMap</a> :: Map (String, String) Int</dt><dd class="doc"><p>Number of instances with
 each exclusion/location tags
 pair
</p></dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:Node" class="caption collapser" onclick="toggleSection('i:Node')">Instances</p><div id="section.i:Node" class="show"><table><tr><td class="src">Eq <a href="Ganeti-HTools-Node.html#t:Node">Node</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Show <a href="Ganeti-HTools-Node.html#t:Node">Node</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Ganeti-HTools-Types.html#t:Element">Element</a> <a href="Ganeti-HTools-Node.html#t:Node">Node</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Arbitrary <a href="Ganeti-HTools-Node.html#t:Node">Node</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:pCpuEff" class="def">pCpuEff</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Double<a href="Ganeti/HTools/Node.html#pCpuEff" class="link">Source</a></p><div class="doc"><p>Derived parameter: ratio of virutal to physical CPUs, weighted
 by CPU speed.
</p></div></div><div class="top"><p class="src"><a name="v:pCpuEffForth" class="def">pCpuEffForth</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Double<a href="Ganeti/HTools/Node.html#pCpuEffForth" class="link">Source</a></p><div class="doc"><p>Derived parameter: ratio of virutal to physical CPUs, weighted
 by CPU speed and taking forthcoming instances into account.
</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:AssocList" class="def">AssocList</a> = [(<a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a>, <a href="Ganeti-HTools-Node.html#t:Node">Node</a>)]<a href="Ganeti/HTools/Node.html#AssocList" class="link">Source</a></p><div class="doc"><p>A simple name for the int, node association list.
</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:List" class="def">List</a> = <a href="Ganeti-HTools-Container.html#t:Container">Container</a> <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#List" class="link">Source</a></p><div class="doc"><p>A simple name for a node map.
</p></div></div><div class="top"><p class="src"><a name="v:noSecondary" class="def">noSecondary</a> :: <a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a><a href="Ganeti/HTools/Node.html#noSecondary" class="link">Source</a></p><div class="doc"><p>Constant node index for a non-moveable instance.
</p></div></div><h1 id="g:2">Helper functions
</h1><div class="top"><p class="src"><a name="v:addTag" class="def">addTag</a> :: Ord k =&gt; Map k Int -&gt; k -&gt; Map k Int<a href="Ganeti/HTools/Node.html#addTag" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:addTags" class="def">addTags</a> :: Ord k =&gt; Map k Int -&gt; [k] -&gt; Map k Int<a href="Ganeti/HTools/Node.html#addTags" class="link">Source</a></p><div class="doc"><p>Add multiple values.
</p></div></div><div class="top"><p class="src"><a name="v:delTag" class="def">delTag</a> :: Ord k =&gt; Map k Int -&gt; k -&gt; Map k Int<a href="Ganeti/HTools/Node.html#delTag" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:delTags" class="def">delTags</a> :: Ord k =&gt; Map k Int -&gt; [k] -&gt; Map k Int<a href="Ganeti/HTools/Node.html#delTags" class="link">Source</a></p><div class="doc"><p>Remove multiple value.
</p></div></div><div class="top"><p class="src"><a name="v:rejectAddTags" class="def">rejectAddTags</a> :: <a href="Ganeti-HTools-Node.html#t:TagMap">TagMap</a> -&gt; [String] -&gt; Bool<a href="Ganeti/HTools/Node.html#rejectAddTags" class="link">Source</a></p><div class="doc"><p>Check if we can add a list of tags to a tagmap.
</p></div></div><div class="top"><p class="src"><a name="v:conflictingPrimaries" class="def">conflictingPrimaries</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Int<a href="Ganeti/HTools/Node.html#conflictingPrimaries" class="link">Source</a></p><div class="doc"><p>Check how many primary instances have conflicting tags. The
 algorithm to compute this is to sum the count of all tags, then
 subtract the size of the tag map (since each tag has at least one,
 non-conflicting instance); this is equivalent to summing the
 values in the tag map minus one.
</p></div></div><div class="top"><p class="src"><a name="v:incIf" class="def">incIf</a> :: Num a =&gt; Bool -&gt; a -&gt; a -&gt; a<a href="Ganeti/HTools/Node.html#incIf" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:decIf" class="def">decIf</a> :: Num a =&gt; Bool -&gt; a -&gt; a -&gt; a<a href="Ganeti/HTools/Node.html#decIf" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:haveExclStorage" class="def">haveExclStorage</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; Bool<a href="Ganeti/HTools/Node.html#haveExclStorage" class="link">Source</a></p><div class="doc"><p>Is exclusive storage enabled on any node?
</p></div></div><div class="top"><p class="src"><a name="v:computePmem" class="def">computePmem</a> :: Int -&gt; Double -&gt; Int -&gt; Double<a href="Ganeti/HTools/Node.html#computePmem" class="link">Source</a></p><div class="doc"><p>Conversion formula from fMem, tMem and nMem to pMem.
</p></div></div><h1 id="g:3">Initialization functions
</h1><div class="top"><p class="src"><a name="v:create" class="def">create</a> :: String -&gt; Double -&gt; Int -&gt; Int -&gt; Double -&gt; Int -&gt; Double -&gt; Int -&gt; Bool -&gt; Int -&gt; Int -&gt; <a href="Ganeti-HTools-Types.html#t:Gdx">Gdx</a> -&gt; Bool -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#create" class="link">Source</a></p><div class="doc"><p>Create a new node.
</p><p>The index and the peers maps are empty, and will be need to be
 update later via the <code><a href="Ganeti-HTools-Node.html#v:setIdx">setIdx</a></code> and <code><a href="Ganeti-HTools-Node.html#v:buildPeers">buildPeers</a></code> functions.
</p></div></div><div class="top"><p class="src"><a name="v:mDskToloDsk" class="def">mDskToloDsk</a> :: Double -&gt; Double -&gt; Int<a href="Ganeti/HTools/Node.html#mDskToloDsk" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:mCpuTohiCpu" class="def">mCpuTohiCpu</a> :: Double -&gt; Double -&gt; Int<a href="Ganeti/HTools/Node.html#mCpuTohiCpu" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:computeHiSpindles" class="def">computeHiSpindles</a> :: Double -&gt; Int -&gt; Double<a href="Ganeti/HTools/Node.html#computeHiSpindles" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:setIdx" class="def">setIdx</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#setIdx" class="link">Source</a></p><div class="doc"><p>Changes the index.
</p><p>This is used only during the building of the data structures.
</p></div></div><div class="top"><p class="src"><a name="v:setAlias" class="def">setAlias</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; String -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#setAlias" class="link">Source</a></p><div class="doc"><p>Changes the alias.
</p><p>This is used only during the building of the data structures.
</p></div></div><div class="top"><p class="src"><a name="v:setOffline" class="def">setOffline</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Bool -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#setOffline" class="link">Source</a></p><div class="doc"><p>Sets the offline attribute.
</p></div></div><div class="top"><p class="src"><a name="v:setMaster" class="def">setMaster</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Bool -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#setMaster" class="link">Source</a></p><div class="doc"><p>Sets the master attribute
</p></div></div><div class="top"><p class="src"><a name="v:setNodeTags" class="def">setNodeTags</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; [String] -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#setNodeTags" class="link">Source</a></p><div class="doc"><p>Sets the node tags attribute
</p></div></div><div class="top"><p class="src"><a name="v:setMigrationTags" class="def">setMigrationTags</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Set String -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#setMigrationTags" class="link">Source</a></p><div class="doc"><p>Set migration tags
</p></div></div><div class="top"><p class="src"><a name="v:setRecvMigrationTags" class="def">setRecvMigrationTags</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Set String -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#setRecvMigrationTags" class="link">Source</a></p><div class="doc"><p>Set the migration tags a node is able to receive
</p></div></div><div class="top"><p class="src"><a name="v:setLocationTags" class="def">setLocationTags</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Set String -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#setLocationTags" class="link">Source</a></p><div class="doc"><p>Set the location tags
</p></div></div><div class="top"><p class="src"><a name="v:setXmem" class="def">setXmem</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Int -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#setXmem" class="link">Source</a></p><div class="doc"><p>Sets the unnaccounted memory.
</p></div></div><div class="top"><p class="src"><a name="v:setMdsk" class="def">setMdsk</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Double -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#setMdsk" class="link">Source</a></p><div class="doc"><p>Sets the max disk usage ratio.
</p></div></div><div class="top"><p class="src"><a name="v:setMcpu" class="def">setMcpu</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Double -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#setMcpu" class="link">Source</a></p><div class="doc"><p>Sets the max cpu usage ratio. This will update the node's
 ipolicy, losing sharing (but it should be a seldomly done operation).
</p></div></div><div class="top"><p class="src"><a name="v:setPolicy" class="def">setPolicy</a> :: <a href="Ganeti-HTools-Types.html#t:IPolicy">IPolicy</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#setPolicy" class="link">Source</a></p><div class="doc"><p>Sets the policy.
</p></div></div><div class="top"><p class="src"><a name="v:computeMaxRes" class="def">computeMaxRes</a> :: <a href="Ganeti-HTools-PeerMap.html#t:PeerMap">PeerMap</a> -&gt; <a href="Ganeti-HTools-PeerMap.html#t:Elem">Elem</a><a href="Ganeti/HTools/Node.html#computeMaxRes" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:fMemTreshold" class="def">fMemTreshold</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Int<a href="Ganeti/HTools/Node.html#fMemTreshold" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:buildPeers" class="def">buildPeers</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#buildPeers" class="link">Source</a></p><div class="doc"><p>Builds the peer map for a given node.
</p></div></div><div class="top"><p class="src"><a name="v:calcSpindleUse" class="def">calcSpindleUse</a> :: Bool -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Double<a href="Ganeti/HTools/Node.html#calcSpindleUse" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:calcSpindleUseForth" class="def">calcSpindleUseForth</a> :: Bool -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Double<a href="Ganeti/HTools/Node.html#calcSpindleUseForth" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:calcNewFreeSpindles" class="def">calcNewFreeSpindles</a> :: Bool -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Int<a href="Ganeti/HTools/Node.html#calcNewFreeSpindles" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:calcNewFreeSpindlesForth" class="def">calcNewFreeSpindlesForth</a> :: Bool -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Int<a href="Ganeti/HTools/Node.html#calcNewFreeSpindlesForth" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:calcFmemOfflineOrForthcoming" class="def">calcFmemOfflineOrForthcoming</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Container.html#t:Container">Container</a> <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Int<a href="Ganeti/HTools/Node.html#calcFmemOfflineOrForthcoming" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:getInstanceDsrdLocScore" class="def">getInstanceDsrdLocScore</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; Int<a href="Ganeti/HTools/Node.html#getInstanceDsrdLocScore" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:getLocationExclusionPairs" class="def">getLocationExclusionPairs</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; [(String, String)]<a href="Ganeti/HTools/Node.html#getLocationExclusionPairs" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:setPri" class="def">setPri</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#setPri" class="link">Source</a></p><div class="doc"><p>Assigns an instance to a node as primary and update the used VCPU
 count, utilisation data, tags map and desired location score.
</p></div></div><div class="top"><p class="src"><a name="v:setSec" class="def">setSec</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#setSec" class="link">Source</a></p><div class="doc"><p>Assigns an instance to a node as secondary and updates disk utilisation.
</p></div></div><div class="top"><p class="src"><a name="v:computePDsk" class="def">computePDsk</a> :: Int -&gt; Double -&gt; Double<a href="Ganeti/HTools/Node.html#computePDsk" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:computeNewPDsk" class="def">computeNewPDsk</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Int -&gt; Int -&gt; Double<a href="Ganeti/HTools/Node.html#computeNewPDsk" class="link">Source</a></p></div><h1 id="g:4">Diagnostic functions
</h1><div class="top"><p class="src"><a name="v:getPolicyHealth" class="def">getPolicyHealth</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Types.html#t:OpResult">OpResult</a> ()<a href="Ganeti/HTools/Node.html#getPolicyHealth" class="link">Source</a></p><div class="doc"><p>For a node diagnose whether it conforms with all policies. The type
 is chosen to represent that of a no-op node operation.
</p></div></div><h1 id="g:5">Update functions
</h1><div class="top"><p class="src"><a name="v:setCpuSpeed" class="def">setCpuSpeed</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Double -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#setCpuSpeed" class="link">Source</a></p><div class="doc"><p>Set the CPU speed
</p></div></div><div class="top"><p class="src"><a name="v:removePri" class="def">removePri</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#removePri" class="link">Source</a></p><div class="doc"><p>Removes a primary instance.
</p></div></div><div class="top"><p class="src"><a name="v:removeSec" class="def">removeSec</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#removeSec" class="link">Source</a></p><div class="doc"><p>Removes a secondary instance.
</p></div></div><div class="top"><p class="src"><a name="v:addPri" class="def">addPri</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Types.html#t:OpResult">OpResult</a> <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#addPri" class="link">Source</a></p><div class="doc"><p>Adds a primary instance (basic version).
</p></div></div><div class="top"><p class="src"><a name="v:addPriEx" class="def">addPriEx</a><a href="Ganeti/HTools/Node.html#addPriEx" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: Bool</td><td class="doc"><p>Whether to override the N+1 and
 other <em>soft</em> checks, useful if we
 come from a worse status (e.g. offline).
 If this is True, forthcoming instances
 may exceed available Node resources.
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a></td><td class="doc"><p>The target node
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a></td><td class="doc"><p>The instance to add
</p></td></tr><tr><td class="src">-&gt; <a href="Ganeti-HTools-Types.html#t:OpResult">OpResult</a> <a href="Ganeti-HTools-Node.html#t:Node">Node</a></td><td class="doc"><p>The result of the operation,
 either the new version of the node
 or a failure mode
</p></td></tr></table></div><div class="doc"><p>Adds a primary instance (extended version).
</p></div></div><div class="top"><p class="src"><a name="v:addSec" class="def">addSec</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a> -&gt; <a href="Ganeti-HTools-Types.html#t:OpResult">OpResult</a> <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#addSec" class="link">Source</a></p><div class="doc"><p>Adds a secondary instance (basic version).
</p></div></div><div class="top"><p class="src"><a name="v:addSecEx" class="def">addSecEx</a> :: Bool -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a> -&gt; <a href="Ganeti-HTools-Types.html#t:OpResult">OpResult</a> <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#addSecEx" class="link">Source</a></p><div class="doc"><p>Adds a secondary instance (extended version).
</p></div></div><div class="top"><p class="src"><a name="v:addSecExEx" class="def">addSecExEx</a> :: Bool -&gt; Bool -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; <a href="Ganeti-HTools-Types.html#t:Ndx">Ndx</a> -&gt; <a href="Ganeti-HTools-Types.html#t:OpResult">OpResult</a> <a href="Ganeti-HTools-Node.html#t:Node">Node</a><a href="Ganeti/HTools/Node.html#addSecExEx" class="link">Source</a></p><div class="doc"><p>Adds a secondary instance (doubly extended version). The first parameter
 tells <code><a href="Ganeti-HTools-Node.html#v:addSecExEx">addSecExEx</a></code> to ignore disks completly. There is only one legitimate
 use case for this, and this is failing over a DRBD instance where the primary
 node is offline (and hence will become the secondary afterwards).
</p></div></div><div class="top"><p class="src"><a name="v:checkMigration" class="def">checkMigration</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; <a href="Ganeti-HTools-Types.html#t:OpResult">OpResult</a> ()<a href="Ganeti/HTools/Node.html#checkMigration" class="link">Source</a></p><div class="doc"><p>Predicate on whether migration is supported between two nodes.
</p></div></div><h1 id="g:6">Stats functions
</h1><div class="top"><p class="src"><a name="v:availDisk" class="def">availDisk</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Int<a href="Ganeti/HTools/Node.html#availDisk" class="link">Source</a></p><div class="doc"><p>Computes the amount of available disk on a given node.
</p></div></div><div class="top"><p class="src"><a name="v:iDsk" class="def">iDsk</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Int<a href="Ganeti/HTools/Node.html#iDsk" class="link">Source</a></p><div class="doc"><p>Computes the amount of used disk on a given node.
</p></div></div><div class="top"><p class="src"><a name="v:availMem" class="def">availMem</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Int<a href="Ganeti/HTools/Node.html#availMem" class="link">Source</a></p><div class="doc"><p>Computes the amount of available memory on a given node.
</p></div></div><div class="top"><p class="src"><a name="v:availCpu" class="def">availCpu</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Int<a href="Ganeti/HTools/Node.html#availCpu" class="link">Source</a></p><div class="doc"><p>Computes the amount of available memory on a given node.
</p></div></div><div class="top"><p class="src"><a name="v:iMem" class="def">iMem</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Int<a href="Ganeti/HTools/Node.html#iMem" class="link">Source</a></p><div class="doc"><p>The memory used by instances on a given node.
</p></div></div><h1 id="g:7">Node graph functions
</h1><h1 id="g:8">Making of a Graph from a node/instance list
</h1><div class="top"><p class="src"><a name="v:instanceToEdges" class="def">instanceToEdges</a> :: <a href="Ganeti-HTools-Instance.html#t:Instance">Instance</a> -&gt; [Edge]<a href="Ganeti/HTools/Node.html#instanceToEdges" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:instancesToEdges" class="def">instancesToEdges</a> :: <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; [Edge]<a href="Ganeti/HTools/Node.html#instancesToEdges" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:nodesToBounds" class="def">nodesToBounds</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; Maybe Bounds<a href="Ganeti/HTools/Node.html#nodesToBounds" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:nodeToSharedSecondaryEdge" class="def">nodeToSharedSecondaryEdge</a> :: <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; [Edge]<a href="Ganeti/HTools/Node.html#nodeToSharedSecondaryEdge" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:filterValid" class="def">filterValid</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; [Edge] -&gt; [Edge]<a href="Ganeti/HTools/Node.html#filterValid" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:mkNodeGraph" class="def">mkNodeGraph</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; Maybe Graph<a href="Ganeti/HTools/Node.html#mkNodeGraph" class="link">Source</a></p><div class="doc"><p>Transform a Node + Instance list into a NodeGraph type.
 Returns Nothing if the node list is empty.
</p></div></div><div class="top"><p class="src"><a name="v:mkRebootNodeGraph" class="def">mkRebootNodeGraph</a> :: <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Node.html#t:List">List</a> -&gt; <a href="Ganeti-HTools-Instance.html#t:List">List</a> -&gt; Maybe Graph<a href="Ganeti/HTools/Node.html#mkRebootNodeGraph" class="link">Source</a></p><div class="doc"><p>Transform a Nodes + Instances into a NodeGraph with all reboot exclusions.
 This includes edges between nodes that are the primary nodes of instances
 that have the same secondary node. Nodes not in the node list will not be
 part of the graph, but they are still considered for the edges arising from
 two instances having the same secondary node.
 Return Nothing if the node list is empty.
</p></div></div><h1 id="g:9">Display functions
</h1><div class="top"><p class="src"><a name="v:showField" class="def">showField</a><a href="Ganeti/HTools/Node.html#showField" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ganeti-HTools-Node.html#t:Node">Node</a></td><td class="doc"><p>Node which we're querying
</p></td></tr><tr><td class="src">-&gt; String</td><td class="doc"><p>Field name
</p></td></tr><tr><td class="src">-&gt; String</td><td class="doc"><p>Field value as string
</p></td></tr></table></div><div class="doc"><p>Return a field for a given node.
</p></div></div><div class="top"><p class="src"><a name="v:showHeader" class="def">showHeader</a> :: String -&gt; (String, Bool)<a href="Ganeti/HTools/Node.html#showHeader" class="link">Source</a></p><div class="doc"><p>Returns the header and numeric propery of a field.
</p></div></div><div class="top"><p class="src"><a name="v:list" class="def">list</a> :: [String] -&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; [String]<a href="Ganeti/HTools/Node.html#list" class="link">Source</a></p><div class="doc"><p>String converter for the node list functionality.
</p></div></div><div class="top"><p class="src"><a name="v:genOpSetOffline" class="def">genOpSetOffline</a> :: Monad m =&gt; <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; Bool -&gt; m <a href="Ganeti-OpCodes.html#t:OpCode">OpCode</a><a href="Ganeti/HTools/Node.html#genOpSetOffline" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:genOobCommand" class="def">genOobCommand</a> :: Monad m =&gt; [<a href="Ganeti-HTools-Node.html#t:Node">Node</a>] -&gt; <a href="Ganeti-Types.html#t:OobCommand">OobCommand</a> -&gt; m <a href="Ganeti-OpCodes.html#t:OpCode">OpCode</a><a href="Ganeti/HTools/Node.html#genOobCommand" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:genPowerOnOpCodes" class="def">genPowerOnOpCodes</a> :: Monad m =&gt; [<a href="Ganeti-HTools-Node.html#t:Node">Node</a>] -&gt; m [<a href="Ganeti-OpCodes.html#t:OpCode">OpCode</a>]<a href="Ganeti/HTools/Node.html#genPowerOnOpCodes" class="link">Source</a></p><div class="doc"><p>Generate OpCode for powering on a list of nodes
</p></div></div><div class="top"><p class="src"><a name="v:genPowerOffOpCodes" class="def">genPowerOffOpCodes</a> :: Monad m =&gt; [<a href="Ganeti-HTools-Node.html#t:Node">Node</a>] -&gt; m [<a href="Ganeti-OpCodes.html#t:OpCode">OpCode</a>]<a href="Ganeti/HTools/Node.html#genPowerOffOpCodes" class="link">Source</a></p><div class="doc"><p>Generate OpCodes for powering off a list of nodes
</p></div></div><div class="top"><p class="src"><a name="v:genAddTagsOpCode" class="def">genAddTagsOpCode</a> :: <a href="Ganeti-HTools-Node.html#t:Node">Node</a> -&gt; [String] -&gt; <a href="Ganeti-OpCodes.html#t:OpCode">OpCode</a><a href="Ganeti/HTools/Node.html#genAddTagsOpCode" class="link">Source</a></p><div class="doc"><p>Generate OpCodes for adding tags to a node
</p></div></div><div class="top"><p class="src"><a name="v:defaultFields" class="def">defaultFields</a> :: [String]<a href="Ganeti/HTools/Node.html#defaultFields" class="link">Source</a></p><div class="doc"><p>Constant holding the fields we're displaying by default.
</p></div></div><div class="top"><p class="src"><a name="v:computeGroups" class="def">computeGroups</a> :: [<a href="Ganeti-HTools-Node.html#t:Node">Node</a>] -&gt; [(<a href="Ganeti-HTools-Types.html#t:Gdx">Gdx</a>, [<a href="Ganeti-HTools-Node.html#t:Node">Node</a>])]<a href="Ganeti/HTools/Node.html#computeGroups" class="link">Source</a></p><div class="doc"><p>Split a list of nodes into a list of (node group UUID, list of
 associated nodes).
</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.10.0</p></div></body></html>