<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>ganeti.bootstrap</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
</head>

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://code.google.com/p/ganeti/">Ganeti</a></th>
          </tr></table></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        <a href="ganeti-module.html">Package&nbsp;ganeti</a> ::
        Module&nbsp;bootstrap
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
        <tr><td align="right"><span class="options">[<a href="javascript:void(0);" class="privatelink"
    onclick="toggle_private();">hide&nbsp;private</a>]</span></td></tr>
        <tr><td align="right"><span class="options"
            >[<a href="frames.html" target="_top">frames</a
            >]&nbsp;|&nbsp;<a href="ganeti.bootstrap-module.html"
            target="_top">no&nbsp;frames</a>]</span></td></tr>
      </table>
    </td>
  </tr>
</table>
<!-- ==================== MODULE DESCRIPTION ==================== -->
<h1 class="epydoc">Module bootstrap</h1><p class="nomargin-top"><span class="codelink"><a href="ganeti.bootstrap-pysrc.html">source&nbsp;code</a></span></p>
<p>Functions to bootstrap a new cluster.</p>

<!-- ==================== FUNCTIONS ==================== -->
<a name="section-Functions"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Functions</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-Functions"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.bootstrap-module.html#_InitSSHSetup" class="summary-sig-name" onclick="show_private();">_InitSSHSetup</a>()</span><br />
      Setup the SSH configuration for the cluster.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.bootstrap-pysrc.html#_InitSSHSetup">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.bootstrap-module.html#GenerateHmacKey" class="summary-sig-name">GenerateHmacKey</a>(<span class="summary-sig-arg">file_name</span>)</span><br />
      Writes a new HMAC key.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.bootstrap-pysrc.html#GenerateHmacKey">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.bootstrap-module.html#GenerateClusterCrypto" class="summary-sig-name">GenerateClusterCrypto</a>(<span class="summary-sig-arg">new_cluster_cert</span>,
        <span class="summary-sig-arg">new_rapi_cert</span>,
        <span class="summary-sig-arg">new_spice_cert</span>,
        <span class="summary-sig-arg">new_confd_hmac_key</span>,
        <span class="summary-sig-arg">new_cds</span>,
        <span class="summary-sig-arg">rapi_cert_pem</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">spice_cert_pem</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">spice_cacert_pem</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">cds</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">nodecert_file</span>=<span class="summary-sig-default">pathutils.NODED_CERT_FILE</span>,
        <span class="summary-sig-arg">rapicert_file</span>=<span class="summary-sig-default">pathutils.RAPI_CERT_FILE</span>,
        <span class="summary-sig-arg">spicecert_file</span>=<span class="summary-sig-default">pathutils.SPICE_CERT_FILE</span>,
        <span class="summary-sig-arg">spicecacert_file</span>=<span class="summary-sig-default">pathutils.SPICE_CACERT_FILE</span>,
        <span class="summary-sig-arg">hmackey_file</span>=<span class="summary-sig-default">pathutils.CONFD_HMAC_KEY</span>,
        <span class="summary-sig-arg">cds_file</span>=<span class="summary-sig-default">pathutils.CLUSTER_DOMAIN_SECRET_FILE</span>)</span><br />
      Updates the cluster certificates, keys and secrets.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.bootstrap-pysrc.html#GenerateClusterCrypto">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.bootstrap-module.html#_InitGanetiServerSetup" class="summary-sig-name" onclick="show_private();">_InitGanetiServerSetup</a>(<span class="summary-sig-arg">master_name</span>)</span><br />
      Setup the necessary configuration for the initial node daemon.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.bootstrap-pysrc.html#_InitGanetiServerSetup">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="_WaitForNodeDaemon"></a><span class="summary-sig-name">_WaitForNodeDaemon</span>(<span class="summary-sig-arg">node_name</span>)</span><br />
      Wait for node daemon to become responsive.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.bootstrap-pysrc.html#_WaitForNodeDaemon">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="_WaitForMasterDaemon"></a><span class="summary-sig-name">_WaitForMasterDaemon</span>()</span><br />
      Wait for master daemon to become responsive.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.bootstrap-pysrc.html#_WaitForMasterDaemon">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="_WaitForSshDaemon"></a><span class="summary-sig-name">_WaitForSshDaemon</span>(<span class="summary-sig-arg">hostname</span>,
        <span class="summary-sig-arg">port</span>,
        <span class="summary-sig-arg">family</span>)</span><br />
      Wait for SSH daemon to become responsive.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.bootstrap-pysrc.html#_WaitForSshDaemon">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.bootstrap-module.html#RunNodeSetupCmd" class="summary-sig-name">RunNodeSetupCmd</a>(<span class="summary-sig-arg">cluster_name</span>,
        <span class="summary-sig-arg">node</span>,
        <span class="summary-sig-arg">basecmd</span>,
        <span class="summary-sig-arg">debug</span>,
        <span class="summary-sig-arg">verbose</span>,
        <span class="summary-sig-arg">use_cluster_key</span>,
        <span class="summary-sig-arg">ask_key</span>,
        <span class="summary-sig-arg">strict_host_check</span>,
        <span class="summary-sig-arg">data</span>)</span><br />
      Runs a command to configure something on a remote machine.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.bootstrap-pysrc.html#RunNodeSetupCmd">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.bootstrap-module.html#_InitFileStorageDir" class="summary-sig-name" onclick="show_private();">_InitFileStorageDir</a>(<span class="summary-sig-arg">file_storage_dir</span>)</span><br />
      Initialize if needed the file storage.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.bootstrap-pysrc.html#_InitFileStorageDir">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">string</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.bootstrap-module.html#_PrepareFileBasedStorage" class="summary-sig-name" onclick="show_private();">_PrepareFileBasedStorage</a>(<span class="summary-sig-arg">enabled_disk_templates</span>,
        <span class="summary-sig-arg">file_storage_dir</span>,
        <span class="summary-sig-arg">default_dir</span>,
        <span class="summary-sig-arg">file_disk_template</span>,
        <span class="summary-sig-arg">init_fn</span>=<span class="summary-sig-default">_InitFileStorageDir</span>,
        <span class="summary-sig-arg">acceptance_fn</span>=<span class="summary-sig-default">None</span>)</span><br />
      Checks if a file-base storage type is enabled and inits the dir.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.bootstrap-pysrc.html#_PrepareFileBasedStorage">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.bootstrap-module.html#_PrepareFileStorage" class="summary-sig-name" onclick="show_private();">_PrepareFileStorage</a>(<span class="summary-sig-arg">enabled_disk_templates</span>,
        <span class="summary-sig-arg">file_storage_dir</span>,
        <span class="summary-sig-arg">init_fn</span>=<span class="summary-sig-default">_InitFileStorageDir</span>,
        <span class="summary-sig-arg">acceptance_fn</span>=<span class="summary-sig-default">None</span>)</span><br />
      Checks if file storage is enabled and inits the dir.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.bootstrap-pysrc.html#_PrepareFileStorage">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.bootstrap-module.html#_PrepareSharedFileStorage" class="summary-sig-name" onclick="show_private();">_PrepareSharedFileStorage</a>(<span class="summary-sig-arg">enabled_disk_templates</span>,
        <span class="summary-sig-arg">file_storage_dir</span>,
        <span class="summary-sig-arg">init_fn</span>=<span class="summary-sig-default">_InitFileStorageDir</span>,
        <span class="summary-sig-arg">acceptance_fn</span>=<span class="summary-sig-default">None</span>)</span><br />
      Checks if shared file storage is enabled and inits the dir.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.bootstrap-pysrc.html#_PrepareSharedFileStorage">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="_InitCheckEnabledDiskTemplates"></a><span class="summary-sig-name">_InitCheckEnabledDiskTemplates</span>(<span class="summary-sig-arg">enabled_disk_templates</span>)</span><br />
      Checks the sanity of the enabled disk templates.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.bootstrap-pysrc.html#_InitCheckEnabledDiskTemplates">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.bootstrap-module.html#_RestrictIpolicyToEnabledDiskTemplates" class="summary-sig-name" onclick="show_private();">_RestrictIpolicyToEnabledDiskTemplates</a>(<span class="summary-sig-arg">ipolicy</span>,
        <span class="summary-sig-arg">enabled_disk_templates</span>)</span><br />
      Restricts the ipolicy's disk templates to the enabled ones.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.bootstrap-pysrc.html#_RestrictIpolicyToEnabledDiskTemplates">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.bootstrap-module.html#InitCluster" class="summary-sig-name">InitCluster</a>(<span class="summary-sig-arg">cluster_name</span>,
        <span class="summary-sig-arg">mac_prefix</span>,
        <span class="summary-sig-arg">master_netmask</span>,
        <span class="summary-sig-arg">master_netdev</span>,
        <span class="summary-sig-arg">file_storage_dir</span>,
        <span class="summary-sig-arg">shared_file_storage_dir</span>,
        <span class="summary-sig-arg">candidate_pool_size</span>,
        <span class="summary-sig-arg">secondary_ip</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">vg_name</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">beparams</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">nicparams</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">ndparams</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">hvparams</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">diskparams</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">enabled_hypervisors</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">modify_etc_hosts</span>=<span class="summary-sig-default">True</span>,
        <span class="summary-sig-arg">modify_ssh_setup</span>=<span class="summary-sig-default">True</span>,
        <span class="summary-sig-arg">maintain_node_health</span>=<span class="summary-sig-default">False</span>,
        <span class="summary-sig-arg">drbd_helper</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">uid_pool</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">default_iallocator</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">primary_ip_version</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">ipolicy</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">prealloc_wipe_disks</span>=<span class="summary-sig-default">False</span>,
        <span class="summary-sig-arg">use_external_mip_script</span>=<span class="summary-sig-default">False</span>,
        <span class="summary-sig-arg">hv_state</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">disk_state</span>=<span class="summary-sig-default">None</span>,
        <span class="summary-sig-arg">enabled_disk_templates</span>=<span class="summary-sig-default">None</span>)</span><br />
      Initialise the cluster.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.bootstrap-pysrc.html#InitCluster">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.bootstrap-module.html#InitConfig" class="summary-sig-name">InitConfig</a>(<span class="summary-sig-arg">version</span>,
        <span class="summary-sig-arg">cluster_config</span>,
        <span class="summary-sig-arg">master_node_config</span>,
        <span class="summary-sig-arg">cfg_file</span>=<span class="summary-sig-default">pathutils.CLUSTER_CONF_FILE</span>)</span><br />
      Create the initial cluster configuration.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.bootstrap-pysrc.html#InitConfig">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.bootstrap-module.html#FinalizeClusterDestroy" class="summary-sig-name">FinalizeClusterDestroy</a>(<span class="summary-sig-arg">master_uuid</span>)</span><br />
      Execute the last steps of cluster destroy</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.bootstrap-pysrc.html#FinalizeClusterDestroy">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.bootstrap-module.html#SetupNodeDaemon" class="summary-sig-name">SetupNodeDaemon</a>(<span class="summary-sig-arg">opts</span>,
        <span class="summary-sig-arg">cluster_name</span>,
        <span class="summary-sig-arg">node</span>)</span><br />
      Add a node to the cluster.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.bootstrap-pysrc.html#SetupNodeDaemon">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.bootstrap-module.html#MasterFailover" class="summary-sig-name">MasterFailover</a>(<span class="summary-sig-arg">no_voting</span>=<span class="summary-sig-default">False</span>)</span><br />
      Failover the master node.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.bootstrap-pysrc.html#MasterFailover">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.bootstrap-module.html#GetMaster" class="summary-sig-name">GetMaster</a>()</span><br />
      Returns the current master node.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.bootstrap-pysrc.html#GetMaster">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">list</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="ganeti.bootstrap-module.html#GatherMasterVotes" class="summary-sig-name">GatherMasterVotes</a>(<span class="summary-sig-arg">node_names</span>)</span><br />
      Check the agreement on who is the master.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="ganeti.bootstrap-pysrc.html#GatherMasterVotes">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
</table>
<!-- ==================== VARIABLES ==================== -->
<a name="section-Variables"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Variables</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-Variables"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a name="_INITCONF_ECID"></a><span class="summary-name">_INITCONF_ECID</span> = <code title="&quot;initconfig-ecid&quot;">&quot;initconfig-ecid&quot;</code>
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a name="_DAEMON_READY_TIMEOUT"></a><span class="summary-name">_DAEMON_READY_TIMEOUT</span> = <code title="10.0">10.0</code><br />
      After how many seconds daemon must be responsive
    </td>
  </tr>
</table>
<p class="indent-wrapped-lines"><b>Imports:</b>
  <span title="os">os</span>,
  <span title="re">re</span>,
  <span title="logging">logging</span>,
  <span title="time">time</span>,
  <span title="tempfile">tempfile</span>,
  <a href="ganeti.cmdlib.cluster-module.html" title="ganeti.cmdlib.cluster">cluster</a>,
  <a href="ganeti.rpc-module.html" title="ganeti.rpc">rpc</a>,
  <a href="ganeti.ssh-module.html" title="ganeti.ssh">ssh</a>,
  <a href="ganeti.utils-module.html" title="ganeti.utils">utils</a>,
  <a href="ganeti.errors-module.html" title="ganeti.errors">errors</a>,
  <a href="ganeti.config-module.html" title="ganeti.config">config</a>,
  <a href="ganeti.constants-module.html" title="ganeti.constants">constants</a>,
  <a href="ganeti.objects-module.html" title="ganeti.objects">objects</a>,
  <a href="ganeti.ssconf-module.html" title="ganeti.ssconf">ssconf</a>,
  <a href="ganeti.serializer-module.html" title="ganeti.serializer">serializer</a>,
  <a href="ganeti.hypervisor-module.html" title="ganeti.hypervisor">hypervisor</a>,
  <a href="ganeti.storage.drbd-module.html" title="ganeti.storage.drbd">drbd</a>,
  <a href="ganeti.storage.filestorage-module.html" title="ganeti.storage.filestorage">filestorage</a>,
  <a href="ganeti.netutils-module.html" title="ganeti.netutils">netutils</a>,
  <a href="ganeti.luxi-module.html" title="ganeti.luxi">luxi</a>,
  <a href="ganeti.jstore-module.html" title="ganeti.jstore">jstore</a>,
  <a href="ganeti.pathutils-module.html" title="ganeti.pathutils">pathutils</a>
</p><br />
<!-- ==================== FUNCTION DETAILS ==================== -->
<a name="section-FunctionDetails"></a>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Function Details</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-FunctionDetails"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
</table>
<a name="_InitSSHSetup"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_InitSSHSetup</span>()</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.bootstrap-pysrc.html#_InitSSHSetup">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Setup the SSH configuration for the cluster.</p>
  <p>This generates a dsa keypair for root, adds the pub key to the 
  permitted hosts and adds the hostkey to its own known hosts.</p>
  <dl class="fields">
  </dl>
</td></tr></table>
</div>
<a name="GenerateHmacKey"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">GenerateHmacKey</span>(<span class="sig-arg">file_name</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.bootstrap-pysrc.html#GenerateHmacKey">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Writes a new HMAC key.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>file_name</code></strong> (str) - Path to output file</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="GenerateClusterCrypto"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">GenerateClusterCrypto</span>(<span class="sig-arg">new_cluster_cert</span>,
        <span class="sig-arg">new_rapi_cert</span>,
        <span class="sig-arg">new_spice_cert</span>,
        <span class="sig-arg">new_confd_hmac_key</span>,
        <span class="sig-arg">new_cds</span>,
        <span class="sig-arg">rapi_cert_pem</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">spice_cert_pem</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">spice_cacert_pem</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">cds</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">nodecert_file</span>=<span class="sig-default">pathutils.NODED_CERT_FILE</span>,
        <span class="sig-arg">rapicert_file</span>=<span class="sig-default">pathutils.RAPI_CERT_FILE</span>,
        <span class="sig-arg">spicecert_file</span>=<span class="sig-default">pathutils.SPICE_CERT_FILE</span>,
        <span class="sig-arg">spicecacert_file</span>=<span class="sig-default">pathutils.SPICE_CACERT_FILE</span>,
        <span class="sig-arg">hmackey_file</span>=<span class="sig-default">pathutils.CONFD_HMAC_KEY</span>,
        <span class="sig-arg">cds_file</span>=<span class="sig-default">pathutils.CLUSTER_DOMAIN_SECRET_FILE</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.bootstrap-pysrc.html#GenerateClusterCrypto">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Updates the cluster certificates, keys and secrets.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>new_cluster_cert</code></strong> (bool) - Whether to generate a new cluster certificate</li>
        <li><strong class="pname"><code>new_rapi_cert</code></strong> (bool) - Whether to generate a new RAPI certificate</li>
        <li><strong class="pname"><code>new_spice_cert</code></strong> (bool) - Whether to generate a new SPICE certificate</li>
        <li><strong class="pname"><code>new_confd_hmac_key</code></strong> (bool) - Whether to generate a new HMAC key</li>
        <li><strong class="pname"><code>new_cds</code></strong> (bool) - Whether to generate a new cluster domain secret</li>
        <li><strong class="pname"><code>rapi_cert_pem</code></strong> (string) - New RAPI certificate in PEM format</li>
        <li><strong class="pname"><code>spice_cert_pem</code></strong> (string) - New SPICE certificate in PEM format</li>
        <li><strong class="pname"><code>spice_cacert_pem</code></strong> (string) - Certificate of the CA that signed the SPICE certificate, in PEM 
          format</li>
        <li><strong class="pname"><code>cds</code></strong> (string) - New cluster domain secret</li>
        <li><strong class="pname"><code>nodecert_file</code></strong> (string) - optional override of the node cert file path</li>
        <li><strong class="pname"><code>rapicert_file</code></strong> (string) - optional override of the rapi cert file path</li>
        <li><strong class="pname"><code>spicecert_file</code></strong> (string) - optional override of the spice cert file path</li>
        <li><strong class="pname"><code>spicecacert_file</code></strong> (string) - optional override of the spice CA cert file path</li>
        <li><strong class="pname"><code>hmackey_file</code></strong> (string) - optional override of the hmac key file path</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="_InitGanetiServerSetup"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_InitGanetiServerSetup</span>(<span class="sig-arg">master_name</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.bootstrap-pysrc.html#_InitGanetiServerSetup">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Setup the necessary configuration for the initial node daemon.</p>
  <p>This creates the nodepass file containing the shared password for the 
  cluster, generates the SSL certificate and starts the node daemon.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>master_name</code></strong> (str) - Name of the master node</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="RunNodeSetupCmd"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">RunNodeSetupCmd</span>(<span class="sig-arg">cluster_name</span>,
        <span class="sig-arg">node</span>,
        <span class="sig-arg">basecmd</span>,
        <span class="sig-arg">debug</span>,
        <span class="sig-arg">verbose</span>,
        <span class="sig-arg">use_cluster_key</span>,
        <span class="sig-arg">ask_key</span>,
        <span class="sig-arg">strict_host_check</span>,
        <span class="sig-arg">data</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.bootstrap-pysrc.html#RunNodeSetupCmd">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Runs a command to configure something on a remote machine.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>cluster_name</code></strong> (string) - Cluster name</li>
        <li><strong class="pname"><code>node</code></strong> (string) - Node name</li>
        <li><strong class="pname"><code>basecmd</code></strong> (string) - Base command (path on the remote machine)</li>
        <li><strong class="pname"><code>debug</code></strong> (bool) - Enable debug output</li>
        <li><strong class="pname"><code>verbose</code></strong> (bool) - Enable verbose output</li>
        <li><strong class="pname"><code>use_cluster_key</code></strong> (bool) - See <a href="ganeti.ssh.SshRunner-class.html#BuildCmd" 
          class="link">ssh.SshRunner.BuildCmd</a></li>
        <li><strong class="pname"><code>ask_key</code></strong> (bool) - See <a href="ganeti.ssh.SshRunner-class.html#BuildCmd" 
          class="link">ssh.SshRunner.BuildCmd</a></li>
        <li><strong class="pname"><code>strict_host_check</code></strong> (bool) - See <a href="ganeti.ssh.SshRunner-class.html#BuildCmd" 
          class="link">ssh.SshRunner.BuildCmd</a></li>
        <li><strong class="pname"><code>data</code></strong> - JSON-serializable input data for script (passed to stdin)</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="_InitFileStorageDir"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_InitFileStorageDir</span>(<span class="sig-arg">file_storage_dir</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.bootstrap-pysrc.html#_InitFileStorageDir">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Initialize if needed the file storage.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>file_storage_dir</code></strong> - the user-supplied value</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>either empty string (if file storage was disabled at build time) 
          or the normalized path to the storage directory</dd>
  </dl>
</td></tr></table>
</div>
<a name="_PrepareFileBasedStorage"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_PrepareFileBasedStorage</span>(<span class="sig-arg">enabled_disk_templates</span>,
        <span class="sig-arg">file_storage_dir</span>,
        <span class="sig-arg">default_dir</span>,
        <span class="sig-arg">file_disk_template</span>,
        <span class="sig-arg">init_fn</span>=<span class="sig-default">_InitFileStorageDir</span>,
        <span class="sig-arg">acceptance_fn</span>=<span class="sig-default">None</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.bootstrap-pysrc.html#_PrepareFileBasedStorage">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Checks if a file-base storage type is enabled and inits the dir.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>enabled_disk_templates</code></strong> (list of string) - list of enabled disk templates</li>
        <li><strong class="pname"><code>file_storage_dir</code></strong> (string) - the file storage directory</li>
        <li><strong class="pname"><code>default_dir</code></strong> (string) - default file storage directory when <code>file_storage_dir</code>
          is 'None'</li>
        <li><strong class="pname"><code>file_disk_template</code></strong> (string) - a disk template whose storage type is 'ST_FILE'</li>
    </ul></dd>
    <dt>Returns: string</dt>
        <dd>the name of the actual file storage directory</dd>
  </dl>
</td></tr></table>
</div>
<a name="_PrepareFileStorage"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_PrepareFileStorage</span>(<span class="sig-arg">enabled_disk_templates</span>,
        <span class="sig-arg">file_storage_dir</span>,
        <span class="sig-arg">init_fn</span>=<span class="sig-default">_InitFileStorageDir</span>,
        <span class="sig-arg">acceptance_fn</span>=<span class="sig-default">None</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.bootstrap-pysrc.html#_PrepareFileStorage">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Checks if file storage is enabled and inits the dir.</p>
  <dl class="fields">
  </dl>
<div class="fields">      <p><strong>See Also:</strong>
        <code>_PrepareFileBasedStorage</code>
      </p>
</div></td></tr></table>
</div>
<a name="_PrepareSharedFileStorage"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_PrepareSharedFileStorage</span>(<span class="sig-arg">enabled_disk_templates</span>,
        <span class="sig-arg">file_storage_dir</span>,
        <span class="sig-arg">init_fn</span>=<span class="sig-default">_InitFileStorageDir</span>,
        <span class="sig-arg">acceptance_fn</span>=<span class="sig-default">None</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.bootstrap-pysrc.html#_PrepareSharedFileStorage">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Checks if shared file storage is enabled and inits the dir.</p>
  <dl class="fields">
  </dl>
<div class="fields">      <p><strong>See Also:</strong>
        <code>_PrepareFileBasedStorage</code>
      </p>
</div></td></tr></table>
</div>
<a name="_RestrictIpolicyToEnabledDiskTemplates"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_RestrictIpolicyToEnabledDiskTemplates</span>(<span class="sig-arg">ipolicy</span>,
        <span class="sig-arg">enabled_disk_templates</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.bootstrap-pysrc.html#_RestrictIpolicyToEnabledDiskTemplates">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Restricts the ipolicy's disk templates to the enabled ones.</p>
  <p>This function clears the ipolicy's list of allowed disk templates from
  the ones that are not enabled by the cluster.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>ipolicy</code></strong> (dict) - the instance policy</li>
        <li><strong class="pname"><code>enabled_disk_templates</code></strong> (list of string) - the list of cluster-wide enabled disk templates</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="InitCluster"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">InitCluster</span>(<span class="sig-arg">cluster_name</span>,
        <span class="sig-arg">mac_prefix</span>,
        <span class="sig-arg">master_netmask</span>,
        <span class="sig-arg">master_netdev</span>,
        <span class="sig-arg">file_storage_dir</span>,
        <span class="sig-arg">shared_file_storage_dir</span>,
        <span class="sig-arg">candidate_pool_size</span>,
        <span class="sig-arg">secondary_ip</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">vg_name</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">beparams</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">nicparams</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">ndparams</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">hvparams</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">diskparams</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">enabled_hypervisors</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">modify_etc_hosts</span>=<span class="sig-default">True</span>,
        <span class="sig-arg">modify_ssh_setup</span>=<span class="sig-default">True</span>,
        <span class="sig-arg">maintain_node_health</span>=<span class="sig-default">False</span>,
        <span class="sig-arg">drbd_helper</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">uid_pool</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">default_iallocator</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">primary_ip_version</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">ipolicy</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">prealloc_wipe_disks</span>=<span class="sig-default">False</span>,
        <span class="sig-arg">use_external_mip_script</span>=<span class="sig-default">False</span>,
        <span class="sig-arg">hv_state</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">disk_state</span>=<span class="sig-default">None</span>,
        <span class="sig-arg">enabled_disk_templates</span>=<span class="sig-default">None</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.bootstrap-pysrc.html#InitCluster">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Initialise the cluster.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>candidate_pool_size</code></strong> (int) - master candidate pool size</li>
        <li><strong class="pname"><code>enabled_disk_templates</code></strong> (list of string) - list of disk_templates to be used in this cluster</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="InitConfig"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">InitConfig</span>(<span class="sig-arg">version</span>,
        <span class="sig-arg">cluster_config</span>,
        <span class="sig-arg">master_node_config</span>,
        <span class="sig-arg">cfg_file</span>=<span class="sig-default">pathutils.CLUSTER_CONF_FILE</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.bootstrap-pysrc.html#InitConfig">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Create the initial cluster configuration.</p>
  <p>It will contain the current node, which will also be the master node, 
  and no instances.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>version</code></strong> (int) - configuration version</li>
        <li><strong class="pname"><code>cluster_config</code></strong> (<a href="ganeti.objects.Cluster-class.html" 
          class="link">objects.Cluster</a>) - cluster configuration</li>
        <li><strong class="pname"><code>master_node_config</code></strong> (<a href="ganeti.objects.Node-class.html" 
          class="link">objects.Node</a>) - master node configuration</li>
        <li><strong class="pname"><code>cfg_file</code></strong> (string) - configuration file path</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="FinalizeClusterDestroy"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">FinalizeClusterDestroy</span>(<span class="sig-arg">master_uuid</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.bootstrap-pysrc.html#FinalizeClusterDestroy">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Execute the last steps of cluster destroy</p>
  <p>This function shuts down all the daemons, completing the destroy begun
  in cmdlib.LUDestroyOpcode.</p>
  <dl class="fields">
  </dl>
</td></tr></table>
</div>
<a name="SetupNodeDaemon"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">SetupNodeDaemon</span>(<span class="sig-arg">opts</span>,
        <span class="sig-arg">cluster_name</span>,
        <span class="sig-arg">node</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.bootstrap-pysrc.html#SetupNodeDaemon">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Add a node to the cluster.</p>
  <p>This function must be called before the actual opcode, and will ssh to
  the remote node, copy the needed files, and start ganeti-noded, allowing 
  the master to do the rest via normal rpc calls.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>cluster_name</code></strong> - the cluster name</li>
        <li><strong class="pname"><code>node</code></strong> - the name of the new node</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="MasterFailover"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">MasterFailover</span>(<span class="sig-arg">no_voting</span>=<span class="sig-default">False</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.bootstrap-pysrc.html#MasterFailover">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Failover the master node.</p>
  <p>This checks that we are not already the master, and will cause the 
  current master to cease being master, and the non-master to become new 
  master.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>no_voting</code></strong> (boolean) - force the operation without remote nodes agreement (dangerous)</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="GetMaster"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">GetMaster</span>()</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.bootstrap-pysrc.html#GetMaster">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Returns the current master node.</p>
  <p>This is a separate function in bootstrap since it's needed by 
  gnt-cluster, and instead of importing directly ssconf, it's better to 
  abstract it in bootstrap, where we do use ssconf in other functions 
  too.</p>
  <dl class="fields">
  </dl>
</td></tr></table>
</div>
<a name="GatherMasterVotes"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">GatherMasterVotes</span>(<span class="sig-arg">node_names</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="ganeti.bootstrap-pysrc.html#GatherMasterVotes">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Check the agreement on who is the master.</p>
  <p>This function will return a list of (node, number of votes), ordered 
  by the number of votes. Errors will be denoted by the key 'None'.</p>
  <p>Note that the sum of votes is the number of nodes this machine knows, 
  whereas the number of entries in the list could be different (if some 
  nodes vote for another master).</p>
  <p>We remove ourselves from the list since we know that (bugs aside) 
  since we use the same source for configuration information for both 
  backend and boostrap, we'll always vote for ourselves.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>node_names</code></strong> (list) - the list of nodes to query for master info; the current node will
          be removed if it is in the list</li>
    </ul></dd>
    <dt>Returns: list</dt>
        <dd>list of (node, votes)</dd>
  </dl>
</td></tr></table>
</div>
<br />
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://code.google.com/p/ganeti/">Ganeti</a></th>
          </tr></table></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">
    Generated by Epydoc 3.0.1 on Wed Dec 30 13:42:33 2015
    </td>
    <td align="right" class="footer">
      <a target="mainFrame" href="http://epydoc.sourceforge.net"
        >http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie();
  // -->
</script>
</body>
</html>
